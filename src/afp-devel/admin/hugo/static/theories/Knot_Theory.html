<div id="Preliminaries">
<div class="head">
<h1>Theory Preliminaries</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Preliminaries: Definitions of tangles and links›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Preliminaries
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the definition of a link. A link is defined as link diagrams upto 
 equivalence moves. Link diagrams are defined in terms of the constituent tangles›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹each  block is a horizontal block built by putting basic link bricks next to each other.
(1) vert is the straight line
(2) cup is the up facing cup
(3) cap is the bottom facing 
(4) over is the positive cross
(5) under is the negative cross›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> brick <span class="main">=</span> vert
                <span class="main">|</span>cup
                <span class="main">|</span>cap
                <span class="main">|</span>over
                <span class="main">|</span>under
         
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹block is obtained by putting bricks next to each other›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> block <span class="main">=</span> <span class="quoted"><span class="quoted">"brick list"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹wall are link diagrams obtained by placing a horizontal blocks a top each other›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> wall <span class="main">=</span>  basic <span class="quoted">block</span>
                <span class="main">|</span>prod <span class="quoted">block</span>  <span class="quoted">wall</span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 66<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Concatenate gives us the block obtained by putting two blocks next to each other›</span></span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">concatenate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"block <span class="main">=&gt;</span> block <span class="main">=&gt;</span> block"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
concatenates_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="main">|</span>
concatenates_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main"><span class="free">⊗</span></span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main"><span class="free">⊗</span></span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> empty_concatenate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">⊗</span> Nil <span class="main">=</span> <span class="free">xs</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Associativity properties of Conscatenation›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> leftright_associativity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">)</span><span class="main">⊗</span><span class="free">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">⊗</span><span class="main">(</span><span class="free">y</span><span class="main">⊗</span><span class="free">z</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> left_associativity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">)</span><span class="main">⊗</span><span class="free">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">⊗</span><span class="free">z</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> right_associativity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⊗</span><span class="main">(</span><span class="free">y</span><span class="main">⊗</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">⊗</span><span class="free">z</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Compose gives us the wall obtained by putting a wall above another, perhaps in an invalid way.
›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">compose</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"wall <span class="main">=&gt;</span> wall <span class="main">=&gt;</span> wall"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∘</span>"</span> 66<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
compose_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">∘</span></span>  <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> prod <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="main">|</span>
compose_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>prod <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main"><span class="free">∘</span></span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> prod <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main"><span class="free">∘</span></span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Associativity properties of composition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> compose_leftassociativity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>wall<span class="main">)</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">∘</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">∘</span><span class="free">y</span> <span class="main">∘</span><span class="free">z</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> compose_rightassociativity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>wall<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="free">y</span> <span class="main">∘</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">∘</span><span class="free">y</span> <span class="main">∘</span><span class="free">z</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹block-length of a block is the number of bricks in a given block›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">block_length</span><span class="main">::</span><span class="quoted"><span class="quoted">"block <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">block_length</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">block_length</span> <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">block_length</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>



<span class="comment1">(*domain tells us the number of incoming strands*)</span>
 <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">domain</span><span class="main">::</span><span class="quoted"><span class="quoted">"brick <span class="main">⇒</span> int"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">domain</span> vert <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">domain</span> cup <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">domain</span> cap <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">domain</span> over <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">domain</span> under <span class="main">=</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_non_negative<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span>domain <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="bound">x</span> <span class="main">=</span> vert<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span> <span class="main">=</span> over<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span>under<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span>cap<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span>cup<span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> brick.exhaust<span class="main">)</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">=</span> vert<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span> <span class="main">=</span> over<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span>under<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span>cap<span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span>cup<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>domain <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> domain.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_refl zero_le_numeral zero_le_one<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>   
   
<span class="comment1">(*co-domain tells us the number of outgoing strands*)</span>
 <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">codomain</span><span class="main">::</span><span class="quoted"><span class="quoted">"brick <span class="main">⇒</span> int"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">codomain</span> vert <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">codomain</span> cup <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">codomain</span> cap <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">codomain</span> over <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">codomain</span> under <span class="main">=</span> <span class="numeral">2</span>"</span></span>

<span class="comment1">(*domain-block tells us the number of incoming strands of a block*)</span>
 <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">domain_block</span><span class="main">::</span><span class="quoted"><span class="quoted">"block <span class="main">⇒</span> int "</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">domain_block</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">domain_block</span> <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="free">domain_block</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_block_non_negative<span class="main">:</span><span class="quoted"><span class="quoted">"domain_block <span class="free">xs</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>domain_non_negative<span class="main">)</span>


<span class="comment1">(*codomain-block tells us the number of outgoing strands of a block*)</span>

 <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">codomain_block</span><span class="main">::</span><span class="quoted"><span class="quoted">"block <span class="main">⇒</span> int "</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">codomain_block</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">codomain_block</span> <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>codomain <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="free">codomain_block</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="comment1">(*domain-wall tells us the number of incoming strands of a wall*)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">domain_wall</span><span class="main">::</span> <span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">domain_wall</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> domain_block <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>                                               
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">domain_wall</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> domain_block <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="comment1">(*domain-wall tells us the number of incoming strands of a wall*)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">codomain_wall</span><span class="main">::</span> <span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">codomain_wall</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>                      
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">codomain_wall</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">codomain_wall</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> domain_wall_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span><span class="main">∘</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> codomain_wall_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="free">xs</span><span class="main">∘</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="free">ys</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹this lemma tells us the number of incoming and outgoing strands
of a composition of two wall›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹absolute value›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">abs</span><span class="main">::</span><span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">abs</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≥</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹theorems about abs›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> abs_zero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> abs_def assms eq_iff_diff_eq_0
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_zero_equality<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> assms abs_zero  eq_iff_diff_eq_0 
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_non_negative<span class="main">:</span> <span class="quoted"><span class="quoted">" abs <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> abs_def diff_0 le_cases neg_0_le_iff_le 
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> abs_non_negative_sum<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" abs <span class="free">x</span> <span class="main">+</span> abs <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">x</span><span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> abs_def diff_0 abs_non_negative  neg_0_le_iff_le 
 add_nonneg_eq_0_iff assms
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_non_negative add_nonneg_eq_0_iff assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas tell us that the number of incoming and outgoing strands of every brick 
is a non negative integer›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_nonnegative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> domain.simps  brick.exhaust le_cases not_numeral_le_zero zero_le_one <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> codomain_nonnegative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas tell us that the number of incoming and outgoing strands of every block 
is a non negative integer›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_block_nonnegative<span class="main">:</span> <span class="quoted"><span class="quoted">"domain_block <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domain_nonnegative<span class="main">)</span> 


<span class="keyword1"><span class="command">lemma</span></span> codomain_block_nonnegative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> codomain_nonnegative<span class="main">)</span> 



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas tell us that if a block is appended to a block with incoming strands, then
the resultant block has incoming strands›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_positive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">#</span>Nil<span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>domain_block <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> 
<span class="main">⟹</span> <span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>domain <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>domain_block <span class="free">y</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>domain <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">#</span>Nil<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">#</span>Nil<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>domain <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>domain_block <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>domain <span class="free">x</span> <span class="main">+</span> domain_block <span class="free">y</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_nonnegative add_nonneg_pos add_pos_nonneg domain_block_nonnegative 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
 <span class="keyword1"><span class="command">from</span></span> this  
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>domain_block<span class="main">(</span><span class="free">x</span><span class="main">#</span>Nil<span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>domain_block <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> 
                                        <span class="main">⟹</span> <span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> domain_additive<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>domain_block <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>domain_block <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> codomain_additive<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="main">(</span><span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> domain_zero_sum<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_block <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>domain_block <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> domain_block_nonnegative add_nonneg_eq_0_iff assms
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_nonneg_eq_0_iff assms domain_block_nonnegative<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> domain_block_positive<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="free">or</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_block <span class="main">(</span><span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domain_additive<span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> domain_additive domain_block_nonnegative domain_zero_sum<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> codomain_block_positive<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="free">or</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="main">(</span><span class="free">x</span><span class="main">⊗</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> codomain_additive<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>1<span class="main">)</span> codomain_additive codomain_block_nonnegative eq_neg_iff_add_eq_0 
        le_less_trans less_le neg_less_0_iff_less
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We prove that if the first count of a block is zero, then it is composed of cups and empty bricks. In
order to do that we define the functions brick-is-cup and is-cup which check if a given block is 
composed of cups or if the blocks are composed of blocks›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">brick_is_cup</span><span class="main">::</span><span class="quoted"><span class="quoted">"brick <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">brick_is_cup</span> vert <span class="main">=</span> False"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">brick_is_cup</span> cup <span class="main">=</span> True"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">brick_is_cup</span> cap <span class="main">=</span> False"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">brick_is_cup</span> over <span class="main">=</span> False"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">brick_is_cup</span> under <span class="main">=</span> False"</span></span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">is_cup</span><span class="main">::</span><span class="quoted"><span class="quoted">"block <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_cup</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_cup</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span> cup<span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">is_cup</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> brickcount_zero_implies_cup<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain <span class="free">x</span><span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> cup<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> brickcount_zero_implies_brick_is_cup<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain <span class="free">x</span><span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>brick_is_cup <span class="free">x</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  


<span class="keyword1"><span class="command">lemma</span></span> domain_zero_implies_is_cup<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_block <span class="free">x</span><span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>is_cup <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>domain <span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>domain_block <span class="skolem">y</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> domain_zero_sum <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"domain_block <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Cons.prems domain_block_nonnegative domain_positive leD neq_iff<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_cup <span class="skolem">y</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
   <span class="keyword1"><span class="command">with</span></span> step1 <span class="keyword2"><span class="keyword">and</span></span> domain_zero_sum  
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain <span class="skolem">a</span><span class="main">=</span> <span class="main">0</span>"</span></span> 
                       <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="quoted"><span class="quoted">‹domain_block <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"brick_is_cup <span class="skolem">a</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> brickcount_zero_implies_brick_is_cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span>cup"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> brick_is_cup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹domain <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span> brickcount_zero_implies_cup<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> step2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_cup <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">y</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> is_cup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We need a function that checks if a wall represents a knot diagram.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">is_tangle_diagram</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span>  bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_tangle_diagram</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_tangle_diagram</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">is_tangle_diagram</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
                               <span class="keyword1">then</span> <span class="main">(</span>codomain_block <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> domain_wall <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> 
                               <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_link_diagram</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span>  bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_link_diagram</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> 
                        <span class="keyword1">then</span> <span class="main">(</span>abs <span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> abs<span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
                         <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tangles">
<div class="head">
<h1>Theory Tangles</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tangles: Definition as a type and basic functions on tangles›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Tangles 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Preliminaries.html">Preliminaries</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* Time to split the file: Links and Tangles in another file*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹well-defined wall as a type called diagram. The morphisms Abs\_diagram maps a well defined wall to 
its diagram type and Rep\_diagram maps the diagram back to the wall›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> Tangle_Diagram <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>wall<span class="main">)</span><span class="main">.</span> is_tangle_diagram <span class="bound">x</span><span class="main">}</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 
<span class="keyword1"><span class="command">typedef</span></span> Link_Diagram <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>wall<span class="main">)</span><span class="main">.</span> is_link_diagram <span class="bound">x</span><span class="main">}</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> 
 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_link_diagram_def abs_def<span class="main">)</span>
 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next few lemmas list the properties of well defined diagrams›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For a well defined diagram, the morphism Rep\_diagram acts as an inverse of Abs\_diagram 
the morphism which maps a well defined wall to its representative in the type diagram›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Abs_Rep_well_defined<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="free">x</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Rep_Tangle_Diagram <span class="main">(</span>Abs_Tangle_Diagram <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> Rep_Tangle_Diagram Abs_Tangle_Diagram_inverse assms mem_Collect_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The map Abs\_diagram is injective›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_well_defined<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">x</span>"</span></span>  
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs_Tangle_Diagram <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Abs_Tangle_Diagram <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> Rep_Tangle_Diagram Abs_Tangle_Diagram_inverse assms mem_Collect_eq  
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹restating the property of well-defined wall in terms of diagram›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In order to locally defined moves, it helps to prove that if composition of two wall is a 
well defined wall then the number of outgoing strands of the wall below are equal to the number of 
incoming strands of the wall above. The following lemmas prove that for a well defined wall, t
he number of incoming and outgoing strands are zero›</span></span>


<span class="comment1">(*is-tangle-compose*)</span>
<span class="keyword1"><span class="command">lemma</span></span> is_tangle_left_compose<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> is_tangle_diagram <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">zs</span><span class="main">)</span><span class="main">∘</span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="main">(</span><span class="skolem">zs</span><span class="main">∘</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="skolem">zs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> prod.hyps prod.prems  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="skolem">zs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> domain_wall_def domain_wall_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="skolem">zs</span> <span class="main">=</span> codomain_block <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">zs</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_tangle_right_compose<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> is_tangle_diagram <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span> <span class="main">∘</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> basic  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> basic.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span><span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> prod.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*tangle diagrams using composition*)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_of_tangle_dgms<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>is_tangle_diagram <span class="free">x</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>codomain_wall <span class="free">x</span> <span class="main">=</span> domain_wall <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">⟹</span> is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">z</span> <span class="main">=</span> codomain_wall <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_wall_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span><span class="main">∘</span><span class="free">y</span><span class="main">=</span> <span class="skolem">z</span><span class="main">*</span><span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> compose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">z</span> <span class="main">=</span> domain_wall <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> basic.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">zs</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">z</span> <span class="main">=</span> domain_wall <span class="skolem">zs</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> prod.prems  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">z</span> <span class="main">=</span> domain_wall <span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_wall.simps domain_wall_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> prod.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> codomain_wall.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="main">(</span><span class="skolem">zs</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">unfolding</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> composition_of_tangle_diagrams<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">x</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_wall <span class="free">y</span> <span class="main">=</span> codomain_wall <span class="free">x</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> comp_of_tangle_dgms <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    

<span class="keyword1"><span class="command">lemma</span></span> converse_composition_of_tangle_diagrams<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>domain_wall <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>codomain_wall <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span> <span class="main">∘</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> compose_def basic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> 
              <span class="main">(</span>is_tangle_diagram <span class="free">y</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>codomain_block <span class="skolem">z</span> <span class="main">=</span> domain_wall <span class="free">y</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_wall <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> basic.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain_wall_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_wall <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="skolem">zs</span> <span class="main">=</span> domain_wall <span class="free">y</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> prod.hyps prod.prems 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_Nil compose_leftassociativity is_tangle_right_compose<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="skolem">zs</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">zs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_wall_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*defining compose for diagrams*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compose_Tangle</span><span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram"</span></span> 
                                                                     <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘</span>"</span> 65<span class="main">)</span>
 <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">compose_Tangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Abs_Tangle_Diagram 
                                  <span class="main">(</span><span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> well_defined_compose<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">x</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">x</span> <span class="main">=</span> codomain_wall <span class="free">y</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs_Tangle_Diagram <span class="free">x</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>Abs_Tangle_Diagram <span class="free">y</span><span class="main">)</span> 
                          <span class="main">=</span> <span class="main">(</span>Abs_Tangle_Diagram <span class="main">(</span><span class="free">x</span> <span class="main">∘</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span>  Abs_Tangle_Diagram_inverse assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> compose_Tangle_def 
        mem_Collect_eq 
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*defining domain and co-domain of tangles*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">domain_Tangle</span><span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> int"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">domain_Tangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> domain_wall<span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">codomain_Tangle</span><span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> int"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">codomain_Tangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> codomain_wall<span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tangle_Algebra">
<div class="head">
<h1>Theory Tangle_Algebra</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tangle\_Algebra: Tensor product of tangles and its properties›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Tangle_Algebra
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Tangles.html">Tangles</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Definition of tensor product of walls›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹the following definition is used to construct a block of n vert strands›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">make_vert_block</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> block"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">make_vert_block</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">make_vert_block</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> vert<span class="main">#</span><span class="main">(</span><span class="free">make_vert_block</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> domain_make_vert<span class="main">:</span><span class="quoted"><span class="quoted">"domain_block <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span> <span class="main">=</span> int <span class="free">n</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> codomain_make_vert<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span> <span class="main">=</span> int <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

  
<span class="comment1">(*we defined the tensor of wall as described in the standard tangle algebra*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tensor</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">=&gt;</span> wall <span class="main">=&gt;</span> wall"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tensor</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tensor</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
                  <span class="keyword1">if</span> <span class="main">(</span>codomain_block <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                  <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> 
                   <span class="keyword1">else</span> 
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
                     <span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main"><span class="free">⊗</span></span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tensor</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
                  <span class="keyword1">if</span> <span class="main">(</span>codomain_block <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
                   <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> 
                   <span class="keyword1">else</span> 
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
                    <span class="main">*</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tensor</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Properties of tensor product of tangles›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_left_tensor<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>empty_concatenate<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Nil_right_tensor<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definition of tensors is extended to diagrams by using the 
following function›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tensor_Tangle</span> <span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tensor_Tangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Abs_Tangle_Diagram <span class="main">(</span><span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="comment1">(*some lemmas*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"tensor <span class="main">(</span>basic <span class="main">[</span>vert<span class="main">]</span><span class="main">)</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹domain\_wall of a tensor product of two walls is the sum of 
the domain\_wall of each of the tensor
 products›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tensor_domain_wall_additivity<span class="main">:</span>
 <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
 <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> basic <span class="skolem">x</span>"</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
   <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> basic <span class="skolem">y</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="skolem">x</span> <span class="main">+</span> domain_block <span class="skolem">y</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>1<span class="main">)</span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs</span> 
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>  
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span><span class="main">*</span><span class="skolem">zs</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> A C tensor.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">ys</span> <span class="main">=</span> domain_block <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">xs</span> <span class="main">=</span> domain_block <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="skolem">x</span> <span class="main">+</span> domain_block <span class="skolem">z</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>  
                 <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span>
                    <span class="main">*</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⊗</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>3<span class="main">)</span> A C <span class="quoted"><span class="quoted">‹codomain_block <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">ys</span> <span class="main">=</span> domain_block <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">xs</span> <span class="main">=</span> domain_block <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="skolem">x</span> <span class="main">+</span> domain_block <span class="skolem">z</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">zs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> basic <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">zs</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>2<span class="main">)</span>  D E <span class="quoted"><span class="quoted">‹codomain_block <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">xs</span> <span class="main">=</span> domain_block <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">ys</span> <span class="main">=</span> domain_block <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def E <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="skolem">z</span> <span class="main">+</span> domain_block <span class="skolem">y</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> 
               <span class="main">=</span> 
                <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>
                  <span class="main">*</span><span class="main">(</span><span class="skolem">zs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>3<span class="main">)</span> D E <span class="quoted"><span class="quoted">‹codomain_block <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">ys</span> <span class="main">=</span> domain_block <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def E <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">xs</span> <span class="main">=</span> domain_block <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="skolem">z</span> <span class="main">+</span> domain_block <span class="skolem">y</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">ws</span>
   <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span>"</span></span>  
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">⊗</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> D F <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">ys</span> <span class="main">=</span> domain_block <span class="skolem">w</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def F <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">xs</span> <span class="main">=</span> domain_block <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span><span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> domain_block <span class="skolem">z</span> <span class="main">+</span> domain_block <span class="skolem">w</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹codomain of tensor of two walls is the sum of the respective
codomain's is shown by the following theorem›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tensor_codomain_wall_additivity<span class="main">:</span>
 <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="free">xs</span> <span class="main">+</span> codomain_wall <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tensor.induct<span class="main">)</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_wall <span class="main">(</span><span class="main">(</span>basic <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">+</span> <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps codomain_block.simps tensor.simps
                     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> codomain_additive<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span>
 <span class="keyword3"><span class="command">assume</span></span> case_2<span class="main">:</span>
         <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span> 
           <span class="main">⟹</span> codomain_wall 
                <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> codomain_wall <span class="skolem">xs</span> 
                     <span class="main">+</span> codomain_wall 
                          <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span><span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span>codomain_wall <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span><span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">xs</span> "</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"Tangle_Algebra.2"</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span><span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span> codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="skolem">xs</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="skolem">xs</span> <span class="main">+</span> codomain_wall <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True codomain_wall.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>
                     <span class="main">*</span><span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"Tangle_Algebra.2"</span><span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> codomain_wall<span class="main">(</span><span class="main">...</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> 
                  <span class="main">=</span> codomain_wall 
                      <span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> domain_wall.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> 
                  <span class="main">=</span> codomain_wall <span class="skolem">xs</span> 
                     <span class="main">+</span> codomain_wall 
                          <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> case_2 False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>
                       <span class="main">+</span> codomain_block <span class="skolem">y</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps 
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> codomain_block_nonnegative   codomain_make_vert int_nat_eq<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> codomain_wall <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span> case_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
        codomain_wall 
             <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>
            <span class="main">=</span> codomain_wall 
               <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">+</span> codomain_wall <span class="skolem">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> codomain_wall <span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> codomain_wall <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">ys</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">...</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="main">...</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="skolem">ys</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="skolem">ys</span> <span class="main">+</span> codomain_wall <span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps<span class="main">(</span>1<span class="main">)</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>
                    <span class="main">*</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">...</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="main">...</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> 
                 <span class="main">=</span> codomain_wall 
                     <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_block <span class="skolem">x</span> <span class="main">+</span> codomain_wall <span class="skolem">ys</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps case_3 False
                      codomain_block_nonnegative codomain_make_vert int_nat_eq
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> codomain_wall <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹basic <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹codomain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="skolem">x</span> <span class="main">+</span> codomain_wall <span class="skolem">ys</span>›</span></span><span class="main">)</span>   
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span>
    <span class="keyword3"><span class="command">assume</span></span> case_4<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="skolem">xs</span> <span class="main">+</span> codomain_wall <span class="skolem">ys</span> "</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> codomain_wall <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">...</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="main">...</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="skolem">xs</span> <span class="main">+</span> codomain_wall <span class="skolem">ys</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> case_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>codomain_wall <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> codomain_wall.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹codomain_wall <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> codomain_wall <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> case_4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*the following theorem tells us that 
given a tensor product of a tangle diagram with a block consisting of 
only vertical strands, it gives a tangle diagram*)</span>

<span class="keyword1"><span class="command">theorem</span></span> is_tangle_make_vert_right<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="free">xs</span><span class="main">)</span> 
          <span class="main">⟹</span> is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
     <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> codomain_block<span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  codomain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="skolem">xs</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation prod.prems<span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted">"0"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> codomain_make_vert  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> make_vert_block.simps codomain_wall.simps  Suc_eq_plus1 
       codomain_make_vert of_nat_0_less_iff zero_less_Suc
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">=</span>  <span class="main">(</span><span class="skolem">x</span><span class="main">⊗</span><span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> domain_wall <span class="skolem">xs</span> <span class="main">+</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> tensor_domain_wall_additivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="main">(</span>domain_wall <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> domain_make_vert domain_wall.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> codomain_block <span class="skolem">x</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span>  codomain_additive codomain_make_vert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="skolem">x</span> <span class="main">=</span> domain_wall <span class="skolem">xs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">from</span></span> 2 3 4 <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> codomain_block <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">xs</span><span class="main">⊗</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prod.hyps prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc Suc_eq_plus1 is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  Suc Suc_eq_plus1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*the following theorem tells us that given a tensor product of a vertical strand block with a 
tangle diagram, it gives a tangle diagram. If the above result can be treated as right product, 
this can be treated as the left product*)</span>

<span class="keyword1"><span class="command">theorem</span></span> is_tangle_make_vert_left<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span> <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>codomain_block <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> codomain_block<span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  codomain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span> <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="skolem">xs</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span> <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation prod.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted">"0"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> codomain_make_vert  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> make_vert_block.simps codomain_wall.simps  Suc_eq_plus1 
              codomain_make_vert of_nat_0_less_iff zero_less_Suc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>
             <span class="main">=</span>  <span class="main">(</span><span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">xs</span><span class="main">)</span> 
                 <span class="main">=</span> domain_wall <span class="skolem">xs</span> <span class="main">+</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tensor_domain_wall_additivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">xs</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="main">(</span>domain_wall <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> domain_make_vert domain_wall.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span> <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span> 
                 <span class="main">=</span> codomain_block <span class="skolem">x</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span>  codomain_additive codomain_make_vert
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> codomain_additive<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="skolem">x</span> <span class="main">=</span> domain_wall <span class="skolem">xs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> 2 3 4 <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">xs</span><span class="main">)</span> 
               <span class="main">=</span> codomain_block <span class="main">(</span><span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prod.hyps prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc Suc_eq_plus1 is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  Suc Suc_eq_plus1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(*We prove that tensor product of two tangle diagrams is a tangle diagram . 
The following lemmas are used in the process of proving each of the 
inductive cases*)</span>
<span class="keyword1"><span class="command">lemma</span></span> simp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
       is_tangle_diagram <span class="main">(</span><span class="free">xs</span><span class="main">)</span> 
<span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
               is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span>  <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">⊗</span> basic <span class="free">y</span><span class="main">)</span><span class="main">)</span>
"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
 <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> 
     <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span><span class="free">xs</span><span class="main">)</span> 
     <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span>
       is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span>  <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> is_tangle_diagram <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>is_tangle_diagram <span class="free">xs</span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟹</span>     
       is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span>
       is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="free">y</span> <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> codomain_block_nonnegative domain_make_vert domain_wall.simps<span class="main">(</span>1<span class="main">)</span> int_nat_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span>
                 codomain_block <span class="free">x</span> <span class="main">=</span> domain_wall <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="free">x</span> <span class="main">+</span>codomain_block <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> codomain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">=</span> domain_wall <span class="free">xs</span> <span class="main">+</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tensor_domain_wall_additivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span>
          domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span> codomain_block <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> <span class="quoted">"2"</span> calculation<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="free">xs</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⟹</span> 
         is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span>
         is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
       is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span>
               is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"Tangle_Algebra.2"</span> <span class="quoted"><span class="quoted">‹
        codomain_block <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> is_tangle_make_vert_right<span class="main">)</span>           
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> simp2<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> 
 <span class="main">⟹</span>
   is_tangle_diagram  <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
 <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">ys</span><span class="main">)</span>
    <span class="main">⟶</span>
      is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> 
     <span class="main">⟹</span>
    <span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> 
   <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> 
         <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
 <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_tangle_diagram  <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span>
              is_tangle_diagram 
                            <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> 
                                               <span class="main">⟶</span> is_tangle_diagram <span class="free">ys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram 
                          <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>is_tangle_diagram <span class="free">ys</span><span class="main">)</span>
               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span>     
     is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span>
                is_tangle_diagram 
                        <span class="main">(</span><span class="main">(</span> basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="free">x</span> 
                         <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> codomain_block_nonnegative domain_make_vert domain_wall.simps<span class="main">(</span>1<span class="main">)</span> 
              int_nat_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span>
                 codomain_block <span class="free">y</span> <span class="main">=</span> domain_wall <span class="free">ys</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> codomain_block <span class="free">x</span> <span class="main">+</span>codomain_block <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> codomain_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>
                 <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">+</span> domain_wall <span class="free">ys</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tensor_domain_wall_additivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span>
          domain_wall <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>
                   <span class="main">=</span> codomain_block <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> <span class="quoted">"2"</span> calculation<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="free">ys</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>
         <span class="main">⟹</span>
          is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> 
          <span class="main">⟶</span>
          is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
       is_tangle_diagram <span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span>
               is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="free">x</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"Tangle_Algebra.3"</span> A B<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> simp3<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">xs</span> <span class="main">∧</span> is_tangle_diagram <span class="free">ys</span> <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span> 
 <span class="main">⟹</span>
     is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">ys</span><span class="main">)</span> 
     <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">*</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">xs</span> <span class="main">∧</span> is_tangle_diagram <span class="free">ys</span> <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>codomain_block <span class="free">x</span> <span class="main">=</span> domain_wall <span class="free">xs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>codomain_block <span class="free">y</span> <span class="main">=</span> domain_wall <span class="free">ys</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span><span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span>
              <span class="main">⟶</span> codomain_block <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> codomain_additive tensor_domain_wall_additivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span><span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span>
              <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">xs</span> <span class="main">⊗</span> <span class="free">ys</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span><span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span>
              <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*tensor product of two tangle diagrams is a tangle diagram*)</span>

<span class="keyword1"><span class="command">theorem</span></span> is_tangle_diagramness<span class="main">:</span>
 <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="free">x</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span>is_tangle_diagram <span class="main">(</span>tensor <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tensor.induct<span class="main">)</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">w</span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⟶</span>is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="skolem">z</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⟶</span>is_tangle_diagram <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> simp1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"Tangle_Algebra.2"</span> add.commute codomain_additive comm_monoid_add_class.add_0 
                is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_tangle_make_vert_right<span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span> 
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">ys</span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⟶</span>is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="skolem">x</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> simp2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"Tangle_Algebra.3"</span> codomain_additive comm_monoid_add_class.add_0 
                   is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_tangle_make_vert_left<span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
 <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"  is_tangle_diagram <span class="skolem">xs</span> <span class="main">∧</span> is_tangle_diagram <span class="skolem">ys</span> <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span>    
    <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⟶</span> is_tangle_diagram <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">xs</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> simp3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">theorem</span></span> tensor_preserves_is_tangle<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">x</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  is_tangle_diagramness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Tensor_Tangle</span><span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram"</span></span> 
          <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘</span>"</span> 65<span class="main">)</span>
 <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Tensor_Tangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> 
     Abs_Tangle_Diagram <span class="main">(</span><span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">theorem</span></span> well_defined_compose<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">x</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">y</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs_Tangle_Diagram <span class="free">x</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>Abs_Tangle_Diagram <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Abs_Tangle_Diagram <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span>  Abs_Tangle_Diagram_inverse assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> 
      mem_Collect_eq tensor_preserves_is_tangle
     tensor_Tangle_def 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tangle_Relation">
<div class="head">
<h1>Theory Tangle_Relation</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Tangle_Relation
<span class="keyword2"><span class="keyword">imports</span></span>  <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">lemma</span></span> symmetry1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symp <span class="free">R</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟶</span>  <span class="free">R</span> <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms sympD<span class="main">)</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms mem_Collect_eq split_conv sympE<span class="main">)</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>rtrancl <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sym_rtrancl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> symE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> symmetry2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> "</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symp <span class="free">R</span><span class="main">^**</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> symp_def Enum.rtranclp_rtrancl_eq assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetry3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symp <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symp <span class="free">R</span><span class="main">^**</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms symmetry1 symmetry2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> symm_trans<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symp <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symp <span class="free">R</span><span class="main">^++</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rtranclpD symmetry3 symp_def tranclp_into_rtranclp<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tangle_Moves">
<div class="head">
<h1>Theory Tangle_Moves</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tangle\_Moves: Defining moves on tangles›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tangle_Moves
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Tangles.html">Tangles</a> <a href="Tangle_Algebra.html">Tangle_Algebra</a> <a href="Tangle_Relation.html">Tangle_Relation</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Two Links diagrams represent the same link if and only if the diagrams can be related by a 
set of moves called the reidemeister moves. For links defined through Tangles, addition set of moves 
are needed to account for different tangle representations of the same link diagram.

We formalise these 'moves' in terms of relations. Each move is defined as a relation on diagrams. 
Two diagrams are then stated to be equivalent if the reflexive-symmetric-transitive closure of the 
disjunction of above relations holds true. A Link is defined as an element of the quotient type of
diagrams modulo equivalence relations. We formalise the definition of framed links on similar lines. 

In terms of formalising the moves, there is a trade off between choosing a small number of moves
from which all other moves can be obtained, which is conducive to probe invariance of a function 
on diagrams. However, such an approach might not be conducive to establish equivalence of two 
diagrams. We opt for the former approach of minimising the number of tangle moves. 
However, the moves that would be useful in practise are proved as theorems in
›</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> relation <span class="main">=</span> <span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Link uncross›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">right_over</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">right_over</span> <span class="main">≡</span>   <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>over<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">left_over</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">" <span class="free">left_over</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
<span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">right_under</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">right_under</span> <span class="main">≡</span>   <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>under<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
<span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">left_under</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">" <span class="free">left_under</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
<span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">straight_line</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">straight_line</span> <span class="main">≡</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uncross_positive_flip</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">uncross_positive_flip</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> right_over<span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>  left_over<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uncross_positive_straighten</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">uncross_positive_straighten</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> right_over<span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> straight_line<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uncross_negative_flip</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">uncross_negative_flip</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> right_under<span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>  left_under<span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uncross_negative_straighten</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">uncross_negative_straighten</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> left_under<span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> straight_line<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*The relation uncross*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uncross</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">uncross</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>uncross_positive_straighten <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>uncross_positive_flip <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
                <span class="main">∨</span><span class="main">(</span>uncross_negative_straighten <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">∨</span> <span class="main">(</span>uncross_negative_flip <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹swing begins›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">r_over_braid</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">r_over_braid</span>  <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>over<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>over<span class="main">#</span> vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">l_over_braid</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">l_over_braid</span>  <span class="main">≡</span>   <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>over<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">r_under_braid</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">r_under_braid</span>  <span class="main">≡</span>   <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>under<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>under<span class="main">#</span> vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">l_under_braid</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">l_under_braid</span>  <span class="main">≡</span>   <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>under<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">swing_pos</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">swing_pos</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> r_over_braid<span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> l_over_braid<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">swing_neg</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">swing_neg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> r_under_braid<span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span>l_under_braid<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">swing</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">swing</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span>swing_pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>swing_neg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹pull begins›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pull_posneg</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pull_posneg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic  <span class="main">(</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pull_negpos</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pull_negpos</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic  <span class="main">(</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹pull definition›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pull</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pull</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>pull_posneg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>pull_negpos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>                   

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹linkrel-pull ends›</span></span>    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹linkrel-straighten›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">straighten_topdown</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">straighten_topdown</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">straighten_downtop</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">straighten_downtop</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>cup<span class="main">#</span> vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span> cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>




<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹definition straighten›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">straighten</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">straighten</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>straighten_topdown <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>straighten_downtop <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹straighten ends›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹rotate moves›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rotate_toppos</span><span class="main">::</span><span class="quoted">relation</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rotate_toppos</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert <span class="main">#</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>cap<span class="main">#</span> vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>under<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rotate_topneg</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rotate_topneg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert <span class="main">#</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>cap<span class="main">#</span> vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>over<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rotate_downpos</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rotate_downpos</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>under<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rotate_downneg</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rotate_downneg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>under<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>vert<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>over<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹rotate definition›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rotate</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rotate</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>rotate_toppos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>rotate_topneg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
<span class="main">∨</span> <span class="main">(</span>rotate_downpos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>rotate_downneg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹rotate ends›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Compress -  Compress has two levels of equivalences. It is a composition of Compress-null, compbelow
and compabove. compbelow and compabove are further written as disjunction of many other relations.
Compbelow refers to when the bottom row is extended or compressed. Compabove refers to when the 
row above is extended or compressed›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compress_top1</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">compress_top1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="bound">B</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="bound">B</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>codomain_wall <span class="bound">B</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compress_bottom1</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">compress_bottom1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>  <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>domain_wall <span class="bound">B</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="bound">B</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compress_bottom</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">compress_bottom</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>   <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">∘</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>domain_wall <span class="bound">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compress_top</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">compress_top</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="bound">B</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="bound">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>codomain_wall <span class="bound">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="comment1">(*compress*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compress</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">compress</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>compress_top <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>compress_bottom <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*(compress_top1 x y) ∨ (compress_bottom1 x y))*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹slide relation refer to the relation where a crossing is slided over a vertical strand›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slide</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">slide</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_block <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="bound">B</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">(</span>domain_block <span class="bound">B</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*can integrate slide and compress using domain-codomain fundas.
ALSO check for domain and codomain in the above equations*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹linkrel-definition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">linkrel</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">=&gt;</span>wall <span class="main">⇒</span>bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">linkrel</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>uncross <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>pull <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>straighten <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> 
<span class="main">∨</span><span class="main">(</span>swing <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>rotate <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>compress <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>slide <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">framed_uncross</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">framed_uncross</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>uncross_positive_flip <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>uncross_negative_flip <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">framed_linkrel</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">=&gt;</span>wall <span class="main">⇒</span>bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">framed_linkrel</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>framed_uncross <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>pull <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>straighten <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> 
<span class="main">∨</span><span class="main">(</span>swing <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>rotate <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>compress <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>slide <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">lemma</span></span> framed_uncross_implies_uncross<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>framed_uncross <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">⟹</span><span class="main">(</span>uncross <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> framed_uncross_def uncross_def<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Link_Algebra">
<div class="head">
<h1>Theory Link_Algebra</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Link\_Algebra: Defining equivalence of tangles and links›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Link_Algebra
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Tangles.html">Tangles</a> <a href="Tangle_Algebra.html">Tangle_Algebra</a> <a href="Tangle_Moves.html">Tangle_Moves</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Tangle_Equivalence</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall  <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">~</span>"</span> 64<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  refl <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">Pure.intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">~</span></span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
 <span class="main">|</span>equality <span class="main">[</span><span class="operator">Pure.intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"linkrel <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
 <span class="main">|</span>domain_compose<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">~</span></span>  <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span>codomain_compose<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">~</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="main">|</span>compose_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> 
         <span class="main">∧</span><span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
                <span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main"><span class="free">~</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span>trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">~</span></span><span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main"><span class="free">~</span></span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>
 <span class="main">|</span>sym<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main"><span class="free">~</span></span><span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
 <span class="main">|</span>tensor_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main"><span class="free">~</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
 <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main"><span class="free">~</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Framed_Tangle_Equivalence</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> wall  <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">~f</span>"</span> 64<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  refl <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">Pure.intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1"><span class="free">~f</span></span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
 <span class="main">|</span>equality <span class="main">[</span><span class="operator">Pure.intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"framed_linkrel <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
 <span class="main">|</span>domain_compose<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1"><span class="free">~f</span></span>  <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span>codomain_compose<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1"><span class="free">~f</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="main">|</span>compose_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> 
         <span class="main">∧</span><span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>domain_wall <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>codomain_wall <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
                <span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">~f</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span>trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="free">~f</span></span><span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="keyword1"><span class="free">~f</span></span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>
 <span class="main">|</span>sym<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="keyword1"><span class="free">~f</span></span><span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
 <span class="main">|</span>tensor_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="keyword1"><span class="free">~f</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
 <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>wall<span class="main">)</span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">~f</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Tangle_Diagram_Equivalence</span><span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram <span class="main">⇒</span> bool"</span></span> 
 <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">~T</span>"</span> 64<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Tangle_Diagram_Equivalence</span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">≡</span> 
<span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Link_Diagram_Equivalence</span><span class="main">::</span><span class="quoted"><span class="quoted">"Link_Diagram <span class="main">⇒</span> Link_Diagram <span class="main">⇒</span> bool"</span></span> 
 <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">~L</span>"</span> 64<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Link_Diagram_Equivalence</span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">≡</span> <span class="main">(</span>Rep_Link_Diagram <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>Rep_Link_Diagram <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> Tangle <span class="main">=</span> <span class="quoted"><span class="quoted">"Tangle_Diagram"</span></span><span class="main">/</span><span class="quoted"><span class="quoted">"Tangle_Diagram_Equivalence"</span></span>
<span class="keyword2"><span class="keyword">morphisms</span></span> Rep_Tangles Abs_Tangles
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivpI<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp Tangle_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> reflp_def Tangle_Diagram_Equivalence_def 
         Tangle_Equivalence.refl 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symp Tangle_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> Tangle_Diagram_Equivalence_def symp_def
         <span class="keyword1"><span class="command">using</span></span>  Tangle_Diagram_Equivalence_def Tangle_Equivalence.sym 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp Tangle_Diagram_Equivalence"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> Tangle_Diagram_Equivalence_def transp_def
         <span class="keyword1"><span class="command">using</span></span>  Tangle_Diagram_Equivalence_def Tangle_Equivalence.trans 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> Link <span class="main">=</span> <span class="quoted"><span class="quoted">"Link_Diagram"</span></span><span class="main">/</span><span class="quoted"><span class="quoted">"Link_Diagram_Equivalence"</span></span>
<span class="keyword2"><span class="keyword">morphisms</span></span> Rep_Links Abs_Links
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivpI<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp Link_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> reflp_def Link_Diagram_Equivalence_def 
         Tangle_Equivalence.refl 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symp Link_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> Link_Diagram_Equivalence_def symp_def
         <span class="keyword1"><span class="command">using</span></span>  Link_Diagram_Equivalence_def  Tangle_Equivalence.sym 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp Link_Diagram_Equivalence"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> Link_Diagram_Equivalence_def transp_def
         <span class="keyword1"><span class="command">using</span></span>  Link_Diagram_Equivalence_def Tangle_Equivalence.trans 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Framed_Tangle_Diagram_Equivalence</span><span class="main">::</span><span class="quoted"><span class="quoted">"Tangle_Diagram <span class="main">⇒</span> Tangle_Diagram <span class="main">⇒</span> bool"</span></span> 
 <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">~T</span>"</span> 64<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Framed_Tangle_Diagram_Equivalence</span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> 
          <span class="main">≡</span> <span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>Rep_Tangle_Diagram <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Framed_Link_Diagram_Equivalence</span><span class="main">::</span><span class="quoted"><span class="quoted">"Link_Diagram <span class="main">⇒</span> Link_Diagram <span class="main">⇒</span> bool"</span></span> 
 <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">~L</span>"</span> 64<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Framed_Link_Diagram_Equivalence</span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> 
       <span class="main">≡</span> <span class="main">(</span>Rep_Link_Diagram <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>Rep_Link_Diagram <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">quotient_type</span></span> Framed_Tangle <span class="main">=</span> <span class="quoted"><span class="quoted">"Tangle_Diagram"</span></span>
               <span class="main">/</span><span class="quoted"><span class="quoted">"Framed_Tangle_Diagram_Equivalence"</span></span>
<span class="keyword2"><span class="keyword">morphisms</span></span> Rep_Framed_Tangles Abs_Framed_Tangles
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivpI<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp Framed_Tangle_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> reflp_def Framed_Tangle_Diagram_Equivalence_def 
         Framed_Tangle_Equivalence.refl 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symp Framed_Tangle_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> Framed_Tangle_Diagram_Equivalence_def symp_def
         <span class="keyword1"><span class="command">using</span></span>  Framed_Tangle_Diagram_Equivalence_def 
          Framed_Tangle_Equivalence.sym 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.sym<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp Framed_Tangle_Diagram_Equivalence"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> Framed_Tangle_Diagram_Equivalence_def transp_def
         <span class="keyword1"><span class="command">using</span></span>  Framed_Tangle_Diagram_Equivalence_def Framed_Tangle_Equivalence.trans 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> Framed_Link <span class="main">=</span> <span class="quoted"><span class="quoted">"Link_Diagram"</span></span><span class="main">/</span><span class="quoted"><span class="quoted">"Framed_Link_Diagram_Equivalence"</span></span>
<span class="keyword2"><span class="keyword">morphisms</span></span> Rep_Framed_Links Abs_Framed_Links
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivpI<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp Framed_Link_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> reflp_def Framed_Link_Diagram_Equivalence_def 
         Framed_Tangle_Equivalence.refl 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symp Framed_Link_Diagram_Equivalence"</span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> Framed_Link_Diagram_Equivalence_def symp_def
         <span class="keyword1"><span class="command">using</span></span>  Framed_Link_Diagram_Equivalence_def  Framed_Tangle_Equivalence.sym 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.sym<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp Framed_Link_Diagram_Equivalence"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> Framed_Link_Diagram_Equivalence_def transp_def
         <span class="keyword1"><span class="command">using</span></span>  Framed_Link_Diagram_Equivalence_def Framed_Tangle_Equivalence.trans 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.trans<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Example">
<div class="head">
<h1>Theory Example</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Showing equivalence of links: An example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Example
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Link_Algebra.html">Link_Algebra</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We prove that a link diagram with a single crossing is equivalent to the 
unknot›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transitive<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">~</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">~</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">~</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.trans assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> prelim_cup_compress<span class="main">:</span>
 <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span>
      <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span>basic <span class="main">(</span>cup <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="main">(</span>cup <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="main">(</span>cup <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">=</span> <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> make_vert_block_def 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram   <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">ultimately</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compress_bottom 
          <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> compress_bottom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compress  <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> compress_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"linkrel <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> linkrel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
     <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.equality compress_bottom_def 
           Tangle_Moves.compress_bottom_def Tangle_Moves.compress_def 
           Tangle_Moves.linkrel_def 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cup_compress<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span>
      <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
         <span class="keyword1"><span class="command">using</span></span> prelim_cup_compress  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span>  <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> domain_compose refl sym Tangle_Equivalence.domain_compose 
         Tangle_Equivalence.sym domain.simps<span class="main">(</span>2<span class="main">)</span> domain_block.simps 
         domain_wall.simps<span class="main">(</span>1<span class="main">)</span> 
         is_tangle_diagram.simps<span class="main">(</span>1<span class="main">)</span> monoid_add_class.add.right_neutral
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> trans <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Example.transitive<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span>   <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>over<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span>    <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>cap<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uncross_straighten_left_over<span class="main">:</span><span class="quoted"><span class="quoted">"left_over <span class="main">~</span> straight_line"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncross right_over left_over"</span></span>
        <span class="keyword1"><span class="command">using</span></span> uncross_positive_flip_def uncross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"linkrel right_over left_over"</span></span>
    <span class="keyword1"><span class="command">using</span></span> linkrel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right_over <span class="main">~</span> left_over"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"left_over <span class="main">~</span> right_over"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncross right_over straight_line"</span></span>
        <span class="keyword1"><span class="command">using</span></span> uncross_positive_straighten_def uncross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"linkrel right_over straight_line"</span></span>
    <span class="keyword1"><span class="command">using</span></span> linkrel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"right_over <span class="main">~</span> straight_line"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left_over <span class="main">~</span>  straight_line<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>right_over <span class="main">~</span> straight_line<span class="main">)</span>
         <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 transitive  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">theorem</span></span> Example<span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">~</span> y"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"left_over <span class="main">~</span> straight_line"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.equality uncross_straighten_left_over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"straight_line <span class="main">~</span> straight_line"</span></span>
   <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> <span class="main">~</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>left_over<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>straight_line<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.tensor_eq<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span><span class="main">)</span> 
           <span class="main">~</span>   <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_wall_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> compose_eq 3  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.compose_eq<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span><span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span> 
                 <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>cup<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span> 
                                                         <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">~</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?x1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cup_compress <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram  <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="var">?x1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x1</span> <span class="main">~</span> <span class="var">?x1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>       
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
     <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> domain_wall  <span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">using</span></span> compose_eq codomain_wall_compose compose_leftassociativity 
               converse_composition_of_tangle_diagrams domain_wall_compose
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.compose_eq is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?x1</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
     <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">~</span> <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> cup_compress <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram  <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert <span class="main">#</span> vert <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
         <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span>  <span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> domain_wall  <span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>  "</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> 
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>       
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                 <span class="keyword1"><span class="command">using</span></span> compose_eq 
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.compose_eq<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?x1</span><span class="main">)</span> <span class="main">~</span>
           <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cup_compress trans
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Example.transitive<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 0 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> trans transp_def trans compose_Nil
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Example.transitive<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  "</span></span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?temp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> "</span></span>  
 <span class="keyword1"><span class="command">have</span></span> 45<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?temp</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_Nil concatenates_Cons concatenates_Nil<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 55<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> 
             <span class="main">=</span>  <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span>  <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?temp</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span>  <span class="main">(</span>basic <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">⊗</span><span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> concatenate.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⊗</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prelim_cup_compress <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">~</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">~</span> <span class="main">(</span><span class="main">(</span><span class="var">?y</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="var">?y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor_eq cup_compress Nil_right_tensor is_tangle_diagram.simps<span class="main">(</span>1<span class="main">)</span> refl
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.tensor_eq<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="var">?y</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="var">?y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>4<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_Nil<span class="main">)</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="main">(</span><span class="var">?y</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="var">?y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor.simps<span class="main">(</span>1<span class="main">)</span> concatenate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?y</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">~</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> domain_compose sym 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.domain_compose Tangle_Equivalence.sym is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?y</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">~</span>  <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trans  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Example.transitive<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">~</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?temp</span> <span class="main">~</span> <span class="var">?temp</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram  <span class="main">(</span><span class="var">?temp</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall  <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> domain_wall <span class="var">?temp</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="var">?temp</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span><span class="var">?temp</span><span class="main">)</span>
                       <span class="main">~</span> <span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> compose_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.compose_eq<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 55 compose_leftassociativity sym wall.simps   
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Tangle_Equivalence.sym compose_Nil<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> 
                    <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span>"</span></span>          
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 8 55 compose_leftassociativity sym wall.simps  Tangle_Equivalence.sym compose_Nil  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>    
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> 
                    <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>left_over <span class="main">⊗</span> straight_line<span class="main">)</span> 
                    <span class="main">~</span> <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>straight_line <span class="main">⊗</span> straight_line<span class="main">)</span><span class="main">)</span>
           <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Example.transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span>  <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> trans transp_def 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Example.transitive<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>cup <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic <span class="main">(</span>cap <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>cap <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>cap <span class="main">#</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.compose_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic<span class="main">(</span>vert<span class="main">#</span>over<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cup<span class="main">#</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="var">?temp</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="var">?z</span> <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">⊗</span><span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> concatenate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="var">?w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span> 
                          <span class="main">=</span> make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_vert_block_def<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compress_top  <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> compress_top_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compress <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?w</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> compress_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"linkrel  <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?w</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> linkrel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="var">?w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="var">?w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">~</span> <span class="var">?w</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span><span class="main">(</span><span class="var">?w</span><span class="main">)</span><span class="main">⊗</span> <span class="main">(</span><span class="var">?w</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.tensor_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~</span> <span class="main">(</span><span class="main">(</span><span class="var">?w</span><span class="main">)</span><span class="main">⊗</span> <span class="main">(</span><span class="var">?w</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="var">?w</span><span class="main">)</span><span class="main">⊗</span> <span class="main">(</span><span class="var">?w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">~</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">~</span> <span class="var">?z</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">=</span> codomain_wall <span class="main">(</span><span class="var">?z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span><span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">=</span> codomain_wall <span class="main">(</span><span class="var">?z</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="var">?z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram  <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="var">?z</span><span class="main">)</span> <span class="main">∘</span>  <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>vert<span class="main">#</span>vert<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">~</span> <span class="main">(</span><span class="var">?z</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aa</span> <span class="main">~</span> <span class="var">?bb</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.compose_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?z</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">~</span> <span class="main">(</span><span class="main">(</span><span class="var">?z</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic<span class="main">(</span>cap<span class="main">#</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bb</span> <span class="main">~</span> <span class="var">?cc</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.codomain_compose  Tangle_Equivalence.sym 
               <span class="quoted"><span class="quoted">‹is_tangle_diagram <span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span> cap<span class="main">]</span> <span class="main">∘</span> basic <span class="main">[]</span><span class="main">)</span>›</span></span> codomain_wall_compose 
               compose_leftassociativity converse_composition_of_tangle_diagrams 
               domain_block.simps<span class="main">(</span>1<span class="main">)</span> domain_wall.simps<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Tangle_Equivalence.compose_eq 
                Tangle_Equivalence.refl 
                <span class="quoted"><span class="quoted">‹codomain_wall <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span> cup<span class="main">]</span><span class="main">)</span> 
                         <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span> over<span class="main">,</span> vert<span class="main">]</span> <span class="main">∘</span> basic <span class="main">[</span>cap<span class="main">,</span> vert<span class="main">,</span> vert<span class="main">]</span><span class="main">)</span>›</span></span> 
                   <span class="quoted"><span class="quoted">‹domain_wall <span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span> cap<span class="main">]</span> <span class="main">∘</span> basic <span class="main">[]</span><span class="main">)</span> 
          <span class="main">=</span> codomain_wall <span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span> cup<span class="main">]</span> <span class="main">∘</span> basic <span class="main">[</span>vert<span class="main">,</span> over<span class="main">,</span> vert<span class="main">]</span><span class="main">)</span>›</span></span> 
                          comp_of_tangle_dgms domain_wall_compose is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aa</span> <span class="main">~</span> <span class="var">?bb</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="var">?bb</span> <span class="main">~</span> <span class="var">?cc</span><span class="main">)</span> <span class="main">⟹</span><span class="var">?aa</span> <span class="main">~</span> <span class="var">?cc</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?aa</span> <span class="main">~</span> <span class="var">?cc</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 14 15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">~</span> <span class="var">?aa</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 9 10 Tangle_Equivalence.trans  Tangle_Equivalence.sym 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">~</span> <span class="var">?aa</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="var">?aa</span> <span class="main">~</span> <span class="var">?cc</span><span class="main">)</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">~</span> <span class="var">?cc</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>cup<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>cap<span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">~</span> <span class="var">?cc</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 17 16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tangle_Equivalence.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>       
</pre>
</div><div id="Kauffman_Matrix">
<div class="head">
<h1>Theory Kauffman_Matrix</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Kauffman Matrix and Kauffman Bracket- Definitions and Properties›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Kauffman_Matrix
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Matrix_Tensor/Matrix_Tensor.html">Matrix_Tensor.Matrix_Tensor</a>
  <a href="Link_Algebra.html">Link_Algebra</a>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fraction_Field.html">HOL-Computational_Algebra.Fraction_Field</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Rational Functions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹intpoly is the type of integer polynomials›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> intpoly <span class="main">=</span> <span class="quoted"><span class="quoted">"int poly"</span></span>

<span class="comment1">(*The following lemma tells us that (pCons 0 1) is an identity function 
on a given type, if it is a commutative ring*)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_pCons<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> poly_1 poly_pCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pCons2<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int poly<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> eval_pCons poly_1 zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">definition</span></span> var_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_zero<span class="main">:</span><span class="quoted"><span class="quoted">"x <span class="main">≠</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> var_def pCons_eq_0_iff zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹rat$\_$poly is the fraction field of integer polynomials. In other
words, it is the type of rational functions›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> rat_poly <span class="main">=</span> <span class="quoted"><span class="quoted">"intpoly fract"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A is defined to be x/1, while B is defined to be 1/x›</span></span>

<span class="keyword1"><span class="command">definition</span></span> var_def1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span>  Fract x <span class="main">1</span>"</span></span>
      
<span class="keyword1"><span class="command">definition</span></span> var_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Fract <span class="main">1</span> x"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Fract <span class="free">c</span> <span class="free">d</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">*</span> <span class="free">d</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> eq_fract assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> A_non_zero<span class="main">:</span><span class="quoted"><span class="quoted">"A <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>rat_poly<span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">unfolding</span></span> var_def1 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span>Fract x <span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fract x <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>rat_poly<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span><span class="main">0</span><span class="main">::</span>intpoly<span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>intpoly<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_fract_def<span class="main">)</span> 
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fract x <span class="main">(</span><span class="main">1</span><span class="main">::</span>intpoly<span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span><span class="main">0</span><span class="main">::</span>intpoly<span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>intpoly<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>intpoly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"x<span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>intpoly<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>intpoly<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>intpoly<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> eq_fract <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"x <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>intpoly<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> non_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_inv_non_zero<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>rat_poly<span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rat_poly_times</span><span class="main">::</span><span class="quoted"><span class="quoted">"rat_poly <span class="main">⇒</span> rat_poly <span class="main">⇒</span> rat_poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rat_poly_times</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rat_poly_plus</span><span class="main">::</span><span class="quoted"><span class="quoted">"rat_poly <span class="main">⇒</span> rat_poly <span class="main">⇒</span> rat_poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rat_poly_plus</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rat_poly_inv</span><span class="main">::</span><span class="quoted"><span class="quoted">"rat_poly <span class="main">⇒</span> rat_poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rat_poly_inv</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span>  rat_poly<span class="main">:</span>semiring_0 <span class="quoted"><span class="quoted">"rat_poly_plus"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"rat_poly_times"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  

<span class="keyword1"><span class="command">interpretation</span></span>  rat_poly<span class="main">:</span>semiring_1 <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"rat_poly_times"</span></span> <span class="quoted"><span class="quoted">"rat_poly_plus"</span></span> <span class="quoted"><span class="main">0</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
 

<span class="keyword1"><span class="command">lemma</span></span> mat1_equiv<span class="main">:</span><span class="quoted"><span class="quoted">"mat1 <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat1I_def vec1I_def<span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹rat$\_$poly is an interpretation of the locale plus\_mult›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>  rat_poly<span class="main">:</span>plus_mult <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"rat_poly_times"</span></span>  <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"rat_poly_plus"</span></span> 
                                  <span class="quoted"><span class="quoted">"rat_poly_inv"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rat_poly_times <span class="skolem">p</span> <span class="main">(</span>rat_poly_plus <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span> 
                    <span class="main">=</span> rat_poly_plus <span class="main">(</span>rat_poly_times <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>rat_poly_times <span class="skolem">p</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rat_poly_times <span class="main">(</span>rat_poly_plus <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">r</span> 
                    <span class="main">=</span> rat_poly_plus <span class="main">(</span>rat_poly_times <span class="skolem">p</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>rat_poly_times <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_semiring_class.distrib<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(*using matrix_multiplication *)</span>
<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="main">[</span><span class="main">[</span>A<span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span>A<span class="main">]</span><span class="main">]</span> <span class="main">[</span><span class="main">[</span>A<span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span>A<span class="main">]</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span>A<span class="main">*</span>A<span class="main">,</span>A<span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span>A<span class="main">*</span>A<span class="main">]</span><span class="main">]</span> "</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        

<span class="keyword1"><span class="command">abbreviation</span></span> 
   <span class="entity">rat_polymat_tensor</span><span class="main">::</span><span class="quoted"><span class="quoted">"rat_poly mat <span class="main">⇒</span> rat_poly mat <span class="main">⇒</span> rat_poly mat"</span></span> 
                                                          <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 65<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rat_polymat_tensor</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> rat_poly.Tensor <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

 
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="free">a</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mult_div_mod_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_div_mod_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>  


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⊗</span>  <span class="free">M</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.Tensor_left_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">" <span class="free">M</span> <span class="main">⊗</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.Tensor_right_id<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Kauffman matrices›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We assign every brick to a matrix of rational polynmials›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">brickmat</span><span class="main">::</span><span class="quoted"><span class="quoted">"brick <span class="main">⇒</span> rat_poly mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">brickmat</span> vert <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">brickmat</span> cup  <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span>A<span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span>B<span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">brickmat</span> cap  <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span>A<span class="main">,</span>B<span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">brickmat</span> over <span class="main">=</span> <span class="main">[</span><span class="main">[</span>A<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
                   <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span>B<span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
                   <span class="main">[</span><span class="main">0</span><span class="main">,</span>B<span class="main">,</span>A<span class="main">-</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
                   <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span>A<span class="main">]</span><span class="main">]</span>"</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">brickmat</span> under  <span class="main">=</span> <span class="main">[</span><span class="main">[</span>B<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
                     <span class="main">[</span><span class="main">0</span><span class="main">,</span>B<span class="main">-</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">,</span>A<span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
                     <span class="main">[</span><span class="main">0</span><span class="main">,</span>A<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
                     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span>B<span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inverse1<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_times A B <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> non_zero  One_fract_def monoid_mult_class.mult.right_neutral 
       mult_fract mult_fract_cancel  var_def1 var_def2
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse2<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_times B A <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span>  One_fract_def monoid_mult_class.mult.right_neutral mult_fract 
        mult_fract_cancel non_zero var_def1 var_def2
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> B_non_zero<span class="main">:</span><span class="quoted"><span class="quoted">"B <span class="main">≠</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> A_non_zero mult_inv_non_zero inverse1 
       divide_fract div_0 fract_collapse<span class="main">(</span>2<span class="main">)</span> 
       monoid_mult_class.mult.left_neutral 
       mult_fract_cancel non_zero var_def2 zero_neq_one
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rat_poly_times <span class="free">p</span> <span class="main">(</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="main">(</span>rat_poly_times <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>rat_poly_times <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.plus_left_distributivity<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_left_distributivity<span class="main">:</span>
      <span class="quoted"><span class="quoted">"rat_poly_times <span class="free">p</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="main">(</span>rat_poly_times <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>rat_poly_times <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> minus_mult_right right_diff_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> minus_right_distributivity<span class="main">:</span>
    <span class="quoted"><span class="quoted">"rat_poly_times <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>rat_poly_times <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>rat_poly_times <span class="free">q</span> <span class="free">r</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span>  minus_left_distributivity rat_poly.comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> equation<span class="main">:</span>
   <span class="quoted"><span class="quoted">"rat_poly_plus 
     <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span> 
              <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A
                       <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
                     <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> B<span class="main">*</span><span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minus_left_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
         <span class="quoted"><span class="quoted">"rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
                               <span class="main">=</span>  B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">*</span>A"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minus_right_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A <span class="main">+</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="main">(</span>brickmat over<span class="main">)</span> <span class="main">(</span>brickmat under<span class="main">)</span> 
   <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> "</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse1 inverse2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>equation<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rat_poly_inv A <span class="main">=</span> <span class="main">-</span>A"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vert_dim<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>brickmat vert<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∧</span>length <span class="main">(</span>brickmat vert<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> cup_dim<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>brickmat cup<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>brickmat cup<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> cap_dim<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>brickmat cap<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>brickmat cap<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> over_dim<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>brickmat over<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>brickmat over<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> under_dim<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>brickmat under<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>brickmat under<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> mat_vert<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span>brickmat vert<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> mat_cup<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">1</span> <span class="numeral">4</span> <span class="main">(</span>brickmat cup<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> mat_cap<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="numeral">4</span> <span class="main">1</span> <span class="main">(</span>brickmat cap<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> mat_over<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="numeral">4</span> <span class="numeral">4</span> <span class="main">(</span>brickmat over<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> mat_under<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="numeral">4</span> <span class="numeral">4</span> <span class="main">(</span>brickmat under<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rowlength</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rowlength</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">rowlength</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command">using</span></span> vert_dim cup_dim cap_dim over_dim under_dim domain.simps 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">d</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>brickmat cup<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹we assign every block to a matrix of rational function as follows›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">blockmat</span><span class="main">::</span><span class="quoted"><span class="quoted">"block <span class="main">⇒</span> rat_poly mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">blockmat</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">blockmat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>brickmat <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">blockmat</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"blockmat <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">=</span> brickmat <span class="free">a</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> blockmat.simps  rat_poly.Tensor_right_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_sum<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nat <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>nat <span class="free">b</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>domain_block <span class="free">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">l</span> <span class="skolem">ls</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> vert
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> domain.simps vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1_left Suc_nat_eq_nat_zadd1 
              calculation<span class="main">(</span>4<span class="main">)</span> domain.simps<span class="main">(</span>1<span class="main">)</span> domain_block_non_negative 
              vert
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> over
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain.simps over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_add_distrib domain_block_nonnegative over<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> under
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons under <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain.simps under <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_add_distrib domain_block_nonnegative under<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> cup 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">0</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain.simps cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> nat_sum cup  domain.simps<span class="main">(</span>2<span class="main">)</span> nat_0 plus_int_code<span class="main">(</span>2<span class="main">)</span> 
             plus_nat.add_0
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> cap
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain.simps cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cap domain_block_nonnegative nat_add_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> row_length_domain_block<span class="main">:</span>
 <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>domain_block <span class="free">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">l</span> <span class="skolem">ls</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> vert
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain.simps vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1_left Suc_nat_eq_nat_zadd1 calculation<span class="main">(</span>4<span class="main">)</span> domain.simps<span class="main">(</span>1<span class="main">)</span> 
                domain_block_non_negative vert
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> over
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain.simps over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> over domain_block_nonnegative nat_add_distrib<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> under
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons under <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain.simps under <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> under domain_block_nonnegative nat_add_distrib<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> cup 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">0</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain.simps cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nat_sum cup  domain.simps<span class="main">(</span>2<span class="main">)</span> 
                nat_0 plus_int_code<span class="main">(</span>2<span class="main">)</span> plus_nat.add_0  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
     <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> cap
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps  rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def Cons cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain.simps cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain <span class="skolem">l</span> <span class="main">+</span> domain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cap domain_block_nonnegative nat_add_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_block.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">lemma</span></span> length_codomain_block<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">ls</span><span class="main">)</span> 
                                    <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>codomain_block <span class="free">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">l</span> <span class="skolem">ls</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> vert
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps rat_poly.length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  Cons vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> codomain.simps vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span> <span class="main">+</span> codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nat_sum  Suc_eq_plus1_left Suc_nat_eq_nat_zadd1 
               codomain.simps<span class="main">(</span>1<span class="main">)</span>  codomain_block_nonnegative nat_numeral 
               numeral_One vert  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> over
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps rat_poly.length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  Cons over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> codomain.simps over <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span> <span class="main">+</span> codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nat_sum  over codomain.simps codomain_block_nonnegative 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> under 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps rat_poly.length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  Cons under <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> codomain.simps under <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span> <span class="main">+</span> codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nat_sum  under codomain.simps codomain_block_nonnegative 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> cup
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> blockmat.simps rat_poly.length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span>  Cons cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> codomain.simps cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span> <span class="main">+</span> codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> nat_sum  cup codomain.simps 
                 codomain_block_nonnegative 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> cap
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> blockmat.simps rat_poly.length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span>  Cons cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">0</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span>codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> codomain.simps cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain <span class="skolem">l</span> <span class="main">+</span> codomain_block <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> nat_sum cap codomain.simps codomain_block_nonnegative 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="main">(</span><span class="skolem">l</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> matrix_blockmat<span class="main">:</span>
 <span class="quoted"><span class="quoted">"mat 
      <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">ls</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">ls</span><span class="main">)</span><span class="main">)</span>  
                    <span class="main">(</span>blockmat <span class="free">ls</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span> 
 <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> Nil 
        <span class="keyword1"><span class="command">unfolding</span></span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> rat_poly.row_length_def mat_def 
        vec_def Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ls</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Cons_1<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                 <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Cons_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> blockmat.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">*</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> calculation rat_poly.row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>        
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>
                                      <span class="main">*</span><span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  blockmat.simps<span class="main">(</span>2<span class="main">)</span> rat_poly.length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_3<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                            <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span>
                      <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_poly.well_defined_Tensor Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> vert
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vert_dim mat_vert rat_poly.matrix_row_length vert 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> over
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
              <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_over rat_poly.matrix_row_length over 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> under
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
              <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  mat_under rat_poly.matrix_row_length under <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> cap
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
              <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  mat_cap rat_poly.matrix_row_length cap <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> cup
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
             <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>length <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>brickmat <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_cup rat_poly.matrix_row_length cup <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The function kauff$\_$mat below associates every wall to a matrix. 
 We call this the kauffman matrix. When the wall represents a well defined
 tangle diagram, the Kauffman matrix is a 1 $\times$  1 matrix whose entry is the
 Kauffman bracket.›</span></span>       

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">kauff_mat</span><span class="main">::</span><span class="quoted"><span class="quoted">"wall <span class="main">⇒</span> rat_poly mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">kauff_mat</span> <span class="main">(</span>basic <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">kauff_mat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">ws</span></span></span><span class="main">)</span> <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">kauff_mat</span> <span class="free"><span class="bound"><span class="entity">ws</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem tells us  that if a wall
represents a tangle diagram, then its Kauffman matrix is a `valid' matrix.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> matrix_kauff_mat<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>is_tangle_diagram <span class="free">ws</span><span class="main">)</span> 
 <span class="main">⟹</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws</span><span class="main">)</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">ws</span><span class="main">)</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span>mat 
        <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ws</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
       <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> domain_wall.simps<span class="main">(</span>1<span class="main">)</span> 
             row_length_domain_block matrix_blockmat
             length_codomain_block basic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">w</span> <span class="skolem">ws</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> prod_1<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="skolem">ws</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps  prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> prod_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> domain_wall <span class="skolem">ws</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> prod_1 <span class="keyword1"><span class="command">have</span></span> prod_3<span class="main">:</span>
         <span class="quoted"><span class="quoted">"mat 
              <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span>  <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod.hyps prod_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> prod_4<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod.hyps prod_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> prod_5<span class="main">:</span>
           <span class="quoted"><span class="quoted">"mat 
               <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> prod_6<span class="main">:</span>
           <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> row_length_domain_block length_codomain_block 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> ad1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span> 
                             <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                 <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod_3 prod_5 mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> ad1 length_0_conv rat_poly.mat_empty_column_length 
             rat_poly.matrix_row_length rat_poly.row_length_def 
             rat_poly.unique_row_col<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod_6 domain_wall.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span>
                 <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> res1  rat_poly.mat_empty_column_length 
           rat_poly.matrix_row_length rat_poly.unique_row_col<span class="main">(</span>2<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> prod_4 codomain_wall.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> res3<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>  
                               <span class="main">=</span>  <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="main">(</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> res1 res2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹length <span class="main">(</span>kauff_mat <span class="skolem">ws</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>codomain_wall <span class="main">(</span><span class="skolem">w</span> <span class="main">*</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>›</span></span> 
           <span class="quoted"><span class="quoted">‹rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>domain_wall <span class="main">(</span><span class="skolem">w</span> <span class="main">*</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>›</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> effective_matrix_kauff_mat<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span>
                                           <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matrix_kauff_mat assms <span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> assms matrix_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_mult_equiv<span class="main">:</span>
 <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span> <span class="main">=</span> mat_mult <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span> <span class="free">m1</span> <span class="free">m2</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> associative_rat_poly_mat<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span> <span class="main">(</span>rat_poly.row_length <span class="free">m2</span><span class="main">)</span> <span class="free">m1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="free">m2</span><span class="main">)</span> <span class="main">(</span>rat_poly.row_length <span class="free">m3</span><span class="main">)</span> <span class="free">m2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="free">m3</span><span class="main">)</span> <span class="free">nc</span> <span class="free">m3</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="free">m1</span> <span class="main">(</span>rat_poly.matrix_mult <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span> 
                     <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span>  <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.matrix_mult <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span> 
                   <span class="main">=</span> mat_mult <span class="main">(</span>rat_poly.row_length <span class="free">m2</span><span class="main">)</span> <span class="free">m2</span> <span class="free">m3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_mult_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="free">m1</span> <span class="main">(</span>rat_poly.matrix_mult <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span>
                   <span class="main">=</span> mat_mult <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span>  <span class="free">m1</span> 
                                 <span class="main">(</span>mat_mult <span class="main">(</span>rat_poly.row_length <span class="free">m2</span><span class="main">)</span> <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_mult_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span>    mat_mult <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span> 
                           <span class="main">(</span>mat_mult <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms mat_mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
           <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span> 
           <span class="main">(</span>rat_poly.row_length <span class="free">m3</span><span class="main">)</span> 
                     <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> 
                     <span class="main">(</span>rat_poly.row_length <span class="free">m1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> length_0_conv rat_poly.mat_empty_column_length 
            rat_poly.matrix_row_length rat_poly.row_length_Nil 
            rat_poly.unique_row_col<span class="main">(</span>1<span class="main">)</span> rat_poly.unique_row_col<span class="main">(</span>2<span class="main">)</span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span>
                       <span class="main">=</span> mat_mult <span class="main">(</span>rat_poly.row_length 
                                      <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">(</span>rat_poly.matrix_mult <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_mult_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mat_mult_equiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It follows from this result that the Kauffman Matrix of a wall representing a link
diagram, is a 1 $\times$ 1 matrix. 
 Thus it establishes a correspondence between links and
rational functions.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> link_diagram_matrix<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_link_diagram <span class="free">ws</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span> <span class="main">1</span> <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms effective_matrix_kauff_mat  <span class="keyword1"><span class="command">unfolding</span></span> is_link_diagram_def  
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Preliminaries.abs_zero abs_non_negative_sum<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comm_monoid_add_class.add_0 nat_0 power_0<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> tangle_compose_matrix<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>is_tangle_diagram <span class="free">ws1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="free">ws2</span><span class="main">)</span> 
<span class="main">∧</span><span class="main">(</span>domain_wall <span class="free">ws2</span> <span class="main">=</span> codomain_wall <span class="free">ws1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
kauff_mat <span class="main">(</span><span class="free">ws1</span> <span class="main">∘</span> <span class="free">ws2</span><span class="main">)</span> <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ws1</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>basic <span class="skolem">w1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="skolem">w1</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="free">ws2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">ws2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> compose.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="skolem">w1</span><span class="main">)</span> <span class="main">∘</span> <span class="free">ws2</span><span class="main">)</span> <span class="main">=</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod <span class="skolem">w1</span> <span class="skolem">ws1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">w1</span><span class="main">*</span><span class="skolem">ws1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="skolem">ws1</span><span class="main">)</span> 
                 <span class="main">∧</span> <span class="main">(</span>codomain_block <span class="skolem">w1</span> <span class="main">=</span> domain_wall <span class="skolem">ws1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  effective_matrix_kauff_mat   matrix_blockmat  length_codomain_block 
               row_length_domain_block
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span> 
   <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"mat 
                   <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">=</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span>  effective_matrix_kauff_mat prod.prems matrix_blockmat 
                row_length_domain_block <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                  <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"mat 
                 <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">ws2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> prod.prems  effective_matrix_kauff_mat 
              effective_matrix_kauff_mat  
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> prod.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span>"</span></span> 
             <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat 
                      <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">ws2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult 
                         <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span> 
                          <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span> 
                                      <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> rat_poly.matrix_mult 
                             <span class="main">(</span>rat_poly.matrix_mult 
                                     <span class="main">(</span>blockmat <span class="skolem">w1</span><span class="main">)</span>  
                                     <span class="main">(</span>kauff_mat <span class="skolem">ws1</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> associative_rat_poly_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
         <span class="keyword1"><span class="command">using</span></span>  <span class="quoted">"2"</span> codomain_wall.simps<span class="main">(</span>2<span class="main">)</span> compose_Cons 
         prod.hyps prod.prems kauff_mat.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>     
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> left_mat_compose<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="free">ws</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="free">ws</span>  <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> effective_matrix_kauff_mat assms  nat_0 power_0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mat1 <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> mat1_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>kauff_mat <span class="main">(</span><span class="free">ws</span>  <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> rat_poly.matrix_mult 
                                          <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> 
                                          <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tangle_compose_matrix assms is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_mult_equiv mat1_mult_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">theorem</span></span> right_mat_compose<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="free">ws</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span> <span class="main">∘</span><span class="free">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span> <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> effective_matrix_kauff_mat assms  nat_0 power_0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mat1 <span class="main">1</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> mat1_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span> <span class="main">∘</span><span class="free">ws</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">=</span> rat_poly.matrix_mult 
                                           <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> "</span></span>
       <span class="keyword1"><span class="command">using</span></span> tangle_compose_matrix assms is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> effective_matrix_kauff_mat<span class="main">(</span>3<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>1<span class="main">)</span> 
              mat1 mat1_mult_left one_neq_zero rat_poly.mat_empty_column_length 
              rat_poly.unique_row_col<span class="main">(</span>1<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> left_id_blockmat<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="main">[]</span> <span class="main">⊗</span> blockmat <span class="free">b</span> <span class="main">=</span> blockmat <span class="free">b</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> rat_poly.Tensor_left_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 


<span class="keyword1"><span class="command">lemma</span></span> tens_assoc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span><span class="main">(</span>brickmat <span class="bound">a</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="bound">xs</span> <span class="main">⊗</span> blockmat <span class="bound">ys</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span>brickmat <span class="bound">a</span> <span class="main">⊗</span> blockmat <span class="bound">xs</span><span class="main">)</span> <span class="main">⊗</span> blockmat <span class="bound">ys</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span><span class="main">(</span>mat 
               <span class="main">(</span>rat_poly.row_length <span class="main">(</span>brickmat <span class="bound">a</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">(</span>length <span class="main">(</span>brickmat <span class="bound">a</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span>brickmat <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> brickmat.simps 
      <span class="keyword1"><span class="command">unfolding</span></span> mat_def rat_poly.row_length_def Ball_def vec_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> <span class="main">(</span>mat 
                           <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>length <span class="main">(</span>blockmat <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">(</span>blockmat <span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> mat 
                          <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">(</span>length <span class="main">(</span>blockmat <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">(</span>blockmat <span class="bound">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rat_poly.associativity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> kauff_mat_tensor_distrib<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span><span class="main">∀</span><span class="bound">ys</span><span class="main">.</span><span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="bound">xs</span> <span class="main">⊗</span> basic <span class="bound">ys</span><span class="main">)</span> 
 <span class="main">=</span> kauff_mat <span class="main">(</span>basic <span class="bound">xs</span><span class="main">)</span> <span class="main">⊗</span> kauff_mat <span class="main">(</span>basic <span class="bound">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">xs</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.vec_mat_Tensor_vector_id<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tens_assoc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> blockmat_tensor_distrib<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>blockmat <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="free">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"blockmat <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> kauff_mat <span class="main">(</span>basic <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> kauff_mat <span class="main">(</span>basic <span class="free">a</span><span class="main">)</span> <span class="main">⊗</span> kauff_mat <span class="main">(</span>basic <span class="free">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> kauff_mat_tensor_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="free">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="free">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> blockmat_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span><span class="main">(</span>blockmat <span class="bound">bs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">bs</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv rat_poly.vec_mat_Tensor_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv rat_poly.vec_mat_Tensor_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv rat_poly.vec_mat_Tensor_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv rat_poly.vec_mat_Tensor_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv rat_poly.vec_mat_Tensor_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The kauffman matrix of a wall representing a tangle diagram is 
         non empty›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>  kauff_mat_non_empty<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ws</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> <span class="main">=</span>  <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> effective_matrix_kauff_mat assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> is_tangle_diagram_length_rowlength<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">w</span><span class="main">*</span><span class="free">ws</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">w</span><span class="main">)</span> <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>codomain_block <span class="free">w</span> <span class="main">=</span> domain_wall <span class="free">ws</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> effective_matrix_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_tangle_diagram.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">w</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_blockmat length_codomain_block <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_tangle_diagram_matrix_match<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">w1</span><span class="main">*</span><span class="free">ws1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">w2</span><span class="main">*</span><span class="free">ws2</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_match <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span> 
                      <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rat_poly.matrix_match_def
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws1</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws2</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_length_rowlength assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_length_rowlength assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="free">w1</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws1</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 kauff_mat_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="free">w2</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws2</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 kauff_mat_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
 <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following function constructs a $2^n \times 2^n$ identity matrix
 for a given $n$›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">make_vert_equiv</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> rat_poly mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">make_vert_equiv</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">make_vert_equiv</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">make_vert_equiv</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mve1<span class="main">:</span><span class="quoted"><span class="quoted">"make_vert_equiv <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> make_vert_equiv.simps brickmat.simps<span class="main">(</span>1<span class="main">)</span> 
       One_nat_def rat_poly.Tensor_right_id
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="numeral">2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>make_vert_equiv <span class="main">1</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">!</span><span class="free">j</span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mve1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rat_poly.Tensor_right_id<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> make_vert_equiv.simps mat1_index assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat1_vert_equiv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>brickmat vert<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> brickmat.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="var">?r</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?r</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rat_poly.row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span>  
                               <span class="main">(</span><span class="main">(</span><span class="var">?r</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?r</span> <span class="main">!</span> <span class="main">0</span><span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?r</span> <span class="main">!</span> <span class="main">0</span><span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?r</span> <span class="main">!</span> <span class="main">1</span><span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?r</span> <span class="main">!</span> <span class="main">1</span><span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_2_cases<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat1<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="var">?l</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat1_index<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="var">?l</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span> <span class="main">!</span><span class="bound">i</span> <span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 1  3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat_eqI<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> blockmat_make_vert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"blockmat <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command">unfolding</span></span> make_vert_block.simps blockmat.simps make_vert_equiv.simps 
 <span class="keyword1"><span class="command">using</span></span> mat1_vert_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_make_vert_equiv<span class="main">:</span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat 
         <span class="main">(</span>rat_poly.row_length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">(</span>length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"make_vert_equiv <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> blockmat_make_vert  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"domain_block <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span> <span class="main">=</span> int <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> domain_make_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span> <span class="main">=</span> int <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> codomain_make_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> 
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span>rat_poly.row_length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span>length <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>make_vert_equiv <span class="free">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat_int row_length_domain_block<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_codomain_block nat_int<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_blockmat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nat_mult</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*n</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nat_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equal_div_mod<span class="main">:</span><span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equal_div_mod2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">=</span> <span class="free">i</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> equal_div_mod <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> impl_rule<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">i</span> <span class="bound">j</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 

<span class="keyword1"><span class="command">lemma</span></span> implic<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">R</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>  
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">R</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.div_right_ineq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_if_then<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">Q</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⟹</span> <span class="main">(</span>rat_poly_times <span class="free">v</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rat_poly_unity<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_times <span class="main">1</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span>  <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat1I_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> make_vert_equiv_mat<span class="main">:</span>
<span class="quoted"><span class="quoted">"make_vert_equiv <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 mat1_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"make_vert_equiv <span class="skolem">k</span> <span class="main">=</span> mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"make_vert_equiv <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> make_vert_equiv.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mat1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> 
                  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat1_index<span class="main">)</span>   
   <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>                               
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat1_vert_equiv vert_dim<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat1I_def<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                      <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span>length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"4"</span> mat1 mat1_vert_equiv vert_dim<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span>"</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Suc 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prop_make_vert_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat1I_def<span class="main">)</span> 
       
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                         <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Suc  mat1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span> 
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
               <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                 <span class="main">=</span>  rat_poly_times
                       <span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                                 <span class="keyword1">*n</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
               <span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                       <span class="keyword1">*n</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
            <span class="main">=</span>  rat_poly_times
                <span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> 5 8 rat_poly.effective_matrix_Tensor_elements2 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"4"</span> <span class="quoted">"6"</span> <span class="quoted">"7"</span> rat_poly.comm<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                           <span class="keyword1">*n</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> 3 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                           <span class="keyword1">*n</span><span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> 4 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"6"</span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                          <span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">then</span> <span class="main">1</span> 
                     <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> mat1_index <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span> <span class="quoted">"7"</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">*n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">using</span></span> 7 allI  Suc.IH prop_make_vert_equiv<span class="main">(</span>1<span class="main">)</span> 
                    rat_poly.div_left_ineq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">⟶</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">*n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> 7 allI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.IH prop_make_vert_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rat_poly.div_left_ineq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>     
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>
                          <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>               
   <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>
                     <span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                         <span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>         
    <span class="keyword1"><span class="command">proof</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>                   
     <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>
                     <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> 0 13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>
                               <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                        <span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
                             <span class="keyword1"><span class="command">using</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span><span class="main">)</span>      
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>
                       <span class="main">∧</span>  <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                           <span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                   <span class="keyword1"><span class="command">using</span></span> mat1_index <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span> <span class="quoted">"7"</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">*n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
               <span class="keyword1"><span class="command">using</span></span> 7 allI  mod_less_divisor 
               nat_zero_less_power_iff zero_less_numeral <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">⟶</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">*n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> 7 allI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span> calculation<span class="main">)</span>        
   <span class="keyword1"><span class="command">qed</span></span>     
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 18<span class="main">:</span>
             <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>
                          <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"7"</span><span class="main">)</span>          
   <span class="keyword1"><span class="command">have</span></span> 19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                              <span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>         
    <span class="keyword1"><span class="command">proof</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>                   
     <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>
                          <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> 0 18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span><span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                          <span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">then</span> <span class="main">1</span> 
                            <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
                             <span class="keyword1"><span class="command">using</span></span> 15 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span><span class="main">)</span>      
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> 
              <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">⟶</span> rat_poly_times
                              <span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>
                                  <span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span>
                    <span class="main">(</span><span class="keyword1">if</span> 
                        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>                        
                         <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
     <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>
                      <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span>    <span class="main">(</span><span class="keyword1">if</span> 
                          <span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="keyword1">then</span> <span class="main">1</span> 
                               <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> 0 14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span>  <span class="main">(</span><span class="keyword1">if</span> 
                          <span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="keyword1">then</span> <span class="main">1</span> 
                               <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> 0 19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rat_poly_times
                     <span class="main">(</span><span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">(</span><span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">=</span>
                           <span class="main">(</span><span class="keyword1">if</span> 
                             <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="keyword1">then</span> <span class="main">1</span> 
                                  <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">⟶</span> rat_poly_times 
                              <span class="main">(</span>mat1 <span class="numeral">2</span> 
                                 <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> 
                                 <span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>  
         <span class="main">⟹</span> rat_poly_times 
              <span class="main">(</span>mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>   <span class="main">1</span>"</span></span>                  
       <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">∧</span> <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">=</span> <span class="main">1</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> s1 local_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> 
                 <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>   
             <span class="keyword1"><span class="command">using</span></span> s2 local_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"6"</span> <span class="quoted">"7"</span> Suc.IH local_assms mve1 prop_make_vert_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                          prop_make_vert_equiv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rat_poly.right_id<span class="main">)</span>  
       <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword3"><span class="command">show</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
          mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span>
      mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>                         
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span>  <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
           mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> 
   <span class="main">∨</span> mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> local_assms<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span> <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> s2 local_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
        mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> 
    <span class="main">∨</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span>
    mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span>
      mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
         <span class="keyword3"><span class="command">assume</span></span> local_assm1<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                    <span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">⟹</span> 
                mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">=</span> <span class="main">0</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> s2 local_assm1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"7"</span><span class="main">)</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">⟹</span>  mat1 <span class="numeral">2</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                                <span class="main">=</span> <span class="main">0</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> s1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">div</span> rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
         <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>rat_poly.row_length <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
                         <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="keyword1">then</span> <span class="main">1</span> 
                         <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span> <span class="quoted">"7"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>  <span class="main">(</span><span class="bound">j</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span>
                                                                                <span class="keyword1">then</span> <span class="main">1</span> 
                                                                                 <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>    
               <span class="keyword1"><span class="command">using</span></span> equal_div_mod2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                      <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
         <span class="main">(</span><span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹make_vert_equiv <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> mat1 <span class="numeral">2</span> <span class="main">⊗</span> mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>›</span></span>      
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prop_make_vert_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prop_make_vert_equiv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                  prop_make_vert_equiv<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.Tensor <span class="main">(</span>mat1 <span class="numeral">2</span><span class="main">)</span>  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 mat_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> make_vert_equiv.simps 
   <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹make_vert_equiv <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> mat1 <span class="numeral">2</span> <span class="main">⊗</span> mat1 <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> make_vert_block_map_blockmat<span class="main">:</span>
 <span class="quoted"><span class="quoted">"blockmat <span class="main">(</span>make_vert_block <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_make_vert make_vert_equiv_mat<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span>  mat1_rt_mult<span class="main">:</span><span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
       <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult <span class="free">m1</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="free">nc</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">m1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms  mat1_mult_right rat_poly.mat_empty_row_length 
        rat_poly.matrix_row_length 
        rat_poly.row_length_def rat_poly.unique_row_col<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>         

<span class="keyword1"><span class="command">lemma</span></span> mat1_vert_block<span class="main">:</span> 
       <span class="quoted"><span class="quoted">"rat_poly.matrix_mult 
                   <span class="main">(</span>blockmat <span class="free">b</span><span class="main">)</span> 
                   <span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">=</span> <span class="main">(</span>blockmat <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
          <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">b</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>blockmat <span class="free">b</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span>  length_codomain_block matrix_blockmat 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span> mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> make_vert_block_map_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mat1_rt_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following list of theorems deal with distributivity properties
of tensor product of matrices (with entries as rational functions) 
      and composition›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_matrix_match</span><span class="main">::</span>
              <span class="quoted"><span class="quoted">"rat_poly mat <span class="main">⇒</span> rat_poly mat <span class="main">⇒</span> rat_poly mat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">weak_matrix_match</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">≡</span> <span class="main">(</span>mat <span class="main">(</span>rat_poly.row_length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>rat_poly.row_length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>rat_poly.row_length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span>
<span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">=</span> rat_poly.row_length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> weak_distributivity1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weak_matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>rat_poly.matrix_mult <span class="free">A1</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="main">(</span><span class="free">A2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"weak_matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms weak_matrix_match_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.matrix_row_length rat_poly.unique_row_col<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span> <span class="main">1</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> length <span class="free">B1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rat_poly.row_length_def 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rat_poly.matrix_match_def 
        <span class="keyword1"><span class="command">using</span></span> assms weak_matrix_match_def <span class="quoted">"1"</span> blockmat.simps<span class="main">(</span>1<span class="main">)</span>
              matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>rat_poly.matrix_mult <span class="free">A1</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>rat_poly.matrix_mult <span class="free">B1</span>  <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> rat_poly.distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.matrix_mult <span class="free">B1</span>  <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">B1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> weak_matrix_match_def  assms mat1_equiv mat1_mult_right
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">A2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  rat_poly.Tensor_right_id  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_matrix_match2</span><span class="main">::</span>
     <span class="quoted"><span class="quoted">"rat_poly mat <span class="main">⇒</span> rat_poly mat <span class="main">⇒</span> rat_poly mat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">weak_matrix_match2</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="free"><span class="bound"><span class="entity">B2</span></span></span> <span class="main">≡</span> <span class="main">(</span>mat <span class="main">(</span>rat_poly.row_length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>rat_poly.row_length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>rat_poly.row_length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span>
<span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B2</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">=</span> rat_poly.row_length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> weak_distributivity2<span class="main">:</span>
<span class="quoted"><span class="quoted">"weak_matrix_match2 <span class="free">A1</span> <span class="free">B1</span> <span class="free">B2</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="free">A1</span><span class="main">⊗</span> <span class="main">(</span>rat_poly.matrix_mult <span class="free">B1</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">=</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="main">(</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"weak_matrix_match2 <span class="free">A1</span> <span class="free">B1</span> <span class="free">B2</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms weak_matrix_match2_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.matrix_row_length rat_poly.unique_row_col<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span> <span class="main">1</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.row_length <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> length <span class="free">A1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rat_poly.row_length_def 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_match <span class="free">A1</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="free">B1</span> <span class="free">B2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rat_poly.matrix_match_def  
        <span class="keyword1"><span class="command">using</span></span> assms weak_matrix_match2_def  
             <span class="quoted">"1"</span> blockmat.simps<span class="main">(</span>1<span class="main">)</span> matrix_blockmat
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>rat_poly.matrix_mult <span class="free">A1</span>  <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>rat_poly.matrix_mult <span class="free">B1</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> rat_poly.distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly.matrix_mult <span class="free">A1</span>  <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">A1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> weak_matrix_match2_def
              assms mat1_equiv mat1_mult_right
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span> <span class="main">=</span> <span class="free">B2</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.Tensor_left_id<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> is_tangle_diagram_weak_matrix_match<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">w1</span><span class="main">*</span><span class="free">ws1</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"weak_matrix_match <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> weak_matrix_match_def
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat 
          <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws1</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat 
                <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
           <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matrix_blockmat  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> length_codomain_block <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_length_rowlength assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="free">w1</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws1</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws1</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 kauff_mat_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="free">w2</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_non_empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> is_tangle_diagram_weak_matrix_match2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">w2</span><span class="main">*</span><span class="free">ws2</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"codomain_block <span class="free">w1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"weak_matrix_match2 <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> weak_matrix_match2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
            <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> matrix_blockmat  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                 <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> length_codomain_block <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="free">w1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat 
                <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> matrix_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat 
           <span class="main">(</span>rat_poly.row_length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">(</span>length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_blockmat<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>blockmat <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_length_rowlength assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="free">w1</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_non_empty<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="free">ws2</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">ws2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_tangle_diagram.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 kauff_mat_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"blockmat <span class="free">w2</span> <span class="main">=</span> <span class="main">[]</span> "</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> is_tangle_diagram_vert_block<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span>codomain_block <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain_wall.simps make_vert_block.simps 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> codomain_block_nonnegative domain_make_vert int_nat_eq<span class="main">)</span>      
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem tells us that the the map kauff$\_$mat when 
 restricted to walls representing tangles preserves the tensor product›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Tensor_Invariance<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>is_tangle_diagram <span class="free">ws1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>is_tangle_diagram <span class="free">ws2</span><span class="main">)</span>
 <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="free">ws1</span> <span class="main">⊗</span> <span class="free">ws2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">ws1</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>kauff_mat <span class="free">ws2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tensor.induct<span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> kauff_mat_tensor_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">as</span> <span class="skolem">bs</span>
  <span class="keyword3"><span class="command">assume</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"  is_tangle_diagram <span class="skolem">as</span> <span class="main">∧</span> is_tangle_diagram <span class="skolem">bs</span> 
                <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> kauff_mat <span class="skolem">as</span> <span class="main">⊗</span> kauff_mat <span class="skolem">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prems<span class="main">:</span><span class="quoted"><span class="quoted">" is_tangle_diagram <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="skolem">b</span><span class="main">*</span><span class="skolem">bs</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">⊗</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">bs</span><span class="main">)</span> 
                         <span class="main">=</span> kauff_mat <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> kauff_mat <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.matrix_match 
                         <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                         <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span> 
                         <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> 
                         <span class="main">(</span>kauff_mat <span class="skolem">bs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> prems is_tangle_diagram_matrix_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="skolem">as</span> <span class="main">∧</span> is_tangle_diagram <span class="skolem">bs</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> prems is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult 
                                   <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult 
                             <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">(</span><span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>kauff_mat <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hyps 1  kauff_mat_tensor_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span><span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">⊗</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> 0 rat_poly.distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> kauff_mat <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> kauff_mat <span class="main">(</span><span class="skolem">b</span><span class="main">*</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">as</span> <span class="skolem">bs</span> 
  <span class="keyword3"><span class="command">assume</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>  
            <span class="main">⟹</span> is_tangle_diagram <span class="skolem">as</span> 
               <span class="main">∧</span> is_tangle_diagram 
                      <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">⟹</span> kauff_mat 
                  <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span> kauff_mat <span class="skolem">as</span> 
                      <span class="main">⊗</span> kauff_mat 
                         <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> prems<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" kauff_mat <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">⊗</span> basic <span class="skolem">b</span><span class="main">)</span> 
                  <span class="main">=</span> kauff_mat <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> kauff_mat <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span>"</span></span>                   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> True 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span><span class="skolem">b</span><span class="main">)</span> <span class="main">*</span>  <span class="skolem">as</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> tensor.simps True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span><span class="skolem">b</span><span class="main">)</span> <span class="main">*</span>  <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> 
                              rat_poly.matrix_mult 
                                   <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>  
                                   <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> 
                           rat_poly.matrix_mult 
                                     <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span>  blockmat_tensor_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> T1<span class="main">:</span>
                     <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">=</span> rat_poly.matrix_mult 
                                     <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weak_matrix_match 
                            <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                            <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span> 
                            <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_weak_matrix_match True prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult 
                        <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>
                              <span class="main">=</span> <span class="main">(</span><span class="main">(</span>rat_poly.matrix_mult 
                                           <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                                            <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> weak_distributivity1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
                               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> F0<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.matrix_match 
                                 <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                                 <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span> 
                                  <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span>
                                   <span class="main">(</span>kauff_mat <span class="var">?bs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prems is_tangle_diagram_vert_block 
                 is_tangle_diagram_matrix_match  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
      <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> F2<span class="main">:</span><span class="quoted"><span class="quoted">" is_tangle_diagram <span class="skolem">as</span> 
                     <span class="main">∧</span> is_tangle_diagram <span class="var">?bs</span>"</span></span>   
            <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F3<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat 
                         <span class="main">(</span><span class="skolem">as</span><span class="main">⊗</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                     kauff_mat <span class="skolem">as</span> <span class="main">⊗</span> kauff_mat <span class="var">?bs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> F1 hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> <span class="var">?bs</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> False tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">=</span> kauff_mat<span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> <span class="var">?bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult 
                                             <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                                             <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">as</span> <span class="main">⊗</span> <span class="var">?bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult 
                                            <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
                                            <span class="main">(</span><span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>kauff_mat <span class="var">?bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> F3  blockmat_tensor_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 
               <span class="quoted"><span class="quoted">"<span class="main">...</span>  
                    <span class="main">=</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⊗</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="var">?bs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> rat_poly.distributivity F0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> 
                                  <span class="main">=</span>  <span class="main">(</span>rat_poly.matrix_mult 
                                             <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                                             <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mat1_vert_block <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">⊗</span> <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>       
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">as</span> <span class="skolem">bs</span> 
   <span class="keyword3"><span class="command">assume</span></span> hyps<span class="main">:</span>
       <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>  
          <span class="main">⟹</span>  is_tangle_diagram 
                       <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="skolem">as</span><span class="main">)</span> 
          <span class="main">⟹</span> kauff_mat <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⊗</span> <span class="skolem">as</span><span class="main">)</span> 
            <span class="main">=</span>  kauff_mat <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">⊗</span> kauff_mat <span class="skolem">as</span> "</span></span>
   <span class="keyword3"><span class="command">assume</span></span> prems<span class="main">:</span><span class="quoted"><span class="quoted">"is_tangle_diagram <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> is_tangle_diagram <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span> "</span></span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" kauff_mat <span class="main">(</span> <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span>  <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> kauff_mat <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span>  kauff_mat <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span>"</span></span>                   
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"codomain_block <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span>  <span class="skolem">as</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> tensor.simps True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span><span class="skolem">a</span> <span class="main">)</span> <span class="main">*</span>  <span class="skolem">as</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult 
                                      <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>  
                                      <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult 
                                         <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span>  blockmat_tensor_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span> 
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> T1<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">=</span> rat_poly.matrix_mult 
                                          <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                                          <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weak_matrix_match2 
                              <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> 
                               <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                               <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram_weak_matrix_match2 
               True prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly.matrix_mult 
                                <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>
                     <span class="main">=</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span>  
                        <span class="main">⊗</span> <span class="main">(</span>rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> weak_distributivity2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span> "</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> F0<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly.matrix_match  
                                   <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span>
                                   <span class="main">(</span>kauff_mat <span class="var">?bs</span><span class="main">)</span> 
                                   <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                                   <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> prems is_tangle_diagram_vert_block 
              is_tangle_diagram_matrix_match  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
     <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span><span class="quoted"><span class="quoted">"codomain_block <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">have</span></span> F2<span class="main">:</span><span class="quoted"><span class="quoted">" is_tangle_diagram <span class="skolem">as</span> 
                     <span class="main">∧</span> is_tangle_diagram <span class="var">?bs</span>"</span></span>   
         <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F3<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="var">?bs</span> <span class="main">⊗</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> kauff_mat <span class="var">?bs</span> <span class="main">⊗</span> kauff_mat <span class="skolem">as</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> F1 hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?bs</span> <span class="main">⊗</span> <span class="skolem">as</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> False tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 
                    <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">=</span> kauff_mat<span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?bs</span> <span class="main">⊗</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> 
                                 <span class="main">=</span> rat_poly.matrix_mult 
                                               <span class="main">(</span>blockmat <span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                                               <span class="main">(</span>kauff_mat <span class="main">(</span><span class="var">?bs</span> <span class="main">⊗</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> 
                          <span class="main">=</span> rat_poly.matrix_mult 
                                    <span class="main">(</span><span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span><span class="main">(</span>kauff_mat <span class="var">?bs</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>                      
         <span class="keyword1"><span class="command">using</span></span> F3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_tensor_distrib<span class="main">)</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  
                                 <span class="main">=</span> <span class="main">(</span>rat_poly.matrix_mult 
                                          <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> 
                                          <span class="main">(</span>kauff_mat <span class="var">?bs</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">⊗</span> <span class="main">(</span>rat_poly.matrix_mult  
                                              <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                                              <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> rat_poly.distributivity F0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="skolem">b</span><span class="main">)</span> 
                                      <span class="main">⊗</span> <span class="main">(</span>rat_poly.matrix_mult 
                                                   <span class="main">(</span>blockmat <span class="skolem">a</span><span class="main">)</span> 
                                                   <span class="main">(</span>kauff_mat <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mat1_vert_block <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">⊗</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Computations">
<div class="head">
<h1>Theory Computations</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Computations: This section can be skipped›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Computations
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Kauffman_Matrix.html">Kauffman_Matrix</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">lemma</span></span> unlink_computation<span class="main">:</span>
 <span class="quoted"><span class="quoted">"rat_poly_plus <span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> <span class="main">(</span>rat_poly_times A A<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_plus
       <span class="main">(</span>rat_poly_times <span class="numeral">2</span> <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">+</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> <span class="main">(</span>rat_poly_times A A<span class="main">)</span><span class="main">)</span> <span class="main">=</span> A<span class="main">^</span><span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_Bit0<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> B<span class="main">^</span><span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_Bit0<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="numeral">2</span> <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">=</span> <span class="numeral">2</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> inverse1  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_2_right one_add_one rat_poly.assoc rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> computation_swingpos<span class="main">:</span>
<span class="quoted"><span class="quoted">" rat_poly_plus <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> B<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
       <span class="main">(</span>rat_poly_times A <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
               <span class="main">=</span> A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power3_eq_cube<span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> B<span class="main">)</span>
                 <span class="main">=</span> A<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span>B"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse1 numeral_Bit0 power3_eq_cube<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> B<span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> B <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span>B"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 2  
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity mult.commute mult.right_neutral<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> B<span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> B <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inverse1 minus_right_distributivity 
             mult.left_commute mult.right_neutral power2_eq_square power_numeral_odd<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
       <span class="main">(</span>rat_poly_times A <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">=</span>  <span class="main">(</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span><span class="main">(</span> A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                   <span class="keyword1"><span class="command">using</span></span> inverse1 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> B<span class="main">)</span> <span class="main">-</span> B <span class="main">+</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A <span class="main">-</span> A<span class="main">*</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A <span class="main">-</span> A<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
                   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power2_eq_square<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power3_eq_cube<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse1<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> B"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity power3_eq_cube<span class="main">)</span>  
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> power_add
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>B<span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 numeral_3_eq_3 power_Suc power_numeral_odd<span class="main">)</span>
                     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span> 
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power3_eq_cube<span class="main">)</span>   
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>                     
                     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                     <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                     <span class="keyword1"><span class="command">using</span></span> inverse2 
                     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                    <span class="keyword1"><span class="command">using</span></span> s1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>          
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
       <span class="main">(</span>rat_poly_times A <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> B<span class="main">)</span> <span class="main">-</span> B <span class="main">+</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span>  B <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> B<span class="main">)</span> <span class="main">-</span> B <span class="main">+</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> B"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span>  A<span class="main">*</span><span class="main">(</span><span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>A"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_left_distributivity mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power3_eq_cube<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A <span class="main">-</span> B<span class="main">*</span>B<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> inverse2 minus_left_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span>A<span class="main">*</span>A <span class="main">-</span> A<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_semigroup_mult_class.mult_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> power3_eq_cube<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> B"</span></span>
             <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_mult_class.mult.left_neutral<span class="main">)</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span>  A<span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> B"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> computation2<span class="main">:</span>
<span class="quoted"><span class="quoted">" rat_poly_plus <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
       <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
               <span class="main">=</span> B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power3_eq_cube<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> A<span class="main">)</span>
                 <span class="main">=</span> B<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span>A"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> inverse2 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute one_plus_numeral power_add power_one_right semiring_norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
              semiring_norm<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> A <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span>A"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 2 
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_left_distributivity<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> A <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_Bit0 numeral_Bit1<span class="main">)</span> 
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
       <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">=</span>  <span class="main">(</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span><span class="main">(</span> B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity<span class="main">)</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> inverse2
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> A<span class="main">)</span> <span class="main">-</span> A <span class="main">+</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B <span class="main">-</span> B<span class="main">*</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>             
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B <span class="main">-</span> B<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power3_eq_cube<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> A"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity power3_eq_cube<span class="main">)</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> power_add
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>A<span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> A<span class="main">^</span><span class="numeral">5</span>"</span></span>
                     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 numeral_3_eq_3 power_Suc power_numeral_odd<span class="main">)</span>
                   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>
                   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power3_eq_cube<span class="main">)</span>   
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>                     
                   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                      <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                    <span class="keyword1"><span class="command">using</span></span> s1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>          
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
       <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> A<span class="main">)</span> <span class="main">-</span> A <span class="main">+</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span>  A <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> A<span class="main">)</span> <span class="main">-</span> A <span class="main">+</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> A"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span>  B<span class="main">*</span><span class="main">(</span><span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>B"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> minus_left_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_left_distributivity mult.commute<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power3_eq_cube<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span>  inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B<span class="main">*</span>B <span class="main">-</span> B<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_semigroup_mult_class.mult_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> power3_eq_cube<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> A"</span></span>
             <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_mult_class.mult.left_neutral<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span>  B<span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> A"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> computation_swingneg<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span> <span class="main">=</span>
    rat_poly_plus
     <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
       <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> computation2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     

<span class="keyword1"><span class="command">lemma</span></span> computation_toppos<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_inv <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span> <span class="main">=</span>
    rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B"</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
                   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">*</span>A"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>             
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> rat_poly_inv <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span><span class="main">(</span>B <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">*</span>B"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">*</span>B"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> inverse1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
                
<span class="comment1">(*rat_poly_times A (A - rat_poly_times (rat_poly_times B B) B) =
    rat_poly_inv (rat_poly_times B (B - rat_poly_times (rat_poly_times A A) A))*)</span>

<span class="keyword1"><span class="command">lemma</span></span> computation_downpos_prelim<span class="main">:</span>
<span class="quoted"><span class="quoted">"rat_poly_inv <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span> <span class="main">=</span>
    rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A"</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">(</span>B <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
                   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">*</span>B"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> rat_poly_inv <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span><span class="main">(</span>A <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">*</span>A"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span>A <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">*</span>A"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> inverse2   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> computation_downpos<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_times A <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> <span class="main">=</span>
    rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> computation_downpos_prelim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rat_poly.comm<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> computatition_positive_flip<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_plus
     <span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times A B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times A A<span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times A B<span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> B"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times A B<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> B"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> A<span class="main">*</span><span class="main">(</span><span class="main">(</span>A <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span> <span class="main">-</span> B"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
                     <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span> <span class="main">-</span> B"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> B <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">*</span>A<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> computation_negative_flip<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_plus
     <span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times B A<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times B A<span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> A"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_inv <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times B A<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> A"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> B<span class="main">*</span><span class="main">(</span><span class="main">(</span>B <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">*</span>B<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> inverse1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span> <span class="main">-</span> A"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span><span class="main">)</span>
                     <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">)</span> <span class="main">-</span> A"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly_inv <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span> B<span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> A <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> computation_pull_pos_neg<span class="main">:</span>
<span class="quoted"><span class="quoted">"rat_poly_plus <span class="main">(</span>rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A
                       <span class="main">=</span> <span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
                     <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> B<span class="main">*</span><span class="main">(</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">*</span>A<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> minus_left_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span><span class="main">(</span>A<span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">*</span><span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A"</span></span>
                <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"rat_poly_times B <span class="main">(</span>B <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span> A<span class="main">)</span>
                               <span class="main">=</span>  B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B <span class="main">=</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span>B<span class="main">)</span><span class="main">*</span>A"</span></span>
              <span class="keyword1"><span class="command">using</span></span> minus_right_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">*</span>A<span class="main">)</span><span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span> A<span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B<span class="main">*</span>B <span class="main">-</span> A<span class="main">*</span>A <span class="main">+</span> <span class="main">(</span>A<span class="main">*</span>A<span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">*</span>B<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
         <span class="main">=</span> A <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> power3_eq_cube <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_subtract<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
         <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power2_eq_square<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="free">q</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="free">p</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="free">p</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="free">q</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_left_distributivity rat_poly.comm<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span> <span class="free">q</span><span class="main">*</span><span class="free">q</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span> <span class="main">(</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> power2_eq_square <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>

 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cube_minus<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">q</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> 
                <span class="main">=</span> <span class="main">(</span><span class="bound">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="bound">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">q</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="bound">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">q</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 numeral_3_eq_3 power_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> square_subtract <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span> <span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">-</span> <span class="main">(</span><span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_right_distributivity<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> minus_left_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 numeral_3_eq_3 power_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> distrib_left mult_2 power2_eq_square 
               semigroup_mult_class.mult.assoc<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left minus_left_distributivity<span class="main">)</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 numeral_3_eq_3 power_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command">with</span></span> 1 2 3 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span>
                      <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">q</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> 
        <span class="main">=</span> rat_poly_plus <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">-</span> 
                          rat_poly_times 
                              <span class="main">(</span>rat_poly_times <span class="numeral">3</span> <span class="main">(</span><span class="skolem">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> 
                              <span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times <span class="numeral">3</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> 
                                                               <span class="main">-</span> <span class="skolem">q</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> power_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="free">m</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_mult<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> cube_minus2<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">::</span>rat_poly<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> 
                <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> cube_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_poly<span class="main">:</span><span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">*</span><span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">b</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sub1<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="main">*</span><span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> n_distrib<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>A<span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>A<span class="main">*</span>B<span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rat_poly_id_pow<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>rat_poly<span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> power_prod<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>A<span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>B<span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>rat_poly<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_distrib<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> non_zero var_def<span class="main">)</span>      

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Linkrel_Kauffman">
<div class="head">
<h1>Theory Linkrel_Kauffman</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tangle moves and Kauffman bracket›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Linkrel_Kauffman 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Computations.html">Computations</a>
<span class="keyword2"><span class="keyword">begin</span></span> 


<span class="keyword1"><span class="command">lemma</span></span> mat1_vert_wall_left<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"rat_poly.matrix_mult  <span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span>"</span></span>  
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms matrix_kauff_mat<span class="main">)</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span> mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> make_vert_block_map_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_make_vert mat1_mult_left prop_make_vert_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> mat1_vert_wall_right<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"rat_poly.matrix_mult  <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>rat_poly.row_length <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>kauff_mat <span class="free">b</span><span class="main">)</span>"</span></span>  
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms matrix_kauff_mat<span class="main">)</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span> mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> make_vert_block_map_blockmat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat1_rt_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> compress_top_inv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>compress_top <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">⟹</span> kauff_mat <span class="free">w1</span> <span class="main">=</span> kauff_mat <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"compress_top <span class="free">w1</span> <span class="free">w2</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="bound">B</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>codomain_wall <span class="bound">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> compress_top_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="skolem">B</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>codomain_wall <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="skolem">B</span><span class="main">)</span>
                         <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>codomain_wall <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat<span class="main">(</span><span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span>kauff_mat <span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="skolem">B</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> 1 mat1_vert_wall_left <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat<span class="main">(</span><span class="free">w1</span><span class="main">)</span> <span class="main">=</span> kauff_mat <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">w2</span> <span class="main">=</span> kauff_mat <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_mat_compose<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_make_vert_int<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>domain_block <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> <span class="free">n</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> domain_make_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> compress_bottom_inv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>compress_bottom <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">⟹</span> kauff_mat <span class="free">w1</span> <span class="main">=</span> kauff_mat <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"compress_bottom <span class="free">w1</span> <span class="free">w2</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">∘</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>domain_wall <span class="bound">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> compress_bottom_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>domain_wall <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>domain_wall <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                               <span class="main">∧</span><span class="main">(</span>is_tangle_diagram <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat<span class="main">(</span><span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="main">(</span> <span class="skolem">B</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>kauff_mat <span class="skolem">B</span><span class="main">)</span>
                                    <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram <span class="skolem">B</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_tangle_diagram  <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> is_tangle_diagram.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="skolem">B</span> <span class="main">=</span> domain_wall <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"codomain_wall <span class="skolem">B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">B</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> codomain_block_nonnegative<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain_block <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">=</span> codomain_wall <span class="skolem">B</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> domain_make_vert_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_wall.simps<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tangle_compose_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>    
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rat_poly.matrix_mult <span class="main">(</span>kauff_mat <span class="skolem">B</span><span class="main">)</span>
                                    <span class="main">(</span>blockmat <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> tangle_compose_matrix  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="skolem">B</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> 1 mat1_vert_wall_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat<span class="main">(</span><span class="free">w1</span><span class="main">)</span> <span class="main">=</span> kauff_mat <span class="skolem">B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">w2</span> <span class="main">=</span> kauff_mat <span class="skolem">B</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> right_mat_compose<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">theorem</span></span> compress_inv<span class="main">:</span><span class="quoted"><span class="quoted">"compress <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span> <span class="main">=</span> kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> compress_def <span class="keyword1"><span class="command">using</span></span> compress_bottom_inv compress_top_inv
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> striaghten_topdown_computation<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>cap<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span>  kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>kauff_mat_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse1 inverse2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> straighten_topdown_inv<span class="main">:</span><span class="quoted"><span class="quoted">"straighten_topdown <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> straighten_topdown_def <span class="keyword1"><span class="command">using</span></span> striaghten_topdown_computation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> striaghten_downtop_computation<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>cup<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span>  kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span><span class="main">[</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>kauff_mat_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse1 inverse2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> straighten_downtop_inv<span class="main">:</span><span class="quoted"><span class="quoted">"straighten_downtop <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> straighten_downtop_def <span class="keyword1"><span class="command">using</span></span> striaghten_downtop_computation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
<span class="keyword1"><span class="command">theorem</span></span> straighten_inv<span class="main">:</span><span class="quoted"><span class="quoted">"straighten <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> straighten_def <span class="keyword1"><span class="command">using</span></span> straighten_topdown_inv straighten_downtop_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*swing relations*)</span>

<span class="keyword1"><span class="command">lemma</span></span> kauff_mat_swingpos<span class="main">:</span>
 <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span>r_over_braid<span class="main">)</span> <span class="main">=</span> kauff_mat <span class="main">(</span>l_over_braid<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_swingpos<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> swing_pos_inv<span class="main">:</span><span class="quoted"><span class="quoted">"swing_pos <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> swing_pos_def <span class="keyword1"><span class="command">using</span></span> kauff_mat_swingpos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> kauff_mat_swingneg<span class="main">:</span>
<span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span>r_under_braid<span class="main">)</span> <span class="main">=</span> kauff_mat <span class="main">(</span>l_under_braid<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_swingneg<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> swing_neg_inv<span class="main">:</span><span class="quoted"><span class="quoted">"swing_neg <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> swing_neg_def <span class="keyword1"><span class="command">using</span></span> kauff_mat_swingneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> swing_inv<span class="main">:</span>
<span class="quoted"><span class="quoted">"swing <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> swing_def <span class="keyword1"><span class="command">using</span></span> swing_pos_inv swing_neg_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rotate_toppos_kauff_mat<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>over<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span> vert<span class="main">]</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span>  kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>under<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_toppos<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> rotate_toppos_inv<span class="main">:</span><span class="quoted"><span class="quoted">"rotate_toppos <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rotate_toppos_def <span class="keyword1"><span class="command">using</span></span> rotate_toppos_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rotate_topneg_kauff_mat<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>under<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span> vert<span class="main">]</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span>  kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>over<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_toppos<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">lemma</span></span> rotate_topneg_inv<span class="main">:</span><span class="quoted"><span class="quoted">"rotate_topneg <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rotate_topneg_def <span class="keyword1"><span class="command">using</span></span> rotate_topneg_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rotate_downpos_kauff_mat<span class="main">:</span>
 <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>over<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>under<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_downpos<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>     


<span class="keyword1"><span class="command">lemma</span></span> rotate_downpos_inv<span class="main">:</span><span class="quoted"><span class="quoted">"rotate_downpos <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rotate_downpos_def <span class="keyword1"><span class="command">using</span></span> rotate_downpos_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> rotate_downneg_kauff_mat<span class="main">:</span>
 <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>cup<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>under<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>cup<span class="main">]</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">[</span>over<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_downpos<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>     


<span class="keyword1"><span class="command">lemma</span></span> rotate_downneg_inv<span class="main">:</span><span class="quoted"><span class="quoted">"rotate_downneg <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rotate_downneg_def <span class="keyword1"><span class="command">using</span></span> rotate_downneg_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*the matrix is an invariant under rotation *)</span>
<span class="keyword1"><span class="command">theorem</span></span> rotate_inv<span class="main">:</span><span class="quoted"><span class="quoted">"rotate <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> rotate_def <span class="keyword1"><span class="command">using</span></span> rotate_downneg_inv rotate_downpos_inv rotate_topneg_inv   
           rotate_toppos_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*framed_uncross begins*)</span>


<span class="keyword1"><span class="command">lemma</span></span> positive_flip_kauff_mat<span class="main">:</span>
 <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span>left_over<span class="main">)</span> <span class="main">=</span> kauff_mat <span class="main">(</span>right_over<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command">using</span></span> computatition_positive_flip <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
 <span class="keyword1"><span class="command">using</span></span> computatition_positive_flip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     

<span class="keyword1"><span class="command">lemma</span></span> uncross_positive_flip_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"uncross_positive_flip <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> uncross_positive_flip_def <span class="keyword1"><span class="command">using</span></span>  positive_flip_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> negative_flip_kauff_mat<span class="main">:</span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span>left_under<span class="main">)</span> <span class="main">=</span> kauff_mat <span class="main">(</span>right_under<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>  
 <span class="keyword1"><span class="command">using</span></span> computation_negative_flip <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> uncross_negative_flip_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"uncross_negative_flip <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> uncross_negative_flip_def <span class="keyword1"><span class="command">using</span></span>  negative_flip_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> framed_uncross_inv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>framed_uncross <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> framed_uncross_def <span class="keyword1"><span class="command">using</span></span> uncross_negative_flip_inv uncross_positive_flip_inv
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*pull begins here*)</span>

<span class="keyword1"><span class="command">lemma</span></span>  pos_neg_kauff_mat<span class="main">:</span>
<span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>over<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>under<span class="main">]</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse1 inverse2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>computation_pull_pos_neg<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">lemma</span></span> pull_posneg_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"pull_posneg <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> pull_posneg_def <span class="keyword1"><span class="command">using</span></span>  pos_neg_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>  neg_pos_kauff_mat<span class="main">:</span><span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>under<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>over<span class="main">]</span><span class="main">)</span><span class="main">)</span> 
   <span class="main">=</span> kauff_mat <span class="main">(</span><span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>basic <span class="main">[</span>vert<span class="main">,</span>vert<span class="main">]</span><span class="main">)</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse1 inverse2<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> computation_pull_pos_neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> computation_downpos<span class="main">)</span>
         
<span class="keyword1"><span class="command">lemma</span></span> pull_negpos_inv<span class="main">:</span><span class="quoted"><span class="quoted">"pull_negpos <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> pull_negpos_def <span class="keyword1"><span class="command">using</span></span> neg_pos_kauff_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> pull_inv<span class="main">:</span><span class="quoted"><span class="quoted">"pull <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> pull_def <span class="keyword1"><span class="command">using</span></span> pull_posneg_inv pull_negpos_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> slide_inv<span class="main">:</span><span class="quoted"><span class="quoted">"slide <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span> <span class="main">=</span> kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"slide <span class="free">w1</span> <span class="free">w2</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_block <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="bound">B</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>domain_block <span class="bound">B</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> slide_def assm  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span><span class="main">(</span><span class="free">w2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">w1</span> <span class="main">=</span> kauff_mat <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_blockmat row_length_domain_block<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 domain_wall.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">w1</span> <span class="main">=</span> rat_poly.matrix_mult 
                                     <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>domain_wall <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                      <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tangle_compose_matrix is_tangle_diagram.simps 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_Nil kauff_mat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> kauff_mat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  rat_poly.matrix_mult  <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> domain_wall.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> make_vert_block_map_blockmat<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> s1 mat1_mult_left <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> make_vert_equiv_mat prop_make_vert_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">w2</span> <span class="main">=</span> kauff_mat <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>domain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_codomain_block matrix_blockmat row_length_domain_block<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span>  <span class="main">=</span> <span class="main">(</span><span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> 1 domain_wall.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="free">w2</span> <span class="main">=</span> 
                         rat_poly.matrix_mult 
                            <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>kauff_mat <span class="main">(</span>basic <span class="main">(</span>make_vert_block <span class="main">(</span>nat <span class="main">(</span>codomain_wall <span class="main">(</span>basic <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> tangle_compose_matrix is_tangle_diagram.simps 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_Nil kauff_mat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> kauff_mat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  rat_poly.matrix_mult  <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span>mat1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span>codomain_block <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
                             <span class="keyword1"><span class="command">using</span></span> kauff_mat.simps<span class="main">(</span>1<span class="main">)</span> domain_wall.simps<span class="main">(</span>1<span class="main">)</span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blockmat_make_vert codomain_wall.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> make_vert_equiv_mat<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>blockmat <span class="skolem">B</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> s1  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat1_rt_mult<span class="main">)</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> framed_linkrel_inv<span class="main">:</span><span class="quoted"><span class="quoted">"framed_linkrel <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="main">(</span>kauff_mat <span class="free">w1</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>kauff_mat <span class="free">w2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> framed_linkrel_def
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> framed_uncross_inv pull_inv straighten_inv  swing_inv rotate_inv compress_inv slide_inv 
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Kauffman_Invariance">
<div class="head">
<h1>Theory Kauffman_Invariance</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Kauffman\_Invariance: Proving the invariance of Kauffman Bracket›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kauffman_Invariance
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Link_Algebra.html">Link_Algebra</a> <a href="Linkrel_Kauffman.html">Linkrel_Kauffman</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the following theorem, we prove that the kauffman matrix 
 is invariant of framed link invariance›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> kauffman_invariance<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">::</span>wall<span class="main">)</span> <span class="keyword1">~f</span> <span class="free">w2</span> <span class="main">⟹</span> kauff_mat <span class="free">w1</span> <span class="main">=</span> kauff_mat <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>Framed_Tangle_Equivalence.induct<span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> refl
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> sym
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> trans
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> compose_eq
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> compose_eq tangle_compose_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> codomain_compose
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> codomain_compose left_mat_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> domain_compose
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> domain_compose right_mat_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> tensor_eq
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span>  tensor_eq.IH Tensor_Invariance <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> equality
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> framed_linkrel_inv equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rat_poly_times A B <span class="main">=</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> inverse1  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹we calculate kauffman bracket of a few links›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹kauffman bracket of an unknot with zero crossings›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">[</span>cup<span class="main">]</span><span class="main">*</span><span class="main">(</span>basic <span class="main">[</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">-</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>B<span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹kauffman bracket of an a two component unlinked unknot 
    with zero crossings›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">*</span><span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>A<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">+</span><span class="main">(</span>B<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mat_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matT_vec_multI_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>replicate_def rat_poly.row_length_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scalar_prod<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unlink_computation<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trefoil_polynomial</span><span class="main">::</span><span class="quoted"><span class="quoted">"rat_poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">trefoil_polynomial</span> <span class="main">≡</span>
rat_poly_plus
     <span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times A A<span class="main">)</span>
       <span class="main">(</span>rat_poly_plus
         <span class="main">(</span>rat_poly_times B
           <span class="main">(</span>rat_poly_times B
             <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
               <span class="main">(</span>rat_poly_times A A<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
           <span class="main">(</span>rat_poly_plus <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times A A<span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
               <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
                 <span class="main">(</span>rat_poly_times A A<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rat_poly_plus
       <span class="main">(</span>rat_poly_times <span class="numeral">2</span>
         <span class="main">(</span>rat_poly_times A
           <span class="main">(</span>rat_poly_times A
             <span class="main">(</span>rat_poly_times A
               <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times A <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span>
         <span class="main">(</span>rat_poly_times B
           <span class="main">(</span>rat_poly_times <span class="main">(</span>A <span class="main">-</span> rat_poly_times <span class="main">(</span>rat_poly_times B B<span class="main">)</span> B<span class="main">)</span>
             <span class="main">(</span>rat_poly_times B <span class="main">(</span>rat_poly_times B B<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹kauffman bracket of trefoil›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> trefoil<span class="main">:</span>
<span class="quoted"><span class="quoted">"kauff_mat <span class="main">(</span><span class="main">[</span>cup<span class="main">,</span>cup<span class="main">]</span><span class="main">*</span><span class="main">[</span>vert<span class="main">,</span>over<span class="main">,</span>vert<span class="main">]</span><span class="main">*</span><span class="main">[</span>vert<span class="main">,</span>over<span class="main">,</span>vert<span class="main">]</span><span class="main">*</span><span class="main">[</span>vert<span class="main">,</span>over<span class="main">,</span>vert<span class="main">]</span>
              <span class="main">*</span><span class="main">(</span>basic <span class="main">[</span>cap<span class="main">,</span>cap<span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">[</span><span class="main">[</span>trefoil_polynomial<span class="main">]</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_multI_def matT_vec_multI_def rat_poly.row_length_def
   scalar_prod trefoil_polynomial_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Knot_Theory">
<div class="head">
<h1>Theory Knot_Theory</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Knot_Theory
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Kauffman_Invariance.html">Kauffman_Invariance</a> <a href="Example.html">Example</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>