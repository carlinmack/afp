<div id="Preliminaries">
<div class="head">
<h1>Theory Preliminaries</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Preliminaries
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Cardinals/Cardinals.html">HOL-Cardinals.Cardinals</a>"</span>
        <span class="quoted">"<a href="../../HOL/HOL-Library/Countable_Set_Type.html">HOL-Library.Countable_Set_Type</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscelanea›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A fixed countable universe for interpreting countable models:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> univ <span class="main">=</span> UU <span class="quoted">nat</span>

<span class="keyword1" id="Preliminaries-infinite_univ"><span class="command">lemma</span></span> infinite_univ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> univ set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> infinite_iff_card_of_nat card_of_ordLeq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-countable_univ"><span class="command">lemma</span></span> countable_univ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>UNIV <span class="main">::</span> univ set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> countable_card_of_nat <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> surj_imp_ordLeq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">UU</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_UNIV surj_def univ.exhaust<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Picking an element from a nonempty set (Hilbert choice for sets):›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pick</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1" id="Preliminaries-pick"><span class="command">lemma</span></span> pick<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> pick <span class="free">X</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> pick_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> someI_ex<span class="main">)</span>

<span class="keyword1" id="Preliminaries-pick_NE"><span class="command">lemma</span></span> pick_NE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> pick <span class="free">X</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sappend</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">@@</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Al</span></span></span> <span class="main"><span class="free">@@</span></span> <span class="free"><span class="bound"><span class="entity">Bl</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">al</span> <span class="main">@</span> <span class="bound">bl</span> <span class="main">|</span> <span class="bound">al</span> <span class="bound">bl</span><span class="main">.</span> <span class="bound">al</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Al</span></span></span> <span class="main">∧</span> <span class="bound">bl</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Bl</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Preliminaries-sappend_NE"><span class="command">lemma</span></span> sappend_NE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">@@</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sappend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fst3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span> <span class="main">*</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fst3</span> <span class="free"><span class="bound"><span class="entity">abc</span></span></span> <span class="main">≡</span> fst <span class="free"><span class="bound"><span class="entity">abc</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">snd3</span> <span class="free"><span class="bound"><span class="entity">abc</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">abc</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">trd3</span> <span class="free"><span class="bound"><span class="entity">abc</span></span></span> <span class="main">≡</span> snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">abc</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> int

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">any</span> <span class="main">≡</span> undefined"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Non-emptyness of predicates:›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">NE</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="bound">a</span>"</span></span>

<span class="keyword1" id="Preliminaries-NE_NE"><span class="command">lemma</span></span> NE_NE<span class="main">:</span> <span class="quoted"><span class="quoted">"NE NE"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">.</span></span> True"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-length_Suc_0"><span class="command">lemma</span></span> length_Suc_0<span class="main">:</span>
<span class="quoted"><span class="quoted">"length <span class="free">al</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="free">al</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> length_0_conv length_Suc_conv<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹List combinators›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> list_all2_length <span class="main">=</span> list_all2_conv_all_nth
<span class="keyword1"><span class="command">lemmas</span></span> list_eq_iff <span class="main">=</span> list_eq_iff_nth_eq
<span class="keyword1"><span class="command">lemmas</span></span> list_all_iff
<span class="keyword1"><span class="command">lemmas</span></span> list_all_length

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">singl</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Preliminaries-length_singl"><span class="command">lemma</span></span> length_singl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>singl <span class="free">a</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> singl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Preliminaries-hd_singl"><span class="command">lemma</span></span> hd_singl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>singl <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> singl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Preliminaries-hd_o_singl"><span class="command">lemma</span></span> hd_o_singl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="keyword1">o</span> singl <span class="main">=</span> id"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> comp_def fun_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Preliminaries-singl_hd"><span class="command">lemma</span></span> singl_hd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">al</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">⟹</span> singl <span class="main">(</span>hd <span class="free">al</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> singl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">al</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Preliminaries-singl_inj"><span class="command">lemma</span></span> singl_inj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singl <span class="free">a</span> <span class="main">=</span> singl <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> singl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* The list of a finite set: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">al</span><span class="main">.</span> distinct <span class="bound">al</span> <span class="main">∧</span> set <span class="bound">al</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="Preliminaries-distinct_set_list"><span class="command">lemma</span></span> distinct_set_list<span class="main">:</span>
<span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> distinct <span class="main">(</span>list <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> finite_distinct_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> distinct_list<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> distinct_set_list<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> set_list<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> distinct_set_list<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1" id="Preliminaries-set_list_set"><span class="command">lemma</span></span> set_list_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>list <span class="main">(</span>set <span class="free">xl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-length_list"><span class="command">lemma</span></span> length_list<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> length <span class="main">(</span>list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card distinct_set_list<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all_mp"><span class="command">lemma</span></span> list_all_mp<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">ψ</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"list_all <span class="free">φ</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all <span class="free">ψ</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all_map"><span class="command">lemma</span></span> list_all_map<span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all <span class="free">φ</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> list_all <span class="main">(</span><span class="free">φ</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> length_map list_all_length nth_map o_def<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_Emp"><span class="command">lemma</span></span> list_Emp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"list <span class="main">{}</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_empty2 set_list_set<span class="main">)</span>

<span class="keyword1" id="Preliminaries-distinct_set_eq_Singl"><span class="command">lemma</span></span> distinct_set_eq_Singl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">al</span> <span class="main">⟹</span> set <span class="free">al</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">al</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">al</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> List.set_simps distinct.simps
           distinct_singleton empty_not_insert insert_eq_iff set_empty2<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_Singl"><span class="command">lemma</span></span> list_Singl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"list <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> some_equality<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_insert"><span class="command">lemma</span></span> list_insert<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">al1</span> <span class="bound">al2</span><span class="main">.</span>
   <span class="free">A</span> <span class="main">=</span> set <span class="main">(</span><span class="bound">al1</span> <span class="main">@</span> <span class="bound">al2</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="bound">al1</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span> <span class="main">@</span> <span class="bound">al2</span><span class="main">)</span> <span class="main">∧</span>
   list <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">al1</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span> <span class="main">@</span> <span class="bound">al2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>list <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">al1</span></span> <span class="skolem"><span class="skolem">al2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"list <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">al1</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">al2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons eq_Nil_appendI split_list_last<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">al1</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">al2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_set_list finite_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">al1</span> <span class="main">@</span> <span class="skolem">al2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">b</span> <span class="free">A</span> <span class="main">=</span> insert <span class="free">b</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">al1</span> <span class="main">@</span> <span class="skolem">al2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 0 set_list<span class="main">[</span><span class="operator">OF</span> finite.insertI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">al1</span> <span class="main">@</span> <span class="skolem">al2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preliminaries-list_all_list"><span class="command">lemma</span></span> list_all_list<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all <span class="free">φ</span> <span class="main">(</span>list <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Preliminaries-list_ex_list"><span class="command">lemma</span></span> list_ex_list<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> list_ex <span class="free">φ</span> <span class="main">(</span>list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_ex_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹list update:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lupd</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lupd</span> Nil Nil <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lupd</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bl</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="free">lupd</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="free"><span class="bound"><span class="entity">bl</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lupd</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> any"</span></span>

<span class="keyword1" id="Preliminaries-set_lupd"><span class="command">lemma</span></span> set_lupd<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">al</span> <span class="main">∨</span> <span class="free">F1</span> <span class="free">a</span> <span class="main">=</span> <span class="free">F2</span> <span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lupd <span class="free">al</span> <span class="free">bl</span> <span class="free">F1</span> <span class="free">a</span> <span class="main">=</span> lupd <span class="free">al</span> <span class="free">bl</span> <span class="free">F2</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F1</span></span> <span class="quoted"><span class="free">F2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-lupd_map"><span class="command">lemma</span></span> lupd_map<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">al</span> <span class="main">=</span> length <span class="free">bl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">∈</span> set <span class="free">al</span> <span class="main">∨</span> <span class="free">G</span> <span class="free">a1</span> <span class="main">=</span> <span class="free">F</span> <span class="main">(</span><span class="free">H</span> <span class="free">a1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lupd <span class="free">al</span> <span class="main">(</span>map <span class="free">F</span> <span class="free">bl</span><span class="main">)</span> <span class="free">G</span> <span class="free">a1</span> <span class="main">=</span> <span class="free">F</span> <span class="main">(</span>lupd <span class="free">al</span> <span class="free">bl</span> <span class="free">H</span> <span class="free">a1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-nth_map2"><span class="command">lemma</span></span> nth_map2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">bl</span> <span class="main">=</span> length <span class="free">al</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map2 <span class="free">f</span> <span class="free">al</span> <span class="free">bl</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">bl</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_Nil_iff"><span class="command">lemma</span></span> list_all2_Nil_iff<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_NilL"><span class="command">lemma</span></span> list_all2_NilL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="main">[]</span> <span class="free">ys</span> <span class="main">⟷</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> list_all2_Nil_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_NilR"><span class="command">lemma</span></span> list_all2_NilR<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> list_all2_Nil_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_ConsL"><span class="command">lemma</span></span> list_all2_ConsL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs'</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span> <span class="bound">ys'</span><span class="main">.</span> <span class="free">ys</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys'</span> <span class="main">∧</span> <span class="free">R</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">∧</span> list_all2 <span class="free">R</span> <span class="free">xs'</span> <span class="bound">ys'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_elimL"><span class="command">lemma</span></span> list_all2_elimL<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> Cons<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span> <span class="bound">ys'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">ys</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys'</span><span class="main">;</span> <span class="free">R</span> <span class="free">x</span> <span class="bound">y</span><span class="main">;</span> list_all2 <span class="free">R</span> <span class="free">xs'</span> <span class="bound">ys'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> list_all2_ConsL assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Preliminaries-list_all2_elimL2"><span class="command">lemma</span></span> list_all2_elimL2<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Cons<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs'</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span> <span class="bound">ys'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">ys</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys'</span><span class="main">;</span> <span class="free">R</span> <span class="free">x</span> <span class="bound">y</span><span class="main">;</span> list_all2 <span class="free">R</span> <span class="free">xs'</span> <span class="bound">ys'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> list_all2_ConsL assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Preliminaries-list_all2_ConsR"><span class="command">lemma</span></span> list_all2_ConsR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">xs'</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="bound">xs'</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">x</span> <span class="free">y</span> <span class="main">∧</span> list_all2 <span class="free">R</span> <span class="bound">xs'</span> <span class="free">ys'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_elimR"><span class="command">lemma</span></span> list_all2_elimR<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> Cons<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">xs'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">xs</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="bound">xs'</span><span class="main">;</span> <span class="free">R</span> <span class="bound">x</span> <span class="free">y</span><span class="main">;</span> list_all2 <span class="free">R</span> <span class="bound">xs'</span> <span class="free">ys'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> list_all2_ConsR assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Preliminaries-list_all2_elimR2"><span class="command">lemma</span></span> list_all2_elimR2<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Cons<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">xs'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">xs</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="bound">xs'</span><span class="main">;</span> <span class="free">R</span> <span class="bound">x</span> <span class="free">y</span><span class="main">;</span> list_all2 <span class="free">R</span> <span class="bound">xs'</span> <span class="free">ys'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> list_all2_ConsR assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Preliminaries-ex_list_all2"><span class="command">lemma</span></span> ex_list_all2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ys</span><span class="main">.</span> list_all2 <span class="free">f</span> <span class="free">xs</span> <span class="bound">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_simps insertCI list_all2_Cons<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all2_cong"><span class="command">lemma</span></span> list_all2_cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs1</span> <span class="main">=</span> <span class="free">ys1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs2</span> <span class="main">=</span> <span class="free">ys2</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs2</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span><span class="free">xs1</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">xs2</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">R'</span> <span class="main">(</span><span class="free">ys1</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ys2</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs1</span> <span class="free">xs2</span> <span class="main">⟷</span> list_all2 <span class="free">R'</span> <span class="free">ys1</span> <span class="free">ys2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms list_all2_length<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all2_o"><span class="command">lemma</span></span> list_all2_o<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span> <span class="free">bl</span> <span class="main">=</span> list_all2 <span class="free">P</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">al</span><span class="main">)</span> <span class="free">bl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_all2_map1 comp_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Preliminaries-set_size_list"><span class="command">lemma</span></span> set_size_list<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> size_list <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms size_list_estimation' order_eq_refl<span class="main">)</span>

<span class="keyword1" id="Preliminaries-nth_size_list"><span class="command">lemma</span></span> nth_size_list<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">≤</span> size_list <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms nth_mem set_size_list<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all2_list_all"><span class="command">lemma</span></span> list_all2_list_all<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟷</span>
 length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">∧</span> list_all <span class="free">f</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_all2_length list_all_length<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all2_list_allR"><span class="command">lemma</span></span> list_all2_list_allR<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟷</span>
 length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">∧</span> list_all <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> list_all2_length list_all_length<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all2_list_all_2"><span class="command">lemma</span></span> list_all2_list_all_2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all2 <span class="free">f</span> <span class="free">xs</span> <span class="free">xs</span> <span class="main">⟷</span> list_all <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_iff list_all_iff zip_same<span class="main">)</span>

<span class="keyword1" id="Preliminaries-list_all2_map_map"><span class="command">lemma</span></span> list_all2_map_map<span class="main">:</span>
<span class="quoted"><span class="quoted">"list_all2 <span class="free">φ</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="free">g</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">T</span><span class="main">.</span> <span class="free">φ</span> <span class="main">(</span><span class="free">f</span> <span class="bound">T</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_all2_map1 list_all2_map2 list_all2_list_all_2 <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Preliminaries-length_map2"><span class="command">lemma</span></span> length_map2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map2 <span class="free">f</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-listAll2_map2I"><span class="command">lemma</span></span> listAll2_map2I<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="main">(</span>map2 <span class="free">f</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> list_all2I<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> set_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*
lemma listAll2_map2I[intro?]:
assumes "length xs = length ys" and "⋀ x y. R x (f x y)"
shows "list_all2 R xs (map2 f xs ys)"
apply(rule list_all2I) using assms unfolding set_zip map2_def by auto
*)</span>

<span class="keyword1" id="Preliminaries-set_incl_pred"><span class="command">lemma</span></span> set_incl_pred<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span><span class="main">.</span> <span class="free">A</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> predicate1D predicate1I<span class="main">)</span>

<span class="keyword1" id="Preliminaries-set_incl_pred2"><span class="command">lemma</span></span> set_incl_pred2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a1</span> <span class="bound">a2</span><span class="main">.</span> <span class="free">A</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a1</span> <span class="bound">a2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> predicate2I rev_predicate2D<span class="main">)</span>

<span class="keyword1" id="Preliminaries-set_incl_pred3"><span class="command">lemma</span></span> set_incl_pred3<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">a3</span><span class="main">.</span> <span class="free">A</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">a3</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">a3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a1</span><span class="main">.</span> <span class="free">A</span> <span class="bound">a1</span> <span class="main">≤</span> <span class="free">B</span> <span class="bound">a1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_funD le_funI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iff_allI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_incl_pred2 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preliminaries-set_incl_pred4"><span class="command">lemma</span></span> set_incl_pred4<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">a3</span> <span class="bound">a4</span><span class="main">.</span> <span class="free">A</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">a3</span> <span class="bound">a4</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">a3</span> <span class="bound">a4</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a1</span><span class="main">.</span> <span class="free">A</span> <span class="bound">a1</span> <span class="main">≤</span> <span class="free">B</span> <span class="bound">a1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_funD le_funI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iff_allI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_incl_pred3 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preliminaries-list_all_mono"><span class="command">lemma</span></span> list_all_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="main">≤</span> <span class="free">chi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all <span class="free">phi</span> <span class="main">≤</span> list_all <span class="free">chi</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> set_incl_pred list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-list_all2_mono"><span class="command">lemma</span></span> list_all2_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="main">≤</span> <span class="free">chi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">phi</span> <span class="main">≤</span> list_all2 <span class="free">chi</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> list_all2_mono set_incl_pred2<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Variables›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The type of variables:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> var <span class="main">=</span> Variable <span class="quoted">nat</span>

<span class="keyword1" id="Preliminaries-card_of_var"><span class="command">lemma</span></span> card_of_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>UNIV<span class="main">::</span>var set<span class="main">|</span> <span class="keyword1">=o</span> natLeq"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>UNIV<span class="main">::</span>var set<span class="main">|</span> <span class="keyword1">=o</span> <span class="main">|</span>UNIV<span class="main">::</span>nat set<span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ordIso_symmetric<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> card_of_ordIsoI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def surj_def <span class="keyword1"><span class="command">using</span></span> var.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>UNIV<span class="main">::</span>nat set<span class="main">|</span> <span class="keyword1">=o</span> natLeq"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> card_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preliminaries-infinite_var"><span class="command">lemma</span></span> infinite_var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> var set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> card_of_var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordIso_natLeq_infinite1<span class="main">)</span>

<span class="keyword1" id="Preliminaries-countable_var"><span class="command">lemma</span></span> countable_var<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>UNIV <span class="main">::</span> var set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> var set<span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> countable_card_of_nat <span class="keyword1"><span class="command">unfolding</span></span> card_of_ordLeq2<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">OF</span> 0<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">Variable</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* FIXME: Move into Countable_Set *)</span>
<span class="keyword1" id="Preliminaries-countable_infinite"><span class="command">lemma</span></span> countable_infinite<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="keyword1">≤o</span> <span class="main">|</span><span class="free">B</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="keyword1">≤o</span> natLeq"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> countable_card_le_natLeq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"natLeq <span class="keyword1">≤o</span> <span class="main">|</span><span class="free">B</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B infinite_iff_natLeq_ordLeq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Partitioning V in two infinite disjoint sets *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">part12_pred</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span> <span class="main">≡</span>
 <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span> <span class="main">∪</span> snd <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span> <span class="main">∩</span> snd <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
 infinite <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span><span class="main">)</span> <span class="main">∧</span> infinite <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">V1_V2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">part12</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">V1_V2</span><span class="main">.</span> part12_pred <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="bound">V1_V2</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">part1</span> <span class="main">=</span> fst <span class="keyword1">o</span> part12"</span></span>  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">part2</span> <span class="main">=</span> snd <span class="keyword1">o</span> part12"</span></span>

<span class="keyword1" id="Preliminaries-part12_pred"><span class="command">lemma</span></span> part12_pred<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="free">V</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">V1_V2</span><span class="main">.</span> part12_pred <span class="free">V</span> <span class="bound">V1_V2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinite_iff_countable_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">`</span> UNIV"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">`</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="var">?u</span> <span class="main">∧</span> inj <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="var">?A</span> <span class="main">∧</span> infinite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="var">?A</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">-</span> <span class="var">?V1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="var">?V1</span> <span class="main">∪</span> <span class="var">?V2</span> <span class="main">∧</span> <span class="var">?V1</span> <span class="main">∩</span> <span class="var">?V2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?V1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 f
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imageD subset_inj_on top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="var">?B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 f
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imageD subset_inj_on top_greatest<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="var">?B</span> <span class="main">⊆</span> <span class="var">?V2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_eq<span class="main">)</span> <span class="operator">arith</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?V2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinite_super<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> part12_pred_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="var"><span class="var"><span class="var">?V1</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="var"><span class="var"><span class="var">?V2</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preliminaries-part12"><span class="command">lemma</span></span> part12<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"part12_pred <span class="free">V</span> <span class="main">(</span>part12 <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part12_pred<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> part12_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>

<span class="keyword1" id="Preliminaries-part1_Un_part2"><span class="command">lemma</span></span> part1_Un_part2<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span> <span class="main">⟹</span> part1 <span class="free">V</span> <span class="main">∪</span> part2 <span class="free">V</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part12 <span class="keyword1"><span class="command">unfolding</span></span> part1_def part2_def part12_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-part1_Int_part2"><span class="command">lemma</span></span> part1_Int_part2<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span> <span class="main">⟹</span> part1 <span class="free">V</span> <span class="main">∩</span> part2 <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part12 <span class="keyword1"><span class="command">unfolding</span></span> part1_def part2_def part12_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-infinite_part1"><span class="command">lemma</span></span> infinite_part1<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span> <span class="main">⟹</span> infinite <span class="main">(</span>part1 <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part12 <span class="keyword1"><span class="command">unfolding</span></span> part1_def part12_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-part1_su"><span class="command">lemma</span></span> part1_su<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span> <span class="main">⟹</span> part1 <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part1_Un_part2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-infinite_part2"><span class="command">lemma</span></span> infinite_part2<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span> <span class="main">⟹</span> infinite <span class="main">(</span>part2 <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part12 <span class="keyword1"><span class="command">unfolding</span></span> part2_def part12_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preliminaries-part2_su"><span class="command">lemma</span></span> part2_su<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">V</span> <span class="main">⟹</span> part2 <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part1_Un_part2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TermsAndClauses">
<div class="head">
<h1>Theory TermsAndClauses</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Syntax of Terms and Clauses›</span></span>
<span class="keyword1"><span class="command">theory</span></span> TermsAndClauses
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Preliminaries.html">Preliminaries</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span>
<span class="quoted"><span class="plain_text">‹These are used for both unsorted and many-sorted FOL, the difference being that,
for the latter, the signature will fix a variable typing.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Terms:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'fsym</span> trm <span class="main">=</span>
  Var <span class="quoted">var</span> <span class="main">|</span>
  Fn <span class="tfree"><span class="quoted"><span class="tfree">'fsym</span></span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> trm list"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Atomic formulas (atoms):›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> atm <span class="main">=</span>
  Eq <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> trm"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> trm"</span></span> <span class="main">|</span>
  Pr <span class="tfree"><span class="quoted"><span class="tfree">'psym</span></span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> trm list"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Literals:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> lit <span class="main">=</span>
  Pos <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> atm"</span></span> <span class="main">|</span>
  Neg <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> atm"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Clauses:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> cls <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> lit list"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Problems:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> cls set"</span></span>

<span class="keyword1" id="TermsAndClauses-trm_induct"><span class="command">lemma</span></span> trm_induct<span class="main">[</span><span class="operator">case_names</span> Var Fn<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> trm<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">φ</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span> <span class="bound">Tl</span><span class="main">.</span> list_all <span class="free">φ</span> <span class="bound">Tl</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">(</span>Fn <span class="bound">f</span> <span class="bound">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> trm.induct<span class="main">)</span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vars</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">vars</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vars</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">vars</span> <span class="main">`</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">varsA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">varsA</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">varsA</span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map vars <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">varsL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">varsL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> varsA <span class="free"><span class="bound"><span class="entity">at</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">varsL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> varsA <span class="free"><span class="bound"><span class="entity">at</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">varsC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map varsL <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">varsPB</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>varsC <span class="bound">c</span> <span class="main">|</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Substitution:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">substA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">substA</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">substA</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">substL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">substL</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> Pos <span class="main">(</span>substA <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">substL</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>substA <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">substC</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> map <span class="main">(</span>substL <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">substPB</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">=</span> <span class="main">{</span>substC <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="bound">c</span> <span class="main">|</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="TermsAndClauses-subst_cong"><span class="command">lemma</span></span> subst_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> vars <span class="free">T</span> <span class="main">⟹</span> <span class="free">π1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">π2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">π1</span> <span class="free">T</span> <span class="main">=</span> subst <span class="free">π2</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-substA_congA"><span class="command">lemma</span></span> substA_congA<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsA <span class="free">at</span> <span class="main">⟹</span> <span class="free">π1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">π2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substA <span class="free">π1</span> <span class="free">at</span> <span class="main">=</span> substA <span class="free">π2</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms subst_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-substL_congL"><span class="command">lemma</span></span> substL_congL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsL <span class="free">l</span> <span class="main">⟹</span> <span class="free">π1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">π2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substL <span class="free">π1</span> <span class="free">l</span> <span class="main">=</span> substL <span class="free">π2</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms substA_congA<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-substC_congC"><span class="command">lemma</span></span> substC_congC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsC <span class="free">c</span> <span class="main">⟹</span> <span class="free">π1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">π2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substC <span class="free">π1</span> <span class="free">c</span> <span class="main">=</span> substC <span class="free">π2</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substL_congL<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> substC_def varsC_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-substPB_congPB"><span class="command">lemma</span></span> substPB_congPB<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsPB <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">π1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">π2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substPB <span class="free">π1</span> <span class="free">Φ</span> <span class="main">=</span> substPB <span class="free">π2</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substC_congC<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> substPB_def varsPB_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> substC_congC<span class="main">)</span> 

<span class="keyword1" id="TermsAndClauses-vars_subst"><span class="command">lemma</span></span> vars_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>subst <span class="free">π</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> vars <span class="free">T</span><span class="main">.</span> vars <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-varsA_substA"><span class="command">lemma</span></span> varsA_substA<span class="main">:</span>
<span class="quoted"><span class="quoted">"varsA <span class="main">(</span>substA <span class="free">π</span> <span class="free">at</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> varsA <span class="free">at</span><span class="main">.</span> vars <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> vars_subst<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">π</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-varsL_substL"><span class="command">lemma</span></span> varsL_substL<span class="main">:</span>
<span class="quoted"><span class="quoted">"varsL <span class="main">(</span>substL <span class="free">π</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> varsL <span class="free">l</span><span class="main">.</span> vars <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> varsA_substA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">π</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-varsC_substC"><span class="command">lemma</span></span> varsC_substC<span class="main">:</span>
<span class="quoted"><span class="quoted">"varsC <span class="main">(</span>substC <span class="free">π</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> varsC <span class="free">c</span><span class="main">.</span> vars <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> substC_def varsC_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">unfolding</span></span> substC_def varsC_def map_map set_map
  <span class="keyword1"><span class="command">unfolding</span></span> comp_def varsL_substL <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TermsAndClauses-varsPB_Un"><span class="command">lemma</span></span> varsPB_Un<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"varsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">∪</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">=</span> varsPB <span class="free">Φ1</span> <span class="main">∪</span> varsPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndClauses-varsC_append"><span class="command">lemma</span></span> varsC_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"varsC <span class="main">(</span><span class="free">c1</span> <span class="main">@</span> <span class="free">c2</span><span class="main">)</span> <span class="main">=</span> varsC <span class="free">c1</span> <span class="main">∪</span> varsC <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> varsC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndClauses-varsPB_sappend_incl"><span class="command">lemma</span></span> varsPB_sappend_incl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"varsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">⊆</span>  varsPB <span class="free">Φ1</span> <span class="main">∪</span> varsPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> varsPB_def sappend_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-varsPB_sappend"><span class="command">lemma</span></span> varsPB_sappend<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Φ1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Φ2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"varsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">=</span> varsPB <span class="free">Φ1</span> <span class="main">∪</span> varsPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsPB <span class="free">Φ1</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsC <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">∈</span> <span class="free">Φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">∈</span> <span class="free">Φ2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">unfolding</span></span> varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sappend_def varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsPB <span class="free">Φ2</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsC <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">∈</span> <span class="free">Φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">∈</span> <span class="free">Φ2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sappend_def varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">unfold</span> varsPB_def sappend_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-varsPB_substPB"><span class="command">lemma</span></span> varsPB_substPB<span class="main">:</span>
<span class="quoted"><span class="quoted">"varsPB <span class="main">(</span>substPB <span class="free">π</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> varsPB <span class="free">Φ</span><span class="main">.</span> vars <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?K</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsPB <span class="main">(</span>substPB <span class="free">π</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">Φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsC <span class="main">(</span>substC <span class="free">π</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> varsPB_def substPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> varsC_substC varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> varsPB <span class="free">Φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars <span class="main">(</span><span class="free">π</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">Φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> varsC <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsC <span class="main">(</span>substC <span class="free">π</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> varsC_substC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> varsPB <span class="main">(</span>substPB <span class="free">π</span> <span class="free">Φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">unfolding</span></span> varsPB_def substPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndClauses-subst_o"><span class="command">lemma</span></span> subst_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"subst <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> subst <span class="free">π1</span> <span class="main">(</span>subst <span class="free">π2</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-o_subst"><span class="command">lemma</span></span> o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"subst <span class="free">π1</span> <span class="keyword1">o</span> subst <span class="free">π2</span> <span class="main">=</span> subst <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> subst_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="TermsAndClauses-substA_o"><span class="command">lemma</span></span> substA_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"substA <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span> <span class="free">at</span> <span class="main">=</span> substA <span class="free">π1</span> <span class="main">(</span>substA <span class="free">π2</span> <span class="free">at</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> subst_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-o_substA"><span class="command">lemma</span></span> o_substA<span class="main">:</span>
<span class="quoted"><span class="quoted">"substA <span class="free">π1</span> <span class="keyword1">o</span> substA <span class="free">π2</span> <span class="main">=</span> substA <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> substA_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="TermsAndClauses-substL_o"><span class="command">lemma</span></span> substL_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"substL <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> substL <span class="free">π1</span> <span class="main">(</span>substL <span class="free">π2</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substA_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-o_substL"><span class="command">lemma</span></span> o_substL<span class="main">:</span>
<span class="quoted"><span class="quoted">"substL <span class="free">π1</span> <span class="keyword1">o</span> substL <span class="free">π2</span> <span class="main">=</span> substL <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> substL_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="TermsAndClauses-substC_o"><span class="command">lemma</span></span> substC_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"substC <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> substC <span class="free">π1</span> <span class="main">(</span>substC <span class="free">π2</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substL_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> substC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-o_substC"><span class="command">lemma</span></span> o_substC<span class="main">:</span>
<span class="quoted"><span class="quoted">"substC <span class="free">π1</span> <span class="keyword1">o</span> substC <span class="free">π2</span> <span class="main">=</span> substC <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> substC_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="TermsAndClauses-substPB_o"><span class="command">lemma</span></span> substPB_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"substPB <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span> <span class="free">Φ</span> <span class="main">=</span> substPB <span class="free">π1</span> <span class="main">(</span>substPB <span class="free">π2</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substC_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">π1</span></span> <span class="quoted"><span class="free">π2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> substPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndClauses-o_substPB"><span class="command">lemma</span></span> o_substPB<span class="main">:</span>
<span class="quoted"><span class="quoted">"substPB <span class="free">π1</span> <span class="keyword1">o</span> substPB <span class="free">π2</span> <span class="main">=</span> substPB <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> substPB_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="TermsAndClauses-finite_vars"><span class="command">lemma</span></span> finite_vars<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-finite_varsA"><span class="command">lemma</span></span> finite_varsA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varsA <span class="free">at</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> finite_vars <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-finite_varsL"><span class="command">lemma</span></span> finite_varsL<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varsL <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> finite_varsA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-finite_varsC"><span class="command">lemma</span></span> finite_varsC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varsC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> finite_varsL <span class="keyword1"><span class="command">unfolding</span></span> varsC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="TermsAndClauses-finite_varsPB"><span class="command">lemma</span></span> finite_varsPB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> finite <span class="main">(</span>varsPB <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> finite_varsC <span class="keyword1"><span class="command">unfolding</span></span> varsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_Union<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sig">
<div class="head">
<h1>Theory Sig</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Many-Typed (Many-Sorted) First-Order Logic›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Sig <span class="keyword2"><span class="keyword">imports</span></span> <a href="Preliminaries.html">Preliminaries</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this formalization, we call ``types" what the first-order logic community usually calls ``sorts".›</span></span> 


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Signatures›</span></span> 

<span class="keyword1"><span class="command">locale</span></span> Signature <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
    countable_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'tp</span> set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> countable_wtFsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">{</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'fsym</span><span class="main">.</span> <span class="free">wtFsym</span> <span class="bound">f</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> countable_wtPsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">{</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'psym</span><span class="main">.</span> <span class="free">wtPsym</span> <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Partitioning of the variables in countable sets for each type:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tpOfV_pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>var <span class="main">⇒</span> <span class="tfree">'tp</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tpOfV_pred</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">σ</span><span class="main">.</span> infinite <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-`</span> <span class="main">{</span><span class="bound">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tpOfV</span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">f</span><span class="main">.</span> tpOfV_pred <span class="bound">f</span>"</span></span>

<span class="keyword1" id="Sig-infinite_fst_vimage"><span class="command">lemma</span></span> infinite_fst_vimage<span class="main">:</span>
<span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">(</span>fst <span class="main">::</span> <span class="tfree">'a</span> <span class="main">×</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="var">?f</span> <span class="main">-`</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">-`</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">|</span> <span class="bound">n</span> <span class="main">.</span> True<span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> range <span class="main">(</span>Pair <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> range_inj_infinite<span class="main">)</span>
   <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sig-tpOfV_pred"><span class="command">lemma</span></span> tpOfV_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span><span class="main">.</span> tpOfV_pred <span class="bound">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ut</span></span> <span class="skolem"><span class="skolem">Uv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ut</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'tp</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Uv</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">::</span> var set<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Unt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Unt</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">U2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U2</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'tp</span> <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> U2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U2</span> <span class="main">≡</span> <span class="skolem">Ut</span> <span class="main">×</span> <span class="skolem">Unt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ut_def Unt_def U2_def UNIV_Times_UNIV <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">U2</span><span class="main">|</span> <span class="keyword1">=o</span> <span class="main">|</span><span class="skolem">Unt</span> <span class="main">×</span> <span class="skolem">Ut</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> U2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_of_Times_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">Unt</span> <span class="main">×</span> <span class="skolem">Ut</span><span class="main">|</span> <span class="keyword1">=o</span> <span class="main">|</span><span class="skolem">Unt</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_of_Times_infinite_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Ut_def Unt_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat_not_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_not_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> countable_card_of_nat countable_tp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">Unt</span><span class="main">|</span> <span class="keyword1">=o</span> <span class="main">|</span><span class="skolem">Uv</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ordIso_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unt_def Uv_def <span class="keyword1"><span class="command">using</span></span> card_of_var card_of_nat<span class="main">[</span><span class="operator">THEN</span> ordIso_symmetric<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> ordIso_transitive<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">U2</span><span class="main">|</span> <span class="keyword1">=o</span> <span class="main">|</span><span class="skolem">Uv</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">Uv</span><span class="main">|</span> <span class="keyword1">=o</span> <span class="main">|</span><span class="skolem">U2</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> ordIso_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="skolem">Uv</span> <span class="skolem">U2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card_of_ordIso<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="keyword1"><span class="keyword1">o</span></span> <span class="skolem"><span class="skolem">g</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> tpOfV_pred_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command">unfolding</span></span> vimage_comp <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> finite_vimageD<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def Uv_def U2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_fst_vimage<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sig-tpOfV_pred_tpOfV"><span class="command">lemma</span></span> tpOfV_pred_tpOfV<span class="main">:</span> <span class="quoted"><span class="quoted">"tpOfV_pred tpOfV"</span></span>
<span class="keyword1"><span class="command">using</span></span> tpOfV_pred <span class="keyword1"><span class="command">unfolding</span></span> tpOfV_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>

<span class="keyword1" id="Sig-tpOfV"><span class="command">lemma</span></span> tpOfV<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>tpOfV <span class="main">-`</span> <span class="main">{</span><span class="free">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tpOfV_pred_tpOfV <span class="keyword1"><span class="command">unfolding</span></span> tpOfV_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tpart1</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="bound">σ</span><span class="main">.</span> part1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="bound">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tpart2</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="bound">σ</span><span class="main">.</span> part2 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="bound">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tinfinite</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">σ</span><span class="main">.</span> infinite <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="bound">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sig-tinfinite_var"><span class="command">lemma</span></span> tinfinite_var<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tinfinite <span class="main">(</span>UNIV <span class="main">::</span> var set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">using</span></span> tpOfV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Sig-tinifnite_singl"><span class="command">lemma</span></span> tinifnite_singl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="main">(</span><span class="free">V</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="free">V</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="skolem">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="skolem">σ</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ 0<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sig-tpart1_Un_tpart2"><span class="command">lemma</span></span> tpart1_Un_tpart2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tpart1 <span class="free">V</span> <span class="main">∪</span> tpart2 <span class="free">V</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms part1_Un_part2 <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def tpart1_def tpart2_def
<span class="keyword1"><span class="command">unfolding</span></span> UN_Un_distrib<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Sig-tpart1_Int_tpart2"><span class="command">lemma</span></span> tpart1_Int_tpart2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tpart1 <span class="free">V</span> <span class="main">∩</span> tpart2 <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms part1_Int_part2 <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def tpart1_def tpart2_def
<span class="keyword1"><span class="command">unfolding</span></span> Int_UN_distrib2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">=</span> <span class="improper">xb</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> part1_su part2_su <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(* fixme: clean proof *)</span>

<span class="keyword1" id="Sig-tpart1_su"><span class="command">lemma</span></span> tpart1_su<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tpart1 <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def tpart1_def
<span class="keyword1"><span class="command">using</span></span> part1_su <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> UN_least<span class="main">)</span>

<span class="keyword1" id="Sig-tpart1_in"><span class="command">lemma</span></span> tpart1_in<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> tpart1 <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms tpart1_su <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Sig-tinfinite_tpart1"><span class="command">lemma</span></span> tinfinite_tpart1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="main">(</span>tpart1 <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def tpart1_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">σ'</span><span class="main">.</span> part1 <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="bound">σ'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="skolem">σ</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> part1 <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="skolem">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms part1_su <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">...</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms infinite_part1 <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sig-tinfinite_tpart2"><span class="command">lemma</span></span> tinfinite_tpart2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="main">(</span>tpart2 <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def tpart2_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">σ'</span><span class="main">.</span> part2 <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="bound">σ'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="skolem">σ</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> part2 <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="skolem">σ</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms part2_su <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">...</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms infinite_part2 <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sig-tpart2_su"><span class="command">lemma</span></span> tpart2_su<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tpart2 <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def tpart2_def
<span class="keyword1"><span class="command">using</span></span> part2_su <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> UN_least<span class="main">)</span>

<span class="keyword1" id="Sig-tpart2_in"><span class="command">lemma</span></span> tpart2_in<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> tpart2 <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms tpart2_su <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Typed-pick: picking a variable of a given type›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tpick</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> pick <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sig-tinfinite_ex"><span class="command">lemma</span></span> tinfinite_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Sig-tpick"><span class="command">lemma</span></span> tpick<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tpick <span class="free">σ</span> <span class="free">V</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="free">σ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> tpOfV <span class="skolem">x</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tinfinite_ex<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∩</span> tpOfV <span class="main">-`</span> <span class="main">{</span><span class="free">σ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tpick_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pick<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sig-tpick_in"><span class="command">lemma</span></span> tpick_in<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span> <span class="main">⟹</span> tpick <span class="free">σ</span> <span class="free">V</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> tpOfV_tpick<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tinfinite <span class="free">V</span> <span class="main">⟹</span> tpOfV <span class="main">(</span>tpick <span class="free">σ</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tpick <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Sig-finite_tinfinite"><span class="command">lemma</span></span> finite_tinfinite<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tinfinite <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms infinite_var <span class="keyword1"><span class="command">unfolding</span></span> tinfinite_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_Int2 Diff_Int_distrib2 Int_UNIV_left finite_Diff2 tpOfV<span class="main">)</span>

<span class="comment1">(* get variable terms for the given types: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">getVars</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">getVars</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">getVars</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">σl</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">xl</span> <span class="main">=</span> <span class="free">getVars</span> <span class="free"><span class="bound"><span class="entity">σl</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>tpick <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>UNIV <span class="main">-</span> set <span class="bound">xl</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="bound">xl</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sig-distinct_getVars"><span class="command">lemma</span></span> distinct_getVars<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>getVars <span class="free">σl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tpick_in<span class="main">[</span><span class="operator">OF</span> finite_tinfinite<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">σl</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Sig-length_getVars"><span class="command">lemma</span></span> length_getVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>getVars <span class="free">σl</span><span class="main">)</span> <span class="main">=</span> length <span class="free">σl</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">σl</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Sig-map_tpOfV_getVars"><span class="command">lemma</span></span> map_tpOfV_getVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map tpOfV <span class="main">(</span>getVars <span class="free">σl</span><span class="main">)</span> <span class="main">=</span> <span class="free">σl</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tpOfV_tpick<span class="main">[</span><span class="operator">OF</span> finite_tinfinite<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">σl</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Sig-tpOfV_getVars_nth"><span class="command">lemma</span></span> tpOfV_getVars_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">σl</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tpOfV <span class="main">(</span>getVars <span class="free">σl</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">σl</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> map_tpOfV_getVars <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_getVars nth_map<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Signature *)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="M">
<div class="head">
<h1>Theory M</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> M
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TermsAndClauses.html">TermsAndClauses</a> <a href="Sig.html">Sig</a>
<span class="keyword2"><span class="keyword">begin</span></span>  


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Well-typed (well-formed) terms, clauses, literals and problems›</span></span>

<span class="keyword1"><span class="command">context</span></span> Signature <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The type of a term›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tpOf</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tpOf</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tpOf</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="comment1">(* Well-typed terms *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wt</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wt</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">wt</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">⟷</span>
 <span class="free">wtFsym</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> list_all <span class="free">wt</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span> <span class="main">∧</span> <span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> map tpOf <span class="free"><span class="bound"><span class="entity">Tl</span></span></span>"</span></span>

<span class="comment1">(* Well-typed atoms (atomic formulas) *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wtA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wtA</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">⟷</span> wt <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∧</span> wt <span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">∧</span> tpOf <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> tpOf <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">wtA</span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">⟷</span>
 <span class="free">wtPsym</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> list_all wt <span class="free"><span class="bound"><span class="entity">Tl</span></span></span> <span class="main">∧</span> <span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map tpOf <span class="free"><span class="bound"><span class="entity">Tl</span></span></span>"</span></span>

<span class="comment1">(* Well-typed literals *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wtL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wtL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> wtA <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">wtL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> wtA <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="comment1">(* Well-typed clauses *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtC</span> <span class="main">≡</span> list_all wtL"</span></span>

<span class="keyword1" id="M-wtC_append"><span class="command">lemma</span></span> wtC_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtC <span class="main">(</span><span class="free">c1</span> <span class="main">@</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟷</span> wtC <span class="free">c1</span> <span class="main">∧</span> wtC <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* Well-typed problems *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtPB</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">.</span> wtC <span class="bound">c</span>"</span></span>

<span class="keyword1" id="M-wtPB_Un"><span class="command">lemma</span></span> wtPB_Un<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">∪</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">⟷</span> wtPB <span class="free">Φ1</span> <span class="main">∧</span> wtPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-wtPB_UN"><span class="command">lemma</span></span> wtPB_UN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtPB <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Φ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> wtPB <span class="main">(</span><span class="free">Φ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-wtPB_sappend"><span class="command">lemma</span></span> wtPB_sappend<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wtPB <span class="free">Φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wtPB <span class="free">Φ2</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> wtPB_def sappend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Well-typed substitutions *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtSB</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> wt <span class="main">(</span><span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> tpOf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> tpOfV <span class="bound">x</span>"</span></span>

<span class="keyword1" id="M-wtSB_wt"><span class="command">lemma</span></span> wtSB_wt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π</span> <span class="main">⟹</span> wt <span class="main">(</span><span class="free">π</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtSB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-wtSB_tpOf"><span class="command">lemma</span></span> wtSB_tpOf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π</span> <span class="main">⟹</span> tpOf <span class="main">(</span><span class="free">π</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> tpOfV <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtSB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-wt_tpOf_subst"><span class="command">lemma</span></span> wt_tpOf_subst<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wt <span class="main">(</span>subst <span class="free">π</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> tpOf <span class="main">(</span>subst <span class="free">π</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> tpOf <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> wt_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> wt_tpOf_subst<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> tpOf_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> wt_tpOf_subst<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1" id="M-wtSB_o"><span class="command">lemma</span></span> wtSB_o<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtSB <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">unfolding</span></span> wtSB_def <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Getting variable terms for given types: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">getTvars</span> <span class="free"><span class="bound"><span class="entity">σl</span></span></span> <span class="main">≡</span> map Var <span class="main">(</span>getVars <span class="free"><span class="bound"><span class="entity">σl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="M-length_getTvars"><span class="command">lemma</span></span> length_getTvars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>getTvars <span class="free">σl</span><span class="main">)</span> <span class="main">=</span> length <span class="free">σl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> getTvars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-wt_getTvars"><span class="command">lemma</span></span> wt_getTvars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"list_all wt <span class="main">(</span>getTvars <span class="free">σl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_all_length getTvars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="M-wt_nth_getTvars"><span class="command">lemma</span></span> wt_nth_getTvars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">σl</span> <span class="main">⟹</span> wt <span class="main">(</span>getTvars <span class="free">σl</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> getTvars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-map_tpOf_getTvars"><span class="command">lemma</span></span> map_tpOf_getTvars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map tpOf <span class="main">(</span>getTvars <span class="free">σl</span><span class="main">)</span> <span class="main">=</span> <span class="free">σl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> getTvars_def <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-tpOf_nth_getTvars"><span class="command">lemma</span></span> tpOf_nth_getTvars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">σl</span> <span class="main">⟹</span> tpOf <span class="main">(</span>getTvars <span class="free">σl</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">σl</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> getTvars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Signature *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Structures›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We split a structre into a ``type structure'' that interprets the types 
and the rest of the structure that interprets the function and relation symbols.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Type structures:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Tstruct <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> <span class="tfree">'univ</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> NE_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"NE <span class="main">(</span><span class="free">intT</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Environment:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'tp</span><span class="main">,</span><span class="tfree">'univ</span><span class="main">)</span> env <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> var <span class="main">⇒</span> <span class="tfree">'univ</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Structures:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Struct <span class="main">=</span> Signature <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="main">+</span>
                Tstruct <span class="quoted"><span class="free">intT</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> <span class="tfree">'univ</span> <span class="main">⇒</span> bool"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'univ</span> list <span class="main">⇒</span> <span class="tfree">'univ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'univ</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
intF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">intT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">intF</span> <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
dummy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intP</span> <span class="main">=</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Well-typed environment:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtE</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">intT</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="M-wtTE_intT"><span class="command">lemma</span></span> wtTE_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">intT</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtE_def dom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Picking an element from the domain of a given type: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pickT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">a</span>"</span></span>

<span class="keyword1" id="M-pickT"><span class="command">lemma</span></span> pickT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="main">(</span>pickT <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> pickT_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> NE_intT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Picking a well-typed environment:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pickE</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xl</span></span></span><span class="main">::</span>var list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span>
 <span class="keyword1">SOME</span> <span class="bound">ξ</span><span class="main">.</span> wtE <span class="bound">ξ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">xl</span></span></span><span class="main">.</span> <span class="bound">ξ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xl</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="M-ex_pickE"><span class="command">lemma</span></span> ex_pickE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xl</span> <span class="main">=</span> length <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xl</span> <span class="main">⟹</span> <span class="free">intT</span> <span class="main">(</span>tpOfV <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ξ</span><span class="main">.</span> wtE <span class="bound">ξ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">xl</span><span class="main">.</span> <span class="bound">ξ</span> <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> pickT <span class="main"><span class="main">(</span></span>tpOfV <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> wtE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xl</span> <span class="skolem">a</span> <span class="skolem">al</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">xl</span><span class="main">.</span> <span class="skolem">ξ</span> <span class="main">(</span><span class="skolem">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">al</span><span class="main">!</span><span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ'</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="keyword1">else</span> <span class="skolem">ξ</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x'</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ξ'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> wtE_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">(</span>tpOfV <span class="skolem">x'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ξ'</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 Cons.prems<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ξ'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xl</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xl</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">al</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">xl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xl</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc i Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">using</span></span> j Cons.prems<span class="main">(</span>1<span class="main">)</span> Cons.hyps 2 <span class="keyword1"><span class="command">unfolding</span></span> ξ'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.hyps 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> ξ'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="M-wtE_pickE_pickE"><span class="command">lemma</span></span> wtE_pickE_pickE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xl</span> <span class="main">=</span> length <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xl</span> <span class="main">⟹</span> <span class="free">intT</span> <span class="main">(</span>tpOfV <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtE <span class="main">(</span>pickE <span class="free">xl</span> <span class="free">al</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xl</span> <span class="main">⟶</span> pickE <span class="free">xl</span> <span class="free">al</span> <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?phi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">ξ</span><span class="main">.</span> wtE <span class="bound">ξ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">xl</span><span class="main">.</span> <span class="bound">ξ</span> <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pickE_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?phi</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> ex_pickE<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> wtE_pickE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> wtE_pickE_pickE<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>

<span class="keyword1" id="M-pickE"><span class="command">lemma</span></span> pickE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xl</span> <span class="main">=</span> length <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xl</span> <span class="main">⟹</span> <span class="free">intT</span> <span class="main">(</span>tpOfV <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xl</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pickE <span class="free">xl</span> <span class="free">al</span> <span class="main">(</span><span class="free">xl</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span><span class="main">!</span><span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms wtE_pickE_pickE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pickAnyE</span> <span class="main">≡</span> pickE <span class="main">[]</span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="M-wtE_pickAnyE"><span class="command">lemma</span></span> wtE_pickAnyE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtE pickAnyE"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> pickAnyE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wtE_pickE<span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(* Interpretation of terms: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">int</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">int</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">int</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="main">(</span><span class="free">int</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Satisfaction of atoms: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">satA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">satA</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">⟷</span> int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">satA</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map <span class="main">(</span>int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Satisfaction literals: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">satL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">satL</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> satA <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">satL</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> satA <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="comment1">(* Satisfaction of clauses: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">satC</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> list_ex <span class="main">(</span>satL <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="M-satC_append"><span class="command">lemma</span></span> satC_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"satC <span class="free">ξ</span> <span class="main">(</span><span class="free">c1</span> <span class="main">@</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟷</span> satC <span class="free">ξ</span> <span class="free">c1</span> <span class="main">∨</span> satC <span class="free">ξ</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> satC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-satC_iff_set"><span class="command">lemma</span></span> satC_iff_set<span class="main">:</span> <span class="quoted"><span class="quoted">"satC <span class="free">ξ</span> <span class="free">c</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">l</span> <span class="main">∈</span> set <span class="free">c</span><span class="main">.</span> satL <span class="free">ξ</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> satC_def Bex_set<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="comment1">(* satisfaction of problems *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">satPB</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">.</span> satC <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">c</span>"</span></span>

<span class="keyword1" id="M-satPB_Un"><span class="command">lemma</span></span> satPB_Un<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"satPB <span class="free">ξ</span> <span class="main">(</span><span class="free">Φ1</span> <span class="main">∪</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">⟷</span> satPB <span class="free">ξ</span> <span class="free">Φ1</span> <span class="main">∧</span> satPB <span class="free">ξ</span> <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-satPB_UN"><span class="command">lemma</span></span> satPB_UN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"satPB <span class="free">ξ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Φ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> satPB <span class="free">ξ</span> <span class="main">(</span><span class="free">Φ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-satPB_sappend"><span class="command">lemma</span></span> satPB_sappend<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"satPB <span class="free">ξ</span> <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">⟷</span> satPB <span class="free">ξ</span> <span class="free">Φ1</span> <span class="main">∨</span> satPB <span class="free">ξ</span> <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> satPB_def sappend_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> satC_append<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SAT</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">ξ</span><span class="main">.</span> wtE <span class="bound">ξ</span> <span class="main">⟶</span> satPB <span class="bound">ξ</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span>"</span></span>

<span class="keyword1" id="M-SAT_UN"><span class="command">lemma</span></span> SAT_UN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SAT <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Φ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> SAT <span class="main">(</span><span class="free">Φ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Soundness of typing w.r.t. interpretation:›</span></span>

<span class="keyword1" id="M-wt_int"><span class="command">lemma</span></span> wt_int<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtE<span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> wtE
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> intF <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_map_map<span class="main">)</span>

<span class="keyword1" id="M-int_cong"><span class="command">lemma</span></span> int_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> vars <span class="free">T</span> <span class="main">⟹</span> <span class="free">ξ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ξ2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"int <span class="free">ξ1</span> <span class="free">T</span> <span class="main">=</span> int <span class="free">ξ2</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>int <span class="free">ξ1</span><span class="main">)</span> <span class="skolem">Tl</span> <span class="main">=</span> map <span class="main">(</span>int <span class="free">ξ2</span><span class="main">)</span> <span class="skolem">Tl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> map_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-satA_cong"><span class="command">lemma</span></span> satA_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsA <span class="free">at</span> <span class="main">⟹</span> <span class="free">ξ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ξ2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"satA <span class="free">ξ1</span> <span class="free">at</span> <span class="main">⟷</span> satA <span class="free">ξ2</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms int_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">ξ1</span></span> <span class="quoted"><span class="free">ξ2</span></span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> int_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">ξ1</span></span> <span class="quoted"><span class="free">ξ2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> map_eq_conv<span class="main">)</span>

<span class="keyword1" id="M-satL_cong"><span class="command">lemma</span></span> satL_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsL <span class="free">l</span> <span class="main">⟹</span> <span class="free">ξ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ξ2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"satL <span class="free">ξ1</span> <span class="free">l</span> <span class="main">⟷</span> satL <span class="free">ξ2</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms satA_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">ξ1</span></span> <span class="quoted"><span class="free">ξ2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="M-satC_cong"><span class="command">lemma</span></span> satC_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsC <span class="free">c</span> <span class="main">⟹</span> <span class="free">ξ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ξ2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"satC <span class="free">ξ1</span> <span class="free">c</span> <span class="main">⟷</span> satC <span class="free">ξ2</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms satL_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">ξ1</span></span> <span class="quoted"><span class="free">ξ2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> satC_def varsC_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> satL_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">ξ1</span></span> <span class="quoted"><span class="free">ξ2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="M-satPB_cong"><span class="command">lemma</span></span> satPB_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsPB <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">ξ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ξ2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"satPB <span class="free">ξ1</span> <span class="free">Φ</span> <span class="main">⟷</span> satPB <span class="free">ξ2</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> satPB_def varsPB_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> satC_cong ball_cong assms<span class="main">)</span>

<span class="keyword1" id="M-int_o"><span class="command">lemma</span></span> int_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"int <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> int <span class="free">ξ</span> <span class="main">(</span>subst <span class="free">ρ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff o_def
<span class="keyword1"><span class="command">using</span></span> map_ext <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> int_subst <span class="main">=</span> int_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="M-int_o_subst"><span class="command">lemma</span></span> int_o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"int <span class="free">ξ</span> <span class="keyword1">o</span> subst <span class="free">ρ</span> <span class="main">=</span> int <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> int_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="M-satA_o"><span class="command">lemma</span></span> satA_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"satA <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span> <span class="free">at</span> <span class="main">=</span> satA <span class="free">ξ</span> <span class="main">(</span>substA <span class="free">ρ</span> <span class="free">at</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_o_subst int_o<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">ξ</span></span> <span class="quoted"><span class="free">ρ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> satA_subst <span class="main">=</span> satA_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="M-satA_o_subst"><span class="command">lemma</span></span> satA_o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"satA <span class="free">ξ</span> <span class="keyword1">o</span> substA <span class="free">ρ</span> <span class="main">=</span> satA <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> satA_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="M-satL_o"><span class="command">lemma</span></span> satL_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"satL <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> satL <span class="free">ξ</span> <span class="main">(</span>substL <span class="free">ρ</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> satA_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ξ</span></span> <span class="quoted"><span class="free">ρ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> satL_subst <span class="main">=</span> satL_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="M-satL_o_subst"><span class="command">lemma</span></span> satL_o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"satL <span class="free">ξ</span> <span class="keyword1">o</span> substL <span class="free">ρ</span> <span class="main">=</span> satL <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> satL_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="M-satC_o"><span class="command">lemma</span></span> satC_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"satC <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> satC <span class="free">ξ</span> <span class="main">(</span>substC <span class="free">ρ</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> satL_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ξ</span></span> <span class="quoted"><span class="free">ρ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> satC_def substC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> satC_subst <span class="main">=</span> satC_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="M-satC_o_subst"><span class="command">lemma</span></span> satC_o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"satC <span class="free">ξ</span> <span class="keyword1">o</span> substC <span class="free">ρ</span> <span class="main">=</span> satC <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> satC_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="M-satPB_o"><span class="command">lemma</span></span> satPB_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"satPB <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span> <span class="free">Φ</span> <span class="main">=</span> satPB <span class="free">ξ</span> <span class="main">(</span>substPB <span class="free">ρ</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> satC_o<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ξ</span></span> <span class="quoted"><span class="free">ρ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> satPB_def substPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> satPB_subst <span class="main">=</span> satPB_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="M-satPB_o_subst"><span class="command">lemma</span></span> satPB_o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"satPB <span class="free">ξ</span> <span class="keyword1">o</span> substPB <span class="free">ρ</span> <span class="main">=</span> satPB <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> satPB_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="M-wtE_o"><span class="command">lemma</span></span> wtE_o<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">ρ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtE <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtE_def <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"tpOfV <span class="skolem">x</span> <span class="main">=</span> tpOf <span class="main">(</span><span class="free">ρ</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">(</span>tpOfV <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>int <span class="free">ξ</span> <span class="main">∘</span> <span class="free">ρ</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> 0<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wt_int<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* fixme: unify compE and int ξ o ρ, since they are the same *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">compE</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="M-wtE_compE"><span class="command">lemma</span></span> wtE_compE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wtSB <span class="free">ρ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtE <span class="main">(</span>compE <span class="free">ρ</span> <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtE_def <span class="keyword1"><span class="command">using</span></span> assms wt_int
<span class="keyword1"><span class="command">unfolding</span></span> wtSB_def compE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="M-compE_upd"><span class="command">lemma</span></span> compE_upd<span class="main">:</span> <span class="quoted"><span class="quoted">"compE <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">T</span><span class="main">)</span><span class="main">)</span> <span class="free">ξ</span> <span class="main">=</span> <span class="main">(</span>compE <span class="free">ρ</span> <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> compE_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Struct *)</span>


<span class="keyword1"><span class="command">context</span></span> Signature <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The function symbols of: *)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fsyms</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">fsyms</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">fsyms</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map <span class="free">fsyms</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fsymsA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">fsymsA</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">=</span> fsyms <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∪</span> fsyms <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">fsymsA</span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map fsyms <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fsymsL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">fsymsL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> fsymsA <span class="free"><span class="bound"><span class="entity">at</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">fsymsL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> fsymsA <span class="free"><span class="bound"><span class="entity">at</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsymsC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map fsymsL <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsymsPB</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>fsymsC <span class="bound">c</span> <span class="main">|</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="M-fsyms_int_cong"><span class="command">lemma</span></span> fsyms_int_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF1</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF2</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> fsyms <span class="free">T</span> <span class="main">⟹</span> <span class="free">intF1</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">intF2</span> <span class="bound">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Struct.int <span class="free">intF1</span> <span class="free">ξ</span> <span class="free">T</span> <span class="main">=</span> Struct.int <span class="free">intF2</span> <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Struct.int <span class="free">intF1</span> <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span> <span class="main">=</span> map <span class="main">(</span>Struct.int <span class="free">intF2</span> <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff map_ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">using</span></span> Fn Struct.int.simps<span class="main">[</span><span class="operator">OF</span> S1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main">]</span> Struct.int.simps<span class="main">[</span><span class="operator">OF</span> S2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Struct.int.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span> Struct.int.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="M-fsyms_satA_cong"><span class="command">lemma</span></span> fsyms_satA_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF1</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF2</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> fsymsA <span class="free">at</span> <span class="main">⟹</span> <span class="free">intF1</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">intF2</span> <span class="bound">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Struct.satA <span class="free">intF1</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">at</span> <span class="main">⟷</span> Struct.satA <span class="free">intF2</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> 0 fsyms_int_cong<span class="main">[</span><span class="operator">OF</span> S1 S2<span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fsyms_int_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1 S2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">ξ</span></span><span class="main"><span class="main">]</span></span>
                <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Struct.satA.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span> Struct.satA.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Struct.satA.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span> Struct.satA.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> map_eq_conv<span class="main">)</span>

<span class="keyword1" id="M-fsyms_satL_cong"><span class="command">lemma</span></span> fsyms_satL_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF1</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF2</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> fsymsL <span class="free">l</span> <span class="main">⟹</span> <span class="free">intF1</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">intF2</span> <span class="bound">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Struct.satL <span class="free">intF1</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">l</span> <span class="main">⟷</span> Struct.satL <span class="free">intF2</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> 0 fsyms_satA_cong<span class="main">[</span><span class="operator">OF</span> S1 S2<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Struct.satL.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span> Struct.satL.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ξ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="M-fsyms_satC_cong"><span class="command">lemma</span></span> fsyms_satC_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF1</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF2</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> fsymsC <span class="free">c</span> <span class="main">⟹</span> <span class="free">intF1</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">intF2</span> <span class="bound">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Struct.satC <span class="free">intF1</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">c</span> <span class="main">⟷</span> Struct.satC <span class="free">intF2</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> 0 fsyms_satL_cong<span class="main">[</span><span class="operator">OF</span> S1 S2<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Struct.satC_def<span class="main">[</span><span class="operator">OF</span> S1<span class="main">]</span> Struct.satC_def<span class="main">[</span><span class="operator">OF</span> S2<span class="main">]</span> fsymsC_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fsyms_satL_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1 S2<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="M-fsyms_satPB_cong"><span class="command">lemma</span></span> fsyms_satPB_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF1</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF2</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> fsymsPB <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">intF1</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">intF2</span> <span class="bound">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Struct.satPB <span class="free">intF1</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">Φ</span> <span class="main">⟷</span> Struct.satPB <span class="free">intF2</span> <span class="free">intP</span> <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Struct.satPB_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1<span class="main"><span class="main">]</span></span> Struct.satPB_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S2<span class="main"><span class="main">]</span></span> fsymsPB_def
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fsyms_satC_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> S1 S2<span class="main"><span class="main">]</span></span> ball_cong 0<span class="main">)</span>

<span class="keyword1" id="M-fsymsPB_Un"><span class="command">lemma</span></span> fsymsPB_Un<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fsymsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">∪</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">=</span> fsymsPB <span class="free">Φ1</span> <span class="main">∪</span> fsymsPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fsymsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-fsymsC_append"><span class="command">lemma</span></span> fsymsC_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fsymsC <span class="main">(</span><span class="free">c1</span> <span class="main">@</span> <span class="free">c2</span><span class="main">)</span> <span class="main">=</span> fsymsC <span class="free">c1</span> <span class="main">∪</span> fsymsC <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fsymsC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="M-fsymsPB_sappend_incl"><span class="command">lemma</span></span> fsymsPB_sappend_incl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"fsymsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">⊆</span>  fsymsPB <span class="free">Φ1</span> <span class="main">∪</span> fsymsPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> fsymsPB_def sappend_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="M-fsymsPB_sappend"><span class="command">lemma</span></span> fsymsPB_sappend<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Φ1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Φ2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fsymsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span> <span class="main">=</span> fsymsPB <span class="free">Φ1</span> <span class="main">∪</span> fsymsPB <span class="free">Φ2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fsymsPB <span class="free">Φ1</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fsymsC <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">∈</span> <span class="free">Φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">∈</span> <span class="free">Φ2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">unfolding</span></span> fsymsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fsymsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sappend_def fsymsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fsymsPB <span class="free">Φ2</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fsymsC <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">∈</span> <span class="free">Φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">∈</span> <span class="free">Φ2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> fsymsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fsymsPB <span class="main">(</span><span class="free">Φ1</span> <span class="main">@@</span> <span class="free">Φ2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sappend_def fsymsPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">unfold</span> fsymsPB_def sappend_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="M-Struct_upd"><span class="command">lemma</span></span> Struct_upd<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">al</span><span class="main">.</span> list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">ef</span><span class="main">)</span> <span class="bound">al</span> <span class="main">⟹</span> <span class="free">intT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">ef</span><span class="main">)</span> <span class="main">(</span><span class="free">EF</span> <span class="bound">al</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">intT</span> <span class="main">(</span><span class="free">intF</span> <span class="main">(</span><span class="free">ef</span> <span class="main">:=</span> <span class="free">EF</span><span class="main">)</span><span class="main">)</span> <span class="free">intP</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> Struct_def Struct_axioms_def Tstruct_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Signature *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Problems›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A problem is a potentially infinitary formula in clausal form, i.e., 
a potentially infinite conjunction of clauses.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Problem <span class="main">=</span> Signature <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt_Φ<span class="main">:</span> <span class="quoted"><span class="quoted">"wtPB <span class="free">Φ</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Models of a problem›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Model of a problem:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Model <span class="main">=</span> Problem <span class="main">+</span> Struct <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> SAT<span class="main">:</span> <span class="quoted"><span class="quoted">"SAT <span class="free">Φ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="M-sat_Φ"><span class="command">lemma</span></span> sat_Φ<span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span> <span class="main">⟹</span> satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> SAT <span class="keyword1"><span class="command">unfolding</span></span> SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CM">
<div class="head">
<h1>Theory CM</h1>
</div>
<pre class="source"><span class="comment1">(* Countable version of MFOL structures: *)</span>
<span class="keyword1"><span class="command">theory</span></span> CM
<span class="keyword2"><span class="keyword">imports</span></span> <a href="M.html">M</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Countable Versions of the locales from M
that assume a fixed countable carrier univ
instead of an arbitrary one 'univ: *)</span>
<span class="keyword1"><span class="command">locale</span></span> Tstruct <span class="main">=</span> M.Tstruct <span class="quoted"><span class="free">intT</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> univ <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">locale</span></span> Struct <span class="main">=</span> M.Struct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword1"><span class="command">locale</span></span> Model <span class="main">=</span> M.Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword1"><span class="command">sublocale</span></span> Struct <span class="main">&lt;</span> Tstruct <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> Model <span class="main">&lt;</span> Struct <span class="keyword1"><span class="command">..</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mono">
<div class="head">
<h1>Theory Mono</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Monotonicity›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Mono <span class="keyword2"><span class="keyword">imports</span></span> <a href="CM.html">CM</a> <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Fullness and infiniteness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In a structure, a full type is one that contains all elements of univ (the fixed countable universe):›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Tstruct<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">full</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">d</span><span class="main">.</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">d</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> FullStruct <span class="main">=</span> F<span class="main">?</span> <span class="main">:</span> Struct <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> full<span class="main">:</span> <span class="quoted"><span class="quoted">"full <span class="free">σ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Mono-full2"><span class="command">lemma</span></span> full2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> full <span class="keyword1"><span class="command">unfolding</span></span> full_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mono-full_True"><span class="command">lemma</span></span> full_True<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">σ</span> <span class="bound">D</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> FullModel <span class="main">=</span>
F<span class="main">?</span> <span class="main">:</span> Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span> <span class="main">+</span>
F<span class="main">?</span> <span class="main">:</span> FullStruct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An infinite structure is one with all carriers infinite:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> InfStruct <span class="main">=</span> I<span class="main">?</span> <span class="main">:</span> Struct <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> inf<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">intT</span> <span class="free">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> InfModel <span class="main">=</span>
I<span class="main">?</span> <span class="main">:</span> Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span> <span class="main">+</span>
I<span class="main">?</span> <span class="main">:</span> InfStruct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword1"><span class="command">context</span></span> Problem <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">SStruct</span> <span class="main">≡</span> Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">FFullStruct</span> <span class="main">≡</span> FullStruct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">IInfStruct</span> <span class="main">≡</span> InfStruct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">MModel</span> <span class="main">≡</span> Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">FFullModel</span> <span class="main">≡</span> FullModel <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">IInfModel</span> <span class="main">≡</span> InfModel <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Problem that deduces some infiniteness constraints:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIk <span class="main">=</span> Ik<span class="main">?</span> <span class="main">:</span> Problem <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">infTp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="comment1">(* infTp assumes that Φ implies infiniteness on the infTp-marked types,
i.e., any model of Φ is infinite on these types: *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> infTp<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">intT</span> <span class="bound">intF</span> <span class="bound">intP</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span>univ<span class="main">)</span><span class="main">.</span> <span class="main">⟦</span><span class="free">infTp</span> <span class="bound">σ</span><span class="main">;</span> MModel <span class="bound">intT</span> <span class="bound">intF</span> <span class="bound">intP</span><span class="main">⟧</span> <span class="main">⟹</span> infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="bound">intT</span> <span class="bound">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> ModelIk <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="main">+</span>
Ik<span class="main">?</span> <span class="main">:</span> Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Mono-infTp_infinite"><span class="command">lemma</span></span> infTp_infinite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span> <span class="main">⟹</span> infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">intT</span> <span class="free">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ProblemIk.infTp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">wtFsym</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">wtPsym</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">arOf</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">resOf</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">parOf</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Φ</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">infTp</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Monotonicity›</span></span>

<span class="keyword1"><span class="command">context</span></span> Problem <span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(* Monotonicity: *)</span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">monot</span> <span class="main">≡</span>
 <span class="main">(</span><span class="main">∃</span> <span class="bound">intT</span> <span class="bound">intF</span> <span class="bound">intP</span><span class="main">.</span> MModel <span class="bound">intT</span> <span class="bound">intF</span> <span class="bound">intP</span><span class="main">)</span>
 <span class="main">⟶</span>
 <span class="main">(</span><span class="main">∃</span> <span class="bound">intTI</span> <span class="bound">intFI</span> <span class="bound">intPI</span><span class="main">.</span> IInfModel <span class="bound">intTI</span> <span class="bound">intFI</span> <span class="bound">intPI</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> MonotProblem <span class="main">=</span> Problem <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> monot<span class="main">:</span> <span class="quoted">monot</span>

<span class="keyword1"><span class="command">locale</span></span> MonotProblemIk <span class="main">=</span>
MonotProblem <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="main">+</span>
ProblemIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span>

<span class="keyword1"><span class="command">context</span></span> MonotProblem
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">MI_pred</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">≡</span> IInfModel <span class="main">(</span>fst3 <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">(</span>snd3 <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">(</span>trd3 <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">MI</span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">K</span><span class="main">.</span> MI_pred <span class="bound">K</span>"</span></span>

<span class="keyword1" id="Mono-MI_pred"><span class="command">lemma</span></span> MI_pred<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"MModel <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">K</span><span class="main">.</span> MI_pred <span class="bound">K</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MI_pred <span class="main">(</span><span class="skolem">T</span><span class="main">,</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> monot assms <span class="keyword1"><span class="command">unfolding</span></span> monot_def MI_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mono-MI_pred_MI"><span class="command">lemma</span></span> MI_pred_MI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"MModel <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"MI_pred MI"</span></span>
<span class="keyword1"><span class="command">using</span></span> MI_pred<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> MI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intTI</span> <span class="main">≡</span> fst3 MI"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFI</span> <span class="main">≡</span> snd3 MI"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPI</span> <span class="main">≡</span> trd3 MI"</span></span>

<span class="keyword1" id="Mono-InfModel_intTI_intFI_intPI"><span class="command">lemma</span></span> InfModel_intTI_intFI_intPI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"MModel <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IInfModel intTI intFI intPI"</span></span>
<span class="keyword1"><span class="command">using</span></span> MI_pred_MI<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> MI_pred_def intFI_def intPI_def intTI_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MonotProblem *)</span>

<span class="keyword1"><span class="command">locale</span></span> MonotModel <span class="main">=</span> M<span class="main">?</span> <span class="main">:</span> MonotProblem <span class="main">+</span> M<span class="main">?</span> <span class="main">:</span> Model

<span class="keyword1"><span class="command">context</span></span> MonotModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Mono-InfModelI"><span class="command">lemma</span></span> InfModelI<span class="main">:</span> <span class="quoted"><span class="quoted">"IInfModel intTI intFI intPI"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> MonotProblem.InfModel_intTI_intFI_intPI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* Trivial fact: Any monotonic problem that has a model also has an infinite model: *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> MonotModel <span class="main">&lt;</span> InfModel <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">intTI</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFI</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPI</span>
<span class="keyword1"><span class="command">using</span></span> InfModelI <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">context</span></span> InfModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">toFull</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> bij_betw <span class="bound">F</span> <span class="main">{</span><span class="bound">a</span><span class="main">::</span>univ<span class="main">.</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">a</span><span class="main">}</span> <span class="main">(</span>UNIV<span class="main">::</span>univ set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fromFull</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> inv_into <span class="main">{</span><span class="bound">a</span><span class="main">::</span>univ<span class="main">.</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">a</span><span class="main">}</span> <span class="main">(</span>toFull <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intTF</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> True"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> toFull <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map2 fromFull <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPF</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map2 fromFull <span class="main">(</span><span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mono-intTF"><span class="command">lemma</span></span> intTF<span class="main">:</span> <span class="quoted"><span class="quoted">"intTF <span class="free">σ</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> intTF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mono-ex_toFull"><span class="command">lemma</span></span> ex_toFull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span><span class="main">.</span> bij_betw <span class="bound">F</span> <span class="main">{</span><span class="bound">a</span><span class="main">::</span>univ<span class="main">.</span> <span class="free">intT</span> <span class="free">σ</span> <span class="bound">a</span><span class="main">}</span> <span class="main">(</span>UNIV<span class="main">::</span>univ set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf card_of_ordIso card_of_UNIV countable_univ UnE
          countable_infinite not_ordLeq_ordLess ordLeq_ordLess_Un_ordIso<span class="main">)</span>

<span class="keyword1" id="Mono-toFull"><span class="command">lemma</span></span> toFull<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>toFull <span class="free">σ</span><span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">intT</span> <span class="free">σ</span> <span class="bound">a</span><span class="main">}</span> UNIV"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> ex_toFull someI_ex toFull_def<span class="main">)</span>

<span class="keyword1" id="Mono-toFull_fromFull"><span class="command">lemma</span></span> toFull_fromFull<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"toFull <span class="free">σ</span> <span class="main">(</span>fromFull <span class="free">σ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I bij_betw_inv_into_right fromFull_def toFull<span class="main">)</span>

<span class="keyword1" id="Mono-fromFull_toFull"><span class="command">lemma</span></span> fromFull_toFull<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span> <span class="main">⟹</span> fromFull <span class="free">σ</span> <span class="main">(</span>toFull <span class="free">σ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CollectI bij_betw_inv_into_left toFull fromFull_def<span class="main">)</span>

<span class="keyword1" id="Mono-fromFull_inj"><span class="command">lemma</span></span> fromFull_inj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fromFull <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> fromFull <span class="free">σ</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> toFull_fromFull<span class="main">)</span>

<span class="keyword1" id="Mono-toFull_inj"><span class="command">lemma</span></span> toFull_inj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"toFull <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> toFull <span class="free">σ</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fromFull_toFull<span class="main">)</span>

<span class="keyword1" id="Mono-fromFull"><span class="command">lemma</span></span> fromFull<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="main">(</span>fromFull <span class="free">σ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fromFull_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv_into_into<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"toFull <span class="free"><span class="free">σ</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">intT</span></span> <span class="free"><span class="free">σ</span></span> <span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> toFull <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mono-toFull_iff_fromFull"><span class="command">lemma</span></span> toFull_iff_fromFull<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"toFull <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> fromFull <span class="free">σ</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fromFull_toFull toFull_fromFull<span class="main">)</span>

<span class="keyword1" id="Mono-Tstruct"><span class="command">lemma</span></span> Tstruct<span class="main">:</span> <span class="quoted"><span class="quoted">"Tstruct intTF"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> intTF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mono-FullStruct"><span class="command">lemma</span></span> FullStruct<span class="main">:</span> <span class="quoted"><span class="quoted">"FullStruct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> intTF intFF intPF"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> intTF_def Tstruct.full_def<span class="main">[</span><span class="operator">OF</span> Tstruct<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* locale InfModel *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> InfModel <span class="main">&lt;</span> FullStruct
<span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted">intTF</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPF</span>
<span class="keyword1"><span class="command">using</span></span> FullStruct <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">context</span></span> InfModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">kE</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> fromFull <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mono-kE"><span class="command">lemma</span></span> kE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"kE <span class="free">ξ</span> <span class="free">x</span> <span class="main">=</span> fromFull <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> kE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mono-wtE"><span class="command">lemma</span></span> wtE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"F.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> F.wtE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mono-kE_wtE"><span class="command">lemma</span></span> kE_wtE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I.wtE_def kE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mono-kE_int_toFull"><span class="command">lemma</span></span> kE_int_toFull<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"toFull <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>I.int <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> F.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>I.int <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tl</span> <span class="main">=</span>
           map2 fromFull <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>F.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"map <span class="var">?F</span> <span class="skolem">Tl</span> <span class="main">=</span> map2 fromFull <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>map <span class="var">?H</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">Tl</span> <span class="main">=</span> length <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?L</span> <span class="main">=</span> length <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?L</span>"</span></span>  <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?toFull</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"toFull <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fromFull</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fromFull <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> tp<span class="main">:</span> <span class="quoted"><span class="quoted">"tpOf <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">arOf</span> <span class="skolem">f</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn<span class="main">(</span>2<span class="main">)</span> i <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?F</span> <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I.wt_int<span class="main">[</span><span class="operator">OF</span> ξ wt<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> tp <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?toFull</span> <span class="main">(</span><span class="var">?F</span> <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?H</span> <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Fn tp i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_iff kE_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> fromFull <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?H</span> <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> toFull_iff_fromFull <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="var">?R</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I.int.simps F.int.simps tpOf.simps <span class="keyword1"><span class="command">unfolding</span></span> intFF_def 0 <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mono-kE_int"><span class="command">lemma</span></span> kE_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.int <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> fromFull <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>F.int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> kE_int_toFull<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> toFull_iff_fromFull<span class="main">[</span><span class="operator">OF</span> I.wt_int<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ξ T<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Mono-map_kE_int"><span class="command">lemma</span></span> map_kE_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all wt <span class="free">Tl</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>I.int <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span> map2 fromFull <span class="main">(</span>map tpOf <span class="free">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>F.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> length_map length_map2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T ξ kE_int length_map list_all_length nth_map nth_map2<span class="main">)</span>

<span class="keyword1" id="Mono-kE_satA"><span class="command">lemma</span></span> kE_satA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> at<span class="main">:</span> <span class="quoted"><span class="quoted">"wtA <span class="free">at</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satA <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span> <span class="free">at</span> <span class="main">⟷</span> F.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intPF_def<span class="main">)</span>

<span class="keyword1" id="Mono-kE_satL"><span class="command">lemma</span></span> kE_satL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"wtL <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satL <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟷</span> F.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mono-kE_satC"><span class="command">lemma</span></span> kE_satC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"wtC <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satC <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> F.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I.satC_def F.satC_def
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wtC_def<span class="main">)</span>

<span class="keyword1" id="Mono-kE_satPB"><span class="command">lemma</span></span> kE_satPB<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="main">(</span>kE <span class="free">ξ</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> I.sat_Φ<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> wt_Φ assms <span class="keyword1"><span class="command">unfolding</span></span> I.satPB_def F.satPB_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wtPB_def<span class="main">)</span>

<span class="keyword1" id="Mono-F_SAT"><span class="command">lemma</span></span> F_SAT<span class="main">:</span> <span class="quoted"><span class="quoted">"F.SAT <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> F.SAT_def <span class="keyword1"><span class="command">using</span></span> kE_satPB kE_wtE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mono-FullModel"><span class="command">lemma</span></span> FullModel<span class="main">:</span> <span class="quoted"><span class="quoted">"FullModel <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> intTF intFF intPF"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> F_SAT <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context InfModel *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> InfModel <span class="main">&lt;</span> FullModel <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">intTF</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPF</span>
<span class="keyword1"><span class="command">using</span></span> FullModel <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">context</span></span> MonotProblem <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intTF</span> <span class="main">≡</span> InfModel.intTF"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFF</span> <span class="main">≡</span> InfModel.intFF <span class="free">arOf</span> <span class="free">resOf</span> intTI intFI"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPF</span> <span class="main">≡</span> InfModel.intPF <span class="free">parOf</span> intTI intPI"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Strengthening of the infiniteness condition for monotonicity,
replacing infininetess by fullness:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> FullModel_intTF_intFF_intPF<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"MModel <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"FFullModel intTF intFF intPF"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> intTF_def intFF_def intPF_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> InfModel.FullModel<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> InfModel_intTI_intFI_intPI<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MonotProblem *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> MonotModel <span class="main">&lt;</span> FullModel <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">intTF</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPF</span>
<span class="keyword1"><span class="command">using</span></span> FullModel <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mcalc">
<div class="head">
<h1>Theory Mcalc</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The First Monotonicity Calculus›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Mcalc
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Mono.html">Mono</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIk <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Naked variables›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nvT</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nvT</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nvT</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nvA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nvA</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">=</span> nvT <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∪</span> nvT <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nvA</span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nvL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nvL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> nvA <span class="free"><span class="bound"><span class="entity">at</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nvL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nvC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nvL <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nvPB</span> <span class="main">≡</span> <span class="main">⋃</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> nvC <span class="bound">c</span>"</span></span>

<span class="keyword1" id="Mcalc-nvT_vars"><span class="command">lemma</span></span> nvT_vars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nvT <span class="free">T</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> vars <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="Mcalc-nvA_varsA"><span class="command">lemma</span></span> nvA_varsA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nvA <span class="free">at</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> varsA <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc-nvL_varsL"><span class="command">lemma</span></span> nvL_varsL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nvL <span class="free">l</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> varsL <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc-nvC_varsC"><span class="command">lemma</span></span> nvC_varsC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nvC <span class="free">c</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> varsC <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> varsC_def nvC_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc-nvPB_varsPB"><span class="command">lemma</span></span> nvPB_varsPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nvPB <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> varsPB <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> varsPB_def nvPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The calculus›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">mcalc</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊢</span>"</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvC <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1" id="Mcalc-mcalc_iff"><span class="command">lemma</span></span> mcalc_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊢</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">infTp</span> <span class="free">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvC <span class="free">c</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mcalc.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIk *)</span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkMcalc <span class="main">=</span> ProblemIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> mcalc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Φ</span> <span class="main">⟹</span> <span class="bound">σ</span> <span class="main">⊢</span> <span class="bound">c</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> ModelIkMcalc <span class="main">=</span>
ModelIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span> <span class="main">+</span>
ProblemIkMcalc <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Extension of a structure to an infinite structure
by adding indistinguishable elements›</span></span>

<span class="keyword1"><span class="command">context</span></span> ModelIkMcalc <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The projection from univ to a structure:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">proj</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> pickT <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1" id="Mcalc-intT_proj"><span class="command">lemma</span></span> intT_proj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="main">(</span>proj <span class="free">σ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> proj_def <span class="keyword1"><span class="command">using</span></span> pickT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-proj_id"><span class="command">lemma</span></span> proj_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span> <span class="main">⟹</span> proj <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> proj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-surj_proj"><span class="command">lemma</span></span> surj_proj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span>   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> proj <span class="free">σ</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">::</span>univ<span class="main">)</span> <span class="main">≡</span> <span class="free">infTp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟶</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map2 proj <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map2 proj <span class="main">(</span><span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mcalc-not_infTp_I_intT"><span class="command">lemma</span></span> not_infTp_I_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">infTp</span> <span class="free">σ</span> <span class="main">⟹</span> I_intT <span class="free">σ</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc-infTp_I_intT"><span class="command">lemma</span></span> infTp_I_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span> <span class="main">⟹</span> I_intT <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc-NE_I_intT"><span class="command">lemma</span></span> NE_I_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"NE <span class="main">(</span>I_intT <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> NE_intT <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc-I_intF"><span class="command">lemma</span></span> I_intF<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 I_intT <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I_intT <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>I_intF <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I_intT_def I_intF_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> intF<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-Tstruct_I_intT"><span class="command">lemma</span></span> Tstruct_I_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"Tstruct I_intT"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> NE_I_intT<span class="main">)</span>

<span class="keyword1" id="Mcalc-inf_I_intT"><span class="command">lemma</span></span> inf_I_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> I_intT <span class="free">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc-InfStruct"><span class="command">lemma</span></span> InfStruct<span class="main">:</span> <span class="quoted"><span class="quoted">"IInfStruct I_intT I_intF I_intP"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> NE_I_intT I_intF Tstruct_I_intT inf_I_intT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkMcalc *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ModelIkMcalc <span class="main">&lt;</span> InfStruct <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">I_intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">I_intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">I_intP</span>
<span class="keyword1"><span class="command">using</span></span> InfStruct <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The soundness of the calculus›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In what follows, ``Ik'' stands for the original
(augmented with infiniteness-knowledge)
and ``I'' for the infinite structure constructed from it
through the above sublocale statement.›</span></span>


<span class="keyword1"><span class="command">context</span></span> ModelIkMcalc <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The environment translation along the projection:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">transE</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> proj <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mcalc-transE"><span class="command">lemma</span></span> transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"transE <span class="free">ξ</span> <span class="free">x</span> <span class="main">=</span> proj <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> transE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc-wtE_transE"><span class="command">lemma</span></span> wtE_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span> <span class="main">⟹</span> Ik.wtE <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ik.wtE_def I.wtE_def transE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ik_intT</span> <span class="main">≡</span> <span class="free">intT</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ik_intF</span> <span class="main">≡</span> <span class="free">intF</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ik_intP</span> <span class="main">≡</span> <span class="free">intP</span>"</span></span>

<span class="keyword1" id="Mcalc-Ik_intT_int"><span class="command">lemma</span></span> Ik_intT_int<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> snv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">infTp</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvT <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="main">=</span> Var <span class="bound">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Var <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">using</span></span> wtE_transE<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> I.wt_int I_intT_def ξ wt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvT <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> tpOf <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ik.full <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ik.full_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> nonVar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="main">=</span> Var <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonVar wt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> I_intF_def tpOf.simps int.simps
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ik.intF<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> listAll2_map2I<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc-int_transE_proj"><span class="command">lemma</span></span> int_transE_proj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> proj <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wt <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik_intT <span class="main">(</span><span class="free">resOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>I_intF <span class="skolem">f</span> <span class="main">(</span>map <span class="main">(</span>int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="var">?a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> I_intF_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ik.intF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"proj <span class="var">?σ</span> <span class="var">?a</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> proj_id<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ik.int.simps int.simps tpOf.simps 1
    <span class="keyword1"><span class="command">unfolding</span></span> I_intF_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">intF</span></span> <span class="skolem"><span class="skolem">f</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">arOf</span> <span class="skolem">f</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> tpOf <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> proj <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_length transE_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span>
          map2 proj <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">use</span> Fn <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc-int_transE_snv"><span class="command">lemma</span></span> int_transE_snv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> snv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">infTp</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvT <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> I.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> int_transE_proj<span class="main">[</span><span class="operator">OF</span> wt<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> proj_id<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> Ik_intT_int<span class="main">[</span><span class="operator">OF</span> wt ξ snv<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Mcalc-int_transE_Fn"><span class="command">lemma</span></span> int_transE_Fn<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all wt <span class="free">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">arOf</span> <span class="free">f</span> <span class="main">=</span> map tpOf <span class="free">Tl</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>Fn <span class="free">f</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span> I.int <span class="free">ξ</span> <span class="main">(</span>Fn <span class="free">f</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> int_transE_snv<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-intP_transE"><span class="command">lemma</span></span> intP_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all wt <span class="free">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtPsym</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">parOf</span> <span class="free">p</span> <span class="main">=</span> map tpOf <span class="free">Tl</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik_intP <span class="free">p</span> <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span> I_intP <span class="free">p</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Ik_intP <span class="free"><span class="free">p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">using</span></span> int_transE_proj <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-satA_snvA_transE"><span class="command">lemma</span></span> satA_snvA_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtA<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtA <span class="free">at</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">infTp</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvA <span class="free">at</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.satA <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">at</span> <span class="main">⟷</span> I.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ball_Un<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> int_transE_snv<span class="main">)</span>

<span class="comment1">(* The next contrapositive twist is crucial for proving satL_transE: *)</span>
<span class="keyword1" id="Mcalc-satA_transE"><span class="command">lemma</span></span> satA_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtA<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtA <span class="free">at</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"I.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.satA <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> int_transE_proj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-satL_snvL_transE"><span class="command">lemma</span></span> satL_snvL_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtL<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> pL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">infTp</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nvL <span class="free">l</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="bound">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ik.satL <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-satC_snvC_transE"><span class="command">lemma</span></span> satC_snvC_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtC<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtC <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> pC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">⊢</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ik.satC <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Ik.mcalc_iff Ik.satC_def satC_def Ik.wtC_def nvC_def
<span class="keyword1"><span class="command">unfolding</span></span> list_all_iff list_ex_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_mem satL_snvL_transE<span class="main">)</span>

<span class="keyword1" id="Mcalc-satPB_snvPB_transE"><span class="command">lemma</span></span> satPB_snvPB_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Ik.wt_Φ Ik.sat_Φ<span class="main">[</span><span class="operator">OF</span> wtE_transE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ξ<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> mcalc ξ <span class="keyword1"><span class="command">unfolding</span></span> Ik.satPB_def satPB_def Ik.wtPB_def nvPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-I_SAT"><span class="command">lemma</span></span> I_SAT<span class="main">:</span> <span class="quoted"><span class="quoted">"I.SAT <span class="free">Φ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I.SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc-InfModel"><span class="command">lemma</span></span> InfModel<span class="main">:</span> <span class="quoted"><span class="quoted">"IInfModel I_intT I_intF I_intP"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> I_SAT<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkMcalc *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ModelIkMcalc <span class="main">&lt;</span> inf<span class="main">?</span><span class="main">:</span> InfModel <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">I_intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">I_intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">I_intP</span>
<span class="keyword1"><span class="command">using</span></span> InfModel <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkMcalc <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">MModelIkMcalc</span> <span class="main">≡</span> ModelIkMcalc <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">infTp</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> monot<span class="main">:</span> <span class="quoted">monot</span>
<span class="keyword1"><span class="command">unfolding</span></span> monot_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">intT</span> <span class="skolem">intF</span> <span class="skolem">intP</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"MModel <span class="skolem">intT</span> <span class="skolem">intF</span> <span class="skolem">intP</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"MModelIkMcalc <span class="skolem">intT</span> <span class="skolem">intF</span> <span class="skolem">intP</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ModelIkMcalc_def ModelIk_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">intTI</span> <span class="bound">intFI</span> <span class="bound">intPI</span><span class="main">.</span> IInfModel <span class="bound">intTI</span> <span class="bound">intFI</span> <span class="bound">intPI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ModelIkMcalc.InfModel<span class="main">[</span><span class="operator">OF</span> M<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkMcalc *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Final theorem in sublocale form: Any problem that passes the
  monotonicity calculus is monotonic:›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkMcalc <span class="main">&lt;</span> MonotProblem
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> monot<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="T_G_Prelim">
<div class="head">
<h1>Theory T_G_Prelim</h1>
</div>
<pre class="source"><span class="comment1">(* Preliminaries on the tag and guard encodings  *)</span>
<span class="keyword1"><span class="command">theory</span></span> T_G_Prelim
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Mcalc.html">Mcalc</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* Copy of ProblemIk, together with a partitioning of the types.
O stands for the original---this copy shall be used
as ``the original problem: *)</span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkTpart <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* types aimed to be protected (with tags or guards) *)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">protFw</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* types aimed to be protected in a featherweight fashion  *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
    tp_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">¬</span> <span class="free">prot</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">protFw</span> <span class="bound">σ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> tp_mcalc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">prot</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">⊢</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The notion of being a result type of some operation symbol: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isRes</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isRes</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">f</span><span class="main">.</span> <span class="free">wtFsym</span> <span class="bound">f</span> <span class="main">∧</span> <span class="free">resOf</span> <span class="bound">f</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="comment1">(* Types meant to be left unprotected:
-- in the case of tags, terms of these type are not tagged;
-- in the case of guards, no guards are added for these types  *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">unprot</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="free">prot</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">protFw</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1" id="T_G_Prelim-unprot_mcalc"><span class="command">lemma</span></span> unprot_mcalc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>unprot <span class="free">σ</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">⊢</span> <span class="free">c</span> "</span></span>
<span class="keyword1"><span class="command">using</span></span> tp_mcalc <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart *)</span>


<span class="comment1">(* Problem with type partition and model: *)</span>
<span class="keyword1"><span class="command">locale</span></span> ModelIkTpart <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIkTpart <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">prot</span></span> <span class="quoted"><span class="free">protFw</span></span> <span class="main">+</span>
Ik<span class="main">?</span> <span class="main">:</span> Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prot</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protFw</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mcalc2">
<div class="head">
<h1>Theory Mcalc2</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Second Monotonicity Calculus›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Mcalc2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Mono.html">Mono</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Extension policies›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Extension policy: copy, true or false extension:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> epol <span class="main">=</span> Cext <span class="main">|</span> Text <span class="main">|</span> Fext

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Problem with infinite knowledge and predicate-extension policy:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkPol <span class="main">=</span> ProblemIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="comment1">(* the predicate-extension policy *)</span> <span class="free">pol</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> <span class="tfree">'psym</span> <span class="main">⇒</span> epol"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* guard of a variable occurring in a certain literal of a certain clause: *)</span>
    <span class="free">grdOf</span> <span class="main">::</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> cls <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> lit <span class="main">⇒</span> var <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> lit"</span></span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkPol <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Naked variables›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nv2T</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nv2T</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nv2T</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nv2L</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nv2L</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nv2T <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∪</span> nv2T <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nv2L</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nv2L</span> <span class="main">(</span>Pos <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="free">pol</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Fext<span class="main">}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nv2L</span> <span class="main">(</span>Neg <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="free">pol</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Text<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nv2C</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2L <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mcalc2-in_nv2T"><span class="command">lemma</span></span> in_nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2T <span class="free">T</span> <span class="main">⟷</span> <span class="free">T</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D nv2T.simps singleton_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2-nv2T_vars"><span class="command">lemma</span></span> nv2T_vars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2T <span class="free">T</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> vars <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="Mcalc2-nv2L_varsL"><span class="command">lemma</span></span> nv2L_varsL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2L <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> varsL <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">at</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pr <span class="skolem">p</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Pos
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pol</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nv2T_vars<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">at</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pr <span class="skolem">p</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Neg
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pol</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nv2T_vars<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2-nv2C_varsC"><span class="command">lemma</span></span> nv2C_varsC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2C <span class="free">c</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> varsC <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> varsC_def nv2C_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The calculus›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The notion of a literal being a guard for a (typed) variable:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">isGuard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span><span class="tfree">'psym</span><span class="main">)</span> lit <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">isGuard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">isGuard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">f</span> <span class="bound">Tl</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">=</span> Fn <span class="bound">f</span> <span class="bound">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T2</span></span></span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">f</span> <span class="bound">Tl</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> Fn <span class="bound">f</span> <span class="bound">Tl</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">isGuard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Pos <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">pol</span> <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Text"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">isGuard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Neg <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">pol</span> <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Fext"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The monotonicity calculus from the Classen et. al. paper, applied
to non-infinite types only: it checks that any variable in any literal of any clause
is indeed guarded by its guard:›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">mcalc2</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊢2</span>"</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">⊢2</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">l</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> nv2L <span class="bound">l</span><span class="main">;</span> tpOfV <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">⟧</span>
         <span class="main">⟹</span> isGuard <span class="bound">x</span> <span class="main">(</span><span class="free">grdOf</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">l</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">⊢2</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1" id="Mcalc2-mcalc2_iff"><span class="command">lemma</span></span> mcalc2_iff<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊢2</span> <span class="free">c</span> <span class="main">⟷</span>
 <span class="free">infTp</span> <span class="free">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">l</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> nv2L <span class="bound">l</span> <span class="main">∧</span> tpOfV <span class="bound">x</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">⟶</span> isGuard <span class="bound">x</span> <span class="main">(</span><span class="free">grdOf</span> <span class="free">c</span> <span class="bound">l</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mcalc2.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIk *)</span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkPolMcalc2 <span class="main">=</span> ProblemIkPol <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">pol</span></span> <span class="quoted"><span class="free">grdOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pol</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">grdOf</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span>
<span class="comment1">(* well-definednedd of the guard: *)</span>
    grdOf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">l</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">c</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">;</span> <span class="bound">l</span> <span class="main">∈</span> set <span class="bound">c</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> nv2L <span class="bound">l</span><span class="main">;</span> <span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
                     <span class="main">⟹</span> <span class="free">grdOf</span> <span class="bound">c</span> <span class="bound">l</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">c</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> mcalc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Φ</span> <span class="main">⟹</span> <span class="bound">σ</span> <span class="main">⊢2</span> <span class="bound">c</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Mcalc2-wtL_grdOf"><span class="command">lemma</span></span> wtL_grdOf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">Φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> set <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2L <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtL <span class="main">(</span><span class="free">grdOf</span> <span class="free">c</span> <span class="free">l</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> grdOf<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms list_all_iff wtC_def wtPB_def wt_Φ<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> ModelIkPolMcalc2 <span class="main">=</span>
ModelIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span> <span class="main">+</span>
ProblemIkPolMcalc2 <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">pol</span></span> <span class="quoted"><span class="free">grdOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="free">pol</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">grdOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mcalc2C">
<div class="head">
<h1>Theory Mcalc2C</h1>
</div>
<pre class="source"><span class="comment1">(* A particular case of the second calculus, with policy constant on types: *)</span>
<span class="keyword1"><span class="command">theory</span></span> Mcalc2C
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Mcalc2.html">Mcalc2</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Constant policy on types›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Currently our soundness proof only covers the case of the calculus
having different extension policies for different predicates, but not
for differnt types versus the same predicate. This is sufficient for our purpose
of proving soundness of the guard encodings.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkPolMcalc2C <span class="main">=</span>
ProblemIkPolMcalc2 <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">pol</span></span> <span class="quoted"><span class="free">grdOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pol</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">grdOf</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> pol_ct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pol</span> <span class="free">σ1</span> <span class="free">P</span> <span class="main">=</span> <span class="free">pol</span> <span class="free">σ2</span> <span class="free">P</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkPolMcalc2C <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polC</span> <span class="main">≡</span> <span class="free">pol</span> any"</span></span>

<span class="keyword1" id="Mcalc2C-pol_polC"><span class="command">lemma</span></span> pol_polC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pol</span> <span class="free">σ</span> <span class="free">P</span> <span class="main">=</span> polC <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> polC_def <span class="keyword1"><span class="command">using</span></span> pol_ct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-nv2L_simps"><span class="command">lemma</span></span> nv2L_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"nv2L <span class="main">(</span>Pos <span class="main">(</span>Pr <span class="free">p</span> <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> polC <span class="free">p</span> <span class="keyword1">of</span> Fext <span class="main">⇒</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="quoted"><span class="quoted">"nv2L <span class="main">(</span>Neg <span class="main">(</span>Pr <span class="free">p</span> <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> polC <span class="free">p</span> <span class="keyword1">of</span> Text <span class="main">⇒</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> epol.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pol_polC<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> nv2L.simps<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span><span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>

<span class="keyword1" id="Mcalc2C-isGuard_simps"><span class="command">lemma</span></span> isGuard_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"isGuard <span class="free">x</span> <span class="main">(</span>Pos <span class="main">(</span>Pr <span class="free">p</span> <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> polC <span class="free">p</span> <span class="main">=</span> Text"</span></span>
<span class="quoted"><span class="quoted">"isGuard <span class="free">x</span> <span class="main">(</span>Neg <span class="main">(</span>Pr <span class="free">p</span> <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map nv2T <span class="free">Tl</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> polC <span class="free">p</span> <span class="main">=</span> Fext"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pol_polC<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> isGuard.simps<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span><span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context  ProblemIkPolMcalc2 *)</span>


<span class="keyword1"><span class="command">locale</span></span> ModelIkPolMcalc2C <span class="main">=</span>
ModelIk <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span> <span class="main">+</span>
ProblemIkPolMcalc2C <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">pol</span></span> <span class="quoted"><span class="free">grdOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="free">pol</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">grdOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Extension of a structure to an infinte structure
by adding indistinguishable elements›</span></span>

<span class="keyword1"><span class="command">context</span></span> ModelIkPolMcalc2C <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The projection from univ to a structure: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">proj</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> pickT <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1" id="Mcalc2C-intT_proj"><span class="command">lemma</span></span> intT_proj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="main">(</span>proj <span class="free">σ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> proj_def <span class="keyword1"><span class="command">using</span></span> pickT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-proj_id"><span class="command">lemma</span></span> proj_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span> <span class="main">⟹</span> proj <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> proj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-map_proj_id"><span class="command">lemma</span></span> map_proj_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="free">σl</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map2 proj <span class="free">σl</span> <span class="free">al</span> <span class="main">=</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-surj_proj"><span class="command">lemma</span></span> surj_proj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span>   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> proj <span class="free">σ</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">::</span>univ<span class="main">)</span> <span class="main">≡</span> <span class="free">infTp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟶</span> <span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map2 proj <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">I_intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span>
 <span class="keyword1">case</span> polC <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
   Cext <span class="main">⇒</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map2 proj <span class="main">(</span><span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>
  <span class="main">|</span>Text <span class="main">⇒</span> <span class="keyword1">if</span> list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="keyword1">then</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="keyword1">else</span> True
  <span class="main">|</span>Fext <span class="main">⇒</span> <span class="keyword1">if</span> list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="keyword1">then</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="keyword1">else</span> False"</span></span>

<span class="keyword1" id="Mcalc2C-not_infTp_I_intT"><span class="command">lemma</span></span> not_infTp_I_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">infTp</span> <span class="free">σ</span> <span class="main">⟹</span> I_intT <span class="free">σ</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I_intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2C-infTp_I_intT"><span class="command">lemma</span></span> infTp_I_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span> <span class="main">⟹</span> I_intT <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">intT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I_intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2C-NE_I_intT"><span class="command">lemma</span></span> NE_I_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"NE <span class="main">(</span>I_intT <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> NE_intT <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc2C-I_intP_Cext"><span class="command">lemma</span></span> I_intP_Cext<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"polC <span class="free">p</span> <span class="main">=</span> Cext <span class="main">⟹</span> I_intP <span class="free">p</span> <span class="free">al</span> <span class="main">=</span> <span class="free">intP</span> <span class="free">p</span> <span class="main">(</span>map2 proj <span class="main">(</span><span class="free">parOf</span> <span class="free">p</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2C-I_intP_Text_imp"><span class="command">lemma</span></span> I_intP_Text_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polC <span class="free">p</span> <span class="main">=</span> Text"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intP</span> <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I_intP <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-I_intP_Fext_imp"><span class="command">lemma</span></span> I_intP_Fext_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polC <span class="free">p</span> <span class="main">=</span> Fext"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">intP</span> <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> I_intP <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">parOf</span> <span class="free">p</span><span class="main">)</span> <span class="free">al</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc2C-I_intP_intT"><span class="command">lemma</span></span> I_intP_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">parOf</span> <span class="free">p</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I_intP <span class="free">p</span> <span class="free">al</span> <span class="main">=</span> <span class="free">intP</span> <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"polC <span class="free">p</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-I_intP_Text_not_intT"><span class="command">lemma</span></span> I_intP_Text_not_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polC <span class="free">p</span> <span class="main">=</span> Text"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">parOf</span> <span class="free">p</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I_intP <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-I_intP_Fext_not_intT"><span class="command">lemma</span></span> I_intP_Fext_not_intT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polC <span class="free">p</span> <span class="main">=</span> Fext"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> list_all2 <span class="free">intT</span> <span class="main">(</span><span class="free">parOf</span> <span class="free">p</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> I_intP <span class="free">p</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> I_intP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-I_intF"><span class="command">lemma</span></span> I_intF<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 I_intT <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I_intT <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>I_intF <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I_intT_def I_intF_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> intF<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-Tstruct_I_intT"><span class="command">lemma</span></span> Tstruct_I_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"Tstruct I_intT"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> NE_I_intT<span class="main">)</span>

<span class="keyword1" id="Mcalc2C-inf_I_intT"><span class="command">lemma</span></span> inf_I_intT<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> I_intT <span class="free">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Mcalc2C-InfStruct"><span class="command">lemma</span></span> InfStruct<span class="main">:</span> <span class="quoted"><span class="quoted">"IInfStruct I_intT I_intF I_intP"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> NE_I_intT I_intF Tstruct_I_intT inf_I_intT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkPolMcalc2C *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ModelIkPolMcalc2C <span class="main">&lt;</span> InfStruct <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">I_intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">I_intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">I_intP</span>
<span class="keyword1"><span class="command">using</span></span> InfStruct <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The soundness of the calculus›</span></span>

<span class="comment1">(* In what follows, ``Ik" stands for the original
(augmented with infiniteness-knowledge)
and ``I" for the infinite structure constructed from it
through the above sublocale statement. *)</span>

<span class="keyword1"><span class="command">context</span></span> ModelIkPolMcalc2C <span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(* The environment translation along the projection: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">transE</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> proj <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mcalc2C-transE"><span class="command">lemma</span></span> transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"transE <span class="free">ξ</span> <span class="free">x</span> <span class="main">=</span> proj <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> transE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2C-wtE_transE"><span class="command">lemma</span></span> wtE_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span> <span class="main">⟹</span> Ik.wtE <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ik.wtE_def I.wtE_def transE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ik_intT</span> <span class="main">≡</span> <span class="free">intT</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ik_intF</span> <span class="main">≡</span> <span class="free">intF</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ik_intP</span> <span class="main">≡</span> <span class="free">intP</span>"</span></span>

<span class="keyword1" id="Mcalc2C-Ik_intT_int"><span class="command">lemma</span></span> Ik_intT_int<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="main">(</span>Ik.tpOf <span class="free">T</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> Ik.tpOf <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="main">(</span>Ik.tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="main">=</span> Var <span class="bound">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Var <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">using</span></span> wtE_transE<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> I.wt_int I_intT_def ξ wt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> tpOf <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nv2T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ik.full <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ik.full_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> nonVar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="main">=</span> Var <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonVar wt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> I_intF_def tpOf.simps int.simps
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ik.intF<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> listAll2_map2I<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2C-int_transE_proj"><span class="command">lemma</span></span> int_transE_proj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> proj <span class="main">(</span>tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wt <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik_intT <span class="main">(</span><span class="free">resOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>I_intF <span class="skolem">f</span> <span class="main">(</span>map <span class="main">(</span>int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="var">?a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> I_intF_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ik.intF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"proj <span class="var">?σ</span> <span class="var">?a</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> proj_id<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ik.int.simps int.simps tpOf.simps 1
    <span class="keyword1"><span class="command">unfolding</span></span> I_intF_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">intF</span></span> <span class="skolem"><span class="skolem">f</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">arOf</span> <span class="skolem">f</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> tpOf <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> proj <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_length transE_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span>
          map2 proj <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> Fn<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2C-int_transE_nv2T"><span class="command">lemma</span></span> int_transE_nv2T<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="main">(</span>Ik.tpOf <span class="free">T</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> Ik.tpOf <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> I.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> int_transE_proj<span class="main">[</span><span class="operator">OF</span> wt<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> proj_id<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> Ik_intT_int<span class="main">[</span><span class="operator">OF</span> wt ξ nv2T<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Mcalc2C-isGuard_not_satL_intT"><span class="command">lemma</span></span> isGuard_not_satL_intT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtL<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* crucial hypothesis--the essence of guarding:*)</span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"isGuard <span class="free">x</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="comment1">(* "proj σ (ξ σ x) = ξ σ x" *)</span>
<span class="comment1">(* "Ik.int (transE ξ) (Var σ x) = I.int ξ (Var σ x)" *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">at</span><span class="main">)</span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pr <span class="skolem">p</span> <span class="skolem">Tl</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> Tin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> set <span class="skolem">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2T <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pol<span class="main">:</span> <span class="quoted"><span class="quoted">"polC <span class="skolem">p</span> <span class="main">=</span> Text"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">unfolding</span></span> Pos Pr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_nv2T<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Tin
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 0 <span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">parOf</span> <span class="skolem">p</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wtL <span class="keyword1"><span class="command">unfolding</span></span> Pos Pr T
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T x in_nv2T tpOf.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 Ik_intT <span class="main">(</span><span class="free">parOf</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?phi</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ns <span class="keyword1"><span class="command">unfolding</span></span> Pos Pr <span class="keyword1"><span class="command">using</span></span> pol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?phi</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ns 0 i Ti <span class="keyword1"><span class="command">unfolding</span></span> Pos Pr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_length nth_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> g<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">at</span><span class="main">)</span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">T1</span> <span class="skolem">T2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T1</span> <span class="main">=</span> Var <span class="free">x</span> <span class="main">∨</span> <span class="skolem">T2</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">unfolding</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> wt1<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="skolem">T1</span>"</span></span> <span class="quoted"><span class="quoted">"Ik.tpOf <span class="skolem">T1</span> <span class="main">=</span> tpOfV <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wt2<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="skolem">T2</span>"</span></span> <span class="quoted"><span class="quoted">"Ik.tpOf <span class="skolem">T2</span> <span class="main">=</span> tpOfV <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtL <span class="keyword1"><span class="command">unfolding</span></span> Neg Eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"I.int <span class="free">ξ</span> <span class="skolem">T1</span> <span class="main">=</span> I.int <span class="free">ξ</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns <span class="keyword1"><span class="command">unfolding</span></span> Neg Eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">T1</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> T1 <span class="main">=</span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">Tl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T2</span> <span class="main">=</span> Fn <span class="skolem">f</span> <span class="skolem">Tl</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g T1 Eq <span class="keyword1"><span class="command">unfolding</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">infTp</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="skolem">T2</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="bound">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"I.int <span class="free">ξ</span> <span class="skolem">T2</span> <span class="main">=</span> Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int_transE_nv2T wt2 ξ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="skolem">T1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq 1 <span class="keyword1"><span class="command">using</span></span> wt2 ξ Ik.wt_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">Tl</span></span> <span class="keyword2"><span class="keyword">where</span></span> T2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T2</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T1</span> <span class="main">=</span> Fn <span class="skolem">f</span> <span class="skolem">Tl</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Eq Neg g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">infTp</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="skolem">T1</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="bound">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"I.int <span class="free">ξ</span> <span class="skolem">T1</span> <span class="main">=</span> Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int_transE_nv2T wt1 ξ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 1
      <span class="keyword1"><span class="command">using</span></span> wt1 ξ Ik.wt_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pr <span class="skolem">p</span> <span class="skolem">Tl</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> Tin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> set <span class="skolem">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> nv2T <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pol<span class="main">:</span> <span class="quoted"><span class="quoted">"polC <span class="skolem">p</span> <span class="main">=</span> Fext"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">unfolding</span></span> Neg Pr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_nv2T<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Tin
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 0 <span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">parOf</span> <span class="skolem">p</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wtL <span class="keyword1"><span class="command">unfolding</span></span> Neg Pr T
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T x in_nv2T tpOf.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 Ik_intT <span class="main">(</span><span class="free">parOf</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?phi</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ns <span class="keyword1"><span class="command">unfolding</span></span> Neg Pr <span class="keyword1"><span class="command">using</span></span> pol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?phi</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="var">?σ</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ns 0 i Ti <span class="keyword1"><span class="command">unfolding</span></span> Neg Pr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_length nth_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2C-int_transE"><span class="command">lemma</span></span> int_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> Ik.wtL <span class="bound">l</span> <span class="main">∧</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l</span> <span class="main">∧</span> isGuard <span class="bound">x</span> <span class="bound">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> I.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="main">(</span>Ik.tpOf <span class="free">T</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="free">T</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> Ik.tpOf <span class="free">T</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> int_transE_nv2T<span class="main">[</span><span class="operator">OF</span> wt ξ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> Ik.tpOf <span class="free">T</span>"</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">infTp</span> <span class="skolem">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> nv2T <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Var <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_nv2T<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> tpOfV <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"isGuard <span class="skolem">x</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nv2T<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> σ<span class="main"><span class="main">]</span></span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T <span class="keyword1"><span class="command">using</span></span> isGuard_not_satL_intT<span class="main">[</span><span class="operator">OF</span> 0 ξ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2C-intT_int_transE"><span class="command">lemma</span></span> intT_int_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> Ik.wtL <span class="bound">l</span> <span class="main">∧</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l</span> <span class="main">∧</span> isGuard <span class="bound">x</span> <span class="bound">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik_intT <span class="main">(</span>Ik.tpOf <span class="free">T</span><span class="main">)</span> <span class="main">(</span>I.int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"I.int <span class="free">ξ</span> <span class="free">T</span> <span class="main">=</span> Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int_transE<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> Ik.wt_int<span class="main">[</span><span class="operator">OF</span> wtE_transE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ξ<span class="main"><span class="main">]</span></span> wt<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2C-map_int_transE_nv2T"><span class="command">lemma</span></span> map_int_transE_nv2T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all Ik.wt <span class="free">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="main">∃</span><span class="bound">T</span><span class="main">∈</span>set <span class="free">Tl</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="bound">T</span><span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> Ik.wtL <span class="bound">l</span> <span class="main">∧</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l</span> <span class="main">∧</span> isGuard <span class="bound">x</span> <span class="bound">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span> map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> int_transE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Mcalc2C-list_all2_intT_int_transE_nv2T"><span class="command">lemma</span></span> list_all2_intT_int_transE_nv2T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all Ik.wt <span class="free">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
nv2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="main">∃</span><span class="bound">T</span><span class="main">∈</span>set <span class="free">Tl</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> nv2T <span class="bound">T</span><span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> Ik.wtL <span class="bound">l</span> <span class="main">∧</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l</span> <span class="main">∧</span> isGuard <span class="bound">x</span> <span class="bound">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all2 Ik_intT <span class="main">(</span>map Ik.tpOf <span class="free">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> list_all_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> intT_int_transE nth_mem<span class="main">)</span>

<span class="keyword1" id="Mcalc2C-map_proj_transE"><span class="command">lemma</span></span> map_proj_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all wt <span class="free">Tl</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Ik.int <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span>
       map2 proj <span class="main">(</span>map tpOf <span class="free">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">using</span></span> int_transE_proj <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mcalc2C-satL_transE"><span class="command">lemma</span></span> satL_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtL<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
nv2T<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> nv2L <span class="free">l</span><span class="main">⟧</span> <span class="main">⟹</span>
             <span class="main">∃</span> <span class="bound">l'</span><span class="main">.</span> Ik.wtL <span class="bound">l'</span> <span class="main">∧</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l'</span> <span class="main">∧</span> isGuard <span class="bound">x</span> <span class="bound">l'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ik.satL <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">at</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pr <span class="skolem">p</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Pos Pr
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"polC <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="main">(</span>map Ik.tpOf <span class="skolem">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">at</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pr <span class="skolem">p</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Neg Pr
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"polC <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="main">(</span>map Ik.tpOf <span class="skolem">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>I.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> assms int_transE_proj<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2C-satPB_transE"><span class="command">lemma</span></span> satPB_transE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"I.wtE <span class="free">ξ</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I.satPB_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> cin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">Φ</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"I.satC <span class="free">ξ</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> mc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">⊢2</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mcalc2<span class="main">[</span><span class="operator">OF</span> cin<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.satC <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sat_Φ wtE_transE<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span> cin <span class="keyword1"><span class="command">unfolding</span></span> Ik.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> wtC<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtC <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wt_Φ cin <span class="keyword1"><span class="command">unfolding</span></span> wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> set <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.satL <span class="main">(</span>transE <span class="free">ξ</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">unfolding</span></span> Ik.satC_iff_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> wtL<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wtC <span class="keyword1"><span class="command">unfolding</span></span> wtC_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> lin list_all_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l'</span><span class="main">.</span> <span class="bound">l'</span> <span class="main">∈</span> set <span class="skolem">c</span> <span class="main">⟹</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I.satC_iff_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I.satL <span class="free">ξ</span> <span class="skolem">l</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> satL_transE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wtL ξ _ l<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tpOfV <span class="skolem">x</span>"</span></span>
     <span class="keyword3"><span class="command">assume</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">infTp</span> <span class="var">?σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> nv2L <span class="skolem">l</span>"</span></span>
     <span class="keyword1"><span class="command">hence</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"isGuard <span class="skolem">x</span> <span class="main">(</span><span class="free">grdOf</span> <span class="skolem">c</span> <span class="skolem">l</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span><span class="main">]</span> lin <span class="keyword1"><span class="command">unfolding</span></span> mcalc2_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l'</span><span class="main">.</span> Ik.wtL <span class="bound">l'</span> <span class="main">∧</span> <span class="main">¬</span> I.satL <span class="free">ξ</span> <span class="bound">l'</span> <span class="main">∧</span> isGuard <span class="skolem">x</span> <span class="bound">l'</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">grdOf</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command">using</span></span> g σ cin lin wtL_grdOf x 0 grdOf x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0 lin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mcalc2C-I_SAT"><span class="command">lemma</span></span> I_SAT<span class="main">:</span> <span class="quoted"><span class="quoted">"I.SAT <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> I.SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mcalc2C-InfModel"><span class="command">lemma</span></span> InfModel<span class="main">:</span> <span class="quoted"><span class="quoted">"IInfModel I_intT I_intF I_intP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> I_SAT<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkPolMcalc2C *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ModelIkPolMcalc2C <span class="main">&lt;</span> inf<span class="main">?</span><span class="main">:</span> InfModel <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">I_intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">I_intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">I_intP</span>
<span class="keyword1"><span class="command">using</span></span> InfModel <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkPolMcalc2C <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
<span class="quoted"><span class="quoted">"<span class="free">MModelIkPolMcalc2C</span> <span class="main">≡</span> ModelIkPolMcalc2C <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">pol</span> <span class="free">grdOf</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> monot<span class="main">:</span> <span class="quoted">monot</span>
<span class="keyword1"><span class="command">unfolding</span></span> monot_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">intT</span> <span class="skolem">intF</span> <span class="skolem">intP</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"MModel <span class="skolem">intT</span> <span class="skolem">intF</span> <span class="skolem">intP</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"MModelIkPolMcalc2C <span class="skolem">intT</span> <span class="skolem">intF</span> <span class="skolem">intP</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ModelIkPolMcalc2C_def ModelIk_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">intTI</span> <span class="bound">intFI</span> <span class="bound">intPI</span><span class="main">.</span> IInfModel <span class="bound">intTI</span> <span class="bound">intFI</span> <span class="bound">intPI</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ModelIkPolMcalc2C.InfModel<span class="main">[</span><span class="operator">OF</span> M<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkPolMcalc2 *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Final theorem in sublocale form: Any problem that passes the
  monotonicity calculus is monotonic:›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkPolMcalc2C <span class="main">&lt;</span> MonotProblem
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> monot<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="G">
<div class="head">
<h1>Theory G</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Guard-Based Encodings›</span></span>
<span class="keyword1"><span class="command">theory</span></span> G
<span class="keyword2"><span class="keyword">imports</span></span> <a href="T_G_Prelim.html">T_G_Prelim</a> <a href="Mcalc2C.html">Mcalc2C</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The guard translation›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The extension of the function symbols with type witnesses:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span><span class="tfree">'tp</span><span class="main">)</span> efsym <span class="main">=</span> Oldf <span class="tfree"><span class="quoted"><span class="tfree">'fsym</span></span></span> <span class="main">|</span> Wit <span class="tfree"><span class="quoted"><span class="tfree">'tp</span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The extension of the predicate symbols with type guards:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'psym</span><span class="main">,</span><span class="tfree">'tp</span><span class="main">)</span> epsym <span class="main">=</span> Oldp <span class="tfree"><span class="quoted"><span class="tfree">'psym</span></span></span> <span class="main">|</span> Guard <span class="tfree"><span class="quoted"><span class="tfree">'tp</span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Extension of the partitioned infinitely augmented problem
for dealing with guards:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkTpartG <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIkTpart <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">prot</span></span> <span class="quoted"><span class="free">protFw</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prot</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protFw</span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="comment1">(* Further refinement of prot: *)</span>
    <span class="free">protCl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* types aimed to be classically protected *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
    protCl_prot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">protCl</span> <span class="bound">σ</span> <span class="main">⟹</span> <span class="free">prot</span> <span class="bound">σ</span>"</span></span>
    <span class="comment1">(* In order to add classical (implicational) guards, one needs
      backwards closure on the ranks of function symbols*)</span>
<span class="keyword2"><span class="keyword">and</span></span> protCl_fsym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resPf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> list_all <span class="free">protCl</span> <span class="main">(</span><span class="free">arOf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> ModelIkTpartG <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIkTpartG <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">prot</span></span> <span class="quoted"><span class="free">protFw</span></span> <span class="quoted"><span class="free">protCl</span></span> <span class="main">+</span>
Ik<span class="main">?</span> <span class="main">:</span> ModelIkTpart <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">prot</span></span> <span class="quoted"><span class="free">protFw</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prot</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protFw</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protCl</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="G-protCl_resOf_arOf"><span class="command">lemma</span></span> protCl_resOf_arOf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">protCl</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms protCl_fsym <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹``GE'' stands for ``guard encoding'':›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_wtFsym</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_wtFsym</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">wtFsym</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_wtFsym</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> isRes <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∨</span> <span class="free">protCl</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_arOf</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_arOf</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_arOf</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_resOf</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_resOf</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_resOf</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_wtPsym</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_wtPsym</span> <span class="main">(</span>Oldp <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">wtPsym</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_wtPsym</span> <span class="main">(</span>Guard <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> unprot <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_parOf</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_parOf</span> <span class="main">(</span>Oldp <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_parOf</span> <span class="main">(</span>Guard <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span>"</span></span>


<span class="keyword1" id="G-countable_GE_wtFsym"><span class="command">lemma</span></span> countable_GE_wtFsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>Collect GE_wtFsym<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?K</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">ef</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ef</span> <span class="keyword1">of</span> Oldf <span class="bound">f</span> <span class="main">⇒</span> Inl <span class="bound">f</span> <span class="main">|</span> Wit <span class="bound">σ</span> <span class="main">⇒</span> Inr <span class="bound">σ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span><span class="tfree">'tp</span> set"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Collect <span class="free">wtFsym</span><span class="main">)</span> <span class="main">&lt;+&gt;</span> <span class="var">?U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?F</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">y</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">`</span> <span class="var">?K</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ef</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="var">?K</span><span class="main">|</span> <span class="keyword1">≤o</span> <span class="main">|</span><span class="var">?L</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card_of_ordLeq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countable_wtFsym countable_tp
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> countable_Plus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> countable_ordLeq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-countable_GE_wtPsym"><span class="command">lemma</span></span> countable_GE_wtPsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>Collect GE_wtPsym<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?K</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">ep</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ep</span> <span class="keyword1">of</span> Oldp <span class="bound">p</span> <span class="main">⇒</span> Inl <span class="bound">p</span> <span class="main">|</span> Guard <span class="bound">σ</span> <span class="main">⇒</span> Inr <span class="bound">σ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span><span class="tfree">'tp</span> set"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Collect <span class="free">wtPsym</span><span class="main">)</span> <span class="main">&lt;+&gt;</span> <span class="var">?U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?F</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">y</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">`</span> <span class="var">?K</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ep</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="var">?K</span><span class="main">|</span> <span class="keyword1">≤o</span> <span class="main">|</span><span class="var">?L</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card_of_ordLeq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countable_wtPsym countable_tp
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> countable_Plus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> countable_ordLeq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpartG *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span> <span class="main">:</span> Signature
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
<span class="keyword1"><span class="command">using</span></span> countable_tp countable_GE_wtFsym countable_GE_wtPsym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The guarding literal of a variable:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">grdLit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'tp</span><span class="main">)</span> efsym<span class="main">,</span> <span class="main">(</span><span class="tfree">'psym</span><span class="main">,</span> <span class="tfree">'tp</span><span class="main">)</span> epsym<span class="main">)</span> lit"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">grdLit</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> Neg <span class="main">(</span>Pr <span class="main">(</span>Guard <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The (set of) guarding literals of a literal and of a clause:›</span></span>

<span class="comment1">(* of a literal: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">glitOfL</span> <span class="main">::</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> lit <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'tp</span><span class="main">)</span> efsym<span class="main">,</span> <span class="main">(</span><span class="tfree">'psym</span><span class="main">,</span> <span class="tfree">'tp</span><span class="main">)</span> epsym<span class="main">)</span> lit set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">glitOfL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">{</span>grdLit <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsA <span class="free"><span class="bound"><span class="entity">at</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free">prot</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">protFw</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> nvA <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">glitOfL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>grdLit <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsA <span class="free"><span class="bound"><span class="entity">at</span></span></span> <span class="main">∧</span> <span class="free">prot</span> <span class="main">(</span>tpOfV <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="comment1">(* of a clause: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">glitOfC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map glitOfL <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="G-finite_glitOfL"><span class="command">lemma</span></span> finite_glitOfL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>glitOfL <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"glitOfL <span class="free">l</span> <span class="main">⊆</span> grdLit <span class="main">`</span> <span class="main">{</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> varsL <span class="free">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq finite_surj finite_varsL<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-finite_glitOfC"><span class="command">lemma</span></span> finite_glitOfC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>glitOfC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> glitOfC_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_Union<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> finite_glitOfL <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gT</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">gT</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">gT</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> Fn <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="free">gT</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">gA</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span>gT <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">(</span>gT <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">gA</span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> Pr <span class="main">(</span>Oldp <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>map gT <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">gL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> Pos <span class="main">(</span>gA <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">gL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>gA <span class="free"><span class="bound"><span class="entity">at</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">(</span>map gL <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>list <span class="main">(</span>glitOfC <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="G-set_gC"><span class="command">lemma</span></span> set_gC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>gC <span class="free">c</span><span class="main">)</span> <span class="main">=</span> gL <span class="main">`</span> <span class="main">(</span>set <span class="free">c</span><span class="main">)</span> <span class="main">∪</span> glitOfC <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> gC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The extra axioms:›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The function axioms:›</span></span>

<span class="comment1">(* conclusion (atom): *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cOfFax</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> Pr <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>Fn <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="comment1">(* hypotheses (list of atoms): *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">hOfFax</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> map2 <span class="main">(</span>Pr <span class="keyword1">o</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>map singl <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(* The axiom (clause) for non-classically-decorated (lightweight and featherweigh) types: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fax</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">[</span>Pos <span class="main">(</span>cOfFax <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="comment1">(* The axiom (clause) for classically-decorated types: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">faxCD</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> map Neg <span class="main">(</span>hOfFax <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">@</span> fax <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="comment1">(* The set of axioms: *)</span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Fax</span> <span class="main">≡</span> <span class="main">{</span>fax <span class="bound">f</span> <span class="main">|</span> <span class="bound">f</span><span class="main">.</span> <span class="free">wtFsym</span> <span class="bound">f</span> <span class="main">∧</span> <span class="main">¬</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="bound">f</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>
       <span class="main">{</span>faxCD <span class="bound">f</span> <span class="main">|</span> <span class="bound">f</span><span class="main">.</span> <span class="free">wtFsym</span> <span class="bound">f</span> <span class="main">∧</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="bound">f</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The witness axioms:›</span></span>

<span class="comment1">(* The axiom (clause): *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wax</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">[</span>Pos <span class="main">(</span>Pr <span class="main">(</span>Guard <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[</span>Fn <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="comment1">(* The set of axioms: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wax</span> <span class="main">≡</span> <span class="main">{</span>wax <span class="bound">σ</span> <span class="main">|</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">¬</span> unprot <span class="bound">σ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> isRes <span class="bound">σ</span> <span class="main">∨</span> <span class="free">protCl</span> <span class="bound">σ</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gPB</span> <span class="main">=</span> gC <span class="main">`</span> <span class="free">Φ</span> <span class="main">∪</span> Fax <span class="main">∪</span> Wax"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Well-typedness of the translation:›</span></span>

<span class="keyword1" id="G-tpOf_g"><span class="command">lemma</span></span> tpOf_g<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.tpOf <span class="main">(</span>gT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.tpOf <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="G-wt_g"><span class="command">lemma</span></span> wt_g<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span> <span class="main">⟹</span> GE.wt <span class="main">(</span>gT <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="G-wtA_gA"><span class="command">lemma</span></span> wtA_gA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtA <span class="free">at</span> <span class="main">⟹</span> GE.wtA <span class="main">(</span>gA <span class="free">at</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="G-wtL_gL"><span class="command">lemma</span></span> wtL_gL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="free">l</span> <span class="main">⟹</span> GE.wtL <span class="main">(</span>gL <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="G-wtC_map_gL"><span class="command">lemma</span></span> wtC_map_gL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtC <span class="free">c</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>map gL <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ik.wtC_def GE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="G-wtL_grdLit_unprot"><span class="command">lemma</span></span> wtL_grdLit_unprot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> GE.wtL <span class="main">(</span>grdLit <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> grdLit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtL_grdLit"><span class="command">lemma</span></span> wtL_grdLit<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prot</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> GE.wtL <span class="main">(</span>grdLit <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtL_grdLit_unprot<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtL_glitOfL"><span class="command">lemma</span></span> wtL_glitOfL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> glitOfL <span class="free">l</span> <span class="main">⟹</span> GE.wtL <span class="free">l'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="G-wtL_glitOfC"><span class="command">lemma</span></span> wtL_glitOfC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> glitOfC <span class="free">c</span> <span class="main">⟹</span> GE.wtL <span class="free">l'</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> glitOfC_def GE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="G-wtC_list_glitOfC"><span class="command">lemma</span></span> wtC_list_glitOfC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtC <span class="main">(</span>list <span class="main">(</span>glitOfC <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> glitOfC_def GE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtC_gC"><span class="command">lemma</span></span> wtC_gC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtC <span class="free">c</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>gC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> gC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-wtA_cOfFax_unprot"><span class="command">lemma</span></span> wtA_cOfFax_unprot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> <span class="main">¬</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtA <span class="main">(</span>cOfFax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> cOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-wtA_cOfFax"><span class="command">lemma</span></span> wtA_cOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> <span class="free">prot</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtA <span class="main">(</span>cOfFax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtA_cOfFax_unprot<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtA_hOfFax"><span class="command">lemma</span></span> wtA_hOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> list_all GE.wtA <span class="main">(</span>hOfFax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> hOfFax_def <span class="keyword1"><span class="command">unfolding</span></span> list_all_length
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singl_def unprot_def<span class="main">)</span>

<span class="keyword1" id="G-wtC_fax_unprot"><span class="command">lemma</span></span> wtC_fax_unprot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> <span class="main">¬</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>fax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fax_def GE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtC_fax"><span class="command">lemma</span></span> wtC_fax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> <span class="free">prot</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>fax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtC_fax_unprot<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtC_faxCD"><span class="command">lemma</span></span> wtC_faxCD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>faxCD <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> faxCD_def GE.wtC_append <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> wtA_hOfFax<span class="main">[</span><span class="operator">unfolded</span> list_all_length<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GE.wtC_def list_all_length<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-wtPB_Fax"><span class="command">lemma</span></span> wtPB_Fax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtPB Fax"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Fax_def GE.wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtC_wax_unprot"><span class="command">lemma</span></span> wtC_wax_unprot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¬</span> unprot <span class="free">σ</span><span class="main">;</span> <span class="main">¬</span> isRes <span class="free">σ</span> <span class="main">∨</span> <span class="free">protCl</span> <span class="free">σ</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>wax <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wax_def GE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-wtC_wax"><span class="command">lemma</span></span> wtC_wax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">prot</span> <span class="free">σ</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="free">σ</span><span class="main">;</span> <span class="main">¬</span> isRes <span class="free">σ</span> <span class="main">∨</span> <span class="free">protCl</span> <span class="free">σ</span><span class="main">⟧</span> <span class="main">⟹</span> GE.wtC <span class="main">(</span>wax <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtC_wax_unprot<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtPB_Wax"><span class="command">lemma</span></span> wtPB_Wax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtPB Wax"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Wax_def GE.wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtPB_gC_Φ"><span class="command">lemma</span></span> wtPB_gC_Φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtPB <span class="main">(</span>gC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Ik.wt_Φ <span class="keyword1"><span class="command">unfolding</span></span> Ik.wtPB_def GE.wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtPB_tPB"><span class="command">lemma</span></span> wtPB_tPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtPB gPB"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*  *)</span>

<span class="keyword1" id="G-wtA_Guard"><span class="command">lemma</span></span> wtA_Guard<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GE.wtA <span class="main">(</span>Pr <span class="main">(</span>Guard <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">T</span><span class="main">.</span> <span class="free">Tl</span> <span class="main">=</span> <span class="main">[</span><span class="bound">T</span><span class="main">]</span> <span class="main">∧</span> GE.wt <span class="bound">T</span> <span class="main">∧</span> tpOf <span class="bound">T</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> list.inject map_eq_Cons_conv 
                           list_all_simps map_is_Nil_conv neq_Nil_conv<span class="main">)</span>

<span class="keyword1" id="G-wt_Wit"><span class="command">lemma</span></span> wt_Wit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GE.wt <span class="main">(</span>Fn <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tl</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-tpOf_Wit"><span class="command">lemma</span></span> tpOf_Wit<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.tpOf <span class="main">(</span>Fn <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpartG *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">context</span></span> ModelIkTpartG <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The identity-guard extension of a given structure of the original signature *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_intF</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_intF</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> <span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_intF</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> pickT <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="comment1">(* note: for witnesses, we only care about al being [] *)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GE_intP</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GE_intP</span> <span class="main">(</span>Oldp <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">GE_intP</span> <span class="main">(</span>Guard <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> True"</span></span>
<span class="comment1">(* note: for guards, we only care about al being a singleton *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkTpartG *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ModelIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span> <span class="main">:</span> Struct
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span> <span class="keyword2"><span class="keyword">and</span></span>
arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">GE_intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">GE_intP</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ef</span> <span class="skolem">al</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"GE_wtFsym <span class="skolem">ef</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="main">(</span>GE_arOf <span class="skolem">ef</span><span class="main">)</span> <span class="skolem">al</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">(</span>GE_resOf <span class="skolem">ef</span><span class="main">)</span> <span class="main">(</span>GE_intF <span class="skolem">ef</span> <span class="skolem">al</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> intF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ef</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> ModelIkTpartG <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="G-g_int"><span class="command">lemma</span></span> g_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.int <span class="free">ξ</span> <span class="main">(</span>gT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>GE.int <span class="free">ξ</span> <span class="main">∘</span> gT<span class="main">)</span> <span class="skolem">Tl</span> <span class="main">=</span> map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-map_g_int"><span class="command">lemma</span></span> map_g_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>GE.int <span class="free">ξ</span> <span class="main">∘</span> gT<span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span> map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-gA_satA"><span class="command">lemma</span></span> gA_satA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satA <span class="free">ξ</span> <span class="main">(</span>gA <span class="free">at</span><span class="main">)</span> <span class="main">⟷</span> Ik.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-gL_satL"><span class="command">lemma</span></span> gL_satL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satL <span class="free">ξ</span> <span class="main">(</span>gL <span class="free">l</span><span class="main">)</span> <span class="main">⟷</span> Ik.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-map_gL_satC"><span class="command">lemma</span></span> map_gL_satC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satC <span class="free">ξ</span> <span class="main">(</span>map gL <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> Ik.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> GE.satC_def Ik.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="G-gC_satC"><span class="command">lemma</span></span> gC_satC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"GE.satC <span class="free">ξ</span> <span class="main">(</span>gC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> gC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-gC_Φ_satPB"><span class="command">lemma</span></span> gC_Φ_satPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"GE.satPB <span class="free">ξ</span> <span class="main">(</span>gC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> GE.satPB_def Ik.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-Fax_Wax_satPB"><span class="command">lemma</span></span> Fax_Wax_satPB<span class="main">:</span>
<span class="quoted"><span class="quoted">"GE.satPB <span class="free">ξ</span> <span class="main">(</span>Fax<span class="main">)</span> <span class="main">∧</span> GE.satPB <span class="free">ξ</span> <span class="main">(</span>Wax<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> GE.satPB_def GE.satC_def Fax_def Wax_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cOfFax_def hOfFax_def fax_def faxCD_def wax_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Fax_satPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Fax_Wax_satPB<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Wax_satPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Fax_Wax_satPB<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1" id="G-soundness"><span class="command">lemma</span></span> soundness<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.SAT gPB"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> GE.SAT_def gPB_def <span class="keyword1"><span class="command">using</span></span> SAT <span class="keyword1"><span class="command">unfolding</span></span> Ik.SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> G_soundness<span class="main">:</span>
<span class="quoted"><span class="quoted">"Model GE_wtFsym GE_wtPsym GE_arOf GE_resOf GE_parOf gPB <span class="free">intT</span> GE_intF GE_intP"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> wtPB_tPB soundness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkTpartG *)</span>

<span class="comment1">(* Soundness theorem in sublocale form: Given a problem (with indicated
type partition) and a model for it, we obtain a model of the tag-extended (GE)
problem: *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> ModelIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span> <span class="main">:</span> Model
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span> <span class="keyword2"><span class="keyword">and</span></span>
arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">gPB</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">GE_intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">GE_intP</span>
<span class="keyword1"><span class="command">using</span></span> G_soundness <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="comment1">(* Problem with type partition and model of its guard-encoding translation: *)</span>
<span class="keyword1"><span class="command">locale</span></span> ProblemIkTpartG_GEModel <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIkTpartG <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">prot</span></span> <span class="quoted"><span class="free">protFw</span></span> <span class="quoted"><span class="free">protCl</span></span> <span class="main">+</span>
GE<span class="main">?</span> <span class="main">:</span> Model <span class="quoted"><span class="quoted">"ProblemIkTpartG.GE_wtFsym <span class="free">wtFsym</span> <span class="free">resOf</span> <span class="free">protCl</span>"</span></span>
            <span class="quoted"><span class="quoted">"ProblemIkTpartG.GE_wtPsym <span class="free">wtPsym</span> <span class="free">prot</span> <span class="free">protFw</span>"</span></span>
            <span class="quoted"><span class="quoted">"ProblemIkTpartG.GE_arOf <span class="free">arOf</span>"</span></span> <span class="quoted"><span class="quoted">"ProblemIkTpartG.GE_resOf <span class="free">resOf</span>"</span></span>
            <span class="quoted"><span class="quoted">"ProblemIkTpartG.GE_parOf <span class="free">parOf</span>"</span></span>
            <span class="quoted">gPB</span> <span class="quoted"><span class="free">eintT</span></span> <span class="quoted"><span class="free">eintF</span></span> <span class="quoted"><span class="free">eintP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prot</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protFw</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protCl</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintP</span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG_GEModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The reduct structure of a given structure in the guard-extended signature:›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span>
 <span class="keyword1">if</span> unprot <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">then</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
 <span class="keyword1">else</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free">eintP</span> <span class="main">(</span>Guard <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">eintP</span> <span class="main">(</span>Oldp <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span>"</span></span>

<span class="comment1">(* Semantic rephrasings of the fact that the (guarded problem) model satisfies
   Fax and Wax *)</span>
<span class="keyword1" id="G-GE_Guard_all"><span class="command">lemma</span></span> GE_Guard_all<span class="main">:</span> <span class="comment1">(* fixme: messy proof *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="free">eintP</span> <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free">f</span><span class="main">)</span> <span class="free">al</span><span class="main">]</span><span class="main">)</span>
 <span class="main">∧</span>
 <span class="main">(</span><span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟶</span>
  list_all2 <span class="main">(</span><span class="free">eintP</span> <span class="main">∘</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map singl <span class="free">al</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="free">eintP</span> <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free">f</span><span class="main">)</span> <span class="free">al</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?A1</span> <span class="main">⟶</span> <span class="var">?C</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="var">?A2</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="main">⟶</span> <span class="var">?C</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xl</span> <span class="main">=</span> getVars <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xl</span> <span class="main">=</span> length <span class="free">al</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">al</span> <span class="main">=</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"length <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> xl_def <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> tpOfV <span class="main">(</span><span class="skolem">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> xl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xl</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xl_def <span class="keyword1"><span class="command">using</span></span> distinct_getVars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> pickE <span class="skolem">xl</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ξ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtE_pickE<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> al list_all2_nthD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">ξ</span> <span class="main">(</span><span class="skolem">xl</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> ξ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all2_length <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pickE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>GE.int <span class="skolem">ξ</span><span class="main">)</span> <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all2_length getTvars_def xl_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"GE.satC <span class="skolem">ξ</span> <span class="main">(</span>map Neg <span class="main">(</span>map2 <span class="main">(</span>Pr <span class="main">∘</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map singl <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">¬</span> list_all2 <span class="main">(</span><span class="free">eintP</span> <span class="main">∘</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map singl <span class="free">al</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GE.satC_def list_ex_length list_all2_map2 singl_def
  <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_zip_map2 singl_def getTvars_def xl_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Fax<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satPB <span class="skolem">ξ</span> Fax"</span></span> <span class="keyword1"><span class="command">using</span></span> GE.sat_Φ<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> gPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A1</span></span></span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.satC <span class="skolem">ξ</span> <span class="main">(</span>fax <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f Fax <span class="keyword1"><span class="command">unfolding</span></span> GE.satPB_def Fax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fax_def cOfFax_def GE.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?H2</span></span></span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.satC <span class="skolem">ξ</span> <span class="main">(</span>faxCD <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f Fax <span class="keyword1"><span class="command">unfolding</span></span> GE.satPB_def Fax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H2</span>›</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> faxCD_def fax_def cOfFax_def hOfFax_def
   <span class="keyword1"><span class="command">unfolding</span></span> GE.satC_append 1 <span class="keyword1"><span class="command">unfolding</span></span> GE.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-GE_Guard_not_unprot_protCl"><span class="command">lemma</span></span> GE_Guard_not_unprot_protCl<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> GE_Guard_all<span class="main">[</span><span class="operator">OF</span> f al<span class="main">]</span> f2 <span class="keyword1"><span class="command">unfolding</span></span> intF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-GE_Guard_protCl"><span class="command">lemma</span></span> GE_Guard_protCl<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="free">eintP</span> <span class="main">∘</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map singl <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> GE_Guard_all<span class="main">[</span><span class="operator">OF</span> f al<span class="main">]</span> f2 H <span class="keyword1"><span class="command">unfolding</span></span> intF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-GE_Guard_not_unprot"><span class="command">lemma</span></span> GE_Guard_not_unprot<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="free">eintP</span> <span class="main">∘</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map singl <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> GE_Guard_protCl<span class="main">[</span><span class="operator">OF</span> f _ al H<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> GE_Guard_not_unprot_protCl<span class="main">[</span><span class="operator">OF</span> f f2 _ al<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-GE_Wit"><span class="command">lemma</span></span> GE_Wit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isRes <span class="free">σ</span> <span class="main">∨</span> <span class="free">protCl</span> <span class="free">σ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="free">eintF</span> <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> pickE <span class="main">[]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ξ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtE_pickE<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"GE.satPB <span class="skolem">ξ</span> Wax"</span></span> <span class="keyword1"><span class="command">using</span></span> GE.sat_Φ<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> gPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.satC <span class="skolem">ξ</span> <span class="main">(</span>wax <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Wax_def GE.satPB_def <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> satC_def wax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-NE_intT_forget"><span class="command">lemma</span></span> NE_intT_forget<span class="main">:</span> <span class="quoted"><span class="quoted">"NE <span class="main">(</span>intT <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GE.NE_intT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="free">σ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"isRes <span class="free">σ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">=</span> <span class="free">resOf</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> isRes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">al</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">al</span> <span class="main">=</span> map pickT <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">al</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> al_def list_all2_map2 <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> intF <span class="skolem">f</span> <span class="skolem">al</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def σ intF_def <span class="keyword1"><span class="command">using</span></span> f al
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GE_arOf.simps GE_resOf.simps GE_wtFsym.simps GE.intF<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protCl</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True GE_arOf.simps GE_resOf.simps GE_wtFsym.simps intF list_all2_Nil<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">using</span></span> GE_Wit<span class="main">[</span><span class="operator">OF</span> unprot<span class="main">]</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unprot GE_Guard_not_unprot_protCl<span class="main">[</span><span class="operator">OF</span> f _ _ al<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> σ a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot a <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False GE_arOf.simps GE_resOf.simps GE_wtFsym.simps intF list_all2_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">using</span></span> GE_Wit<span class="main">[</span><span class="operator">OF</span> unprot<span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-wt_intF"><span class="command">lemma</span></span> wt_intF<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 intT <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intT <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> intT_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free">f</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GE_arOf.simps GE_resOf.simps GE_wtFsym.simps f al GE.intF<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> intF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintP</span> <span class="main">(</span>Guard <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protCl</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> GE_Guard_not_unprot_protCl<span class="main">[</span><span class="operator">OF</span> f unprot False 0<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"list_all <span class="free">protCl</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> protCl_fsym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">¬</span> unprot <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> list_all_length unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="free">eintP</span> <span class="main">∘</span> Guard<span class="main">)</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map singl <span class="free">al</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> intT_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> list_all2_length list_all_length
      singl_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> GE_Guard_protCl<span class="main">[</span><span class="operator">OF</span> f True 0 2<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-Struct"><span class="command">lemma</span></span> Struct<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> intT intF intP"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> NE_intT_forget wt_intF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpartG_GEModel *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG_GEModel <span class="main">&lt;</span> Ik<span class="main">?</span> <span class="main">:</span> Struct
<span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted">intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intP</span>
<span class="keyword1"><span class="command">using</span></span> Struct <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG_GEModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="G-wtE"><span class="command">lemma</span></span> wtE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span> <span class="main">⟹</span> GE.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ik.wtE_def GE.wtE_def intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="G-int_g"><span class="command">lemma</span></span> int_g<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.int <span class="free">ξ</span> <span class="main">(</span>gT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ar</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">arOf</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">resOf</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span> <span class="main">=</span> map <span class="main">(</span>GE.int <span class="free">ξ</span> <span class="main">∘</span> gT<span class="main">)</span> <span class="skolem">Tl</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ik.int.simps GE.int.simps gT.simps <span class="keyword1"><span class="command">unfolding</span></span> intF_def
  <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-map_int_g"><span class="command">lemma</span></span> map_int_g<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span> map <span class="main">(</span>GE.int <span class="free">ξ</span> <span class="main">∘</span> gT<span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-satA_gA"><span class="command">lemma</span></span> satA_gA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satA <span class="free">ξ</span> <span class="main">(</span>gA <span class="free">at</span><span class="main">)</span> <span class="main">⟷</span> Ik.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intP_def<span class="main">)</span>

<span class="keyword1" id="G-satL_gL"><span class="command">lemma</span></span> satL_gL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satL <span class="free">ξ</span> <span class="main">(</span>gL <span class="free">l</span><span class="main">)</span> <span class="main">⟷</span> Ik.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="G-satC_map_gL"><span class="command">lemma</span></span> satC_map_gL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.satC <span class="free">ξ</span> <span class="main">(</span>map gL <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> Ik.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> GE.satC_def Ik.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtE_not_grdLit_unprot"><span class="command">lemma</span></span> wtE_not_grdLit_unprot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* crucial: *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> GE.satL <span class="free">ξ</span> <span class="main">(</span>grdLit <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Ik.wtE_def intT_def grdLit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-wtE_not_grdLit"><span class="command">lemma</span></span> wtE_not_grdLit<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prot</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> GE.satL <span class="free">ξ</span> <span class="main">(</span>grdLit <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtE_not_grdLit_unprot<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-wtE_not_glitOfL"><span class="command">lemma</span></span> wtE_not_glitOfL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> GE.satC <span class="free">ξ</span> <span class="main">(</span>list <span class="main">(</span>glitOfL <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> GE.satC_def list_ex_list<span class="main">[</span><span class="operator">OF</span> finite_glitOfL<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="G-wtE_not_glitOfC"><span class="command">lemma</span></span> wtE_not_glitOfC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> GE.satC <span class="free">ξ</span> <span class="main">(</span>list <span class="main">(</span>glitOfC <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wtE_not_glitOfL<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> GE.satC_def list_ex_list<span class="main">[</span><span class="operator">OF</span> finite_glitOfC<span class="main">]</span> list_ex_list<span class="main">[</span><span class="operator">OF</span> finite_glitOfL<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> glitOfC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-satC_gC"><span class="command">lemma</span></span> satC_gC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"GE.satC <span class="free">ξ</span> <span class="main">(</span>gC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> gC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="G-satPB_gPB"><span class="command">lemma</span></span> satPB_gPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"GE.satPB <span class="free">ξ</span> <span class="main">(</span>gC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ik.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Ik.wt_Φ assms <span class="keyword1"><span class="command">unfolding</span></span> GE.satPB_def Ik.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ik.wtPB_def<span class="main">)</span>

<span class="keyword1" id="G-completeness"><span class="command">lemma</span></span> completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.SAT <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ik.SAT_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ξ</span> <span class="keyword3"><span class="command">assume</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.satPB <span class="skolem">ξ</span> gPB"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GE.sat_Φ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.satPB <span class="skolem">ξ</span> <span class="main">(</span>gC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Ik.satPB <span class="skolem">ξ</span> <span class="free">Φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ξ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-G_completeness"><span class="command">lemma</span></span> G_completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> intT intF intP"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> completeness <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpartG_GEModel *)</span>

<span class="comment1">(* Completeness theorem in sublocale form: Given a problem (with indicated
type partition) and a model for its guard-translated problem,
we obtain a model of the original problem: *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG_GEModel <span class="main">&lt;</span> Ik<span class="main">?</span> <span class="main">:</span> Model
<span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted">intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intP</span>
<span class="keyword1"><span class="command">using</span></span> G_completeness <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The result of the guard translation is an infiniteness-augmented problem›</span></span>

<span class="comment1">(* An observation similar to the corresponding one for tags applies here.  *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span> <span class="main">:</span> Problem
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">gPB</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span> <span class="main">:</span> ProblemIk
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">gPB</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span> <span class="skolem">a</span>  <span class="keyword3"><span class="command">assume</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="skolem">σ</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"Model GE_wtFsym GE_wtPsym GE_arOf GE_resOf GE_parOf gPB <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?GE_intT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ProblemIkTpartG_GEModel.intT <span class="free">prot</span> <span class="free">protFw</span> <span class="skolem">eintT</span> <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?GE_intF</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ProblemIkTpartG_GEModel.intF <span class="skolem">eintF</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?GE_intP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ProblemIkTpartG_GEModel.intP <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"ProblemIkTpartG_GEModel <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span>
                                   <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">prot</span> <span class="free">protFw</span> <span class="free">protCl</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">unfolding</span></span> ProblemIkTpartG_GEModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> MM<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.MModel <span class="var">?GE_intT</span> <span class="var">?GE_intF</span> <span class="var">?GE_intP</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ProblemIkTpartG_GEModel.G_completeness<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="var">?GE_intT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infTp<span class="main">[</span><span class="operator">OF</span> σ MM<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="var">?GE_intT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">eintT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ProblemIkTpartG_GEModel.intT_def<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">eintT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The verification of the second monotonicity calculus criterion
for the guarded problem›</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pol</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pol</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>Oldp <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Cext"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pol</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>Guard <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> Fext"</span></span>

<span class="keyword1" id="G-pol_ct"><span class="command">lemma</span></span> pol_ct<span class="main">:</span> <span class="quoted"><span class="quoted">"pol <span class="free">σ1</span> <span class="free">p</span> <span class="main">=</span> pol <span class="free">σ2</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">grdOf</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> grdLit <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span><span class="main">:</span> ProblemIkPol
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">gPB</span> <span class="keyword2"><span class="keyword">and</span></span> pol <span class="main">=</span> <span class="quoted">pol</span> <span class="keyword2"><span class="keyword">and</span></span> grdOf <span class="main">=</span> <span class="quoted">grdOf</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="G-nv2_nv"><span class="command">lemma</span></span> nv2_nv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.nv2T <span class="main">(</span>gT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> GE.nvT <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_nvL"><span class="command">lemma</span></span> nv2L_nvL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="main">(</span>gL <span class="free">l</span><span class="main">)</span> <span class="main">=</span> GE.nvL <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">at</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">at</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">at</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-nv2L"><span class="command">lemma</span></span> nv2L<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> set <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mc<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.mcalc <span class="free">σ</span> <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="free">σ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> GE.nv2L <span class="main">(</span>gL <span class="free">l</span><span class="main">)</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mc nv2L_nvL <span class="keyword1"><span class="command">unfolding</span></span> GE.mcalc_iff GE.nvC_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">using</span></span> nv2L_nvL<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_subsetI equalityI nv2L_nvL<span class="main">)</span>

<span class="comment1">(* The guarding literals are guarded: *)</span>
<span class="keyword1" id="G-isGuard_grdLit"><span class="command">lemma</span></span> isGuard_grdLit<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.isGuard <span class="free">x</span> <span class="main">(</span>grdLit <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> grdLit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_grdLit"><span class="command">lemma</span></span> nv2L_grdLit<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="main">(</span>grdLit <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> grdLit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-mcalc_mcalc2"><span class="command">lemma</span></span> mcalc_mcalc2<span class="main">:</span> <span class="quoted"><span class="quoted">"GE.mcalc <span class="free">σ</span> <span class="free">c</span> <span class="main">⟹</span> GE.mcalc2 <span class="free">σ</span> <span class="main">(</span>gC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nv2L <span class="keyword1"><span class="command">unfolding</span></span> GE.mcalc2_iff gC_def glitOfC_def grdOf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_wax"><span class="command">lemma</span></span> nv2L_wax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> set <span class="main">(</span>wax <span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> GE.nv2L <span class="free">l'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_Wax"><span class="command">lemma</span></span> nv2L_Wax<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> Wax"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> set <span class="free">c'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="free">l'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Wax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_cOfFax"><span class="command">lemma</span></span> nv2L_cOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="main">(</span>Pos <span class="main">(</span>cOfFax <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> cOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_hOfFax"><span class="command">lemma</span></span> nv2L_hOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">at</span> <span class="main">∈</span> set <span class="main">(</span>hOfFax <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="main">(</span>Neg <span class="free">at</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_fax"><span class="command">lemma</span></span> nv2L_fax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> set <span class="main">(</span>fax <span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> GE.nv2L <span class="free">l</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_faxCD"><span class="command">lemma</span></span> nv2L_faxCD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> set <span class="main">(</span>faxCD <span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> GE.nv2L <span class="free">l</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> faxCD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-nv2L_Fax"><span class="command">lemma</span></span> nv2L_Fax<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> Fax"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> set <span class="free">c'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="free">l'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Fax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="G-grdOf"><span class="command">lemma</span></span> grdOf<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> gPB"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> set <span class="free">c'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> GE.nv2L <span class="free">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">infTp</span> <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"grdOf <span class="free">c'</span> <span class="free">l'</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">c'</span> <span class="main">∧</span> GE.isGuard <span class="free">x</span> <span class="main">(</span>grdOf <span class="free">c'</span> <span class="free">l'</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> Fax <span class="main">∪</span> Wax"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x l' nv2L_Wax nv2L_Fax <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">=</span> gC <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c' <span class="keyword1"><span class="command">unfolding</span></span> gPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> glitOfC <span class="skolem">c</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> set <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">∈</span> glitOfL <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> glitOfC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">=</span> grdLit <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lit.exhaust<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"GE.nv2L <span class="free">l'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tpOfV <span class="free">x</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> set <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">=</span> gL <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l' <span class="keyword1"><span class="command">unfolding</span></span> c' gC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> GE.nvL <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> GE.nvC <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">unfolding</span></span> GE.nvC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> GE.mcalc <span class="var">?σ</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> GE.mcalc_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> tp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prot</span> <span class="var">?σ</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unprot_mcalc<span class="main">[</span><span class="operator">OF</span> _ c<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> unprot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">at</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_at<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> Pos <span class="skolem">at</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> varsA <span class="skolem">at</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> l_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"grdLit <span class="free">x</span> <span class="main">∈</span> glitOfL <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> l_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l x <span class="keyword1"><span class="command">unfolding</span></span> grdOf_def c' gC_def glitOfC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="G-mcalc2"><span class="command">lemma</span></span> mcalc2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> gPB"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"GE.mcalc2 <span class="free">σ</span> <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> Fax <span class="main">∪</span> Wax"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nv2L_Wax nv2L_Fax
  <span class="keyword1"><span class="command">unfolding</span></span> GE.mcalc2_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> gPB"</span></span> <span class="keyword1"><span class="command">using</span></span> c' <span class="keyword1"><span class="command">unfolding</span></span> gPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> GE.mcalc2_iff <span class="keyword1"><span class="command">using</span></span> grdOf<span class="main">[</span><span class="operator">OF</span> c'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpartG *)</span>


<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span><span class="main">:</span> ProblemIkPolMcalc2C
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">gPB</span> <span class="keyword2"><span class="keyword">and</span></span> pol <span class="main">=</span> <span class="quoted">pol</span> <span class="keyword2"><span class="keyword">and</span></span> grdOf <span class="main">=</span> <span class="quoted">grdOf</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> grdOf mcalc2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pol_ct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* We already know that ProblemIkMcalc &lt; MonotProblem, so by transitivity we obtain
the following main theorem, stating that the guard translation yields a monotonic
problem *)</span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkTpartG <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> G_monotonic<span class="main">:</span>
<span class="quoted"><span class="quoted">"MonotProblem GE_wtFsym GE_wtPsym GE_arOf GE_resOf GE_parOf gPB"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpartG *)</span>


<span class="comment1">(* Also in sublocale form: *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpartG <span class="main">&lt;</span> GE<span class="main">?</span><span class="main">:</span> MonotProblem
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">GE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> wtPsym <span class="main">=</span> <span class="quoted">GE_wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">GE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">GE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted">GE_parOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">gPB</span>
<span class="keyword1"><span class="command">using</span></span> G_monotonic <span class="keyword1"><span class="command">.</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="T">
<div class="head">
<h1>Theory T</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tag-Based Encodings›</span></span>
<span class="keyword1"><span class="command">theory</span></span> T 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="T_G_Prelim.html">T_G_Prelim</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The tag translation›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The extension of the function symbols with type tags and type witnesses:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span><span class="tfree">'tp</span><span class="main">)</span> efsym <span class="main">=</span> Oldf <span class="tfree"><span class="quoted"><span class="tfree">'fsym</span></span></span> <span class="main">|</span> Tag <span class="tfree"><span class="quoted"><span class="tfree">'tp</span></span></span> <span class="main">|</span> Wit <span class="tfree"><span class="quoted"><span class="tfree">'tp</span></span></span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkTpart
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹``TE'' stands for ``tag encoding''›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TE_wtFsym</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TE_wtFsym</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">wtFsym</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_wtFsym</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_wtFsym</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> isRes <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TE_arOf</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TE_arOf</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_arOf</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_arOf</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TE_resOf</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TE_resOf</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_resOf</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_resOf</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1" id="T-countable_TE_wtFsym"><span class="command">lemma</span></span> countable_TE_wtFsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>Collect TE_wtFsym<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?K</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">ef</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ef</span> <span class="keyword1">of</span> Oldf <span class="bound">f</span> <span class="main">⇒</span> Inl <span class="bound">f</span> <span class="main">|</span> Tag <span class="bound">σ</span> <span class="main">⇒</span> Inr <span class="main">(</span>Inl <span class="bound">σ</span><span class="main">)</span> <span class="main">|</span> Wit <span class="bound">σ</span> <span class="main">⇒</span> Inr <span class="main">(</span>Inr <span class="bound">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'tp</span> set<span class="main">)</span> <span class="main">&lt;+&gt;</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'tp</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Collect <span class="free">wtFsym</span><span class="main">)</span> <span class="main">&lt;+&gt;</span> <span class="var">?U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?F</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">y</span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">`</span> <span class="var">?K</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ef</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="var">?K</span><span class="main">|</span> <span class="keyword1">≤o</span> <span class="main">|</span><span class="var">?L</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card_of_ordLeq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countable_wtFsym countable_tp
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> countable_Plus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> countable_ordLeq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart <span class="main">&lt;</span> TE<span class="main">?</span> <span class="main">:</span> Signature
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
<span class="keyword1"><span class="command">using</span></span> countable_tp countable_TE_wtFsym countable_wtPsym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkTpart
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* encoding of non-naked terms *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tNN</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tNN</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> unprot <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">then</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> Fn <span class="main">(</span>Tag <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tNN</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>
                    <span class="keyword1">then</span> Fn <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="free">tNN</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>
                    <span class="keyword1">else</span> Fn <span class="main">(</span>Tag <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>Fn <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="free">tNN</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tT</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tT</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> unprot <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">then</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> Fn <span class="main">(</span>Tag <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> tNN <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tL</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="main">(</span>tT <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">(</span>tT <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tL</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="main">(</span>tNN <span class="free"><span class="bound"><span class="entity">T1</span></span></span><span class="main">)</span> <span class="main">(</span>tNN <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tL</span> <span class="main">(</span>Pos <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Pos <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map tNN <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tL</span> <span class="main">(</span>Neg <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map tNN <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tC</span> <span class="main">≡</span> map tL"</span></span>

<span class="comment1">(* The extra axioms: *)</span>

<span class="comment1">(* The function axioms: *)</span>
<span class="comment1">(* Lefthand side: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rOfFax</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> Fn <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(* Righthand side: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lOfFax</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> Fn <span class="main">(</span>Tag <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>rOfFax <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fax</span> <span class="main">≡</span> <span class="main">{</span><span class="main">[</span>Pos <span class="main">(</span>Eq <span class="main">(</span>lOfFax <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>rOfFax <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">|</span> <span class="bound">f</span><span class="main">.</span> <span class="free">wtFsym</span> <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="comment1">(* The witness axioms: *)</span>
<span class="comment1">(* Lefthand side: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rOfWax</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Fn <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[]</span>"</span></span>
<span class="comment1">(* Righthand side: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lOfWax</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Fn <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[</span>rOfWax <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wax</span> <span class="main">≡</span> <span class="main">{</span><span class="main">[</span>Pos <span class="main">(</span>Eq <span class="main">(</span>lOfWax <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span>rOfWax <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">|</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">¬</span> isRes <span class="bound">σ</span> <span class="main">∧</span> <span class="free">protFw</span> <span class="bound">σ</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tPB</span> <span class="main">=</span> tC <span class="main">`</span> <span class="free">Φ</span> <span class="main">∪</span> Fax <span class="main">∪</span> Wax"</span></span>

<span class="comment1">(* Well-typedness of the translation: *)</span>
<span class="keyword1" id="T-tpOf_tNN"><span class="command">lemma</span></span> tpOf_tNN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>tNN <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.tpOf <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="T-tpOf_t"><span class="command">lemma</span></span> tpOf_t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>tT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.tpOf <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="T-wt_tNN"><span class="command">lemma</span></span> wt_tNN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span> <span class="main">⟹</span> TE.wt <span class="main">(</span>tNN <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="T-wt_t"><span class="command">lemma</span></span> wt_t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wt <span class="free">T</span> <span class="main">⟹</span> TE.wt <span class="main">(</span>tT <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="T-wtL_tL"><span class="command">lemma</span></span> wtL_tL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtL <span class="free">l</span> <span class="main">⟹</span> TE.wtL <span class="main">(</span>tL <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> atm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">atm</span></span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="T-wtC_tC"><span class="command">lemma</span></span> wtC_tC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtC <span class="free">c</span> <span class="main">⟹</span> TE.wtC <span class="main">(</span>tC <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tC_def Ik.wtC_def TE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="T-tpOf_rOfFax"><span class="command">lemma</span></span> tpOf_rOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>rOfFax <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">resOf</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-tpOf_lOfFax"><span class="command">lemma</span></span> tpOf_lOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>lOfFax <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">resOf</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-tpOf_rOfWax"><span class="command">lemma</span></span> tpOf_rOfWax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>rOfWax <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-tpOf_lOfWax"><span class="command">lemma</span></span> tpOf_lOfWax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>lOfWax <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-wt_rOfFax"><span class="command">lemma</span></span> wt_rOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span> <span class="main">⟹</span> TE.wt <span class="main">(</span>rOfFax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-wt_lOfFax"><span class="command">lemma</span></span> wt_lOfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span> <span class="main">⟹</span> TE.wt <span class="main">(</span>lOfFax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lOfFax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-wt_rOfWax"><span class="command">lemma</span></span> wt_rOfWax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isRes <span class="free">σ</span> <span class="main">⟹</span> TE.wt <span class="main">(</span>rOfWax <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-wt_lOfWax"><span class="command">lemma</span></span> wt_lOfWax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isRes <span class="free">σ</span> <span class="main">⟹</span> TE.wt <span class="main">(</span>lOfWax <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-wtPB_Fax"><span class="command">lemma</span></span> wtPB_Fax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.wtPB Fax"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Fax_def TE.wtPB_def TE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-wtPB_Wax"><span class="command">lemma</span></span> wtPB_Wax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.wtPB Wax"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Wax_def TE.wtPB_def TE.wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-wtPB_tC_Φ"><span class="command">lemma</span></span> wtPB_tC_Φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.wtPB <span class="main">(</span>tC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Ik.wt_Φ <span class="keyword1"><span class="command">unfolding</span></span> Ik.wtPB_def TE.wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-wtPB_tPB"><span class="command">lemma</span></span> wtPB_tPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.wtPB tPB"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*  *)</span>

<span class="keyword1" id="T-wt_Tag"><span class="command">lemma</span></span> wt_Tag<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"TE.wt <span class="main">(</span>Fn <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">T</span><span class="main">.</span> <span class="free">Tl</span> <span class="main">=</span> <span class="main">[</span><span class="bound">T</span><span class="main">]</span> <span class="main">∧</span> TE.wt <span class="bound">T</span> <span class="main">∧</span> tpOf <span class="bound">T</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> list.inject list_all_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> map_eq_Cons_conv neq_Nil_conv<span class="main">)</span>

<span class="keyword1" id="T-tpOf_Tag"><span class="command">lemma</span></span> tpOf_Tag<span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>Fn <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-wt_Wit"><span class="command">lemma</span></span> wt_Wit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"TE.wt <span class="main">(</span>Fn <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tl</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-tpOf_Wit"><span class="command">lemma</span></span> tpOf_Wit<span class="main">:</span> <span class="quoted"><span class="quoted">"TE.tpOf <span class="main">(</span>Fn <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">context</span></span> ModelIkTpart <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The identity-tag extension of a given structure of the original signature *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TE_intF</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TE_intF</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> <span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_intF</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> hd <span class="free"><span class="bound"><span class="entity">al</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">TE_intF</span> <span class="main">(</span>Wit <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">=</span> pickT <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="comment1">(* note: for tags, we only care about al being the singleton list [a],
   and hence the interpretation returns a; for witnesses, we only care
   about al being [] *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkTpart *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ModelIkTpart <span class="main">&lt;</span> TE<span class="main">?</span> <span class="main">:</span> Struct
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">TE_intF</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ef</span> <span class="skolem">al</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"TE_wtFsym <span class="skolem">ef</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">intT</span> <span class="main">(</span>TE_arOf <span class="skolem">ef</span><span class="main">)</span> <span class="skolem">al</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">(</span>TE_resOf <span class="skolem">ef</span><span class="main">)</span> <span class="main">(</span>TE_intF <span class="skolem">ef</span> <span class="skolem">al</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> intF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ef</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> ModelIkTpart <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="T-tNN_int"><span class="command">lemma</span></span> tNN_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.int <span class="free">ξ</span> <span class="main">(</span>tNN <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>TE.int <span class="free">ξ</span> <span class="main">∘</span> tNN<span class="main">)</span> <span class="skolem">Tl</span> <span class="main">=</span> map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-map_tNN_int"><span class="command">lemma</span></span> map_tNN_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>TE.int <span class="free">ξ</span> <span class="main">∘</span> tNN<span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span> map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-t_int"><span class="command">lemma</span></span> t_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.int <span class="free">ξ</span> <span class="main">(</span>tT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="T-map_t_int"><span class="command">lemma</span></span> map_t_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>TE.int <span class="free">ξ</span> <span class="main">∘</span> tT<span class="main">)</span> <span class="free">Tl</span> <span class="main">=</span> map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff list_all_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-tL_satL"><span class="command">lemma</span></span> tL_satL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.satL <span class="free">ξ</span> <span class="main">(</span>tL <span class="free">l</span><span class="main">)</span> <span class="main">⟷</span> Ik.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> atm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">atm</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-tC_satC"><span class="command">lemma</span></span> tC_satC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.satC <span class="free">ξ</span> <span class="main">(</span>tC <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> Ik.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TE.satC_def Ik.satC_def tC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="T-tC_Φ_satPB"><span class="command">lemma</span></span> tC_Φ_satPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TE.satPB <span class="free">ξ</span> <span class="main">(</span>tC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">⟷</span> Ik.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TE.satPB_def Ik.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-Fax_Wax_satPB"><span class="command">lemma</span></span> Fax_Wax_satPB<span class="main">:</span>
<span class="quoted"><span class="quoted">"TE.satPB <span class="free">ξ</span> <span class="main">(</span>Fax<span class="main">)</span> <span class="main">∧</span> TE.satPB <span class="free">ξ</span> <span class="main">(</span>Wax<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TE.satPB_def TE.satC_def Fax_def Wax_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lOfFax_def rOfFax_def lOfWax_def rOfWax_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Fax_satPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Fax_Wax_satPB<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Wax_satPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Fax_Wax_satPB<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1" id="T-soundness"><span class="command">lemma</span></span> soundness<span class="main">:</span> <span class="quoted"><span class="quoted">"TE.SAT tPB"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TE.SAT_def tPB_def <span class="keyword1"><span class="command">using</span></span> SAT <span class="keyword1"><span class="command">unfolding</span></span> Ik.SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> T_soundness<span class="main">:</span>
<span class="quoted"><span class="quoted">"Model TE_wtFsym <span class="free">wtPsym</span> TE_arOf TE_resOf <span class="free">parOf</span> tPB <span class="free">intT</span> TE_intF <span class="free">intP</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> wtPB_tPB soundness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ModelIkTpart *)</span>



<span class="comment1">(* Soundness theorem in sublocale form: Given a problem (with indicated
type partition) and a model for it, we obtain a model of the tag-extended (TE)
problem: *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> ModelIkTpart <span class="main">&lt;</span> TE<span class="main">?</span> <span class="main">:</span> Model
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">tPB</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">TE_intF</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> wtPB_tPB soundness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="comment1">(* iimg B f transforms f into a function f' having the same B-range as f
and such that it is the identity on its B-image, namely, ∀ b ∈ B. f' (f' a) = f' a;
also, it holds that ∀ b ∈ B. f' (f b) = f b *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">iimg</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1" id="T-inImage_iimg"><span class="command">lemma</span></span> inImage_iimg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⟹</span> iimg <span class="free">B</span> <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iimg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-not_inImage_iimg"><span class="command">lemma</span></span> not_inImage_iimg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⟹</span> iimg <span class="free">B</span> <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iimg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-iimg"><span class="command">lemma</span></span> iimg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> iimg <span class="free">B</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">B</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* Problem with type partition and model of its tag-encoding translation: *)</span>

<span class="keyword1"><span class="command">locale</span></span> ProblemIkTpart_TEModel <span class="main">=</span>
Ik<span class="main">?</span> <span class="main">:</span> ProblemIkTpart <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">infTp</span></span> <span class="quoted"><span class="free">prot</span></span> <span class="quoted"><span class="free">protFw</span></span> <span class="main">+</span>
TE<span class="main">?</span> <span class="main">:</span> Model <span class="quoted"><span class="quoted">"ProblemIkTpart.TE_wtFsym <span class="free">wtFsym</span> <span class="free">resOf</span>"</span></span> <span class="quoted"><span class="free">wtPsym</span></span>
           <span class="quoted"><span class="quoted">"ProblemIkTpart.TE_arOf <span class="free">arOf</span>"</span></span> <span class="quoted"><span class="quoted">"ProblemIkTpart.TE_resOf <span class="free">resOf</span>"</span></span> <span class="quoted"><span class="free">parOf</span></span>
           <span class="quoted">tPB</span> <span class="quoted"><span class="free">eintT</span></span> <span class="quoted"><span class="free">eintF</span></span> <span class="quoted"><span class="free">eintP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prot</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">protFw</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintP</span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkTpart_TEModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* new tag semantics (taking as input elements, instead of singleton lists): *)</span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ntsem</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span>
 <span class="keyword1">if</span> unprot <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∨</span> <span class="free">protFw</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">then</span> id
                   <span class="keyword1">else</span> iimg <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">b</span><span class="main">}</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span>"</span></span>

<span class="keyword1" id="T-unprot_ntsem"><span class="command">lemma</span></span> unprot_ntsem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unprot <span class="free">σ</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="free">σ</span> <span class="main">⟹</span> ntsem <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ntsem_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-protFw_ntsem"><span class="command">lemma</span></span> protFw_ntsem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="free">σ</span> <span class="main">⟹</span> ntsem <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ntsem_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-inImage_ntsem"><span class="command">lemma</span></span> inImage_ntsem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free">σ</span> <span class="bound">b</span><span class="main">}</span> <span class="main">⟹</span> ntsem <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ntsem_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-not_unprot_inImage_ntsem"><span class="command">lemma</span></span> not_unprot_inImage_ntsem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">protFw</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free">σ</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ntsem <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ntsem_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singl_def<span class="main">)</span>

<span class="comment1">(* crucial: *)</span>
<span class="keyword1" id="T-ntsem"><span class="command">lemma</span></span> ntsem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="free">b</span> <span class="main">⟹</span> ntsem <span class="free">σ</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> singl_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="T-eintT_ntsem"><span class="command">lemma</span></span> eintT_ntsem<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="free">a</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="main">(</span>ntsem <span class="free">σ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="free">σ</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free">σ</span> <span class="bound">b</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ntsem <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unprot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">using</span></span> a TE.intF
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TE_arOf.simps TE_resOf.simps TE_wtFsym.simps list_all2_Cons list_all2_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> a<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(* The reduct structure of a given structure in the tag-extended signature: *)</span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span>
 <span class="keyword1">if</span> unprot <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">then</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">protFw</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">then</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
 <span class="keyword1">else</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span>
 <span class="keyword1">if</span> unprot <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>
   <span class="keyword1">then</span> <span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>map2 ntsem <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>
   <span class="keyword1">else</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="main">(</span><span class="free">resOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>map2 ntsem <span class="main">(</span><span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">al</span></span></span> <span class="main">≡</span> <span class="free">eintP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map2 ntsem <span class="main">(</span><span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">al</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Semantic rephrasings of the fact that the (tagged problem) model satisfies
   Fax and Wax *)</span>
<span class="keyword1" id="T-TE_Tag"><span class="command">lemma</span></span> TE_Tag<span class="main">:</span> <span class="comment1">(* fixme: messy proof *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintF</span> <span class="main">(</span>Tag <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free">f</span><span class="main">)</span> <span class="free">al</span><span class="main">]</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xl</span> <span class="main">=</span> getVars <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xl</span> <span class="main">=</span> length <span class="free">al</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">al</span> <span class="main">=</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> xl_def <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> tpOfV <span class="main">(</span><span class="skolem">xl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> xl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xl</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xl_def <span class="keyword1"><span class="command">using</span></span> distinct_getVars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> pickE <span class="skolem">xl</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"TE.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ξ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtE_pickE<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> al  list_all2_nthD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">ξ</span> <span class="main">(</span><span class="skolem">xl</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> ξ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all2_length <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pickE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>TE.int <span class="skolem">ξ</span><span class="main">)</span> <span class="main">(</span>getTvars <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all2_length getTvars_def xl_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TE.satPB <span class="skolem">ξ</span> Fax"</span></span> <span class="keyword1"><span class="command">using</span></span> TE.sat_Φ<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> tPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.satC <span class="skolem">ξ</span> <span class="main">[</span>Pos <span class="main">(</span>Eq <span class="main">(</span>lOfFax <span class="free">f</span><span class="main">)</span> <span class="main">(</span>rOfFax <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> TE.satPB_def Fax_def <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.satA <span class="skolem">ξ</span> <span class="main">(</span>Eq <span class="main">(</span>lOfFax <span class="free">f</span><span class="main">)</span> <span class="main">(</span>rOfFax <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> TE.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lOfFax_def rOfFax_def 0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-TE_Wit"><span class="command">lemma</span></span> TE_Wit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isRes <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="free">σ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="free">eintF</span> <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span><span class="main">]</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> pickE <span class="main">[]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"TE.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ξ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtE_pickE<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TE.satPB <span class="skolem">ξ</span> Wax"</span></span> <span class="keyword1"><span class="command">using</span></span> TE.sat_Φ<span class="main">[</span><span class="operator">OF</span> ξ<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> tPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.satC <span class="skolem">ξ</span> <span class="main">[</span>Pos <span class="main">(</span>Eq <span class="main">(</span>lOfWax <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>rOfWax <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> TE.satPB_def Wax_def <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.satA <span class="skolem">ξ</span> <span class="main">(</span>Eq <span class="main">(</span>lOfWax <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>rOfWax <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> TE.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> TE.satA.simps lOfWax_def rOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-NE_intT_forget"><span class="command">lemma</span></span> NE_intT_forget<span class="main">:</span> <span class="quoted"><span class="quoted">"NE <span class="main">(</span>intT <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TE.NE_intT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="free">σ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> protFw <span class="main">=</span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"isRes <span class="free">σ</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">=</span> <span class="free">resOf</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> isRes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">al</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">al</span> <span class="main">=</span> map pickT <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">al</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> al_def list_all2_map2 <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Oldf <span class="skolem">f</span><span class="main">)</span> <span class="skolem">al</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def σ <span class="keyword1"><span class="command">using</span></span> f al
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TE_arOf.simps TE_resOf.simps TE_wtFsym.simps TE.intF<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ a_def <span class="keyword1"><span class="command">using</span></span> TE_Tag<span class="main">[</span><span class="operator">OF</span> f al<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot protFw <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">eintF</span> <span class="main">(</span>Wit <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False TE_arOf.simps TE_resOf.simps TE_wtFsym.simps TE.intF list_all2_NilR<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">using</span></span> TE_Wit<span class="main">[</span><span class="operator">OF</span> False protFw<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot protFw <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b list_all2_Cons list_all2_NilL
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TE.intF TE_arOf.simps TE_resOf.simps TE_wtFsym.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"intT <span class="free">σ</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> intT_def singl_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> b False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-wt_intF"><span class="command">lemma</span></span> wt_intF<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wtFsym</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 intT <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intT <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">eintF</span> <span class="main">(</span>Tag <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'al</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map2 ntsem <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> al<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="free">al</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="var">?t'al</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> listAll2_map2I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> length <span class="free">al</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> al <span class="keyword1"><span class="command">unfolding</span></span> list_all2_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ntsem <span class="main">(</span><span class="free">arOf</span> <span class="free">f</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eintT_ntsem<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Oldf <span class="free">f</span><span class="main">)</span> <span class="var">?t'al</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TE_arOf.simps TE_resOf.simps TE_wtFsym.simps f TE.intF<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> intF_def intT_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot TE_Tag<span class="main">[</span><span class="operator">OF</span> f 0<span class="main">]</span> 1
      <span class="keyword1"><span class="command">unfolding</span></span> intF_def intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>intF <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> intF_def 0 1 TE_Tag f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"intF <span class="free">f</span> <span class="free">al</span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="main">(</span><span class="free">resOf</span> <span class="free">f</span><span class="main">)</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> intF_def <span class="keyword1"><span class="command">using</span></span> 1 unprot False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singl_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-Struct"><span class="command">lemma</span></span> Struct<span class="main">:</span> <span class="quoted"><span class="quoted">"Struct <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> intT intF intP"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">using</span></span> NE_intT_forget wt_intF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart_TEModel *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart_TEModel <span class="main">&lt;</span> Ik<span class="main">?</span> <span class="main">:</span> Struct
<span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted">intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intP</span>
<span class="keyword1"><span class="command">using</span></span> Struct <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">context</span></span> ProblemIkTpart_TEModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The inverse of the tag function (required for translating environments backwards)*)</span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">invt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> unprot <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∨</span> <span class="free">protFw</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="T-unprot_invt"><span class="command">lemma</span></span> unprot_invt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unprot <span class="free">σ</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="free">σ</span> <span class="main">⟹</span> invt <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> invt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-invt_invt_inImage"><span class="command">lemma</span></span> invt_invt_inImage<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">protFw</span> <span class="free">σ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="keyword1">o</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="free">σ</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="main">(</span>invt <span class="free">σ</span> <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span>invt <span class="free">σ</span> <span class="free">a</span><span class="main">]</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="free">σ</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintF</span> <span class="main">(</span>Tag <span class="free">σ</span><span class="main">)</span> <span class="main">[</span><span class="skolem">b</span><span class="main">]</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> image_def singl_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">unfolding</span></span> invt_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> invt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> invt_invt_inImage<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> invt_inImage<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> invt_invt_inImage<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>


<span class="comment1">(* We translate the environments of the tag-extended-problem model
to environments of its original-signature reduct: *)</span>  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">invt</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">eenv</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> invt <span class="main">(</span>tpOfV <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="T-wt_eenv"><span class="command">lemma</span></span> wt_eenv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TE.wtE <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TE.wtE_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TE.tpOfV <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">eintT</span> <span class="var">?σ</span> <span class="main">(</span>eenv <span class="free">ξ</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="var">?σ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eenv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ξ Ik.wtTE_intT intT_def unprot_invt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="var">?σ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eenv_def <span class="keyword1"><span class="command">using</span></span> unprot ξ
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ik.wtTE_intT intT_def unprot_invt<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eenv_def <span class="keyword1"><span class="command">using</span></span> unprot ξ
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ξ Ik.wtE_def intT_def invt<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-int_tNN"><span class="command">lemma</span></span> int_tNN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TE.int <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>tNN <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TE.tpOfV <span class="skolem">x</span>"</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="var">?σ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="var">?σ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot ξ
      <span class="keyword1"><span class="command">unfolding</span></span> eenv_def Ik.wtE_def intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="var">?σ</span><span class="main">)</span> <span class="main">∘</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="var">?σ</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ξ unprot <span class="keyword1"><span class="command">unfolding</span></span> wtE_def intT_def singl_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> image_cong_simp<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot <span class="keyword1"><span class="command">unfolding</span></span> eenv_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">unfold</span> eenv_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eξ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"eenv <span class="free">ξ</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ar</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">arOf</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">resOf</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?ar</span> <span class="main">=</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map2 ntsem <span class="var">?ar</span> <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="main">=</span>
           map <span class="main">(</span>TE.int <span class="var">?eξ</span> <span class="main">∘</span> tNN<span class="main">)</span> <span class="skolem">Tl</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?ar</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"TE.int <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>tNN <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_length<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ar</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> Ik.Ik.tpOf <span class="main">(</span><span class="skolem">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"intT <span class="main">(</span><span class="var">?ar</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Ik.int <span class="free">ξ</span> <span class="main">(</span><span class="skolem">Tl</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wt_int<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Fn ξ i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_length<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="var">?R</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="main">(</span><span class="var">?ar</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="main">(</span><span class="var">?ar</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> i 1 l 3 <span class="keyword1"><span class="command">unfolding</span></span> intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> l<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="var">?r</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ik.int.simps TE.int.simps tT.simps <span class="keyword1"><span class="command">unfolding</span></span> intF_def <span class="keyword1"><span class="command">using</span></span> Fn 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-map_int_tNN"><span class="command">lemma</span></span> map_int_tNN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> Tl<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all Ik.Ik.wt <span class="free">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"map2 ntsem <span class="main">(</span>map Ik.Ik.tpOf <span class="free">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span>
 map <span class="main">(</span>TE.int <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">∘</span> tNN<span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">Tl</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.Ik.wt <span class="main">(</span><span class="free">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Tl <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intT <span class="main">(</span>Ik.Ik.tpOf <span class="main">(</span><span class="free">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Ik.int <span class="free">ξ</span> <span class="main">(</span><span class="free">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ik.wt_int<span class="main">[</span><span class="operator">OF</span> ξ wt<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> intT_def list_all_length
  <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inImage_ntsem unprot_ntsem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-int_t"><span class="command">lemma</span></span> int_t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.Ik.wt <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TE.int <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>tT <span class="free">T</span><span class="main">)</span> <span class="main">=</span> Ik.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tpOfV <span class="skolem">x</span>"</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="var">?σ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> unprot <span class="main">=</span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">protFw</span> <span class="var">?σ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot ξ
      <span class="keyword1"><span class="command">unfolding</span></span> eenv_def Ik.wtE_def intT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">eintF</span> <span class="main">(</span>Tag <span class="var">?σ</span><span class="main">)</span> <span class="main">∘</span> singl<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="free">eintT</span> <span class="var">?σ</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ξ unprot <span class="keyword1"><span class="command">unfolding</span></span> wtE_def intT_def singl_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> image_cong_simp<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unprot <span class="keyword1"><span class="command">unfolding</span></span> eenv_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">unfold</span> eenv_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fn <span class="skolem">f</span> <span class="skolem">Tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eξ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"eenv <span class="free">ξ</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ar</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">arOf</span> <span class="skolem">f</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">resOf</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?ar</span> <span class="main">=</span> length <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ar</span> <span class="main">=</span> map Ik.Ik.tpOf <span class="skolem">Tl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map2 ntsem <span class="var">?ar</span> <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="skolem">Tl</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span>TE.int <span class="var">?eξ</span> <span class="main">∘</span> tNN<span class="main">)</span> <span class="skolem">Tl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ar <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_int_tNN<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ξ<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="var">?r</span> <span class="main">∨</span> <span class="free">protFw</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Ik.int.simps TE.int.simps tT.simps <span class="keyword1"><span class="command">unfolding</span></span> intF_def <span class="keyword1"><span class="command">using</span></span> Fn 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-map_int_t"><span class="command">lemma</span></span> map_int_t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> Tl<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all Ik.Ik.wt <span class="free">Tl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"map2 ntsem <span class="main">(</span>map Ik.Ik.tpOf <span class="free">Tl</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>Ik.int <span class="free">ξ</span><span class="main">)</span> <span class="free">Tl</span><span class="main">)</span> <span class="main">=</span>
 map <span class="main">(</span>TE.int <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">∘</span> tT<span class="main">)</span> <span class="free">Tl</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">Tl</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.Ik.wt <span class="main">(</span><span class="free">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Tl <span class="keyword1"><span class="command">unfolding</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intT <span class="main">(</span>Ik.Ik.tpOf <span class="main">(</span><span class="free">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Ik.int <span class="free">ξ</span> <span class="main">(</span><span class="free">Tl</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wt_int<span class="main">[</span><span class="operator">OF</span> ξ wt<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> intT_def list_all_length
  <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inImage_ntsem unprot_ntsem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-satL_tL"><span class="command">lemma</span></span> satL_tL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.Ik.wtL <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TE.satL <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>tL <span class="free">l</span><span class="main">)</span> <span class="main">⟷</span> Ik.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> atm<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">atm</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intP_def<span class="main">)</span>

<span class="keyword1" id="T-satC_tC"><span class="command">lemma</span></span> satC_tC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.Ik.wtC <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TE.satC <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>tC <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> Ik.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TE.satC_def Ik.satC_def
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ik.Ik.wtC_def tC_def<span class="main">)</span>

<span class="keyword1" id="T-satPB_tPB"><span class="command">lemma</span></span> satPB_tPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TE.satPB <span class="main">(</span>eenv <span class="free">ξ</span><span class="main">)</span> <span class="main">(</span>tC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">⟷</span> Ik.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Ik.wt_Φ assms <span class="keyword1"><span class="command">unfolding</span></span> TE.satPB_def Ik.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ik.Ik.wtPB_def<span class="main">)</span>

<span class="keyword1" id="T-completeness"><span class="command">lemma</span></span> completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.SAT <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ik.SAT_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ξ</span> <span class="keyword3"><span class="command">assume</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.wtE <span class="skolem">ξ</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.wtE <span class="main">(</span>eenv <span class="skolem">ξ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> wt_eenv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.satPB <span class="main">(</span>eenv <span class="skolem">ξ</span><span class="main">)</span> tPB"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> TE.sat_Φ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"TE.satPB <span class="main">(</span>eenv <span class="skolem">ξ</span><span class="main">)</span> <span class="main">(</span>tC <span class="main">`</span> <span class="free">Φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Ik.satPB <span class="skolem">ξ</span> <span class="free">Φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ξ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="T-T_completeness"><span class="command">lemma</span></span> T_completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> intT intF intP"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> completeness<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart_TEModel *)</span>

<span class="comment1">(* Completeness theorem in sublocale form: Given a problem (with indicated
type partition) and a model for its tag-translated problem,
we obtain a model of the original problem: *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart_TEModel <span class="main">&lt;</span> O<span class="main">?</span> <span class="main">:</span> Model
<span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted">intT</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intP</span>
<span class="keyword1"><span class="command">using</span></span> T_completeness <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The result of the tag translation is an infiniteness-augmented problem›</span></span>

<span class="comment1">(* Note that basic fact, merely stating that
the translation is well-defined between infiniteness-augmented problems,
is only proved at this late stage since it requires completeness.
This is an interesting dependency, not spotted in the paper. *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart <span class="main">&lt;</span> TE<span class="main">?</span> <span class="main">:</span> Problem
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">tPB</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart <span class="main">&lt;</span> TE<span class="main">?</span> <span class="main">:</span> ProblemIk
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">tPB</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span> <span class="skolem">a</span>  <span class="keyword3"><span class="command">assume</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">infTp</span> <span class="skolem">σ</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"Model TE_wtFsym <span class="free">wtPsym</span> TE_arOf TE_resOf <span class="free">parOf</span> tPB <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TE_intT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ProblemIkTpart_TEModel.intT <span class="free">prot</span> <span class="free">protFw</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TE_intF</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ProblemIkTpart_TEModel.intF <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">prot</span> <span class="free">protFw</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TE_intP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ProblemIkTpart_TEModel.intP <span class="free">parOf</span> <span class="free">prot</span> <span class="free">protFw</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"ProblemIkTpart_TEModel <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span>
                                   <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">prot</span> <span class="free">protFw</span> <span class="skolem">eintT</span> <span class="skolem">eintF</span> <span class="skolem">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">unfolding</span></span> ProblemIkTpart_TEModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> MM<span class="main">:</span> <span class="quoted"><span class="quoted">"Ik.MModel <span class="var">?TE_intT</span> <span class="var">?TE_intF</span> <span class="var">?TE_intP</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ProblemIkTpart_TEModel.T_completeness<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="var">?TE_intT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infTp<span class="main">[</span><span class="operator">OF</span> σ MM<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="var">?TE_intT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">eintT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ProblemIkTpart_TEModel.intT_def<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">eintT</span> <span class="skolem">σ</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The verification of the first monotonicity calculus criterion
for the tagged problem›</span></span>

<span class="keyword1"><span class="command">context</span></span> ProblemIkTpart <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="T-nvT_t"><span class="command">lemma</span></span> nvT_t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="free">σ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> TE.nvT <span class="main">(</span>tT <span class="free">T</span><span class="main">)</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-nvL_tL"><span class="command">lemma</span></span> nvL_tL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="free">σ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> TE.nvL <span class="main">(</span>tL <span class="free">l</span><span class="main">)</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> atm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">atm</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> nvT_t<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="T-nvC_tC"><span class="command">lemma</span></span> nvC_tC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> unprot <span class="free">σ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> TE.nvC <span class="main">(</span>tC <span class="free">c</span><span class="main">)</span><span class="main">.</span> tpOfV <span class="bound">x</span> <span class="main">≠</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tC_def TE.nvC_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> nvL_tL<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="T-unprot_nvT_t"><span class="command">lemma</span></span> unprot_nvT_t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"unprot <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> TE.nvT <span class="main">(</span>tT <span class="free">T</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span>  TE.nvT <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="T-tpL_nvT_tL"><span class="command">lemma</span></span> tpL_nvT_tL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"unprot <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> TE.nvL <span class="main">(</span>tL <span class="free">l</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> TE.nvL <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> atm<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">atm</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="T-unprot_nvC_tC"><span class="command">lemma</span></span> unprot_nvC_tC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"unprot <span class="main">(</span>tpOfV <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> TE.nvC <span class="main">(</span>tC <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> TE.nvC <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> tC_def TE.nvC_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* The added axioms are monotonic *)</span>
<span class="keyword1" id="T-nv_OfFax"><span class="command">lemma</span></span> nv_OfFax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> TE.nvT <span class="main">(</span>lOfFax <span class="free">f</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> TE.nvT <span class="main">(</span>rOfFax <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lOfFax_def rOfFax_def lOfWax_def rOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-nv_OfWax"><span class="command">lemma</span></span> nv_OfWax<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> TE.nvT <span class="main">(</span>lOfWax <span class="free">σ'</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> TE.nvT <span class="main">(</span>rOfWax <span class="free">σ'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lOfFax_def rOfFax_def lOfWax_def rOfWax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="T-nvC_Fax"><span class="command">lemma</span></span> nvC_Fax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> Fax <span class="main">⟹</span> TE.nvC <span class="free">c</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Fax_def TE.nvC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="T-mcalc_Fax"><span class="command">lemma</span></span> mcalc_Fax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> Fax <span class="main">⟹</span> TE.mcalc <span class="free">σ</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nvC_Fax <span class="keyword1"><span class="command">unfolding</span></span> TE.mcalc_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="T-nvC_Wax"><span class="command">lemma</span></span> nvC_Wax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> Wax <span class="main">⟹</span> TE.nvC <span class="free">c</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Wax_def TE.nvC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="T-mcalc_Wax"><span class="command">lemma</span></span> mcalc_Wax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> Wax <span class="main">⟹</span> TE.mcalc <span class="free">σ</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nvC_Wax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart <span class="main">&lt;</span> TE<span class="main">?</span><span class="main">:</span> ProblemIkMcalc
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">tPB</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> tPB"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"TE.mcalc <span class="skolem">σ</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tPB_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">Φ</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"TE.mcalc <span class="skolem">σ</span> <span class="main">(</span>tC <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unprot_mcalc<span class="main">[</span><span class="operator">OF</span> _ d<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> TE.mcalc_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unprot <span class="skolem">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> mcalc_Fax mcalc_Wax<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* We already know that ProblemIkMcalc &lt; MonotProblem, so by transitivity we obtain
the following main theorem, stating that the tag translation yields a monotonic
problem *)</span>
<span class="keyword1"><span class="command">context</span></span> ProblemIkTpart <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T_monotonic<span class="main">:</span>
<span class="quoted"><span class="quoted">"MonotProblem TE_wtFsym <span class="free">wtPsym</span> TE_arOf TE_resOf <span class="free">parOf</span> tPB"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context ProblemIkTpart *)</span>


<span class="keyword1"><span class="command">sublocale</span></span> ProblemIkTpart <span class="main">&lt;</span> TE<span class="main">?</span><span class="main">:</span> MonotProblem
<span class="keyword2"><span class="keyword">where</span></span> wtFsym <span class="main">=</span> <span class="quoted">TE_wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> arOf <span class="main">=</span> <span class="quoted">TE_arOf</span> <span class="keyword2"><span class="keyword">and</span></span> resOf <span class="main">=</span> <span class="quoted">TE_resOf</span> <span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">tPB</span>
<span class="keyword1"><span class="command">using</span></span> T_monotonic <span class="keyword1"><span class="command">.</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="U">
<div class="head">
<h1>Theory U</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Untyped (Unsorted) First-Order Logic›</span></span>
<span class="keyword1"><span class="command">theory</span></span> U
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TermsAndClauses.html">TermsAndClauses</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Even though untyped FOL is a particular case of many-typed FOL, we find 
it convenient to represent it separately.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Signatures›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Signature <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> countable_wtFsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">{</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'fsym</span><span class="main">.</span> <span class="free">wtFsym</span> <span class="bound">f</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> countable_wtPsym<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">{</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'psym</span><span class="main">.</span> <span class="free">wtPsym</span> <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Well-typed terms *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wt</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wt</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">wt</span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">wtFsym</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> list_all <span class="free">wt</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span> <span class="main">∧</span> <span class="free">arOf</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">Tl</span></span></span>"</span></span>

<span class="keyword1" id="U-wt_induct"><span class="command">lemma</span></span> wt_induct<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Var Fn<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> wt<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">φ</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Fn<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span> <span class="bound">Tl</span><span class="main">.</span>
   <span class="main">⟦</span><span class="free">wtFsym</span> <span class="bound">f</span><span class="main">;</span> list_all wt <span class="bound">Tl</span><span class="main">;</span> <span class="free">arOf</span> <span class="bound">f</span> <span class="main">=</span> length <span class="bound">Tl</span><span class="main">;</span> list_all <span class="free">φ</span> <span class="bound">Tl</span><span class="main">⟧</span>
 <span class="main">⟹</span> <span class="free">φ</span> <span class="main">(</span>Fn <span class="bound">f</span> <span class="bound">Tl</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span> <span class="main">⟶</span> <span class="free">φ</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Var Fn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Well-typed substitutions *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtSB</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> wt <span class="main">(</span><span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="U-wtSB_wt"><span class="command">lemma</span></span> wtSB_wt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π</span> <span class="main">⟹</span> wt <span class="main">(</span><span class="free">π</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtSB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="U-wt_subst"><span class="command">lemma</span></span> wt_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wt <span class="main">(</span>subst <span class="free">π</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_length<span class="main">)</span>


<span class="keyword1" id="U-wtSB_o"><span class="command">lemma</span></span> wtSB_o<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">π2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtSB <span class="main">(</span>subst <span class="free">π1</span> <span class="keyword1">o</span> <span class="free">π2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">unfolding</span></span> wtSB_def <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Signature *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Structures›</span></span>

<span class="comment1">(* Environment *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'univ</span> env <span class="main">=</span> <span class="quoted"><span class="quoted">"var <span class="main">⇒</span> <span class="tfree">'univ</span>"</span></span>

<span class="comment1">(* Structure *)</span>
<span class="keyword1"><span class="command">locale</span></span> Struct <span class="main">=</span> Signature <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">parOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> nat"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'univ</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'univ</span> list <span class="main">⇒</span> <span class="tfree">'univ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'univ</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
NE_D<span class="main">:</span> <span class="quoted"><span class="quoted">"NE <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
intF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wtFsym</span> <span class="free">f</span><span class="main">;</span> length <span class="free">al</span> <span class="main">=</span> <span class="free">arOf</span> <span class="free">f</span><span class="main">;</span> list_all <span class="free">D</span> <span class="free">al</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">(</span><span class="free">intF</span> <span class="free">f</span> <span class="free">al</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
dummy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">parOf</span> <span class="main">=</span> <span class="free">parOf</span> <span class="main">∧</span> <span class="free">intF</span> <span class="main">=</span> <span class="free">intF</span> <span class="main">∧</span> <span class="free">intP</span> <span class="main">=</span> <span class="free">intP</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Well-typed environment *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtE</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">D</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="U-wtTE_D"><span class="command">lemma</span></span> wtTE_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">(</span><span class="free">ξ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* Interpretation of terms: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">int</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">int</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">int</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Fn <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">intF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="main">(</span><span class="free">int</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Soundness of typing w.r.t. interpretation: *)</span>
<span class="keyword1" id="U-wt_int"><span class="command">lemma</span></span> wt_int<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wtE<span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wt_T<span class="main">:</span> <span class="quoted"><span class="quoted">"wt <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">(</span>int <span class="free">ξ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wt_T <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> int.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wtE wtE_def<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> int.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> intF<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> list_all_map comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="U-int_cong"><span class="command">lemma</span></span> int_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> vars <span class="free">T</span> <span class="main">⟹</span> <span class="free">ξ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ξ2</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"int <span class="free">ξ1</span> <span class="free">T</span> <span class="main">=</span> int <span class="free">ξ2</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff
<span class="keyword1"><span class="command">using</span></span> map_ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="U-int_o"><span class="command">lemma</span></span> int_o<span class="main">:</span>
<span class="quoted"><span class="quoted">"int <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> int <span class="free">ξ</span> <span class="main">(</span>subst <span class="free">ρ</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>  <span class="keyword1"><span class="command">unfolding</span></span> list_all_iff o_def 
<span class="keyword1"><span class="command">using</span></span> map_ext <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> int_subst <span class="main">=</span> int_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="U-int_o_subst"><span class="command">lemma</span></span> int_o_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"int <span class="free">ξ</span> <span class="keyword1">o</span> subst <span class="free">ρ</span> <span class="main">=</span> int <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> comp_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> int_o<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="U-wtE_o"><span class="command">lemma</span></span> wtE_o<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wtE <span class="free">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"wtSB <span class="free">ρ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtE <span class="main">(</span>int <span class="free">ξ</span> <span class="keyword1">o</span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wtE_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wt_int<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span> Signature <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Well-typed (i.e., well-formed) atoms, literals, caluses and problems:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wtA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wtA</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">⟷</span> wt <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">∧</span> wt <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">wtA</span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">wtPsym</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> list_all wt <span class="free"><span class="bound"><span class="entity">Tl</span></span></span> <span class="main">∧</span> <span class="free">parOf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">Tl</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wtL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wtL</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> wtA <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">wtL</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> wtA <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtC</span> <span class="main">≡</span> list_all wtL"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtPB</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">.</span> wtC <span class="bound">c</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Signature *)</span>


<span class="keyword1"><span class="command">context</span></span> Struct <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Satisfaction of atoms: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">satA</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">satA</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">⟷</span> int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="main">=</span> int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">satA</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Pr <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">intP</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>map <span class="main">(</span>int <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Tl</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Satisfaction literals: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">satL</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">satL</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> satA <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">satL</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> satA <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="comment1">(* Satisfaction of clauses: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">satC</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">≡</span> list_ex <span class="main">(</span>satL <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* satisfaction of problems *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">satPB</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">.</span> satC <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="bound">c</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SAT</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">ξ</span><span class="main">.</span> wtE <span class="bound">ξ</span> <span class="main">⟶</span> satPB <span class="bound">ξ</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Struct *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Problems›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Problem <span class="main">=</span> Signature <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">parOf</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> nat"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> wt_Φ<span class="main">:</span> <span class="quoted"><span class="quoted">"wtPB <span class="free">Φ</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Models of a problem›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Model <span class="main">=</span>
  Problem <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="main">+</span>
  Struct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'univ</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'univ</span> list <span class="main">⇒</span> <span class="tfree">'univ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'univ</span> list <span class="main">⇒</span> bool"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> SAT<span class="main">:</span> <span class="quoted"><span class="quoted">"SAT <span class="free">Φ</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CU">
<div class="head">
<h1>Theory CU</h1>
</div>
<pre class="source"><span class="comment1">(* Countable version of UFOL structures: *)</span>
<span class="keyword1"><span class="command">theory</span></span> CU
<span class="keyword2"><span class="keyword">imports</span></span> <a href="U.html">U</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> Struct <span class="main">=</span> U.Struct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> univ"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">locale</span></span> Model <span class="main">=</span> U.Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> univ"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> bool"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="E">
<div class="head">
<h1>Theory E</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The type-erasure translation from many-typed to untyped FOL›</span></span>
<span class="keyword1"><span class="command">theory</span></span> E <span class="keyword2"><span class="keyword">imports</span></span> <a href="Mono.html">Mono</a> <a href="CU.html">CU</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* This is the only development that uses UFOL *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>


<span class="comment1">(* Problem:
sublocale M.Signature &lt; U.Signature
where arOf = "length o arOf" and parOf = "length o parOf"
yields error:
*** Duplicate constant declaration "local.wt_graph" vs. "local.wt_graph"
*)</span>


<span class="comment1">(* Temporary solution: Isomorphic copy of the MFOL hierarchy: *)</span>
<span class="keyword1"><span class="command">locale</span></span> M_Signature <span class="main">=</span> M<span class="main">?</span> <span class="main">:</span> Sig.Signature
<span class="keyword1"><span class="command">locale</span></span> M_Problem <span class="main">=</span> M<span class="main">?</span> <span class="main">:</span> M.Problem
<span class="keyword1"><span class="command">locale</span></span> M_MonotModel <span class="main">=</span> M<span class="main">?</span> <span class="main">:</span> MonotModel <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="quoted"><span class="free">intT</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span>
<span class="keyword1"><span class="command">locale</span></span> M_FullStruct <span class="main">=</span> M<span class="main">?</span> <span class="main">:</span> FullStruct
<span class="keyword1"><span class="command">locale</span></span> M_FullModel <span class="main">=</span> M<span class="main">?</span> <span class="main">:</span> FullModel

<span class="keyword1"><span class="command">sublocale</span></span> M_FullStruct <span class="main">&lt;</span> M_Signature <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> M_Problem <span class="main">&lt;</span> M_Signature <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> M_FullModel <span class="main">&lt;</span> M_FullStruct <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> M_MonotModel <span class="main">&lt;</span> M_FullStruct <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">intTF</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPF</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> M_MonotModel <span class="main">&lt;</span> M_FullModel <span class="keyword2"><span class="keyword">where</span></span>
intT <span class="main">=</span> <span class="quoted">intTF</span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPF</span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">context</span></span> Sig.Signature <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Signature.Signature *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The translation›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> M_Signature <span class="main">&lt;</span> U.Signature
<span class="keyword2"><span class="keyword">where</span></span> arOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">arOf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">parOf</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> countable_wtFsym countable_wtPsym<span class="main">)</span>


<span class="comment1">(* In our implicitly-typed setting, ``e" is just the identity. *)</span>

<span class="keyword1"><span class="command">context</span></span> M_Signature <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Well-typedness of the translation: *)</span>
<span class="keyword1" id="E-wt"><span class="command">lemma</span></span> wt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"M.wt <span class="free">T</span> <span class="main">⟹</span> wt <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="E-wtA"><span class="command">lemma</span></span> wtA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"M.wtA <span class="free">at</span> <span class="main">⟹</span> wtA <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1" id="E-wtL"><span class="command">lemma</span></span> wtL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"M.wtL <span class="free">l</span> <span class="main">⟹</span> wtL <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="E-wtC"><span class="command">lemma</span></span> wtC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"M.wtC <span class="free">c</span> <span class="main">⟹</span> wtC <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> M.wtC_def wtC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="E-wtPB"><span class="command">lemma</span></span> wtPB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"M.wtPB <span class="free">Φ</span> <span class="main">⟹</span> wtPB <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> M.wtPB_def wtPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context M_Signature *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="comment1">(* In our implicitly-typed setting, ``e" is just the identity. *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next puts together an M$\_$signature with a structure for its U.flattened signature:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> UM_Struct <span class="main">=</span>
M<span class="main">?</span> <span class="main">:</span> M_Signature <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="main">+</span>
U<span class="main">?</span> <span class="main">:</span> CU.Struct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">arOf</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">parOf</span>"</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>

<span class="keyword1"><span class="command">sublocale</span></span> UM_Struct <span class="main">&lt;</span> M<span class="main">?</span> <span class="main">:</span> M.Struct <span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NE_D<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_all2_list_all <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> intF<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> UM_Struct <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="E-wtE"><span class="command">lemma</span></span> wtE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"M.wtE <span class="free">ξ</span> <span class="main">⟹</span> U.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> U.wtE_def M.wtE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="E-int_e"><span class="command">lemma</span></span> int_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.int <span class="free">ξ</span> <span class="free">T</span> <span class="main">=</span> M.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> map_eq_conv<span class="main">)</span>

<span class="keyword1" id="E-int_o_e"><span class="command">lemma</span></span> int_o_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.int <span class="free">ξ</span> <span class="main">=</span> M.int <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> int_e fun_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="E-satA_e"><span class="command">lemma</span></span> satA_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satA <span class="free">ξ</span> <span class="free">at</span> <span class="main">⟷</span> M.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="E-satL_e"><span class="command">lemma</span></span> satL_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satL <span class="free">ξ</span> <span class="free">l</span> <span class="main">⟷</span> M.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="E-satC_e"><span class="command">lemma</span></span> satC_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satC <span class="free">ξ</span> <span class="free">c</span> <span class="main">⟷</span> M.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> M.satC_def U.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="E-satPB_e"><span class="command">lemma</span></span> satPB_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satPB <span class="free">ξ</span> <span class="free">Φ</span> <span class="main">⟷</span> M.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> M.satPB_def U.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"U.SAT <span class="free">Φ</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"M.SAT <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> M.SAT_def satPB_e U.SAT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context UM_Struct *)</span>

<span class="keyword1"><span class="command">locale</span></span> UM_Model <span class="main">=</span>
  M_Problem <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">Φ</span></span> <span class="main">+</span>
  UM_Struct <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span> <span class="quoted"><span class="free">arOf</span></span> <span class="quoted"><span class="free">resOf</span></span> <span class="quoted"><span class="free">parOf</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span> <span class="main">+</span>
  CU.Model <span class="quoted"><span class="free">wtFsym</span></span> <span class="quoted"><span class="free">wtPsym</span></span>  <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">arOf</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">parOf</span>"</span></span> <span class="quoted"><span class="free">Φ</span></span>
          <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">intF</span></span> <span class="quoted"><span class="free">intP</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M_U_completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"MModel <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">::</span><span class="tfree">'tp</span><span class="main">.</span> <span class="free">D</span><span class="main">)</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> completeness<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SAT<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context UM_Model *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Global statement of completeness : UM$\_$Model consists
of an M.problem and an U.model satisfying the U.translation of this problem.
It is stated that it yields a model for the M.problem.›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> UM_Model <span class="main">&lt;</span> CM.Model <span class="keyword2"><span class="keyword">where</span></span> intT <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> M_U_completeness <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Soundness for monotonic problems›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> M_FullStruct <span class="main">&lt;</span> U<span class="main">?</span> <span class="main">:</span> CU.Struct
<span class="keyword2"><span class="keyword">where</span></span> arOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">arOf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">parOf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> any"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NE_intT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> full2<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> full_True list_all2_list_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">context</span></span> M_FullModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="E-wtE"><span class="command">lemma</span></span> wtE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.wtE <span class="free">ξ</span> <span class="main">⟹</span> F.wtE <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> U.wtE_def F.wtE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="E-int_e"><span class="command">lemma</span></span> int_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.int <span class="free">ξ</span> <span class="free">T</span> <span class="main">=</span> F.int <span class="free">ξ</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> map_eq_conv<span class="main">)</span>

<span class="keyword1" id="E-int_o_e"><span class="command">lemma</span></span> int_o_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.int <span class="free">ξ</span> <span class="main">=</span> F.int <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fun_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="E-satA_e"><span class="command">lemma</span></span> satA_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satA <span class="free">ξ</span> <span class="free">at</span> <span class="main">⟷</span> F.satA <span class="free">ξ</span> <span class="free">at</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">at</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="E-satL_e"><span class="command">lemma</span></span> satL_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satL <span class="free">ξ</span> <span class="free">l</span> <span class="main">⟷</span> F.satL <span class="free">ξ</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="E-satC_e"><span class="command">lemma</span></span> satC_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satC <span class="free">ξ</span> <span class="free">c</span> <span class="main">⟷</span> F.satC <span class="free">ξ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> F.satC_def U.satC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="E-satPB_e"><span class="command">lemma</span></span> satPB_e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U.satPB <span class="free">ξ</span> <span class="free">Φ</span> <span class="main">⟷</span> F.satPB <span class="free">ξ</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> F.satPB_def U.satPB_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> soundness<span class="main">:</span> <span class="quoted"><span class="quoted">"U.SAT <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> U.SAT_def <span class="keyword1"><span class="command">using</span></span> sat_Φ satPB_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="E-U_Model"><span class="command">lemma</span></span> U_Model<span class="main">:</span>
<span class="quoted"><span class="quoted">"CU.Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="main">(</span>length <span class="main">∘</span> <span class="free">arOf</span><span class="main">)</span> <span class="main">(</span>length <span class="main">∘</span> <span class="free">parOf</span><span class="main">)</span> <span class="free">Φ</span> <span class="main">(</span><span class="free">intT</span> any<span class="main">)</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> wtPB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wt_Φ<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> soundness<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context M_FullModel *)</span>


<span class="keyword1"><span class="command">sublocale</span></span> M_FullModel <span class="main">&lt;</span> CU.Model
<span class="keyword2"><span class="keyword">where</span></span> arOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">arOf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">parOf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> any"</span></span>
<span class="keyword1"><span class="command">using</span></span> U_Model <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> M_MonotModel <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M_U_soundness<span class="main">:</span>
<span class="quoted"><span class="quoted">"CU.Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="main">(</span>length <span class="main">∘</span> <span class="free">arOf</span><span class="main">)</span> <span class="main">(</span>length <span class="main">∘</span> <span class="free">parOf</span><span class="main">)</span> <span class="free">Φ</span>
  <span class="main">(</span>InfModel.intTF <span class="main">(</span>any<span class="main">::</span><span class="tfree">'tp</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>InfModel.intFF <span class="free">arOf</span> <span class="free">resOf</span> intTI intFI<span class="main">)</span> <span class="main">(</span>InfModel.intPF <span class="free">parOf</span> intTI intPI<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> M_FullModel.U_Model<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> M_FullModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> InfModel.FullModel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> MonotModel.InfModelI<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context M_MonotModel *)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Global statement of the soundness theorem: M$\_$MonotModel consists
of a monotonic F.problem satisfied by an F.model.
It is stated that this yields an U.Model for the translated problem.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> M_MonotModel <span class="main">&lt;</span> CU.Model
<span class="keyword2"><span class="keyword">where</span></span> arOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">arOf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> parOf <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">o</span> <span class="free">parOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted"><span class="free">Φ</span></span> <span class="keyword2"><span class="keyword">and</span></span> D <span class="main">=</span> <span class="quoted"><span class="quoted">"intTF <span class="main">(</span>any<span class="main">::</span><span class="tfree">'tp</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> intF <span class="main">=</span> <span class="quoted">intFF</span> <span class="keyword2"><span class="keyword">and</span></span> intP <span class="main">=</span> <span class="quoted">intPF</span>
<span class="keyword1"><span class="command">using</span></span> M_U_soundness <span class="keyword1"><span class="command">.</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Encodings">
<div class="head">
<h1>Theory Encodings</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹End Results in Locale-Free Form›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Encodings
<span class="keyword2"><span class="keyword">imports</span></span> <a href="G.html">G</a> <a href="T.html">T</a> <a href="E.html">E</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section contains the outcome of our type-encoding results,
presented in a locale-free fashion. It is not very useful
from an Isabelle development point of view, where the locale theorems are fine.

Rather, this is aimed as a quasi-self-contained formal documentation of
the overall results for the non-Isabelle-experts.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the soundness theorems below, we employ the following Isabelle types:
\\- type variables (parameters):
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'tp›</span></span></span></span>, of types
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'fsym›</span></span></span></span>, of function symbols
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'psym›</span></span></span></span>, of predicate symbols
%
\\- a fixed countable universe <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>univ›</span></span></span></span> for the carrier of the models
%
\\
and various operators on these types:

(1) the constitutive parts of FOL signatures:
\\---- the boolean predicates
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>wtFsym›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>wtPsym›</span></span></span></span>, indicating the ``well-typed'' function and predicate
symbols; these are just means to select only subsets of these symbols
for consideration in the signature
\\---- the operators arOf and resOf, giving the arity and the result type
of function symbols
\\---- the operator parOf, giving the arity of predicate symbols

(2) the problem, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Φ›</span></span></span></span>, which is a set of clauses over the considered signature

(3) a partition of the types in:
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span>, the types that should be decorated in any case
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span>, the types that should be decorated in a featherweight fashion
\\--- for guards only, a further refinement of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span>, indicating, as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpCD›</span></span></span></span>,
the types that should be classically (i.e., traditionally) decorated
(these partitionings are meant to provide a uniform treatment of the
three styles of encodings:
traditional, lightweight and featherweight)

(4) the constitutive parts of a structure over the considered signature:
\\---- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intT›</span></span></span></span>, the interpretation of each type as a unary predicate (essentially, a set)
over an arbitrary type 'univ
\\---- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intF›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intP›</span></span></span></span>, the interpretations of the function and predicate symbols
as actual functions and predicates over <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>univ›</span></span></span></span>.


›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\ \\ \bf Soundness of the tag encodings: \ \\›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The assumptions of the tag soundness theorems are the following:

(a)  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ProblemIkTpart wtFsym wtPsym arOf resOf parOf Φ infTp tpD tpFD›</span></span></span></span>,
stating that:
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(wtFsym, wtPsym, arOf, resOf, parOf)›</span></span></span></span> form a countable signature
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Φ›</span></span></span></span> is a well-typed problem over this signature
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>infTp›</span></span></span></span> is an indication of the types that the problem guarantees as infinite
in all models
\\--- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span> are disjoint and all types that are not
 marked as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span> or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span>
are deemed safe by the monotonicity calculus from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Mcalc›</span></span></span></span>

(b) <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CM.Model wtFsym wtPsym arOf resOf parOf Φ intT intF intP›</span></span></span></span>
says that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(intT, intF, intP)›</span></span></span></span> is a model for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Φ›</span></span></span></span> (hence <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Φ›</span></span></span></span> is satisfiable)

The conclusion says that we obtain a model of the untyped version of the problem
(after suitable tags and axioms have been added):›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Because of the assumptions on tpD and tpFD, we have the following particular cases
of our parameterized tag encoding:
\\-- if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span> is taked to be everywhere true (hence <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span> becomes everywhere false), we
obtain the traditional tag encoding
\\-- if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span> is taken to be true precisely when the monotonicity calculus fails,
we obtain the lightweight tag encoding
\\-- if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span> is taken to be true precisely when the monotonicity calculus fails,
we obtain the featherweight tag encoding
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tags_soundness<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpFD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> univ"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> bool"</span></span>
<span class="comment1">― ‹The problem translation:›</span>
<span class="comment1">― ‹First the addition of tags (``TE'' stands for ``tag encoding''):›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_wtFsym</span> <span class="main">≡</span> ProblemIkTpart.TE_wtFsym <span class="free">wtFsym</span> <span class="free">resOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_arOf</span> <span class="main">≡</span> ProblemIkTpart.TE_arOf <span class="free">arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_resOf</span> <span class="main">≡</span> ProblemIkTpart.TE_resOf <span class="free">resOf</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_Φ</span> <span class="main">≡</span> ProblemIkTpart.tPB <span class="free">wtFsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">Φ</span> <span class="free">tpD</span> <span class="free">tpFD</span>"</span></span>
<span class="comment1">― ‹Then the deletion of types (``U'' stands for ``untyped''):›</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_arOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">TE_arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_parOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">parOf</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_Φ</span> <span class="main">≡</span> <span class="free">TE_Φ</span>"</span></span>
<span class="comment1">― ‹The forward model translation:›</span>
<span class="comment1">― ‹First, using monotonicity, we build an infinite model of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span><span class="raw_text">"Φ"</span><span class="antiquote">}</span></span>
  (``I'' stands for ``infinite''):›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">intTI</span> <span class="main">≡</span> MonotProblem.intTI <span class="free">TE_wtFsym</span> <span class="free">wtPsym</span> <span class="free">TE_arOf</span> <span class="free">TE_resOf</span> <span class="free">parOf</span> <span class="free">TE_Φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFI</span> <span class="main">≡</span> MonotProblem.intFI <span class="free">TE_wtFsym</span> <span class="free">wtPsym</span> <span class="free">TE_arOf</span> <span class="free">TE_resOf</span> <span class="free">parOf</span> <span class="free">TE_Φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPI</span> <span class="main">≡</span> MonotProblem.intPI <span class="free">TE_wtFsym</span> <span class="free">wtPsym</span> <span class="free">TE_arOf</span> <span class="free">TE_resOf</span> <span class="free">parOf</span> <span class="free">TE_Φ</span>"</span></span>
<span class="comment1">― ‹Then, by isomorphic transfer of the lattter model, we build a model of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span><span class="raw_text">"Φ"</span><span class="antiquote">}</span></span>
 that has all types interpeted as <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"univ"</span><span class="antiquote">}</span></span> (``F'' stands for ``full"):›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFF</span> <span class="main">≡</span> InfModel.intFF <span class="free">TE_arOf</span> <span class="free">TE_resOf</span> <span class="free">intTI</span> <span class="free">intFI</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPF</span> <span class="main">≡</span> InfModel.intPF <span class="free">parOf</span> <span class="free">intTI</span> <span class="free">intPI</span>"</span></span>
<span class="comment1">― ‹Then we build a model of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"U_Φ"</span><span class="antiquote">}</span></span>:›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_intT</span> <span class="main">≡</span> InfModel.intTF <span class="main">(</span>any<span class="main">::</span><span class="tfree">'tp</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹Assumptions of the theorem:›</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
P<span class="main">:</span> <span class="quoted"><span class="quoted">"ProblemIkTpart <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">tpD</span> <span class="free">tpFD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"CM.Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>

<span class="comment1">― ‹Conclusion of the theorem:›</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CU.Model <span class="free">TE_wtFsym</span> <span class="free">wtPsym</span> <span class="free">U_arOf</span> <span class="free">U_parOf</span> <span class="free">U_Φ</span> <span class="free">U_intT</span> <span class="free">intFF</span> <span class="free">intPF</span>"</span></span>

<span class="keyword1"><span class="command">unfolding</span></span> U_arOf_def U_parOf_def U_Φ_def
<span class="keyword1"><span class="command">unfolding</span></span> U_intT_def intTI_def intFI_def intPI_def intFF_def intPF_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> M_MonotModel.M_U_soundness<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> M_MonotModel_def MonotModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command">unfolding</span></span> TE_wtFsym_def TE_arOf_def TE_resOf_def TE_Φ_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ProblemIkTpart.T_monotonic<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ModelIkTpart.T_soundness<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ModelIkTpart_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> M<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\ \\ \bf Soundness of the guard encodings: \ \\›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here the assumptions and conclusion have a similar shapes as those
for the tag encodings. The difference is in the first assumption,
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ProblemIkTpartG wtFsym wtPsym arOf resOf parOf Φ infTp tpD tpFD tpCD›</span></span></span></span>,
which consists of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ProblemIkTpart wtFsym wtPsym arOf resOf parOf Φ infTp tpD tpFD›</span></span></span></span> together
with the following assumptions about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpCD›</span></span></span></span>:
\\-- <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpCD›</span></span></span></span> is included in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span>
\\-- if a result type of an operation symbol is in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span>, then so are all the types in its arity
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We have the following particular cases of our parameterized guard encoding:
\\-- if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpCD›</span></span></span></span> are taked to be everywhere true
(hence <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span> becomes everywhere false),
we obtain the traditional guard encoding
\\-- if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpCD›</span></span></span></span> is taken to be false and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpD›</span></span></span></span> is taken to be true precisely when the
monotonicity calculus fails,
we obtain the lightweight tag encoding
\\-- if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tpFD›</span></span></span></span> is taken to be true precisely when the monotonicity calculus fails,
we obtain the featherweight tag encoding
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> guards_soundness<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpFD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpCD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> univ"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">intP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> bool"</span></span>
<span class="comment1">― ‹The problem translation:›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_wtFsym</span> <span class="main">≡</span> ProblemIkTpartG.GE_wtFsym <span class="free">wtFsym</span> <span class="free">resOf</span> <span class="free">tpCD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_wtPsym</span> <span class="main">≡</span> ProblemIkTpartG.GE_wtPsym <span class="free">wtPsym</span> <span class="free">tpD</span> <span class="free">tpFD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_arOf</span> <span class="main">≡</span> ProblemIkTpartG.GE_arOf <span class="free">arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_resOf</span> <span class="main">≡</span> ProblemIkTpartG.GE_resOf <span class="free">resOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_parOf</span> <span class="main">≡</span> ProblemIkTpartG.GE_parOf <span class="free">parOf</span>"</span></span>

<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_Φ</span> <span class="main">≡</span> ProblemIkTpartG.gPB <span class="free">wtFsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">Φ</span> <span class="free">tpD</span> <span class="free">tpFD</span> <span class="free">tpCD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_arOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">GE_arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_parOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">GE_parOf</span>"</span></span>

<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_Φ</span> <span class="main">≡</span> <span class="free">GE_Φ</span>"</span></span>

<span class="comment1">― ‹The model forward translation:›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">intTI</span> <span class="main">≡</span> MonotProblem.intTI <span class="free">GE_wtFsym</span> <span class="free">GE_wtPsym</span> <span class="free">GE_arOf</span> <span class="free">GE_resOf</span> <span class="free">GE_parOf</span> <span class="free">GE_Φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFI</span> <span class="main">≡</span> MonotProblem.intFI <span class="free">GE_wtFsym</span> <span class="free">GE_wtPsym</span> <span class="free">GE_arOf</span> <span class="free">GE_resOf</span> <span class="free">GE_parOf</span> <span class="free">GE_Φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPI</span> <span class="main">≡</span> MonotProblem.intPI <span class="free">GE_wtFsym</span> <span class="free">GE_wtPsym</span> <span class="free">GE_arOf</span> <span class="free">GE_resOf</span> <span class="free">GE_parOf</span> <span class="free">GE_Φ</span>"</span></span>

<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">intFF</span> <span class="main">≡</span> InfModel.intFF <span class="free">GE_arOf</span> <span class="free">GE_resOf</span> <span class="free">intTI</span> <span class="free">intFI</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intPF</span> <span class="main">≡</span> InfModel.intPF <span class="free">GE_parOf</span> <span class="free">intTI</span> <span class="free">intPI</span>"</span></span>

<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_intT</span> <span class="main">≡</span> InfModel.intTF <span class="main">(</span>any<span class="main">::</span><span class="tfree">'tp</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">assumes</span></span>
P<span class="main">:</span> <span class="quoted"><span class="quoted">"ProblemIkTpartG <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">tpD</span> <span class="free">tpFD</span> <span class="free">tpCD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"CM.Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>

<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CU.Model <span class="free">GE_wtFsym</span> <span class="free">GE_wtPsym</span> <span class="free">U_arOf</span> <span class="free">U_parOf</span> <span class="free">U_Φ</span> <span class="free">U_intT</span> <span class="free">intFF</span> <span class="free">intPF</span>"</span></span>

<span class="keyword1"><span class="command">unfolding</span></span> U_arOf_def U_parOf_def U_Φ_def
<span class="keyword1"><span class="command">unfolding</span></span> U_intT_def intTI_def intFI_def intPI_def intFF_def intPF_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> M_MonotModel.M_U_soundness<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> M_MonotModel_def MonotModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command">unfolding</span></span> GE_wtFsym_def GE_wtPsym_def GE_arOf_def GE_resOf_def GE_parOf_def GE_Φ_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ProblemIkTpartG.G_monotonic<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ModelIkTpartG.G_soundness<span class="main">)</span>
   <span class="keyword1"><span class="command">unfolding</span></span> ModelIkTpartG_def ModelIkTpart_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">unfolding</span></span> ProblemIkTpartG_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> M<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The setting is similar to the one for completeness, except for the following point:

(3) The constitutive parts of a structure over the untyped signature
resulted from the addition of the tags or guards followed by
the deletion of the types: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(D, eintF, eintP)›</span></span></span></span>
›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\ \\ \bf Completeness of the tag encodings \ \\›</span></span>


<span class="keyword1"><span class="command">theorem</span></span> tags_completeness<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpFD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span><span class="tfree">'tp</span><span class="main">)</span> T.efsym <span class="main">⇒</span> univ list <span class="main">⇒</span> univ"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> univ list <span class="main">⇒</span> bool"</span></span>

<span class="comment1">― ‹The problem translation (the same as in the case of soundness):›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_wtFsym</span> <span class="main">≡</span> ProblemIkTpart.TE_wtFsym <span class="free">wtFsym</span> <span class="free">resOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_arOf</span> <span class="main">≡</span> ProblemIkTpart.TE_arOf <span class="free">arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_resOf</span> <span class="main">≡</span> ProblemIkTpart.TE_resOf <span class="free">resOf</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">TE_Φ</span> <span class="main">≡</span> ProblemIkTpart.tPB <span class="free">wtFsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">Φ</span> <span class="free">tpD</span> <span class="free">tpFD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_arOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">TE_arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_parOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">parOf</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_Φ</span> <span class="main">≡</span> <span class="free">TE_Φ</span>"</span></span>

<span class="comment1">― ‹The backward model translation:›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">≡</span> ProblemIkTpart_TEModel.intT <span class="free">tpD</span> <span class="free">tpFD</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">::</span><span class="tfree">'tp</span><span class="main">.</span> <span class="free">D</span><span class="main">)</span> <span class="free">eintF</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intF</span> <span class="main">≡</span> ProblemIkTpart_TEModel.intF <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">tpD</span> <span class="free">tpFD</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">::</span><span class="tfree">'tp</span><span class="main">.</span> <span class="free">D</span><span class="main">)</span> <span class="free">eintF</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intP</span> <span class="main">≡</span> ProblemIkTpart_TEModel.intP <span class="free">parOf</span> <span class="free">tpD</span> <span class="free">tpFD</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">::</span><span class="tfree">'tp</span><span class="main">.</span> <span class="free">D</span><span class="main">)</span> <span class="free">eintF</span> <span class="free">eintP</span>"</span></span>

<span class="keyword2"><span class="keyword">assumes</span></span>
P<span class="main">:</span> <span class="quoted"><span class="quoted">"ProblemIkTpart <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">tpD</span> <span class="free">tpFD</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
M<span class="main">:</span> <span class="quoted"><span class="quoted">"CU.Model <span class="free">TE_wtFsym</span> <span class="free">wtPsym</span> <span class="main">(</span>length <span class="keyword1">o</span> <span class="free">TE_arOf</span><span class="main">)</span>
            <span class="main">(</span>length <span class="keyword1">o</span> <span class="free">parOf</span><span class="main">)</span> <span class="free">TE_Φ</span> <span class="free">D</span> <span class="free">eintF</span> <span class="free">eintP</span>"</span></span>

<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CM.Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> UM<span class="main">:</span> <span class="quoted"><span class="quoted">"UM_Model <span class="free">TE_wtFsym</span> <span class="free">wtPsym</span> <span class="free">TE_arOf</span> <span class="free">TE_resOf</span> <span class="free">parOf</span> <span class="free">TE_Φ</span> <span class="free">D</span> <span class="free">eintF</span> <span class="free">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> UM_Model_def UM_Struct_def
  <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">unfolding</span></span> CU.Model_def CU.Struct_def U.Model_def
  <span class="keyword1"><span class="command">using</span></span> ProblemIkTpart.T_monotonic<span class="main">[</span><span class="operator">OF</span> P<span class="main">,</span>
  <span class="operator">unfolded</span> TE_wtFsym_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> TE_arOf_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
           TE_resOf_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> TE_Φ_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MonotProblem_def M_Problem_def M_Signature_def M.Problem_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> intT_def intF_def intP_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ProblemIkTpart_TEModel.T_completeness<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> ProblemIkTpart_TEModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UM_Model.M_U_completeness<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UM<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> TE_wtFsym_def TE_arOf_def TE_resOf_def TE_Φ_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\ \\ \bf Completeness of the guard encodings \ \\›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> guards_completeness<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">wtFsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">wtPsym</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">arOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">resOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fsym</span> <span class="main">⇒</span> <span class="tfree">'tp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'psym</span> <span class="main">⇒</span> <span class="tfree">'tp</span> list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span> <span class="tfree">'psym</span><span class="main">)</span> prob"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">infTp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpFD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tpCD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tp</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"univ <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'fsym</span><span class="main">,</span><span class="tfree">'tp</span><span class="main">)</span> G.efsym <span class="main">⇒</span> univ list <span class="main">⇒</span> univ"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eintP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'psym</span><span class="main">,</span><span class="tfree">'tp</span><span class="main">)</span> G.epsym <span class="main">⇒</span> univ list <span class="main">⇒</span> bool"</span></span>

<span class="comment1">― ‹The problem translation (the same as in the case of soundness):›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_wtFsym</span> <span class="main">≡</span> ProblemIkTpartG.GE_wtFsym <span class="free">wtFsym</span> <span class="free">resOf</span> <span class="free">tpCD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_wtPsym</span> <span class="main">≡</span> ProblemIkTpartG.GE_wtPsym <span class="free">wtPsym</span> <span class="free">tpD</span> <span class="free">tpFD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_arOf</span> <span class="main">≡</span> ProblemIkTpartG.GE_arOf <span class="free">arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_resOf</span> <span class="main">≡</span> ProblemIkTpartG.GE_resOf <span class="free">resOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_parOf</span> <span class="main">≡</span> ProblemIkTpartG.GE_parOf <span class="free">parOf</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">GE_Φ</span> <span class="main">≡</span> ProblemIkTpartG.gPB <span class="free">wtFsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">Φ</span> <span class="free">tpD</span> <span class="free">tpFD</span> <span class="free">tpCD</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_arOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">GE_arOf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_parOf</span> <span class="main">≡</span> length <span class="main">∘</span> <span class="free">GE_parOf</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">U_Φ</span> <span class="main">≡</span> <span class="free">GE_Φ</span>"</span></span>

<span class="comment1">― ‹The backward model translation:›</span>
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">intT</span> <span class="main">≡</span> ProblemIkTpartG_GEModel.intT <span class="free">tpD</span> <span class="free">tpFD</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">::</span><span class="tfree">'tp</span><span class="main">.</span> <span class="free">D</span><span class="main">)</span> <span class="free">eintP</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intF</span> <span class="main">≡</span> ProblemIkTpartG_GEModel.intF <span class="free">eintF</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">intP</span> <span class="main">≡</span> ProblemIkTpartG_GEModel.intP <span class="free">eintP</span>"</span></span>

<span class="keyword2"><span class="keyword">assumes</span></span>
P<span class="main">:</span> <span class="quoted"><span class="quoted">"ProblemIkTpartG <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">infTp</span> <span class="free">tpD</span> <span class="free">tpFD</span> <span class="free">tpCD</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
M<span class="main">:</span> <span class="quoted"><span class="quoted">"CU.Model <span class="free">GE_wtFsym</span> <span class="free">GE_wtPsym</span> <span class="main">(</span>length <span class="keyword1">o</span> <span class="free">GE_arOf</span><span class="main">)</span>
            <span class="main">(</span>length <span class="keyword1">o</span> <span class="free">GE_parOf</span><span class="main">)</span> <span class="free">GE_Φ</span> <span class="free">D</span> <span class="free">eintF</span> <span class="free">eintP</span>"</span></span>

<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CM.Model <span class="free">wtFsym</span> <span class="free">wtPsym</span> <span class="free">arOf</span> <span class="free">resOf</span> <span class="free">parOf</span> <span class="free">Φ</span> <span class="free">intT</span> <span class="free">intF</span> <span class="free">intP</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> UM<span class="main">:</span> <span class="quoted"><span class="quoted">"UM_Model <span class="free">GE_wtFsym</span> <span class="free">GE_wtPsym</span> <span class="free">GE_arOf</span> <span class="free">GE_resOf</span> <span class="free">GE_parOf</span> <span class="free">GE_Φ</span> <span class="free">D</span> <span class="free">eintF</span> <span class="free">eintP</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> UM_Model_def UM_Struct_def
  <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">unfolding</span></span> CU.Model_def CU.Struct_def U.Model_def
  <span class="keyword1"><span class="command">using</span></span> ProblemIkTpartG.G_monotonic<span class="main">[</span><span class="operator">OF</span> P<span class="main">,</span>
  <span class="operator">unfolded</span> GE_wtFsym_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> GE_arOf_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
           GE_wtPsym_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> GE_parOf_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
           GE_resOf_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> GE_Φ_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MonotProblem_def M_Problem_def M_Signature_def M.Problem_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> intT_def intF_def intP_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ProblemIkTpartG_GEModel.G_completeness<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> ProblemIkTpartG_GEModel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UM_Model.M_U_completeness<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UM<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> GE_wtFsym_def GE_wtPsym_def GE_parOf_def
             GE_arOf_def GE_resOf_def GE_Φ_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>