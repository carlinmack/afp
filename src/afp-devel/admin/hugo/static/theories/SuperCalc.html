<div id="multisets_continued">
<div class="head">
<h1>Theory multisets_continued</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> multisets_continued

<span class="comment1">(* N. Peltier - http://membres-lig.imag.fr/peltier/ *)</span>

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multisets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We use the Multiset theory provided in Isabelle. We prove some additional 
(mostly trivial) lemmata.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_set_inclusion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E1</span> <span class="main">⊂</span> <span class="free">E2</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="free">E1</span> <span class="main">⊂#</span> <span class="main">(</span>mset_set <span class="free">E2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_set <span class="free">E1</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_set <span class="free">E2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?s1</span> <span class="main">⊂#</span> <span class="var">?s2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?s1</span> <span class="main">⊂#</span> <span class="var">?s2</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="var">?s1</span> <span class="skolem">x</span> <span class="main">&gt;</span> count <span class="var">?s2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subseteq_mset_def <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite_set_mset_mset_set finite_subset less_imp_le 
      less_le not_le_imp_less subset_mset.le_less<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="var">?s1</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">E1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="var">?s1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">E1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subseteq_mset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">E2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">E2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="var">?s2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹count <span class="var">?s1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="var">?s1</span> <span class="skolem">x</span> <span class="main">&gt;</span> count <span class="var">?s2</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_ordering_addition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">+</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆#</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> equal_image_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">E</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span>  <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms count_eq_zero_iff count_mset_set<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> image_mset_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> multiset_order_inclusion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊂#</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E</span><span class="main">,</span><span class="free">F</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">-</span><span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="free">E</span> <span class="main">+</span><span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_mset.add_diff_inverse subset_mset_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="free">E</span> <span class="main">+</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">=</span> <span class="free">E</span> <span class="main">+</span><span class="var">?G</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="var">?G</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> one_step_implies_mult <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiset_order_inclusion_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆#</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="free">F</span> <span class="main">∨</span> <span class="main">(</span><span class="free">E</span><span class="main">,</span><span class="free">F</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≠</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊂#</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> multiset_order_inclusion <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_ordering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M2</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="free">M1</span><span class="main">,</span><span class="free">M2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span>  <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span>  <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="var">?L'</span> <span class="main">+</span> <span class="var">?L''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L'</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L'</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M1'</span> <span class="main">=</span> <span class="var">?M2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq multiset.map_cong0 set_mset_filter<span class="main">)</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> <span class="var">?L'</span> <span class="main">+</span> <span class="var">?L''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">=</span> <span class="var">?M1'</span> <span class="main">+</span> <span class="var">?M1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_mset_union<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> <span class="var">?L'</span> <span class="main">+</span> <span class="var">?L''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M2</span> <span class="main">=</span> <span class="var">?M2'</span> <span class="main">+</span> <span class="var">?M2''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_mset_union<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="var">?M1''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?M2''</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set_mset <span class="var">?M1''</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈#</span> <span class="var">?M2''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="var">?M2''</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?M2''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L''</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?M2''</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> dom <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M1</span> <span class="main">=</span> <span class="var">?M1'</span> <span class="main">+</span> <span class="var">?M1''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M2</span> <span class="main">=</span> <span class="var">?M2'</span> <span class="main">+</span> <span class="var">?M2''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M1'</span><span class="main">=</span><span class="var">?M2'</span>›</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M1</span><span class="main">,</span><span class="free">M2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_step_implies_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_ordering_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M2</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M1</span> <span class="main">=</span> <span class="free">M2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span> <span class="main">(</span><span class="free">M1</span><span class="main">,</span><span class="free">M2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">=</span> <span class="free">M2</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≠</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span>  <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span>  <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="var">?L'</span> <span class="main">+</span> <span class="var">?L''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L'</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L'</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M1'</span> <span class="main">=</span> <span class="var">?M2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq multiset.map_cong0 set_mset_filter<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> <span class="var">?L'</span> <span class="main">+</span> <span class="var">?L''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">=</span> <span class="var">?M1'</span> <span class="main">+</span> <span class="var">?M1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_mset_union<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> <span class="var">?L'</span> <span class="main">+</span> <span class="var">?L''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M2</span> <span class="main">=</span> <span class="var">?M2'</span> <span class="main">+</span> <span class="var">?M2''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_mset_union<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="var">?M1''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?M2''</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set_mset <span class="var">?M1''</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈#</span> <span class="var">?M2''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="var">?L''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?L''</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1</span> <span class="skolem">u</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f2</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="var">?M2''</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?M2''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M1</span> <span class="main">≠</span> <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?M2''</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M1</span> <span class="main">=</span> image_mset <span class="free">f1</span> <span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">f2</span> <span class="bound">u</span><span class="main">#}</span> <span class="main">+</span> image_mset <span class="free">f1</span> <span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">f2</span> <span class="bound">u</span><span class="main">#}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M2</span> <span class="main">=</span> image_mset <span class="free">f2</span> <span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">f2</span> <span class="bound">u</span><span class="main">#}</span> <span class="main">+</span> image_mset <span class="free">f2</span> <span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">f2</span> <span class="bound">u</span><span class="main">#}</span>›</span></span> <span class="quoted"><span class="quoted">‹image_mset <span class="free">f1</span> <span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">f2</span> <span class="bound">u</span><span class="main">#}</span> <span class="main">=</span> image_mset <span class="free">f2</span> <span class="main">{#</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="free">L</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">f2</span> <span class="bound">u</span><span class="main">#}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> dom <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M1</span> <span class="main">=</span> <span class="var">?M1'</span> <span class="main">+</span> <span class="var">?M1''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M2</span> <span class="main">=</span> <span class="var">?M2'</span> <span class="main">+</span> <span class="var">?M2''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M1'</span><span class="main">=</span><span class="var">?M2'</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M1</span><span class="main">,</span><span class="free">M2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_step_implies_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult1_def_lemma <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">M0</span> <span class="main">+</span> <span class="main">{#</span><span class="free">a</span><span class="main">#}</span> <span class="main">∧</span> <span class="free">N</span> <span class="main">=</span> <span class="free">M0</span> <span class="main">+</span> <span class="free">K</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="free">K</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">N</span><span class="main">,</span><span class="free">M</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mult1_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_ordering_add1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span><span class="free">E2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span><span class="free">E2</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E2</span><span class="main">,</span><span class="free">E2</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">E2</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">E2</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">E2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E2</span><span class="main">,</span><span class="free">E2</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">E2</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">E2</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">E2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span><span class="free">E2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span><span class="free">E2</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_ordering_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈#</span> <span class="free">E1</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">E1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E1</span> <span class="main">=</span> <span class="var">?M0</span> <span class="main">+</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span> <span class="main">=</span> <span class="var">?M0</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈#</span> <span class="var">?K</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword2"><span class="keyword">and</span></span> iii <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">a</span> <span class="main">#}</span>"</span></span>  <span class="var"><span class="quoted"><span class="var">?M0</span></span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">E1</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> monotonic_fun_mult1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span><span class="free">E2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E1</span> <span class="main">#}</span><span class="main">,</span><span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E1</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E2</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M0</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">E2</span> <span class="main">=</span> <span class="skolem">M0</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">a</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E1</span> <span class="main">=</span> <span class="skolem">M0</span> <span class="main">+</span> <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="skolem">K</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mult1_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="skolem">K</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="skolem">M0</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E2</span> <span class="main">=</span> <span class="skolem">M0</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">a</span><span class="main">#}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E2</span> <span class="main">=</span> <span class="var">?M0</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E1</span> <span class="main">=</span> <span class="skolem">M0</span> <span class="main">+</span> <span class="skolem">K</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="var">?M0</span> <span class="main">+</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="var">?K</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>  <span class="main">∈#</span> <span class="var">?K</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span>  <span class="main">∈#</span> <span class="var">?K</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈#</span> <span class="skolem">K</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_DiffM2 msed_map_invR union_single_eq_member<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈#</span> <span class="skolem">K</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="skolem">K</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b'</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?E1</span> <span class="main">=</span> <span class="var">?M0</span> <span class="main">+</span> <span class="var">?K</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?E2</span> <span class="main">=</span> <span class="var">?M0</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">#}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="var">?K</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?E1</span><span class="main">,</span><span class="var">?E2</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult1_def_lemma<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monotonic_fun_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span><span class="free">E2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E1</span> <span class="main">#}</span><span class="main">,</span><span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E1</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E2</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="var">?E1</span><span class="main">,</span><span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈#</span> <span class="bound">x</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> trancl_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">E1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">E2</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>mult1 <span class="free"><span class="free">r</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?P</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span> <span class="free">E2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="free">r</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">E1</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="free">r</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">E1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="free">r</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> monotonic_fun_mult1<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">E1</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">E1</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="skolem">x</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> monotonic_fun_mult1<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">E1</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">E1</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mult_def trancl.trancl_into_trancl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_set_insert_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span> <span class="main">⊆#</span> mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> 
    <span class="main">&gt;</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> leI subseteq_mset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> count_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> 
    <span class="main">&gt;</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> mset_set_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multiset_eqI<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> count_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> count_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> count_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> count_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∉</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> count_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">E</span> <span class="main">+</span> <span class="main">{#</span> <span class="free">x</span> <span class="main">#}</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_image_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E</span> <span class="main">#}</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_mset.compositionality comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mset_set_mset_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">E</span><span class="main">.</span> card <span class="bound">E</span> <span class="main">=</span> <span class="free">N</span> <span class="main">⟹</span> finite <span class="bound">E</span> <span class="main">⟹</span> mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="bound">E</span><span class="main">)</span> <span class="main">⊆#</span>  <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="bound">E</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">N</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">E</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">E</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">E</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">⊆#</span>  <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="skolem">E</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">E</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">E</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?E</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"Suc.IH"</span> <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?E</span> <span class="main">=</span> <span class="skolem">N</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">⊆#</span>  <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?E</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?E</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="var">?E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="var">?E</span> <span class="main">+</span> <span class="main">{#</span> <span class="skolem">x</span> <span class="main">#}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mset_set_insert <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="var">?E</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">}</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">}</span> <span class="main">)</span> <span class="main">⊆#</span> mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  mset_set_insert_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">from</span></span> this i <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆#</span> mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="var">?E</span><span class="main">)</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span>  <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?E</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Multiset.subset_mset.add_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆#</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?E</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Multiset.subset_mset.order.trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">x</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="var">?E</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#}</span>›</span></span> 
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">⊆#</span> <span class="main">{#</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="skolem">E</span> <span class="main">#}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_mset_set<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">C1</span> <span class="main">∪</span> <span class="free">C2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C1</span> <span class="main">∩</span> <span class="free">C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> count <span class="main">(</span><span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multiset_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span><span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> count <span class="main">(</span><span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span> <span class="free">C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∉</span> <span class="free">C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span><span class="main">∉</span> <span class="free">C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∉</span> <span class="free">C2</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∉</span> <span class="free">C2</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span><span class="main">∉</span> <span class="free">C1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹count <span class="main">(</span>mset_set <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>count <span class="main">(</span>mset_set <span class="free">C2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span> <span class="main">∉</span> <span class="free">C1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span> <span class="main">∉</span> <span class="free">C2</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_thm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">E'</span> <span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈#</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">y</span> <span class="main">∈#</span> <span class="free">E'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> split_image_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">M1</span> <span class="main">+</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">M</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">M1</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">M2</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="well_founded_continued">
<div class="head">
<h1>Theory well_founded_continued</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> well_founded_continued

<span class="comment1">(* N. Peltier - http://membres-lig.imag.fr/peltier/ *)</span>

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Well-Founded Sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Most useful lemmata are already proven in the Well\_Founded theory available in Isabelle. 
We only establish a few convenient results for constructing well-founded sets and relations.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> measure_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="free">r</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">m</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">Q</span><span class="main">::</span><span class="tfree">'b</span> set<span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">::</span> <span class="tfree">'b</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">Q</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="bound">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">∈</span> <span class="free">r'</span> <span class="main">--&gt;</span> <span class="bound">y</span><span class="main">∉</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="main">`</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> Q'_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?Q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> Q'_not_empty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> <span class="var">?Q'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z'min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">z'</span><span class="main">)</span><span class="main">∈</span> <span class="free">r</span> 
      <span class="main">⟶</span> <span class="bound">y</span><span class="main">∉</span><span class="var">?Q'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_eq_minimal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">∈</span> <span class="var">?Q'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">∈</span> <span class="free">r'</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">∉</span><span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">∈</span> <span class="free">r'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="skolem">z</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="skolem">z'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> z'min <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?Q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∉</span><span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">∈</span> <span class="free">r'</span> <span class="main">--&gt;</span> <span class="bound">y</span><span class="main">∉</span><span class="skolem">Q</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> wf_eq_minimal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_proj_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">∉</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">E</span> <span class="main">×</span> <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">E</span> <span class="main">×</span> <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">E</span> <span class="main">×</span> <span class="free">E</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">E</span> <span class="main">×</span> <span class="free">E</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">⊆</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> acyclic_def <span class="keyword1"><span class="command">using</span></span> trancl_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="var">?r</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_acyclic_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?r</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> wfE_min <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span>"</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="terms">
<div class="head">
<h1>Theory terms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> terms

<span class="comment1">(* N. Peltier - http://membres-lig.imag.fr/peltier/ *)</span>

<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-ex/Unification.html">HOL-ex.Unification</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Terms›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Syntax›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We use the same term representation as in the Unification theory provided in Isabelle. 
Terms are represented by binary trees built on variables and constant symbols.›</span></span>
 
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_a_variable</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_a_variable</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_a_variable</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_a_variable</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_a_constant</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_a_constant</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_a_constant</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_a_constant</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_compound</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_compound</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_compound</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">is_compound</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ground_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ground_term</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vars_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> constants_are_not_variables <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_a_constant <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_a_variable <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_a_constant.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_a_variable.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> trm.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> constants_are_ground <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_a_constant <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_a_constant.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ground_term_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the notion of a position together with functions to access to subterms and 
replace them. We establish some basic properties of these functions.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since terms are binary trees, positions are sequences of binary digits.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> indices <span class="main">=</span> Left <span class="main">|</span> Right

<span class="keyword1"><span class="command">type_synonym</span></span> position <span class="main">=</span> <span class="quoted"><span class="quoted">"indices list"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">left_app</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">left_app</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Left <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">right_app</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">right_app</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Right <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_prefix</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strict_prefix</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>append <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subterm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> position <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subterm</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subterm</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">first</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subterm</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">first</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subterm</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>Left <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">subterm</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subterm</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>Right <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">subterm</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">occurs_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">occurs_in</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> subterm <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">position_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"position <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">position_in</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> subterm <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subterms_of</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subterms_of</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>occurs_in <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">proper_subterms_of</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proper_subterms_of</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">≠</span> Nil <span class="main">∧</span> <span class="main">(</span>subterm <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">p</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pos_of</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos_of</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>position_in <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>
 
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">replace_subterm</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> position <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">replace_subterm</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> "</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">replace_subterm</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">first</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">replace_subterm</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">first</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">replace_subterm</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>Left <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span>  
      <span class="main">(</span><span class="main">∃</span><span class="bound">S1</span><span class="main">.</span> <span class="main">(</span><span class="free">replace_subterm</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">S1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> Comb <span class="bound">S1</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">replace_subterm</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>Right <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∃</span><span class="bound">S2</span><span class="main">.</span> <span class="main">(</span><span class="free">replace_subterm</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">S2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> Comb <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">S2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> replace_subterm_is_a_function<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> subterm <span class="bound">t</span> <span class="free">p</span> <span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> replace_subterm <span class="bound">t</span> <span class="free">p</span> <span class="bound">v</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Left"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="skolem">v</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Right›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="skolem">v</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">(</span>Comb <span class="skolem">s</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove some useful lemmata concerning the set of variables or subterms occurring in a 
term.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_subterm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq occurs_in_def subterm.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subterms_of.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> root_position<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Nil <span class="main">∈</span> <span class="main">(</span>pos_of <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq subterm.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> position_in_def pos_of.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_of_an_atomic_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="free">t</span> <span class="main">∨</span> is_a_constant <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subterms_of <span class="free">t</span> <span class="main">=</span> <span class="main">{</span> <span class="free">t</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterms_of <span class="free">t</span> <span class="main">⊆</span> <span class="main">{</span> <span class="free">t</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>subterm <span class="free">t</span> <span class="bound">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">t</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_a_constant.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_a_variable.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subterm.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span> <span class="free">t</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="free">t</span> <span class="main">}</span> <span class="main">⊆</span> subterms_of <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span> <span class="free">t</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> positions_of_an_atomic_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="free">t</span> <span class="main">∨</span> is_a_constant <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_of <span class="free">t</span> <span class="main">=</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_of <span class="free">t</span> <span class="main">⊆</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">x</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>subterm <span class="free">t</span> <span class="skolem">x</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Nil"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_a_constant.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_a_variable.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subterm.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> Nil <span class="main">}</span> <span class="main">⊆</span> pos_of <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indices list"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root_position <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterm_of_a_subterm_is_a_subterm <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">u</span> <span class="free">q</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">u</span> <span class="main">⟹</span> subterm <span class="bound">t</span> <span class="main">(</span>append <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nil.prems assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Left"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">p'</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="main">(</span>append <span class="skolem">p'</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons.IH<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Right›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t</span>  <span class="main">(</span>append <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">p'</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="main">(</span>append <span class="skolem">p'</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons.IH<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t</span>  <span class="main">(</span>append <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> occur_in_subterm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">u</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">t</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">u</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> occurs_in_def subterm_of_a_subterm_is_a_subterm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vars_of_subterm <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> vars_of <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nil.prems assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Left"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">p'</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons.IH<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Right›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">p'</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons.IH<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_subterm <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t</span> <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms subsetI vars_of_subterm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vars_subterms_of <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> subterms_of <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms occurs_in_def vars_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_of_a_non_atomic_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">#</span><span class="bound">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq_Nil_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">#</span><span class="bound">q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">x</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t1</span> <span class="skolem">q</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="free">t1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">x</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t2</span> <span class="skolem">q</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span> <span class="main">⊆</span> subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="free">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t1</span> <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>Left <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>        
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="free">t2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t2</span> <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>Right <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">t1</span> <span class="main">⋅</span> <span class="free">t2</span>›</span></span> root_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> positions_of_a_non_atomic_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">x</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">#</span><span class="bound">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq_Nil_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">#</span><span class="bound">q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">s</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t1</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">q</span> <span class="free">t1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">s</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t2</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">q</span> <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Right›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span> <span class="main">⊆</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> Nil<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Left <span class="main">#</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">q</span> <span class="free">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t1</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>Left <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Left <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">x</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>    
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> Nil<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="free">t2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Right <span class="main">#</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">q</span> <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t2</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>Right <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Right <span class="main">#</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">x</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Nil"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Nil›</span></span> root_position <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_subterms_is_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="main">(</span>subterms_of <span class="main">(</span><span class="free">t</span> <span class="main">::</span> <span class="tfree">'a</span> trm<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> subterms_of_an_atomic_term <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Var <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> subterms_of_an_atomic_term <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Const <span class="skolem">x</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subterms_of <span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subterms_of <span class="skolem">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterms_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">=</span> subterms_of <span class="skolem">t1</span> <span class="main">∪</span> subterms_of <span class="skolem">t2</span> <span class="main">∪</span> <span class="main">{</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subterms_of_a_non_atomic_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>subterms_of <span class="skolem">t1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>subterms_of <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subterms_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_positions_is_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="main">(</span>pos_of <span class="main">(</span><span class="free">t</span> <span class="main">::</span> <span class="tfree">'a</span> trm<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> positions_of_an_atomic_term <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Var <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> positions_of_an_atomic_term <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Const <span class="skolem">x</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>pos_of <span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>pos_of <span class="skolem">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>pos_of <span class="skolem">t1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="skolem">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>pos_of <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>left_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="skolem">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>right_app <span class="main">`</span> <span class="main">(</span>pos_of <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> Nil <span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> positions_of_a_non_atomic_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i ii <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>pos_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_of_instances<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>Const <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhs_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="main">(</span>Const <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lhs_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Const <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rhs_empty <span class="keyword2"><span class="keyword">and</span></span> lhs_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">a</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span> <span class="main">=</span> 
     vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lhs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rhs <span class="keyword2"><span class="keyword">and</span></span> lhs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vars_of <span class="skolem">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span> 
      <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="skolem">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst<span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>   
        <span class="main">∪</span> <span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span> 
      <span class="main">=</span> <span class="main">(</span>vars_of <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>  <span class="main">∪</span> <span class="main">(</span>vars_of <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span> 
              <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="skolem">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span> 
              <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lhs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of <span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>vars_of <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lhs <span class="keyword2"><span class="keyword">and</span></span> rhs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_of_instances <span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">u'</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">v</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subterm <span class="bound">u</span> <span class="free">p</span> <span class="bound">u'</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">q1</span> <span class="bound">u'</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="bound">v</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> is_a_variable <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="bound">v</span> <span class="free">p</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">v'</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prop</span> <span class="free">p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">u'</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">u</span> <span class="main">[]</span> <span class="skolem">u'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="skolem">v</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> is_a_variable <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">v</span> <span class="main">[]</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">v'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">v</span> <span class="main">[]</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterm <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">u'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_a_variable <span class="skolem">v</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_a_variable <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subterm <span class="skolem">v</span> <span class="main">[]</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">u'</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">u</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="skolem">v</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> is_a_variable <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">v</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">v'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">v</span> <span class="main">[]</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cons <span class="skolem">i</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">[]</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">u</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_a_variable <span class="skolem">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">v</span> <span class="main">[]</span> <span class="skolem">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Cons <span class="skolem">i</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">[]</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> this 
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">u</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="main">(</span>subst <span class="skolem">t1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="main">(</span>subst <span class="skolem">t1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">u</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">u'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ti</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">ti</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">q</span> <span class="skolem">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ti</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">∨</span> <span class="skolem">ti</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">v</span> <span class="main">[</span><span class="skolem">i</span><span class="main">]</span> <span class="skolem">ti</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?prop</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="skolem">ti</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">q</span> <span class="skolem">u'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="skolem">ti</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                      <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> is_a_variable <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">ti</span> <span class="skolem">q</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">v'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="skolem">ti</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">q1</span> <span class="skolem">u'</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">ti</span> <span class="skolem">q2</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="skolem">q2</span> <span class="skolem">q1</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">ti</span> <span class="skolem">q2</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">v</span> <span class="main">[</span><span class="skolem">i</span><span class="main">]</span> <span class="skolem">ti</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">v</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> indices.Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> indices.Right›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> append <span class="skolem">q2</span> <span class="skolem">q1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="skolem">q1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="skolem">q1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_a_variable <span class="skolem">x</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">q1</span> <span class="skolem">u'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">v</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="skolem">x</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> is_a_variable <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">ti</span> <span class="skolem">q</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">v'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> is_a_variable <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="skolem">ti</span> <span class="skolem">q</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">ti</span> <span class="skolem">q</span> <span class="skolem">v'</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">v</span> <span class="main">[</span><span class="skolem">i</span><span class="main">]</span> <span class="skolem">ti</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">v</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> indices.Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> indices.Right›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">¬</span> is_a_variable <span class="skolem">v'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">ti</span> <span class="skolem">q</span> <span class="skolem">v'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_of_replacement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> vars_of <span class="bound">s</span> <span class="main">⟹</span> replace_subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">v</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="bound">t</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> Nil <span class="free">v</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_a_variable.cases replace_subterm.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> replace_subterm.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">s1</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t1</span>  <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">s1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> replace_subterm.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">s1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s1</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Cons.IH <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s1</span></span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">s1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="skolem">t1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">s2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> replace_subterm.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">s2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Cons.IH <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s2</span></span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="skolem">t2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t1</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_of_replacement_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="free">t</span> <span class="free">p</span> <span class="free">v</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">⊆</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms subsetI vars_of_replacement<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitutions and Most General Unifiers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Substitutions are defined in the Unification theory. We provide some 
additional definitions and lemmata.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm set <span class="main">=&gt;</span> <span class="tfree">'a</span> subst <span class="main">=&gt;</span> <span class="tfree">'a</span> trm set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subst_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_codomain</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_codomain</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">y</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_codomain_is_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span>›</span></span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span>›</span></span> this <span class="keyword3"><span class="command">show</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">using</span></span> image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onI trm.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subst_codomain <span class="free">η</span> <span class="free">A</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subst_codomain <span class="free">η</span> <span class="free">A</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The notions of unifiers, most general unifiers, the unification algorithm and a 
proof of correctness are provided in the Unification theory. Below, we prove that the algorithm 
is complete.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subt_decompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> Comb <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">≺</span> <span class="free">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">≺</span> <span class="free">s</span> <span class="main">∧</span> <span class="bound">t2</span><span class="main">≺</span> <span class="free">s</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span> 
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> Comb <span class="skolem">s1</span> <span class="skolem">s2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≺</span> <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">t1</span> <span class="main">≺</span> <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> Comb <span class="skolem">s1</span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          d<span class="main">:</span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main">∨</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s2</span> <span class="main">∨</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s1</span> <span class="main">∨</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s2</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≺</span> <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≺</span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≺</span> <span class="skolem">s1</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≺</span> <span class="skolem">s2</span>  <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> d <span class="keyword2"><span class="keyword">and</span></span> i ii iii iv <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subt_irrefl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">s</span> <span class="main">≺</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> 
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≠</span> <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Comb.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≠</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Comb.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">t1</span> <span class="main">∨</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span>  <span class="main">≺</span> <span class="skolem">t1</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≺</span> <span class="skolem">t1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> subt_decompose <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Comb <span class="skolem">t1</span> <span class="skolem">t2</span>  <span class="main">≺</span> <span class="skolem">t2</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">≺</span> <span class="skolem">t2</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> subt_decompose <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGU_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>subst <span class="free">t</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">⟶</span> unify <span class="free">t</span> <span class="free">s</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> unify.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst <span class="main">.</span><span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> unify <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Comb <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst<span class="main">.</span><span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> unify <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst<span class="main">.</span><span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> unify <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> unify.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst<span class="main">.</span><span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> unify <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subst_mono subt_irrefl unify.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst<span class="main">.</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> unify <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subst_mono subt_irrefl unify.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst<span class="main">.</span><span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> unify <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">s1</span> <span class="skolem">s2</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="main">::</span> <span class="tfree">'a</span> subst<span class="main">.</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="skolem">s1</span> <span class="bound">σ</span> <span class="main">⟶</span> unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⋀</span><span class="bound">x2</span><span class="main">.</span> unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">=</span> Some <span class="bound">x2</span> <span class="main">⟹</span>
              <span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> subst <span class="main">(</span><span class="skolem">t2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="main">(</span><span class="skolem">s2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">⟶</span>
              unify <span class="main">(</span><span class="skolem">t2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="main">(</span><span class="skolem">s1</span> <span class="main">⋅</span> <span class="skolem">s2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">⟶</span>
       unify <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s1</span> <span class="main">⋅</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="skolem">s1</span> <span class="bound">σ</span> <span class="main">⟶</span> unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x2</span><span class="main">.</span> unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">=</span> Some <span class="bound">x2</span> <span class="main">⟹</span>
              <span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> subst <span class="main">(</span><span class="skolem">t2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="main">(</span><span class="skolem">s2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">⟶</span>
              unify <span class="main">(</span><span class="skolem">t2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s2</span> <span class="main">⊲</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="main">(</span><span class="skolem">s1</span> <span class="main">⋅</span> <span class="skolem">s2</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">⟶</span>
       unify <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s1</span> <span class="main">⋅</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="main">(</span><span class="skolem">s1</span> <span class="main">⋅</span> <span class="skolem">s2</span><span class="main">)</span> <span class="skolem">σ</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t1</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">s1</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">=</span> Some <span class="skolem">θ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"MGU <span class="skolem">θ</span> <span class="skolem">t1</span> <span class="skolem">s1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> option.exhaust unify_computes_MGU<span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t1</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">s1</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Unifier <span class="skolem">σ</span> <span class="skolem">t1</span> <span class="skolem">s1</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹MGU <span class="skolem">θ</span> <span class="skolem">t1</span> <span class="skolem">s1</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MGU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t2</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">s2</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span>   
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span> 
              <span class="main">=</span> subst <span class="main">(</span>subst <span class="skolem">s2</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_eq_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">=</span> Some <span class="skolem">θ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">θ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unify <span class="main">(</span><span class="skolem">t2</span> <span class="main">⊲</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s2</span> <span class="main">⊲</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unify <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s1</span> <span class="main">⋅</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹unify <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">=</span> Some <span class="skolem">θ</span>›</span></span> option.case_eq_if<span class="main">)</span>  
      <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We establish some useful properties of substitutions and instances.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ground_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ground_on</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> <span class="main">(</span>ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_subst_terms<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_instance<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ground_term <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span> <span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vars_of_instances <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_groundness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms equals0D ground_instance ground_on_def ground_term_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ground_subst_exists  <span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">V</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>ground_on <span class="free">V</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> emptyI
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> ground_on <span class="skolem">A</span> <span class="bound">σ</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="skolem">A</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> ground_on <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="bound">σ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> ground_on <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="bound">σ</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span>Const <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_a_constant <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="main">(</span>ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_a_constant <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> constants_are_ground <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="skolem">A</span> <span class="skolem">σ</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_ground_terms <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">t</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> agreement assms equals0D ground_term_def subst_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_subterms <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span>  <span class="bound">s</span><span class="main">.</span> subterm <span class="bound">t</span> <span class="free">p</span> <span class="bound">s</span> <span class="main">⟹</span> subterm <span class="main">(</span>subst <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span>subst <span class="bound">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> indices.Left›</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> indices.Right›</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_occurs_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">s</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms
  <span class="keyword1"><span class="command">using</span></span> assms occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">coincide_on</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">coincide_on</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coincide_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">η</span> <span class="free">σ</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms coincide_on_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> coincide_on_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">η</span><span class="main">.</span> coincide_on <span class="bound">σ</span> <span class="bound">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> subst <span class="free">t</span> <span class="bound">σ</span> <span class="main">=</span> subst <span class="free">t</span> <span class="bound">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">=</span> subst  <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">=</span> subst  <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_replacement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="free">t</span> <span class="free">p</span> <span class="free">v</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">⊆</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vars_of_replacement_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> contra_subsetD ex_in_conv ground_term_def 
      occs_vars_subset subst_mono vars_iff_occseq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> contra_subsetD ex_in_conv ground_term_def 
      occs_vars_subset subst_mono vars_iff_occseq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">⊆</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="free">σ</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹ground_on <span class="main">(</span>vars_of <span class="free">v</span><span class="main">)</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of <span class="free">s</span><span class="main">)</span> <span class="free">σ</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE ground_on_def rev_subsetD<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ground_instance <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that two disjoint substitutions can always be fused.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> combine_substs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V1</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="free">V1</span> <span class="free">η1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η1</span> <span class="free">V1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η2</span> <span class="free">V2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V1</span> <span class="main">⟹</span> ground_on <span class="free">V1</span> <span class="free">η1</span> <span class="main">⟹</span> <span class="free">V1</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η1</span> <span class="free">V1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η2</span> <span class="free">V2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> emptyI
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_on <span class="skolem">V1</span> <span class="free">η1</span> <span class="main">⟹</span> <span class="skolem">V1</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span> 
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η1</span> <span class="skolem">V1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η2</span> <span class="free">V2</span><span class="main">)</span>"</span></span> 
      <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span> <span class="free">η1</span>"</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span> <span class="free">η1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="skolem">V1</span> <span class="free">η1</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V1</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ'</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>coincide_on <span class="skolem">σ'</span> <span class="free">η1</span> <span class="skolem">V1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>coincide_on <span class="skolem">σ'</span> <span class="free">η2</span> <span class="free">V2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">η1</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="var">?t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹ground_on <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span> <span class="free">η1</span>›</span></span> ground_on_def insertI1<span class="main">)</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="main">[</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span><span class="main">]</span> <span class="skolem">σ'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="var">?σ</span> <span class="free">η1</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>coincide_on <span class="var">?σ</span> <span class="free">η1</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="var">?σ</span>  <span class="main">=</span> subst <span class="var">?t</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_term <span class="var">?t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="var">?σ</span>  <span class="main">=</span> <span class="var">?t</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_terms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η1</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> c <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="var">?σ</span> <span class="free">η2</span> <span class="free">V2</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>coincide_on <span class="var">?σ</span> <span class="free">η2</span> <span class="free">V2</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> c <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="var">?σ</span> <span class="free">η1</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="var">?σ</span> <span class="free">η2</span> <span class="free">V2</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η1</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>coincide_on <span class="bound">σ</span> <span class="free">η2</span> <span class="free">V2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a map function for substitutions and prove its correctness.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">map_subst</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_subst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> Nil <span class="main">=</span> Nil"</span></span> 
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">map_subst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">map_subst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> map_subst_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">σ</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span>  
        <span class="main">∨</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span>  <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span>  <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="var">?u</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="var">?v</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_subst.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.collapse<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?u</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?v</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assoc.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.collapse subst.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="var">?u</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="var">?v</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="var">?u</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="var">?v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?v</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="var">?v</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="var">?u</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  assoc.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.collapse subst.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="var">?u</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="var">?v</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="var">?u</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"Cons.IH"</span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> Var <span class="free">x</span> <span class="main">∨</span> subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Congruences›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the notion of a congruence on ground terms, i.e., an equivalence relation
that is closed under contextual embedding.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> binary_relation_on_trms <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">reflexive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symmetric</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">symmetric</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">transitive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">transitive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">equivalence_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">equivalence_relation</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>reflexive <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>symmetric <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>transitive <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compatible_with_structure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> binary_relation_on_trms<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">compatible_with_structure</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> 
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">t1</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">t2</span> <span class="bound">s2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Comb <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">(</span>Comb <span class="bound">s1</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">congruence</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">congruence</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>equivalence_relation <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>compatible_with_structure <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> replacement_preserves_congruences <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span>  <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>congruence <span class="free">I</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟹</span> subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">u</span> <span class="main">⟹</span> replace_subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">v</span> <span class="bound">s</span> 
          <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="bound">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> Nil <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> Nil <span class="free">v</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="free">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">u</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">t1'</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹congruence <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t1'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t1'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹congruence <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> congruence_def equivalence_relation_def reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t1'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹congruence <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1'</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> congruence_def compatible_with_structure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">u</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Right›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t2'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹congruence <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t2'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹congruence <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> congruence_def equivalence_relation_def reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹congruence <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2'</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> congruence_def compatible_with_structure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">equivalent_on</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">equivalent_on</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> 
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalent_on_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"congruence <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">η</span><span class="main">.</span> equivalent_on <span class="bound">σ</span> <span class="bound">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">t</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst  <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> congruence_def equivalence_relation_def reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def
      <span class="keyword1"><span class="command">unfolding</span></span> congruence_def compatible_with_structure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Renamings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the usual notion of a renaming. We show that fresh renamings always exist 
(provided the set of variables is infinite) and that renamings admit inverses.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">renaming</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">renaming</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">y</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> renamings_admit_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span> <span class="main">⟹</span> renaming <span class="free">σ</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">θ</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> emptyI
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{}</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="var">?θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"renaming <span class="free">σ</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">θ</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">θ</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">θ</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="bound">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> hyp_ind <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"renaming <span class="free">σ</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        ii<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_a_variable.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?η</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> Nil<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">a'</span><span class="main">)</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">a'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a'</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">a'</span><span class="main">)</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>›</span></span>  
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> Nil<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span>›</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span> <span class="main">=</span> Var <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> insertI1 is_a_variable.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                occs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> renaming_def repl_invariance vars_iff_occseq<span class="main">)</span>
         <span class="keyword1"><span class="command">qed</span></span> 
       <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">have</span></span> ii'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> subst_codomain <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">a</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">b</span><span class="main">)</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> subst_codomain <span class="free">σ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="free">σ</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> i' ii' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> renaming_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="main">(</span><span class="free">Vars</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">V'</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">.</span> finite <span class="bound">V'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">η</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>renaming <span class="bound">η</span> <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst_codomain <span class="bound">η</span> <span class="free">V</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">V'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> emptyI
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?η</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> renaming_def subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V'</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> finite <span class="bound">V'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">η</span><span class="main">.</span> renaming <span class="bound">η</span> <span class="skolem">A</span> <span class="main">∧</span> subst_codomain <span class="bound">η</span> <span class="skolem">A</span> <span class="main">∩</span> <span class="bound">V'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V'</span><span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> finite <span class="bound">V'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">η</span><span class="main">.</span> renaming <span class="bound">η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> subst_codomain <span class="bound">η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">V'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"renaming <span class="skolem">η</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subst_codomain_is_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">V'</span> <span class="main">∪</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">¬</span> finite <span class="free">Vars</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">Vars</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rev_finite_subset
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∈</span> <span class="free">Vars</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∉</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?η</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="main">(</span>Var <span class="skolem">nv</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span>  <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span>  <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span>  <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="skolem">η</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> 
        <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> 
          <span class="main">⟶</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> is_a_variable.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> is_a_variable.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> is_a_variable.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> is_a_variable.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y'</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y'</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">y'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nv</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">y'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">y'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nv</span> <span class="main">∉</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?η</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="skolem">η</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"renaming <span class="var">?η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_codomain <span class="var">?η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_codomain <span class="var">?η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="var">?η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="var">?η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span> <span class="var">?η</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span> <span class="var">?η</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nv</span> <span class="main">∉</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span> <span class="var">?η</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subst_codomain <span class="skolem">η</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> subst_codomain <span class="skolem">η</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="var">?η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">η</span><span class="main">.</span> renaming <span class="bound">η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> subst_codomain <span class="bound">η</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="equational_clausal_logic">
<div class="head">
<h1>Theory equational_clausal_logic</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> equational_clausal_logic

<span class="comment1">(* N. Peltier - http://membres-lig.imag.fr/peltier/ *)</span>

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="terms.html">terms</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Equational Clausal Logic›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The syntax and semantics of clausal equational logic are defined as usual. 
Interpretations are congruences on binary trees.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first define the syntax of equational clauses.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> equation <span class="main">=</span> Eq <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lhs</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lhs</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span>"</span></span> <span class="main">|</span>
     <span class="quoted"><span class="quoted">"<span class="free">lhs</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
     <span class="quoted"><span class="quoted">"<span class="free">lhs</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rhs</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rhs</span> <span class="main">(</span>Comb <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span>"</span></span> <span class="main">|</span>
     <span class="quoted"><span class="quoted">"<span class="free">rhs</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
     <span class="quoted"><span class="quoted">"<span class="free">rhs</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> literal <span class="main">=</span> Pos <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> equation"</span></span> <span class="main">|</span> Neg <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> equation"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> <span class="tfree">'a</span> equation"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">atom</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">atom</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> sign <span class="main">=</span> pos <span class="main">|</span> neg
 
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_sign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> sign"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">get_sign</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pos"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">get_sign</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> neg"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">positive_literal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">positive_literal</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">positive_literal</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">negative_literal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">negative_literal</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">negative_literal</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mk_lit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"sign <span class="main">⇒</span> <span class="tfree">'a</span> equation <span class="main">⇒</span> <span class="tfree">'a</span> literal"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mk_lit</span> pos <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mk_lit</span> neg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decompose_equation</span>   
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">decompose_equation</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decompose_literal</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">decompose_literal</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> pos <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Pos <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> decompose_equation <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> neg <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Neg <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> decompose_equation <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subterms_of_eq</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subterms_of_eq</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterms_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∪</span> subterms_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vars_of_eq</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vars_of_eq</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vars_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∪</span> vars_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> decompose_equation_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"decompose_equation <span class="free">e</span> <span class="free">t</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_eq <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms decompose_equation_def sup.cobounded1 sup_commute vars_of_eq.simps<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subterms_of_lit</span> 
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">subterms_of_lit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterms_of_eq <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">subterms_of_lit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterms_of_eq <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vars_of_lit</span> 
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">vars_of_lit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vars_of_eq <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">vars_of_lit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vars_of_eq <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vars_of_cl</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vars_of_cl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of_lit <span class="bound">L</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subterms_of_cl</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subterms_of_cl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_lit <span class="bound">L</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that clauses are defined as sets and not as multisets 
(identical literals are always merged).›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> clause <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal set"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ground_clause</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ground_clause</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vars_of_cl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_equation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> equation <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> <span class="tfree">'a</span> equation"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subst_equation</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_lit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> <span class="tfree">'a</span> literal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subst_lit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>subst_equation <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subst_lit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>subst_equation <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_cl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> <span class="tfree">'a</span> clause"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subst_cl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L'</span><span class="main">.</span> <span class="main">(</span><span class="bound">L'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="bound">L'</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We establish some properties of the functions returning the set of variables occurring in 
an object.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> decompose_literal_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms decompose_equation_vars decompose_literal_def vars_of_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vars_of_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vars_of_cl_lem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_variables_is_finite_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_eq <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_eq <span class="free">e</span> <span class="main">=</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_variables_is_finite_lit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_lit <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">l</span> <span class="main">=</span> <span class="main">(</span>vars_of_eq <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_variables_is_finite_cl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> vars_of_lit <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="free">C</span> <span class="main">=</span> <span class="main">⋃</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span> <span class="main">⟹</span> finite <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_Union <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="free">C</span> <span class="main">=</span> <span class="main">⋃</span> <span class="var">?S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterm_lit_vars <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of_lit <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">u</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> def_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of_eq <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> negative_literal.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> negative_literal.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
      vars_of_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vars_of_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> def_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of_eq <span class="skolem">e</span> <span class="main">=</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equation.exhaust vars_of_eq.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of_eq <span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> def_e def_ts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">t</span> <span class="main">∪</span> subterms_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">u</span> <span class="main">⊆</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE sup.coboundedI1 sup.coboundedI2 vars_subterms_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterm_vars <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of_cl <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">u</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">u</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vars_of_cl.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">u</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We establish some basic properties of substitutions.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterm_cl_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>subterms_of_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of_eq <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> subterms_of_eq <span class="skolem">e</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">t</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">x</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_eq <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">x</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">s</span> <span class="skolem">p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_eq <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of_eq <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> subterms_of_eq <span class="skolem">e</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">t</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">x</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_eq <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subterms_of <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="free">x</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">s</span> <span class="skolem">p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_eq <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_substs_yield_ground_clause<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>ground_clause <span class="var">?D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of_cl <span class="var">?D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">l</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">l</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="skolem">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">l</span> <span class="main">=</span> vars_of_eq <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_eq <span class="skolem">e</span> <span class="main">=</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="var">?t'</span> <span class="var">?s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="skolem">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l'</span> <span class="main">=</span> Pos <span class="var">?e'</span> <span class="main">∨</span> <span class="var">?l'</span> <span class="main">=</span> Neg <span class="var">?e'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l'</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l'</span> <span class="main">=</span> Pos <span class="var">?e'</span> <span class="main">∨</span> <span class="var">?l'</span> <span class="main">=</span> Neg <span class="var">?e'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of_lit <span class="var">?l'</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of_eq <span class="var">?e'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="var">?t'</span> <span class="var">?s'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of <span class="var">?t'</span> <span class="main">∪</span> vars_of <span class="var">?s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>ground_term <span class="var">?t'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span>ground_term <span class="var">?s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_eq <span class="skolem">e</span> <span class="main">=</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">l</span> <span class="main">=</span> vars_of_eq <span class="skolem">e</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">l</span> <span class="main">⊆</span> <span class="var">?V</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="var">?V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">t</span>  <span class="main">⊆</span> <span class="var">?V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="var">?V</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"ground_term <span class="var">?t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_instance <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">s</span>  <span class="main">⊆</span> <span class="var">?V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="var">?V</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"ground_term <span class="var">?s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_instance <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword2"><span class="keyword">and</span></span> iii <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_clauses_and_ground_substs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ground_on <span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> ground_term <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="skolem">L</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="skolem">L</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_eq <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vars_of_lit.elims<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_eq <span class="skolem">e</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span> <span class="main">∪</span> vars_of <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vars_of_eq.elims<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_eq <span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vars_of_instances <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span>›</span></span>  i 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">⊆</span> vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">=</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vars_of_instances <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>›</span></span> i 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">⊆</span> vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="skolem">L</span> <span class="main">=</span> Neg <span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_instance_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="free">C</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="var">?V</span> <span class="skolem">σ</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_subst_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="free">C</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="var">?V</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="var">?D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_substs_yield_ground_clause <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="skolem">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> composition_of_substs <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span>  <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> composition_of_substs_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="main">(</span>subst_equation <span class="free">e</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>subst_equation <span class="free">e</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subst_equation.simps composition_of_substs vars_of_eq.elims<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> composition_of_substs_lit <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subst_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subst_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
    composition_of_substs_eq positive_literal.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> composition_of_substs_cl <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="bound">x</span>  <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?f'</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_of_substs_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_ground_lit <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">y</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subst_equation.elims get_sign.elims<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_terms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_term <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">s</span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_terms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">s</span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">y</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_ground_clause <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C</span> <span class="free">σ</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subst_cl <span class="free">C</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> subst_lit <span class="skolem">y</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> subst_lit <span class="skolem">y</span> <span class="free">σ</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> subst_cl <span class="free">C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">x</span> <span class="free">σ</span> <span class="main">∈</span> subst_cl <span class="free">C</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> subst_lit <span class="skolem">x</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_lit <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subst_cl <span class="free">C</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_finiteness <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Finite_Set.finite_imageI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that two equal substitutions yield the same objects.›</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> subst_eq_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subst_eq <span class="free">σ</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_equation <span class="free">e</span> <span class="free">σ</span> <span class="main">=</span> subst_equation <span class="free">e</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">s</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">s</span> <span class="free">η</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="free">η</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">s</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">s</span> <span class="free">η</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="free">η</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_eq_lit <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subst_eq <span class="free">σ</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">l</span> <span class="free">σ</span> <span class="main">=</span> subst_lit <span class="free">l</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_equation <span class="skolem">e</span> <span class="free">σ</span> <span class="main">=</span> subst_equation <span class="skolem">e</span> <span class="free">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_eq_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_eq_cl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subst_eq <span class="free">σ</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C</span> <span class="free">σ</span> <span class="main">=</span> subst_cl <span class="free">C</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C</span> <span class="free">σ</span> <span class="main">≠</span> subst_cl <span class="free">C</span> <span class="free">η</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L</span> <span class="free">σ</span> <span class="main">≠</span> subst_lit <span class="skolem">L</span> <span class="free">η</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">L</span> <span class="free">σ</span> <span class="main">≠</span> subst_lit <span class="skolem">L</span> <span class="free">η</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> subst_eq_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coincide_on_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_equation <span class="free">e</span> <span class="free">σ</span> <span class="main">=</span> subst_equation <span class="free">e</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_eq <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="free">e</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="free">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_eq <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="free">e</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">s</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">s</span> <span class="free">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="free">η</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">s</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">s</span> <span class="free">η</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coincide_on_lit <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">l</span> <span class="free">σ</span> <span class="main">=</span> subst_lit <span class="free">l</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_eq <span class="skolem">e</span> <span class="main">⊆</span> vars_of_lit <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">l</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="skolem">e</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_equation <span class="skolem">e</span> <span class="free">σ</span> <span class="main">=</span> subst_equation <span class="skolem">e</span> <span class="free">η</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> coincide_on_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coincide_on_cl <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C</span> <span class="free">σ</span> <span class="main">=</span> subst_cl <span class="free">C</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C</span> <span class="free">σ</span> <span class="main">≠</span> subst_cl <span class="free">C</span> <span class="free">η</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L</span> <span class="free">σ</span> <span class="main">≠</span> subst_lit <span class="skolem">L</span> <span class="free">η</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">L</span> <span class="free">σ</span> <span class="main">≠</span> subst_lit <span class="skolem">L</span> <span class="free">η</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Interpretations are congruences on the set of terms.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fo_interpretation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">fo_interpretation</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>congruence <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">validate_ground_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> <span class="tfree">'a</span> equation  <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">validate_ground_eq</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">validate_ground_lit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> <span class="tfree">'a</span> literal  <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">validate_ground_lit</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>validate_ground_eq <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">validate_ground_lit</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>validate_ground_eq <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">validate_ground_clause</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">validate_ground_clause</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">.</span><span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>validate_ground_lit <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">L</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">validate_clause</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">validate_clause</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="main">(</span>validate_ground_clause <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">validate_clause_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binary_relation_on_trms <span class="main">⇒</span> <span class="tfree">'a</span> clause set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">validate_clause_set</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>  <span class="main">⟶</span> <span class="main">(</span>validate_clause <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">clause_entails_clause</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">clause_entails_clause</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="main">(</span>fo_interpretation <span class="bound">I</span> <span class="main">⟶</span> validate_clause <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> validate_clause <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_entails_clause</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set_entails_clause</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="main">(</span>fo_interpretation <span class="bound">I</span> <span class="main">⟶</span> validate_clause_set <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> validate_clause <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">satisfiable_clause_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>  
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">satisfiable_clause_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">I</span><span class="main">.</span> <span class="main">(</span>fo_interpretation <span class="bound">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>validate_clause_set <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We state basic properties of the entailment relation.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_entails_clause_member<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="free">S</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="skolem">I</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_clause <span class="skolem">I</span> <span class="free">C</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹validate_clause_set <span class="skolem">I</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_clause <span class="skolem">I</span> <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> instances_are_entailed <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="free">C</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="free">I</span> <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that two equivalent substitutions yield equivalent objects.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalent_on_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="free">e</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>subst_equation <span class="free">e</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>subst_equation <span class="free">e</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_eq <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span> <span class="free">I</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equivalent_on_term 
    <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_eq <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="free">e</span><span class="main">)</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span> <span class="free">I</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> equivalent_on_term <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> Eq <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def equivalence_relation_def 
    transitive_def symmetric_def reflexive_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> subst_equation.simps validate_ground_eq.simps<span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalent_on_lit <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">l</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_eq <span class="skolem">e</span> <span class="main">⊆</span> vars_of_lit <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">l</span><span class="main">)</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_eq <span class="skolem">e</span><span class="main">)</span> <span class="free">I</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>subst_equation <span class="skolem">e</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> equivalent_on_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalent_on_cl <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_cl <span class="free">C</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>validate_ground_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>validate_ground_clause <span class="free">I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">L</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">≠</span> <span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> equivalent_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="superposition">
<div class="head">
<h1>Theory superposition</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> superposition

<span class="comment1">(* N. Peltier - http://membres-lig.imag.fr/peltier/ *)</span>

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="terms.html">terms</a> <a href="equational_clausal_logic.html">equational_clausal_logic</a> <a href="well_founded_continued.html">well_founded_continued</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
 <a href="multisets_continued.html">multisets_continued</a> 

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definition of the Superposition Calculus›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extended Clauses›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An extended clause is a clause associated with a set of terms. 
The intended meaning is that the terms occurring in the attached set are assumed to be in normal 
form: any application of the superposition rule on these terms is therefore useless and can be 
blocked. Initially the set of irreducible terms attached to each clause is empty. At each inference 
step, new terms can be added or deleted from this set.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> eclause <span class="main">=</span> Ecl <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm set"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_ecl</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">subst_ecl</span> <span class="main">(</span>Ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span>   
    <span class="main">(</span>Ecl <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">{</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cl_ecl</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cl_ecl</span> <span class="main">(</span>Ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">trms_ecl</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">trms_ecl</span> <span class="main">(</span>Ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">renaming_cl</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">renaming_cl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">η</span><span class="main">.</span> <span class="main">(</span>renaming <span class="bound">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closed_under_renaming</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">closed_under_renaming</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="bound">D</span><span class="main">.</span> 
    <span class="main">(</span><span class="bound">C</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>renaming_cl <span class="bound">C</span> <span class="bound">D</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">variable_disjoint</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">variable_disjoint</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span>  <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Orders and Selection Functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We assume that the set of variables is infinite (so that shared variables can be renamed 
away) and that the following objects are given:

(i) A term ordering that is total on ground terms, well-founded and 
closed under contextual embedding and substitutions. This ordering is used as usual to orient 
equations and to restrict the application of the replacement rule.

(ii) A selection function, mapping each clause to a (possibly empty) set of negative literals. 
We assume that this selection function is closed under renamings.

(iii) A function mapping every extended clause to an order on positions, 
which contains the (reversed) prefix ordering. This order allows one to control the order in which 
the subterms are rewritten (terms occurring at minimal positions are considered with the highest 
priority). 

(iv) A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">filter_trms</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that allows one to filter away some of the terms attached to 
a given extended clause (it can be used for instance to remove terms if the set becomes too big). 
The standard superposition calculus corresponds to the case where this function always returns the 
empty set.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> basic_superposition <span class="main">=</span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">trm_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> trm <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">sel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> clause"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pos_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="main">(</span>position <span class="main">×</span> position<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">filter_trms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> trm set <span class="main">⇒</span> <span class="tfree">'a</span> trm set"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>
    trm_ord_wf <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>wf <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_ground_total <span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>ground_term <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ground_term <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> 
        <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">trm_ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_irrefl <span class="main">:</span>  <span class="quoted"><span class="quoted">"irrefl <span class="free">trm_ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_reduction_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>Comb <span class="bound">x1</span> <span class="bound">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Comb <span class="bound">x2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_reduction_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>Comb <span class="bound">y</span> <span class="bound">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Comb <span class="bound">y</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_subterm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="main">(</span>Comb <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">x2</span><span class="main">,</span><span class="main">(</span>Comb <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> trm_ord_subst <span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">(</span>subst <span class="bound">x</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="bound">y</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pos_ord_irrefl <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>irrefl <span class="main">(</span><span class="free">pos_ord</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pos_ord_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trans <span class="main">(</span><span class="free">pos_ord</span> <span class="bound">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pos_ord_prefix <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>append <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pos_ord_nil <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">≠</span> Nil<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span>Nil<span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sel_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>negative_literal <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sel_renaming<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">η</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>renaming <span class="bound">η</span> <span class="main">(</span>vars_of_cl <span class="bound">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">sel</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="free">sel</span> <span class="main">(</span>subst_cl <span class="bound">C</span> <span class="bound">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> infinite_vars<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>finite <span class="free">vars</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> filter_trms_inclusion<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">filter_trms</span> <span class="free">C</span> <span class="free">E</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide some functions to decompose a literal in a way that is compatible with the 
ordering and establish some basic properties.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">orient_lit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> sign <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">orient_lit</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> pos<span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span>
    <span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> neg<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">orient_lit_inst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> sign <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">orient_lit_inst</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> pos<span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span>
    <span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> neg<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_orient_lit<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def orient_lit_def <span class="keyword1"><span class="command">using</span></span> assms orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span> <span class="main">∧</span> vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> pos"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">t</span> <span class="main">∪</span> vars_of <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">s</span> <span class="main">∪</span> vars_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">t</span> <span class="main">∪</span> vars_of <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">s</span> <span class="main">∪</span> vars_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_inst_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span> <span class="main">∧</span> vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> pos"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">t</span> <span class="main">∪</span> vars_of <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">s</span> <span class="main">∪</span> vars_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">t</span> <span class="main">∪</span> vars_of <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> vars_of <span class="free">s</span> <span class="main">∪</span> vars_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_inst_coincide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">L1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">η</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L1</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">s</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L1</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">s</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_inst_subterms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of_lit <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Clause Ordering›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Clauses and extended clauses are ordered by transforming them into multisets of multisets 
of terms. To avoid any problem with the merging of identical literals, the multiset is assigned 
to a pair clause-substitution rather than to an instantiated clause.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first map every literal to a multiset of terms, using the usual conventions and then 
define the multisets associated with clauses and extended clauses.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mset_lit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> <span class="tfree">'a</span> trm multiset"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mset_lit</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">#}</span>"</span></span> <span class="main">|</span>
        <span class="quoted"><span class="quoted">"<span class="free">mset_lit</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">#}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mset_cl</span> 
   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mset_cl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">#}</span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mset_ecl</span> 
   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mset_ecl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> mset_ecl_and_mset_lit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span><span class="free">L</span><span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span><span class="free">L</span><span class="main">#}</span> <span class="main">=</span> mset_set <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">∈#</span> mset_set <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> insert_DiffM2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">#}</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> f1 image_mset_add_mset insert_iff mset_ecl.simps set_mset_add_mset_insert union_mset_add_mset_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ecl_ord_coincide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span> <span class="main">=</span> mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">x</span> <span class="main">⊆</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="free">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coincide_on_lit<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> equal_image_mset 
  <span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"cl_ecl <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  mset_ecl.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Literal and clause orderings are obtained as usual as the multiset extensions of the term 
ordering.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lit_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> literal <span class="main">×</span> <span class="tfree">'a</span> literal<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">lit_ord</span> <span class="main">=</span>  
    <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>mset_lit <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_trm_ord_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  mult_def transI transitive_closure_trans<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans  lit_ord"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> basic_superposition.lit_ord_def basic_superposition_axioms 
    case_prodD case_prodI mem_Collect_eq mult_def transI transitive_closure_trans<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> trm_ord_wf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> lit_ord_def 
        <span class="keyword2"><span class="keyword">and</span></span> measure_wf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="quoted">lit_ord</span> <span class="quoted">mset_lit</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ecl_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> eclause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> eclause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">ecl_ord</span> <span class="main">=</span>  
    <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>mset_ecl <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_ecl <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ecl_ord_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> eclause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> eclause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">ecl_ord_eq</span> <span class="main">=</span>  
    ecl_ord <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mset_ecl <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cl_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">cl_ord</span> <span class="main">=</span>  
    <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>mset_cl <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl  <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cl_ord_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">cl_ord_eq</span> <span class="main">=</span>  cl_ord <span class="main">∪</span> 
    <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mset_cl  <span class="bound">y</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_mult_trm_ord_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  mult_def transI transitive_closure_trans<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ecl_ord_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans  ecl_ord"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> basic_superposition.ecl_ord_def basic_superposition_axioms case_prodD 
    case_prodI mem_Collect_eq mult_def transI transitive_closure_trans<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_ord_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans cl_ord"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> basic_superposition.cl_ord_def basic_superposition_axioms case_prodD 
    case_prodI mem_Collect_eq mult_def transI transitive_closure_trans<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_ord_eq_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans cl_ord_eq"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> trans <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">pa</span> <span class="bound">pb</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">,</span> <span class="bound">pa</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">pb</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pb</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> <span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ppa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> <span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ppb</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> <span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> literal set <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> trans <span class="bound">r</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">pa</span> <span class="bound">pb</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pa</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">pb</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pb</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>trans <span class="bound">r</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="bound">r</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ppa</span> <span class="bound">r</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">pp</span> <span class="bound">r</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pa</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">p</span><span class="main">,</span> mset_cl <span class="bound">pa</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cl_ord_def cl_ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pa</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">p</span> <span class="main">=</span> mset_cl <span class="bound">pa</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pa</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">p</span> <span class="main">=</span> mset_cl <span class="bound">pa</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">pa</span><span class="main">)</span> <span class="main">⇒</span> mset_cl <span class="bound">p</span> <span class="main">=</span> mset_cl <span class="bound">pa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> mset_cl <span class="main">(</span><span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> mset_cl <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> mset_cl <span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_cl <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> mset_cl <span class="main">(</span><span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_cl <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> mset_cl <span class="main">(</span><span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>mset_cl <span class="bound">pa</span><span class="main">,</span> mset_cl <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">ppa</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">pp</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ppb</span> <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>cl_ord <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">pa</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> mset_cl <span class="bound">pa</span> <span class="main">=</span> mset_cl <span class="bound">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cl_ord_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_ecl_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf ecl_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_wf <span class="keyword2"><span class="keyword">and</span></span> wf_mult  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_mult  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> ecl_ord_def 
        <span class="keyword2"><span class="keyword">and</span></span> measure_wf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">ecl_ord</span> <span class="quoted">mset_ecl</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximal_literal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">maximal_literal</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> lit_ord<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eligible_literal</span> 
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">eligible_literal</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="free">sel</span><span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
    <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="main">(</span>subst_lit <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strictly_maximal_literal</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">strictly_maximal_literal</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>  <span class="main">=</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">}</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lower_or_eq</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower_or_eq</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eligible_literal_coincide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="free">L</span> <span class="free">C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="free">L</span> <span class="free">C</span> <span class="free">σ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coincide_on_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of_lit <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ'</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ'</span><span class="main">)</span>  <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next definition extends the ordering to substitutions.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lower_on</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower_on</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> 
  <span class="main">(</span>lower_or_eq <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now establish some properties of the ordering relations.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_or_eq_monotonic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="free">t1</span> <span class="free">s1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="free">t2</span> <span class="free">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>Comb <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lower_or_eq_def <span class="keyword1"><span class="command">using</span></span> trm_ord_reduction_left trm_ord_reduction_right
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lower_or_eq_def trm_ord_trans transD<span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> lower_on_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">η</span><span class="main">.</span> lower_on <span class="bound">σ</span> <span class="bound">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">(</span>lower_or_eq <span class="main">(</span>subst <span class="free">t</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
     <span class="keyword1"><span class="command">unfolding</span></span> lower_or_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">σ</span> <span class="bound">η</span><span class="main">.</span> lower_on <span class="bound">σ</span> <span class="bound">η</span> <span class="main">(</span>vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">(</span>lower_or_eq <span class="main">(</span>subst  <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span>subst  <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="skolem">η</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="skolem">σ</span> <span class="skolem">η</span> <span class="main">(</span>vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="skolem">σ</span> <span class="skolem">η</span> <span class="main">(</span>vars_of <span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="skolem">σ</span> <span class="skolem">η</span> <span class="main">(</span>vars_of <span class="skolem">t2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="skolem">σ</span> <span class="skolem">η</span> <span class="main">(</span>vars_of <span class="skolem">t1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst <span class="skolem">t1</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="skolem">σ</span> <span class="skolem">η</span> <span class="main">(</span>vars_of <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_or_eq <span class="main">(</span>subst <span class="skolem">t1</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹lower_or_eq <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst  <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lower_or_eq_monotonic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> diff_substs_yield_diff_trms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of <span class="free">t</span><span class="main">)</span>
   <span class="main">⟹</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span> <span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of  <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of  <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span>  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst  <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
   <span class="main">⟹</span> <span class="main">(</span>subst  <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst  <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of  <span class="main">(</span>Const <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>
   <span class="main">⟹</span> <span class="main">(</span>subst  <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst  <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t1</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Comb.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_subst_yields_lower_trms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> vars_of <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lower_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> diff_substs_yield_diff_trms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹lower_or_eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lower_or_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_on_lit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of_lit <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> def_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">|</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mset_lit.cases<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> def_l <span class="keyword1"><span class="command">have</span></span> def_ms_l<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{#</span> <span class="skolem">t</span><span class="main">,</span><span class="skolem">s</span> <span class="main">#}</span> <span class="main">∨</span> mset_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{#</span> <span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> def_l  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> def_l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">η</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lower_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_lit <span class="free">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> all_lower<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>subst  <span class="bound">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> 
  <span class="main">∨</span> <span class="main">(</span>subst  <span class="bound">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{#</span> <span class="skolem">t</span><span class="main">,</span><span class="skolem">s</span> <span class="main">#}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_single insert_DiffM2 insert_noteq_member not_gr0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>mset_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{#</span> <span class="skolem">t</span><span class="main">,</span><span class="skolem">s</span> <span class="main">#}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> def_ms_l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{#</span> <span class="skolem">t</span><span class="main">,</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> not_gr0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>subst  <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> 
  <span class="main">∨</span> <span class="main">(</span>subst  <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lower_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lower_or_eq_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_or_eq <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lower_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lower_or_eq_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> sl_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst <span class="bound">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of_lit <span class="free">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> def_l <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lower_subst_yields_lower_trms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lower_subst_yields_lower_trms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> all_lower sl_exists <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">‹mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">#}</span>›</span></span> 
  <span class="quoted"><span class="quoted">‹mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">η</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">#}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?M1</span><span class="main">,</span><span class="var">?M2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl image_mset_ordering 
                        <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?M1</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="var"><span class="quoted"><span class="var">?M2</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst <span class="bound">x</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_on_lit_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>coincide_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="free">L</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="free">L</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
  <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def lower_or_eq_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="free">L</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lower_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_on_cl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M1</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_ecl.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M2</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_ecl.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="var">?f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?f1</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst_lit <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lower_on_lit_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="var">?f1</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?f2</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?f1</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?f2</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irreflI trm_ord_wf wf_mult<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="var">?f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars_of_lit <span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?M</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">u</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> vars_of_lit <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">u</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst_lit <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lower_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="var">?f1</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?f2</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> i ii  <span class="quoted"><span class="quoted">‹<span class="var">?M1</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?f1</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">#}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M2</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?f2</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈#</span> <span class="var">?M</span> <span class="main">#}</span>›</span></span> <span class="quoted"><span class="quoted">‹irrefl <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?M1</span><span class="main">,</span><span class="var">?M2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> image_mset_ordering <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?M1</span></span></span> <span class="var"><span class="quoted"><span class="var">?f1</span></span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="var"><span class="quoted"><span class="var">?M2</span></span></span> <span class="var"><span class="quoted"><span class="var">?f2</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ecl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterm_trm_ord <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span>  <span class="bound">s</span><span class="main">.</span> 
           subterm <span class="bound">t</span> <span class="free">p</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  
          <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Nil <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Nil"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> Nil"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Nil"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> Nil"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterm_trm_ord_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t</span> <span class="free">p</span> <span class="free">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Nil"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> Nil"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subterm_trm_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_of_trm_ord_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> subterms_of <span class="free">t</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t</span> <span class="skolem">p</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subterm_trm_ord_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subt_trm_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≺</span> <span class="free">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≺</span> Var <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≺</span> Const <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span>Const <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> 
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≺</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">t</span><span class="main">,</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">≺</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≺</span> <span class="skolem">t1</span> <span class="main">∨</span> <span class="free">t</span> <span class="main">≺</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">t</span><span class="main">,</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Comb.IH trm_ord_subterm trm_ord_trans trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_ord_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> vars_of <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="free">t</span> <span class="var">?σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free">s</span> <span class="var">?σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">s</span> <span class="var">?θ</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="var">?σ</span> <span class="var">?θ</span> <span class="var">?V</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coincide_on <span class="var">?σ</span> <span class="var">?θ</span> <span class="var">?V</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?V</span>"</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?σ</span> <span class="main">≠</span> subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?θ</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?σ</span> <span class="main">≠</span> subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="var">?θ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assoc.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subst.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> vars_of <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?V</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="free">s</span> <span class="var">?θ</span> <span class="main">=</span> <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">s</span> <span class="var">?σ</span> <span class="main">=</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="main">≺</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> subst <span class="free">s</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹subst <span class="free">s</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">s</span>›</span></span> trm_ord_wf vars_iff_occseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> subt_trm_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="skolem">x</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span><span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_trans trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free">s</span> <span class="var">?σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="free">s</span> <span class="var">?σ</span> <span class="main">=</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?σ</span> <span class="main">=</span> <span class="free">s</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_on_ground<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">σ</span> <span class="free">η</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_on  <span class="free">V</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_on  <span class="free">V</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ground_on <span class="free">V</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def lower_or_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">⊆</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_ord_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> replacement_monotonic <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span>  <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> 
          <span class="main">⟹</span> subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">u</span> <span class="main">⟹</span> replace_subterm <span class="bound">t</span> <span class="free">p</span> <span class="free">v</span> <span class="bound">s</span> 
          <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>subst <span class="bound">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> Nil <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> Nil <span class="free">v</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="free">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">u</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Left›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">t1'</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t1</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t1'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t1'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t1</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.IH Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1'</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trm_ord_reduction_left<span class="main">)</span>   
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">u</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Right›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">s</span>›</span></span>  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t2'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Comb <span class="skolem">t1</span> <span class="skolem">t2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t2</span> <span class="skolem">q</span> <span class="free">v</span> <span class="skolem">t2'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t2'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.IH Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">t1</span> <span class="skolem">t2'</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trm_ord_reduction_right<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_lit_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">{#</span> <span class="main">(</span>subst <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"positive_literal <span class="free">L</span> <span class="main">∨</span> negative_literal <span class="free">L</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> negative_literal.simps<span class="main">(</span>2<span class="main">)</span> positive_literal.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"positive_literal <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equation.exhaust positive_literal.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"negative_literal <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equation.exhaust negative_literal.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_irrefl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="main">,</span><span class="free">L</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lit_ord_wf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="main">,</span><span class="free">M</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst_lit <span class="free">M</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="var">?f</span> <span class="bound">t</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">L</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_lit <span class="free">M</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="var">?L</span><span class="main">,</span><span class="var">?M</span> <span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> monotonic_fun_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mset_lit_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="free">M</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mset_lit_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> l m iii <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> args_are_strictly_lower<span class="main">:</span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_compound <span class="free">t</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lhs <span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∧</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_compound.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> trm_ord_subterm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mset_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> subst_cl <span class="free">D</span> <span class="free">θ</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span><span class="main">,</span>mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">D</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">x</span>  <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subst_eq_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="free">D</span><span class="main">)</span> <span class="main">⊆#</span>  <span class="main">{#</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="free">D</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mset_set_mset_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span>  <span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_mset_subseteq_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="free">D</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mset_image_comp <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword1"><span class="command">have</span></span>
    iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="free">D</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?h</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="free">D</span><span class="main">)</span>  <span class="main">#}</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> equal_image_mset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> iii 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?h</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="free">D</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this 
    <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span><span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="free">D</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span> mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> subst_lit <span class="bound">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">`</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> iv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">η</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="free">C'</span> <span class="main">#}</span> <span class="main">⊆#</span> mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span> <span class="free">η</span><span class="main">)</span> <span class="main">⊆#</span> mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> multiset_order_inclusion_eq mult_trm_ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_lit_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> ground_clause <span class="free">C</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="bound">L</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> emptyI
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> ground_clause <span class="skolem">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="bound">L</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> ground_clause <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="bound">L</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="bound">L</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="skolem">a</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">using</span></span> lit_ord_irrefl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> vars_of_cl <span class="skolem">A</span> <span class="main">∪</span> vars_of_lit <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="skolem">b</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> 
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="skolem">a</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lit_ord_wf maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> 
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>maximal_literal <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> 
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">a'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">b</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a'</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">a'</span><span class="main">)</span> <span class="main">∈</span> lit_ord›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def
          <span class="keyword1"><span class="command">using</span></span> mult_def trancl_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">b</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="skolem">b</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We deduce that a clause contains at least one eligible literal.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eligible_lit_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>eligible_literal <span class="bound">L</span> <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="skolem">L</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_lit_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">L</span> <span class="var">?C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">using</span></span> sel_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmata provide various ways of proving that literals are ordered, depending 
on the relations between the terms they contain.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_dominating_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s1</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∨</span> <span class="main">(</span><span class="free">s1</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x1</span> <span class="free">s1</span> <span class="free">t1</span> <span class="free">p1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x2</span> <span class="free">s2</span> <span class="free">t2</span> <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="free">x1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s1</span> <span class="free">t1</span> <span class="free">p1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s1</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s2</span> <span class="free">t2</span> <span class="free">p2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s2</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s1</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">s1</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s2</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> <span class="free">s2</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s2</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s1</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> o2 trm_ord_trans transE<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword2"><span class="keyword">and</span></span> o2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_trans 
     trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">s1</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    s2max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈#</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span> <span class="main">⊂#</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span> <span class="main">⊂#</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>›</span></span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span> <span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> trm_ord_trans multiset_order_inclusion <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">trm_ord</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="free">p1</span> <span class="main">=</span> pos"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s1</span> <span class="free">t1</span> <span class="free">p1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s1</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="free">p2</span> <span class="main">=</span> pos"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">=</span> neg"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s2</span> <span class="free">t2</span> <span class="free">p2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s2</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> s2max <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span> <span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span> <span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">=</span> pos"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s2</span> <span class="free">t2</span> <span class="free">p2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s2</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> s2max <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span> <span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s1</span> <span class="free">t1</span> <span class="free">p1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s1</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="free">p2</span> <span class="main">=</span> pos"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">=</span> neg"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s2</span> <span class="free">t2</span> <span class="free">p2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s2</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> s2max <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span> <span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span> <span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">=</span> pos"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s2</span> <span class="free">t2</span> <span class="free">p2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s2</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> s2max <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s2</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">s2</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_neg_lit_lhs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> pos"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x2</span> <span class="free">s</span> <span class="free">t2</span> neg"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> pos›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s</span> <span class="free">t2</span> neg›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> smax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈#</span> <span class="main">{#</span> <span class="free">t1</span> <span class="main">#}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> smax <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_neg_lit_rhs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> pos"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x2</span> <span class="free">t2</span> <span class="free">s</span> neg"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> pos›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">t2</span> <span class="free">s</span> neg›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> smax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈#</span> <span class="main">{#</span> <span class="free">t1</span> <span class="main">#}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> smax <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lit_ord_rhs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">x2</span> <span class="free">s</span> <span class="free">t2</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">x2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
    <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_lit <span class="free">x2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> pos"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s</span> <span class="free">t2</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="main">{#</span><span class="free">t1</span><span class="main">#}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neg"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x1</span> <span class="free">s</span> <span class="free">t1</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x1</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> neg›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">x2</span> <span class="free">s</span> <span class="free">t2</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mset_lit.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈#</span> <span class="main">{#</span><span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">#}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="free">t2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t2</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">t1</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword2"><span class="keyword">and</span></span> ii <span class="keyword2"><span class="keyword">and</span></span> max <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult1_def_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span><span class="main">]</span>
        mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">,</span> <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mset_ordering_add1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="free">t1</span><span class="main">,</span><span class="free">t1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">{#</span> <span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">s</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m1 <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that the replacement of a term by an equivalent term preserves the semantics.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_preserves_eq_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 
    fo_interpretation_def congruence_def equivalence_relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">I</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> transitive_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_preserves_lit_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t1</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="main">(</span>mk_lit <span class="free">polarity</span> <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transitive <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 
    fo_interpretation_def congruence_def equivalence_relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> mk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mk_lit <span class="free">polarity</span> <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">I</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> transitive_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> mk <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">I</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> transitive_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> mk <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> mk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mk_lit <span class="free">polarity</span> <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t2</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">t1</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">I</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> transitive_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> mk <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t1</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">I</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">t2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> transitive_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> mk <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_dominated <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="free">L</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of_cl <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">u</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="free">L</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vars_of_cl.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="skolem">L'</span> <span class="skolem">t'</span> <span class="skolem">s'</span> <span class="skolem">p'</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">t'</span> <span class="main">∪</span> subterms_of <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_commute mset_lit.cases subterms_of_eq.simps subterms_of_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          subterms_of_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> trm_ord_wf wf_asym<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">t'</span> <span class="main">∪</span> subterms_of <span class="skolem">s'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">t'</span> <span class="main">∨</span> <span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">∨</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> subterms_of_trm_ord_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> neg_h <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">u</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹vars_of <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">∨</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L'</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="skolem">L'</span> <span class="skolem">t'</span> <span class="skolem">s'</span> <span class="skolem">p'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="main">,</span><span class="skolem">L'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_dominating_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> subterms_of <span class="skolem">s'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">∨</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> subterms_of_trm_ord_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="skolem">s'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> neg_h <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">u</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹vars_of <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">∨</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L'</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="skolem">L'</span> <span class="skolem">t'</span> <span class="skolem">s'</span> <span class="skolem">p'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="main">,</span><span class="skolem">L'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_dominating_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A term dominates an expression if the expression contains no strictly greater subterm:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dominate_eq</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> equation <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">dominate_eq</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dominate_lit</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> literal <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">dominate_lit</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dominate_eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">dominate_lit</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dominate_eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dominate_cl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">dominate_cl</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">(</span>dominate_lit <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">no_disequation_in_cl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">no_disequation_in_cl</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> 
    <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">no_taut_eq_in_cl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">no_taut_eq_in_cl</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eq_occurs_in_cl</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">eq_occurs_in_cl</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">L</span> <span class="bound">t'</span> <span class="bound">s'</span> pos <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> subst <span class="bound">t'</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> subst <span class="bound">s'</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inference Rules›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the rules of the superposition calculus. Standard superposition is 
a refinement of the paramodulation rule based on the following ideas: 

(i) the replacement of a term by a bigger term is forbidden; 

(ii) the replacement can be performed only in the maximal term of a maximal (or selected) literal; 

(iii) replacement of variables is forbidden.

Our definition imposes additional conditions on the positions on which the replacements
are allowed: any superposition inference inside a term occurring in the set attached to the 
extended clause is blocked.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We consider two different kinds of inferences: ground or first-order. Ground inferences
are those needed for completeness, first-order inferences are those actually used 
by theorem provers. For conciseness, these two notions of inferences are defined simultaneously, 
and a parameter is added to the corresponding functions to determine whether the 
inference is ground or first-order.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> inferences <span class="main">=</span> Ground <span class="main">|</span> FirstOrder 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function checks whether a given substitution is a unifier of two terms.
If the inference is first-order then the unifier must be maximal.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ck_unifier</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ck_unifier</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">type</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">type</span></span></span> <span class="main">=</span> FirstOrder<span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>MGU <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>Unifier <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ck_unifier_thm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="free">t</span> <span class="free">s</span> <span class="free">σ</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms MGU_is_Unifier ck_unifier_def Unifier_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_preserve_ck_unifier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="free">t</span> <span class="free">s</span> <span class="free">σ</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="free">t</span> <span class="free">s</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span> Ground"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ck_unifier_thm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function checks whether a given term is allowed to be reduced according to the 
strategy described above, i.e., that it does not occur in the set of terms associated with 
the clause (we do not assume that the set of irreducible terms is closed under subterm
thus we use the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"occurs_in"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> instead of a mere membership test.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">allowed_redex</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">allowed_redex</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">.</span> 
    <span class="main">(</span>occurs_in <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>subst <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function allows one to compute the set of irreducible terms attached to
the conclusion of an inference. The computation depends on the type of the considered inference: 
for ground inferences the entire set of irreducible terms is kept. For first-order inferences, 
the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">filter_trms</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is called to remove some of the terms 
(see also the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">dom_trms</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> below).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_trms</span>
  <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">get_trms</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> FirstOrder<span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">filter_trms</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following definition provides the conditions that allow one to propagate irreducible
terms from the parent clauses to the conclusion. A term can be propagated if it is strictly lower 
than a term occurring in the derived clause, or if it occurs in a negative literal of the derived 
clause. Note that this condition is slightly more restrictive than that of the basic superposition 
calculus, because maximal terms occurring in maximal positive literals cannot be kept in the set of 
irreducible terms. However in our definition, terms can be propagated even if they do not occur in 
the parent clause or in the conclusion. Extended clauses whose set of irreducible terms fulfills 
this property are called well-constrained.›</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_trm</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dom_trm</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> <span class="main">(</span>decompose_literal <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="bound">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom_trm_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="free">t</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span>   assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> subterms_of_lit <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def decompose_equation_def <span class="keyword1"><span class="command">using</span></span> root_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_trms</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dom_trms</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>dom_trm <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom_trms_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dom_trms <span class="free">C</span> <span class="free">E</span> <span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> dom_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dom_trm_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="free">t</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_cl <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decompose_literal_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">well_constrained</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">well_constrained</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> trms_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> dom_trm <span class="bound">y</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next function allows one to check that a set of terms is in normal form. 
The argument <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes the function mapping a term to its normal form 
(we do not assume that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is compatible with the term structure at this point).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_trms_irreducible</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">all_trms_irreducible</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟶</span> occurs_in <span class="bound">y</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Superposition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the superposition rule. Note that we assume that the parent clauses are
variable-disjoint, but we do not explicitly rename them at this point, thus for completeness
we will have to assume that the clause sets are closed under renaming. During the application 
of the rule, all the terms occurring at a position that is lower than that of the reduced
term can be added in the set of irreducible terms attached to the conclusion (the intuition is that
we assume that the terms occurring at minimal positions are reduced first). 
In particular, every proper subterm of the reduced term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">u'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is added in the set of 
irreducible terms, thus every application of the superposition rule in a term introduced 
by unification will be blocked.

Clause <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the ``into'' clause and clause <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the ``from'' clause.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">superposition</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> inferences <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">superposition</span> <span class="free"><span class="bound"><span class="entity">P1</span></span></span> <span class="free"><span class="bound"><span class="entity">P2</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">L</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">M</span> <span class="bound">p</span> <span class="bound">Cl_P1</span> <span class="bound">Cl_P2</span> <span class="bound">Cl_C</span> <span class="bound">polarity</span> <span class="bound">t'</span> <span class="bound">u'</span> <span class="bound">L'</span> <span class="bound">trms_C</span><span class="main">.</span> 
      <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="bound">Cl_P1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">M</span> <span class="main">∈</span> <span class="bound">Cl_P2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>eligible_literal <span class="bound">L</span> <span class="free"><span class="bound"><span class="entity">P1</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span>eligible_literal <span class="bound">M</span> <span class="free"><span class="bound"><span class="entity">P2</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>variable_disjoint <span class="free"><span class="bound"><span class="entity">P1</span></span></span> <span class="free"><span class="bound"><span class="entity">P2</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_P1</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_P2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P2</span></span></span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> is_a_variable <span class="bound">u'</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span>allowed_redex <span class="bound">u'</span> <span class="free"><span class="bound"><span class="entity">P1</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="bound">Cl_C</span> <span class="main">(</span>dom_trms <span class="bound">Cl_C</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">P1</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">P2</span></span></span><span class="main">)</span> <span class="main">∪</span> 
          <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free"><span class="bound"><span class="entity">P1</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="bound">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="bound">Cl_C</span> <span class="bound">trms_C</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">M</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">L</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">polarity</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span>subterm <span class="bound">t</span> <span class="bound">p</span> <span class="bound">u'</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span>ck_unifier <span class="bound">u'</span> <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span>replace_subterm <span class="bound">t</span> <span class="bound">p</span> <span class="bound">v</span> <span class="bound">t'</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> FirstOrder<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="bound">M</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="bound">L</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord<span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> FirstOrder<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>strictly_maximal_literal <span class="free"><span class="bound"><span class="entity">P2</span></span></span> <span class="bound">M</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="bound">L'</span> <span class="main">=</span> mk_lit <span class="bound">polarity</span> <span class="main">(</span>Eq <span class="bound">t'</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="bound">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="bound">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="bound">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Reflexion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the Reflexion rule, which deletes contradictory literals (after unification). 
All the terms occurring in these literals can be added into the set of irreducible terms
(intuitively, we can assume that these terms have been normalized before applying the rule). 
It is sufficient to add the term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, since every term occurring in the considered literal 
is a subterm of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (after unification).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reflexion</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> inferences <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">reflexion</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">L1</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">Cl_P</span> <span class="bound">Cl_C</span> <span class="bound">trms_C</span><span class="main">.</span>
      <span class="main">(</span>eligible_literal <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="bound">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">L1</span> <span class="bound">t</span> <span class="bound">s</span> neg <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>ck_unifier <span class="bound">t</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="bound">Cl_C</span> <span class="bound">trms_C</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="bound">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="bound">Cl_C</span> 
          <span class="main">(</span>dom_trms <span class="bound">Cl_C</span> <span class="main">(</span>subst_set <span class="main">(</span> <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="bound">t</span> <span class="main">}</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Factorization›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the equational factorization rule, which merges two equations sharing the 
same left-hand side (after unification), if the right-hand sides are equivalent. 
Here, contrarily to the previous rule, the term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> cannot be added into the set of 
irreducible terms, because we cannot assume that this term is in normal form (e.g., the application
of the equational factorization rule may yield a new rewrite rule of left-hand side <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). 
However, all proper subterms of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be added.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">factorization</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> inferences <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">factorization</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L'</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">Cl_P</span> <span class="bound">Cl_C</span> <span class="bound">trms_C</span><span class="main">.</span>
      <span class="main">(</span>eligible_literal <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="bound">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">L1</span> <span class="bound">t</span> <span class="bound">s</span> pos <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">L2</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>ck_unifier <span class="bound">t</span> <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="bound">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="bound">s</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="bound">Cl_C</span> <span class="bound">trms_C</span><span class="main">)</span>
      <span class="main">∧</span> <span class="bound">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="bound">Cl_C</span> 
          <span class="main">(</span>dom_trms <span class="bound">Cl_C</span> <span class="main">(</span>subst_set <span class="main">(</span> <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="bound">t</span><span class="main">)</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="bound">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="bound">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derivations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the set of derivable clauses by induction. Note that redundancy criteria 
are not taken into account at this point. Our definition of derivations also covers renaming.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">derivable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause set 
  <span class="main">⇒</span> <span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> inferences <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">derivable</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span><span class="main">,</span> <span class="bound">P2</span> <span class="main">}</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivable_premisses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">derivable_ecl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause set  <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    init <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">derivable_ecl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span> 
    rn <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">derivable_ecl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>renaming_cl <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">derivable_ecl</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span> 
    deriv <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free">derivable_ecl</span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟹</span> <span class="main">(</span>derivable <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> FirstOrder <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">derivable_ecl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a notion of instance by associating clauses with ground substitutions.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instances</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> eclause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">instances</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">C</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>  <span class="main">∧</span> <span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span> <span class="bound">C</span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">clset_instances</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> eclause <span class="main">×</span> <span class="tfree">'a</span> subst<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> clause set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">clset_instances</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">C</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">grounding_set</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">grounding_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we prove that the conclusion of every inference rule is a logical 
consequence of the premises. Thus a clause set is unsatisfiable if the empty clause is derivable. 
For each rule, we first prove that all ground instances of the conclusion are entailed by 
the corresponding instances of the parent clauses, then we lift the result to first-order clauses. 
The proof is standard and straightforward, but note that we also prove that the derived 
clauses are finite and well-constrained.›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> cannot_validate_contradictary_literals <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_lit <span class="free">I</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"congruence <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">t</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> congruence_def reflexive_def equivalence_relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_reflexion_is_sound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="free">C</span> <span class="free">D</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"clause_entails_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>clause_entails_clause <span class="var">?C'</span> <span class="var">?D'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="var">?C'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?D'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="free">σ</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> reflexion_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl 
        <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_instance_exists <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span><span class="main">]</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?CC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="free">σ</span> <span class="free">θ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="var">?σ''</span> <span class="skolem">η</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?CC</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="var">?σ''</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?CC</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="var">?CC</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i validate_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> <span class="var">?CC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">∈</span> <span class="var">?CC</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?CC</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_cl.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">l</span> <span class="free">σ</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">l</span> <span class="free">σ</span> <span class="main">∉</span> <span class="var">?D</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?D</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">L1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="free">σ</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">s</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ck_unifier_thm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span> <span class="main">=</span>
      subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> subst <span class="skolem">s</span> <span class="var">?σ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> cannot_validate_contradictary_literals <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">I</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> subst_lit <span class="skolem">l</span> <span class="var">?σ'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">l</span> <span class="free">σ</span> <span class="main">∈</span> <span class="var">?D</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> subst_lit <span class="skolem">l</span> <span class="var">?σ'</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subst_cl.simps composition_of_substs_lit mem_Collect_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_clause <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_clause validate_clause.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflexion_is_sound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="free">C</span> <span class="free">D</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"clause_entails_clause <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>clause_entails_clause <span class="var">?C</span> <span class="var">?D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="var">?C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?D</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> D_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> instances_are_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ground_reflexion_is_sound <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> D_false <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
    substs_preserve_ground_clause validate_clause.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_semantics_pos <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">l</span> <span class="free">u</span> <span class="free">v</span> pos <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst <span class="free">u</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst <span class="free">v</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">v</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="free">I</span> <span class="main">(</span>Eq <span class="var">?u</span> <span class="var">?v</span><span class="main">)</span> <span class="main">∨</span> validate_ground_eq <span class="free">I</span> <span class="main">(</span>Eq <span class="var">?v</span> <span class="var">?u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="var">?u</span> <span class="var">?v</span> <span class="main">∨</span> <span class="free">I</span> <span class="var">?v</span> <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="free">I</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="var">?u</span> <span class="var">?v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def equivalence_relation_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_semantics_neg <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">l</span> <span class="free">u</span> <span class="free">v</span> neg <span class="free">θ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst <span class="free">u</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst <span class="free">v</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="free">v</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>Eq <span class="var">?u</span> <span class="var">?v</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span>validate_ground_eq <span class="free">I</span> <span class="main">(</span>Eq <span class="var">?v</span> <span class="var">?u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="var">?u</span> <span class="var">?v</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">I</span> <span class="var">?v</span> <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="free">I</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="var">?u</span> <span class="var">?v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def equivalence_relation_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orient_lit_semantics_replacement <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">l</span> <span class="free">u</span> <span class="free">v</span> <span class="free">polarity</span> <span class="free">θ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">u'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="main">(</span>mk_lit <span class="free">polarity</span> <span class="main">(</span>Eq <span class="free">u'</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> Pos <span class="skolem">e</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> Neg <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> Eq <span class="free">u</span> <span class="free">v</span> <span class="main">∨</span> <span class="skolem">e</span> <span class="main">=</span> Eq <span class="free">v</span> <span class="free">u</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">u'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>subst <span class="free">u'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def 
      congruence_def equivalence_relation_def symmetric_def transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="free">I</span> <span class="main">(</span>subst_lit <span class="free">l</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_neg
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I</span> <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">u'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>subst <span class="free">u'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def 
      congruence_def equivalence_relation_def symmetric_def transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_factorization_is_sound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"factorization <span class="free">C</span> <span class="free">D</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"clause_entails_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> clause_entails_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="free">σ</span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?D</span> <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span> <span class="main">≠</span> <span class="skolem">L2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> factorization_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl 
        <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_instance_exists <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span><span class="main">]</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?CC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="free">σ</span> <span class="free">θ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="var">?σ''</span> <span class="skolem">η</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?CC</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="var">?σ''</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?CC</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="var">?CC</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i validate_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> <span class="var">?CC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">∈</span> <span class="var">?CC</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?CC</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_cl.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> substs_preserve_ground_clause validate_clause.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_clause <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?D</span> <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> 
      <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span><span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>
       <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">l</span> <span class="free">σ</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">l</span> <span class="free">σ</span> <span class="main">∉</span> <span class="var">?D</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?D</span> <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">L2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="free">σ</span>  <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ck_unifier_thm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span> <span class="main">=</span>
      subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="var">?σ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="skolem">l</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">L2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_pos 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def equivalence_relation_def 
        symmetric_def transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="var">?σ'</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="skolem">I</span> <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def equivalence_relation_def 
        symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="skolem">I</span> <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_eq <span class="skolem">I</span> <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">‹validate_ground_eq <span class="skolem">I</span> <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?D</span> <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">≠</span> <span class="skolem">L2</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> 
        <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">l</span> <span class="free">σ</span> <span class="main">∈</span> <span class="var">?D</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> subst_lit <span class="skolem">l</span> <span class="var">?σ'</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subst_cl.simps composition_of_substs_lit mem_Collect_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> factorization_is_sound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"factorization <span class="free">C</span> <span class="free">D</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"clause_entails_clause <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>clause_entails_clause <span class="var">?C</span> <span class="var">?D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="var">?C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?D</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> D_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> instances_are_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?D</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ground_factorization_is_sound <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> D_false <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
    substs_preserve_ground_clause validate_clause.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ground_superposition_is_sound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"superposition <span class="free">P1</span> <span class="free">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_entails_clause 
    <span class="main">{</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">,</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="main">}</span>
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> set_entails_clause 
    <span class="main">{</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">,</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="main">}</span>
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert_iff validate_clause_set.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">polarity</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">L'</span></span>   <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="free">σ</span> <span class="free">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="var">?P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="var">?P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> superposition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P2'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?P1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?P2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vars</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of_cl <span class="var">?P1'</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>vars_of_cl <span class="var">?P2'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?P1'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_cl <span class="var">?P1'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P1'</span></span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?P2'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_cl <span class="var">?P2'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P2'</span></span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>vars_of_cl <span class="var">?P1'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>vars_of_cl <span class="var">?P2'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?vars</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="var">?vars</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_subst_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="var">?P1'</span><span class="main">)</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl 
        <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>  
       <span class="keyword1"><span class="command">using</span></span> ground_substs_yield_ground_clause
        <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_on <span class="var">?vars</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="var">?P2'</span><span class="main">)</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl 
        <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>  
       <span class="keyword1"><span class="command">using</span></span> ground_substs_yield_ground_clause 
        <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?P1'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P2''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?P2'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="free">σ</span> <span class="free">θ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"comp <span class="var">?σ''</span> <span class="skolem">η</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P1''</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="var">?σ''</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P1''</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="var">?P1''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  validate_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">∈</span> <span class="var">?P1''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="skolem">l1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P2''</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="var">?σ''</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P2''</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="var">?P2''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  validate_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">∈</span> <span class="var">?P2''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="skolem">l2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l1'</span> <span class="main">∈</span> <span class="var">?P1''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P1''</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">∈</span> <span class="var">?P1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l1</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_cl.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l2'</span> <span class="main">∈</span> <span class="var">?P2''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P2''</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">∈</span> <span class="var">?P2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l2</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_cl.simps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_ground_clause <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?C</span> <span class="free">θ</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="var">?C'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">=</span> <span class="skolem">L</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≠</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l1</span> <span class="main">∈</span> <span class="var">?P1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="var">?P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="var">?P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">l1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">l1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="main">∈</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l1'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l1</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">∈</span> <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> composition_of_substs_lit<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l1'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">=</span> <span class="skolem">M</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≠</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l2</span> <span class="main">∈</span> <span class="var">?P2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="var">?P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="var">?P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">l2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">l2</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="main">∈</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l2'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l2</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">∈</span> <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> composition_of_substs_lit<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l2'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="skolem">I</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l2</span> <span class="main">=</span> <span class="skolem">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l2'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l2'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l2</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="free">σ</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ck_unifier_thm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span> <span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> composition_of_substs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">using</span></span> replacement_preserves_congruences <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="var"><span class="quoted"><span class="var">?σ'</span></span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l1</span> <span class="main">=</span> <span class="skolem">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="skolem">l1'</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l1'</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">l1</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="var">?σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">=</span>  mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="var">?σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_replacement <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="skolem">L</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">polarity</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="var"><span class="quoted"><span class="var">?σ'</span></span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="var">?P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="var">?P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L'</span> <span class="free">σ</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">η</span> <span class="main">∈</span> <span class="var">?C'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L'</span> <span class="var">?σ'</span> <span class="main">∈</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> composition_of_substs_lit<span class="main">)</span> 
  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="skolem">I</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="var">?σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_ground_clause <span class="skolem">I</span> <span class="var">?C'</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> superposition_is_sound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"superposition <span class="free">P1</span> <span class="free">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">{</span> cl_ecl <span class="free">P1</span><span class="main">,</span> cl_ecl <span class="free">P2</span> <span class="main">}</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> set_entails_clause <span class="main">{</span> cl_ecl <span class="free">P1</span><span class="main">,</span> cl_ecl <span class="free">P2</span> <span class="main">}</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="var">?P1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="var">?P2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert_iff validate_clause_set.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="var">?C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> P1_true<span class="main">:</span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P1</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>›</span></span> instances_are_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> P2_true<span class="main">:</span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="var">?P2</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span>›</span></span> instances_are_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
        substs_preserve_ground_clause validate_clause.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">,</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> P1_true <span class="keyword2"><span class="keyword">and</span></span> P2_true <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="skolem">I</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff singletonD validate_clause_set.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> set_entails_clause <span class="var">?S</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>ground_clause <span class="main">(</span>subst_cl <span class="var">?C</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ground_superposition_is_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> superposition_preserves_finiteness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"superposition <span class="free">P1</span> <span class="free">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    def_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> def_C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> superposition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> def_C def_C' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> substs_preserve_finiteness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflexion_preserves_finiteness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="free">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    def_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> def_C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reflexion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> def_C def_C' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> substs_preserve_finiteness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> factorization_preserves_finiteness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"factorization <span class="free">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    def_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> def_C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> factorization_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> def_C def_C' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> substs_preserve_finiteness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivable_clauses_are_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> not_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> superposition_preserves_finiteness <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P1</span></span> <span class="quoted"><span class="skolem">P2</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reflexion_preserves_finiteness <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P1</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span>  factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">" factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  factorization_preserves_finiteness <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P1</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> not_sup not_ref not_fact <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> derivable_clauses_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> not_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">Cl_P1</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">Cl_P2</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">T</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> superposition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">Cl_P</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reflexion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span>  factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">Cl_P</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> factorization_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> not_sup not_ref not_fact <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserves_decompose_literal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">η</span><span class="main">)</span> <span class="free">polarity</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">η</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="var">?t</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="var">?s</span> <span class="var">?t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def 
      decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def 
      decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_dom_trm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="free">t</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="main">(</span>decompose_literal <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="bound">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> 
    <span class="quoted"><span class="quoted">"decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> substs_preserves_decompose_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="var">?t</span> <span class="main">=</span> <span class="var">?u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="var">?u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹decompose_literal <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substs_preserve_well_constrainedness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> trms_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dom_trm <span class="skolem">y</span> <span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"eclause.exhaust"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>Ecl <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">T</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="skolem">T</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> trms_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">z</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_dom_trm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">y</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">¬</span> dom_trm <span class="skolem">y</span> <span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ck_trms_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> get_trms <span class="free">D</span> <span class="main">(</span>dom_trms <span class="free">C</span> <span class="free">E</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="main">(</span>dom_trms <span class="free">C</span> <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> FirstOrder"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">filter_trms</span> <span class="free">D</span> <span class="main">(</span>dom_trms <span class="free">C</span> <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> filter_trms_inclusion <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> FirstOrder"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="main">(</span>dom_trms <span class="free">C</span> <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> filter_trms_inclusion <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivable_clauses_are_well_constrained<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> well_constrained <span class="free">C</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dom_trm <span class="skolem">y</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> not_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">E</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> superposition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span><span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ck_trms_sound  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>dom_trms <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> dom_trm <span class="skolem">y</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> reflexion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span><span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ck_trms_sound  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>dom_trms <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> dom_trm <span class="skolem">y</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> factorization_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span><span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ck_trms_sound  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>dom_trms <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> dom_trm <span class="skolem">y</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> not_sup not_ref not_fact <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> derivable_clauses_are_entailed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span><span class="main">,</span> <span class="bound">P2</span> <span class="main">}</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span><span class="main">,</span> <span class="bound">P2</span> <span class="main">}</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">{</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">}</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> superposition_is_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> set_entails_clause_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="free">C</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
      <span class="quoted"><span class="quoted">‹factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clause_entails_clause <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> factorization_is_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reflexion  <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
      <span class="quoted"><span class="quoted">‹reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> <span class="free">k</span> <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clause_entails_clause <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> reflexion_is_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> clause_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="free">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> not_sup not_fact not_ref <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_derived_clauses_are_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="free">C</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivable_ecl.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">S</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">C</span> <span class="skolem">S</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>  
    <span class="quoted"><span class="quoted">"<span class="main">(</span>renaming_cl <span class="skolem">C</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>renaming_cl <span class="skolem">C</span> <span class="skolem">D</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="skolem">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> renaming_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_Cl</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">C_Cl</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"eclause.exhaust"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="skolem">C</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this hyp_ind <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_finiteness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">S</span> <span class="skolem">C</span> <span class="skolem">S'</span> <span class="skolem">σ</span> <span class="skolem">C'</span> 
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">⟶</span> derivable_ecl <span class="bound">x</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">S'</span> <span class="skolem">σ</span> FirstOrder <span class="skolem">C'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">S'</span> <span class="skolem">σ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> derivable_clauses_are_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_derived_clauses_are_wellconstrained<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="free">C</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>well_constrained <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> well_constrained <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivable_ecl.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>well_constrained <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">S</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">C</span> <span class="skolem">S</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>well_constrained <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>well_constrained <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> well_constrained <span class="skolem">C</span>"</span></span>  
    <span class="quoted"><span class="quoted">"<span class="main">(</span>renaming_cl <span class="skolem">C</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>well_constrained <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>renaming_cl <span class="skolem">C</span> <span class="skolem">D</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="skolem">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> renaming_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹well_constrained <span class="skolem">C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="skolem">D</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_well_constrainedness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">S</span> <span class="skolem">C</span> <span class="skolem">S'</span> <span class="skolem">σ</span> <span class="skolem">C'</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">⟶</span> derivable_ecl <span class="bound">x</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="main">(</span>Ball <span class="skolem">S</span> well_constrained <span class="main">⟶</span> well_constrained <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">S'</span> <span class="skolem">σ</span> FirstOrder <span class="skolem">C'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Ball <span class="skolem">S</span> well_constrained"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">S'</span> <span class="skolem">σ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="skolem">C</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> derivable_clauses_are_well_constrained <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SOUNDNESS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="free">C</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">⟹</span> set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> derivable_ecl.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">S</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">C</span> <span class="skolem">S</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>renaming_cl <span class="skolem">C</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>renaming_cl <span class="skolem">C</span> <span class="skolem">D</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="skolem">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> renaming_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_Cl</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">C_Cl</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"eclause.exhaust"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="skolem">C</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="main">`</span><span class="skolem">S</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> instances_are_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> hyp_ind <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">S</span> <span class="skolem">C</span> <span class="skolem">S'</span> <span class="skolem">σ</span> <span class="skolem">C'</span> 
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">⟶</span> derivable_ecl <span class="bound">x</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">S'</span> <span class="skolem">σ</span> FirstOrder <span class="skolem">C'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span>  set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="main">`</span><span class="skolem">S</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> all_derived_clauses_are_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span>  i <span class="keyword2"><span class="keyword">and</span></span> ii 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span>  <span class="main">(</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">S'</span> <span class="skolem">σ</span> FirstOrder <span class="skolem">C'</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> derivable_clauses_are_entailed <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">S'</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted">FirstOrder</span> <span class="quoted"><span class="skolem">C'</span></span> <span class="quoted"><span class="skolem">I</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> REFUTABLE_SETS_ARE_UNSAT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="free">C</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>satisfiable_clause_set <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>satisfiable_clause_set <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> model<span class="main">:</span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> satisfiable_clause_set_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cl_ecl <span class="main">`</span> <span class="free">S</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> SOUNDNESS <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹fo_interpretation <span class="skolem">I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> model <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="skolem">I</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Redundancy Criteria and Saturated Sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define redundancy criteria. We use similar notions as in the Bachmair and Ganzinger
paper, the only difference is that we have to handle the sets of irreducible terms associated
with the clauses. Indeed, to ensure completeness, we must guarantee that all the terms that are 
irreducible in the entailing clauses are also irreducible in the entailed one 
(otherwise some needed inferences could be blocked due the irreducibility condition, as in the basic 
superposition calculus). Of course, if the attached sets of terms are empty, then this condition 
trivially holds and the definition collapses to the usual one. 

We introduce the following relation:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subterms_inclusion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm set <span class="main">⇒</span> <span class="tfree">'a</span> trm set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subterms_inclusion</span> <span class="free"><span class="bound"><span class="entity">E1</span></span></span> <span class="free"><span class="bound"><span class="entity">E2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E1</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E2</span></span></span><span class="main">.</span> <span class="main">(</span>occurs_in <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_inclusion_refl<span class="main">:</span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subterms_inclusion <span class="free">E</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>subterms_inclusion <span class="free">E</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> occurs_in <span class="skolem">x1</span> <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subterms_inclusion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> occurs_in <span class="skolem">x1</span> <span class="skolem">x1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> subterm <span class="skolem">x1</span> <span class="bound">p</span> <span class="skolem">x1</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>subterm <span class="skolem">x1</span> Nil <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_inclusion_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subterms_inclusion <span class="free">E1</span> <span class="free">E2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E2</span> <span class="main">⊆</span> <span class="free">E2'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subterms_inclusion <span class="free">E1</span> <span class="free">E2'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> basic_superposition.subterms_inclusion_def basic_superposition_axioms 
      subsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_inclusion_preserve_normalization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="free">E</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="free">E'</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all_trms_irreducible_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_inclusion_preserves_normalization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="free">E</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subterms_inclusion <span class="free">E'</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="free">E'</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all_trms_irreducible_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> occur_in_subterm subterms_inclusion_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define two notions of redundancy, the first one is for inferences: any derivable clause 
must be entailed by a set of clauses that are strictly smaller than one of the premises.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">redundant_inference</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">redundant_inference</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">S'</span><span class="main">.</span> <span class="main">(</span><span class="bound">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="bound">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">D'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">D'</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The second one is the usual notion for clauses: a clause is redundant if it is entailed by
smaller (or equal) clauses.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">redundant_clause</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause <span class="main">⇒</span> <span class="tfree">'a</span> eclause set  <span class="main">⇒</span> <span class="tfree">'a</span> subst <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">redundant_clause</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">S'</span><span class="main">.</span> <span class="main">(</span><span class="bound">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="bound">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that according to the definition above, an extended clause is always 
redundant w.r.t.\ a clause obtained from the initial one by adding in the attached set of 
terms a subterm of a term that already occurs in this set. This remark is important because 
explicitly adding such subterms in the attached set may prune the search space, due to the fact 
that the containing term can be removed at some point when calling the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"dom_trm"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
Adding the subterm explicitly is thus useful in this case. In practice, the simplest solution may be 
to assume that the set of irreducible terms is closed under subterm. 

Of course, a clause is also redundant w.r.t.\ any clause obtained by removing terms in the attached
set. In particular, terms can be safely removed from the set of irreducible terms of the entailing 
clauses if needed to make a given clause redundant.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> self_redundant_clause<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="main">(</span>subst_ecl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">C'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eclause.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="free">C</span> <span class="main">=</span> <span class="skolem">Cl_C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="free">C</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Cl_C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst_cl <span class="skolem">Cl_C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"subst_set <span class="skolem">T</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subst_ecl <span class="free">C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C</span> <span class="var">?T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="var">?C</span> <span class="main">=</span> <span class="var">?Cl_C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="var">?C</span> <span class="main">=</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cl_ecl <span class="free">C</span> <span class="main">=</span> <span class="skolem">Cl_C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clset_instances <span class="var">?S</span> <span class="main">=</span> <span class="main">{</span> <span class="var">?Cl_C</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> clset_instances_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cl_ecl <span class="var">?C</span> <span class="main">=</span> <span class="var">?Cl_C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"set_entails_clause <span class="main">(</span>clset_instances <span class="var">?S</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_entails_clause_member <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trms_ecl <span class="var">?C</span> <span class="main">=</span> <span class="var">?T</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> subterms_inclusion_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> Ecl <span class="skolem">Cl_C</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> i ii iii iv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> redundant_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trms_subsumes</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">trms_subsumes</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⊆</span> trms_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inference_closed</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inference_closed</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="bound">C'</span> <span class="bound">D</span> <span class="bound">θ</span><span class="main">.</span> 
      <span class="main">(</span>derivable <span class="bound">D</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">θ</span> FirstOrder <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Various notions of saturatedness are defined, depending on the kind of inferences that are 
considered and on the redundancy criterion.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first definition is the weakest one: all ground inferences must be redundant (this 
definition is used for the completeness proof to make it the most general).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ground_inference_saturated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ground_inference_saturated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">C</span> <span class="bound">P</span> <span class="bound">σ</span> <span class="bound">C'</span><span class="main">.</span> <span class="main">(</span>derivable <span class="bound">C</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">σ</span> Ground <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> 
      <span class="main">(</span>ground_clause <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>grounding_set <span class="bound">P</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>redundant_inference <span class="bound">C</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">P</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The second one states that every ground instance of a first-order inference must be 
redundant.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inference_saturated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">inference_saturated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">C</span> <span class="bound">P</span> <span class="bound">σ</span> <span class="bound">C'</span> <span class="bound">D</span> <span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> 
     <span class="main">(</span>derivable <span class="bound">C</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">σ</span> Ground <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ground_clause <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>grounding_set <span class="bound">P</span> <span class="bound">σ</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span>derivable <span class="bound">D</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">θ</span> FirstOrder <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>trms_subsumes <span class="bound">D</span> <span class="bound">C</span> <span class="bound">η</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">≐</span> <span class="bound">θ</span> <span class="main">◊</span> <span class="bound">η</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span>redundant_inference <span class="main">(</span>subst_ecl <span class="bound">D</span> <span class="bound">η</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">P</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The last definition is the most restrictive one: every derivable clause must be 
redundant.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">clause_saturated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">clause_saturated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">C</span> <span class="bound">P</span> <span class="bound">σ</span> <span class="bound">C'</span> <span class="bound">D</span> <span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> 
     <span class="main">(</span>derivable <span class="bound">C</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">σ</span> Ground <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ground_clause <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span>derivable <span class="bound">D</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">θ</span> FirstOrder <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>trms_subsumes <span class="bound">D</span> <span class="bound">C</span> <span class="bound">η</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">≐</span> <span class="bound">θ</span> <span class="main">◊</span> <span class="bound">η</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span>redundant_clause <span class="main">(</span>subst_ecl <span class="bound">D</span> <span class="bound">η</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">σ</span> <span class="bound">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now relate these various notions, so that the forthcoming completeness proof applies
to all of them. To this purpose, we have to show that the conclusion of a (ground) inference rule 
is always strictly smaller than one of the premises.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conclusion_is_smaller_than_premisses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"grounding_set <span class="free">P</span> <span class="free">σ</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="bound">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="bound">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> not_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="bound">P2</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">M</span></span>  <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">polarity</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">NT</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>"</span></span> 
      <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>"</span></span> 
      <span class="quoted"><span class="quoted">"subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span>"</span></span>
      <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="free">σ</span> Ground"</span></span>
      <span class="quoted"><span class="quoted">"replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">NT</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> lit_ord"</span></span>
      <span class="quoted"><span class="quoted">"strictly_maximal_literal <span class="skolem">P2</span> <span class="skolem">M</span> <span class="free">σ</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> superposition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P2</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> grounding_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> pos"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> pos›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> pos›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
       <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> grounding_set_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">polarity</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">polarity</span>›</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mC1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="skolem">P1</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mC2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">-</span><span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">+</span> mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_mset_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span>
      <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> 
        <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">-</span> <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C'</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="var">?C</span> <span class="main">=</span> mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">-</span><span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">+</span> mset_set <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_mset_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C</span><span class="main">)</span> <span class="main">#}</span>
      <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> 
        <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="var">?K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set_mset <span class="var">?K</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈#</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> image_mset_thm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?K</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈#</span> <span class="var">?J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span>"</span></span>  
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹strictly_maximal_literal <span class="skolem">P2</span> <span class="skolem">M</span> <span class="free">σ</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> strictly_maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lit_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">)</span>›</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>›</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∉</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">=</span> <span class="skolem">L'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span>  <span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="free">σ</span> Ground›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> replacement_monotonic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="skolem">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> pos"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> add.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
        <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span> <span class="main">=</span> pos›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> 
          <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> add.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">∈</span>set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> i ii 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_step_implies_mult empty_iff insert_iff set_mset_add_mset_insert set_mset_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> neg"</span></span>
        
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> 
          <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L'</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> 
          <span class="main">∃</span><span class="bound">j'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">∈</span>set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">from</span></span> this i ii <span class="quoted"><span class="quoted">‹<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> one_step_implies_mult  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
               <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="free">trm_ord</span></span>
               <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span><span class="main">]</span> 
             trm_ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
             
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">=</span> <span class="skolem">L'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this d1 d2  <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"
      <span class="main">(</span><span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="var">?C</span> <span class="main">#}</span><span class="main">,</span>
      <span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span>
     <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  mult_trm_ord_trans one_step_implies_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>  <span class="quoted"><span class="quoted">"mult <span class="free">trm_ord</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> "</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> hyp  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> not_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">Cl_P</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="free">σ</span> Ground<span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> reflexion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mC1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="skolem">P1</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mC2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">-</span><span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">+</span> mset_set <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_mset_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span>
      <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> 
        <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C'</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="var">?C</span> <span class="main">=</span> mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">-</span><span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">+</span> mset_set <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_mset_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C</span><span class="main">)</span> <span class="main">#}</span>
      <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> 
        <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="var">?K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> this d1 d2  <span class="quoted"><span class="quoted">‹<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span>  
    <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"
      <span class="main">(</span><span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="var">?C</span> <span class="main">#}</span><span class="main">,</span>
      <span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span>
     <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  mult_trm_ord_trans one_step_implies_mult <span class="main">[</span><span class="operator">of</span>
    <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>  <span class="quoted"><span class="quoted">"mult <span class="free">trm_ord</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> "</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> hyp  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> not_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"factorization  <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">Cl_P</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="free">σ</span> Ground<span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> factorization_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> grounding_set_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> pos"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> pos›</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> pos"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> pos›</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="free">σ</span> Ground›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> pos›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
       <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> pos›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total 
       <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mC1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="skolem">P1</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mC2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">-</span><span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">+</span> mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_mset_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span>
      <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> 
        <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">-</span> <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C'</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="var">?C</span> <span class="main">=</span> mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">-</span><span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">+</span> mset_set <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split_mset_set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span>"</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C</span><span class="main">)</span> <span class="main">#}</span>
      <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> 
        <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="var">?K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set_mset <span class="var">?K</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈#</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> image_mset_thm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?K</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈#</span> <span class="var">?J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="var">?J</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">=</span> <span class="skolem">L'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">=</span> <span class="main">{#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> add.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span>›</span></span>  
          <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">{#}</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> 
          <span class="main">∃</span><span class="bound">j'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k'</span> <span class="keyword3"><span class="command">assume</span></span> nh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">∈</span>set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> nh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j'</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this i ii <span class="quoted"><span class="quoted">‹<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> one_step_implies_mult  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span> 
               <span class="quoted"><span class="quoted">"<span class="main">{#</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">#}</span>"</span></span> 
               <span class="quoted"><span class="free">trm_ord</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span><span class="main">]</span> 
             trm_ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">=</span> <span class="skolem">L'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this d1 d2 <span class="quoted"><span class="quoted">‹<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"
      <span class="main">(</span><span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="var">?C</span> <span class="main">#}</span><span class="main">,</span>
      <span class="main">{#</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> mset_set <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span>
     <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  mult_trm_ord_trans one_step_implies_mult <span class="main">[</span><span class="operator">of</span>
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="var">?C'</span><span class="main">)</span> <span class="main">#}</span>"</span></span>  <span class="quoted"><span class="quoted">"mult <span class="free">trm_ord</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> "</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P1</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> not_sup not_ref not_fact <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> redundant_inference_clause<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="free">E</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"grounding_set <span class="free">P</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"redundant_inference <span class="free">E</span> <span class="free">S</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">E</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> redundant_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> Ground <span class="free">C'</span>›</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> conclusion_is_smaller_than_premisses <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">D'</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">D'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
            <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_mult_trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ecl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ecl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>      
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D'</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">D'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">E</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> redundant_inference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> clause_saturated_and_inference_saturated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"clause_saturated <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inference_saturated <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inference_saturated <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="skolem"><span class="skolem">D</span></span>  <span class="skolem"><span class="skolem">θ</span></span> <span class="skolem"><span class="skolem">η</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> <span class="quoted"><span class="quoted">"grounding_set <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span>redundant_inference <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inference_saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹grounding_set <span class="skolem">P</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">¬</span>redundant_inference <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">P</span> <span class="skolem">σ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="skolem">C'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> redundant_inference_clause  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span> <span class="bound">P</span> <span class="bound">σ</span> <span class="bound">C'</span> <span class="bound">D</span>  <span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> 
     <span class="main">(</span>derivable <span class="bound">C</span> <span class="bound">P</span> <span class="free">S</span> <span class="bound">σ</span> Ground <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ground_clause <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span>derivable <span class="bound">D</span> <span class="bound">P</span> <span class="free">S</span> <span class="bound">θ</span> FirstOrder <span class="bound">C'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>trms_subsumes <span class="bound">D</span> <span class="bound">C</span> <span class="bound">η</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">≐</span> <span class="bound">θ</span> <span class="main">◊</span> <span class="bound">η</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span>redundant_clause <span class="main">(</span>subst_ecl <span class="bound">D</span> <span class="bound">η</span><span class="main">)</span> <span class="free">S</span> <span class="bound">σ</span> <span class="bound">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> clause_saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="skolem">C'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="skolem">C'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Refutational Completeness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that our variant of the superposition calculus is complete under the 
redundancy criteria defined above. This is done as usual, by constructing a model of every
saturated set not containing the empty clause.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Model Construction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We associate as usual every set of extended clauses with an interpretation. 
The interpretation is constructed in such a way that it is a model of the set of clauses 
if the latter is saturated and does not contain the empty clause.
The interpretation is constructed by defining directly a normalization function mapping every term 
to its normal form, i.e., to the minimal equivalent term. Note that we do not consider sets of 
rewrite rules explicitly.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next function associates every normalization function with the corresponding 
interpretation (two terms are in relation if they share the same normal form). 
The obtained relation is an interpretation if the normalization function 
is compatible with the term combination operator.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">same_values</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">same_values</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">value_is_compatible_with_structure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">value_is_compatible_with_structure</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Comb <span class="bound">t</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Comb <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> same_values_fo_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"value_is_compatible_with_structure <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="main">(</span>same_values <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>same_values <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ref<span class="main">:</span> <span class="quoted"><span class="quoted">"reflexive <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> sym<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible_with_structure <span class="var">?I</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> same_values_def 
      compatible_with_structure_def value_is_compatible_with_structure_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> ref trans sym comp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"congruence <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> congruence_def equivalence_relation_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The normalization function is defined by mapping each term to a set of pairs. Intuitively,
the second element of each pair represents the right hand side of a rule that can be used to rewrite 
the considered term, and the first element of the pair denotes its normal form. 
The value of the term is the first component of the pair with the smallest second component.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function returns the set of values for which the second component is minimal. 
We then prove that this set is non-empty and define a function returning an arbitrary chosen 
element.›</span></span> 
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_trms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> trm <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> trm set"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">min_trms</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">pair</span><span class="main">.</span> <span class="main">(</span><span class="bound">pair</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">pair'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">pair'</span><span class="main">,</span>snd <span class="bound">pair</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> fst <span class="bound">pair</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_trms_not_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"min_trms <span class="free">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pair_ordering</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> trm_ord_wf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="var">?pair_ordering</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  measure_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?pair_ordering</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">z</span> <span class="main">∉</span> <span class="free">E</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> wfE_min <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pair_ordering</span></span></span> <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∈</span> min_trms <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> trm <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> trm"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">get_min</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>min_trms <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> min_trms <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the normalization function. The definition is tuned to 
make the termination proof straightforward. We will reformulate it afterward to get a simpler 
definition. 

We first test whether a subterm of the considered term is reducible. If this is the case then 
the value can be obtained by applying recursively the function on each subterm, and then again on 
the term obtained by combining the obtained normal forms.
If not, then we collect all possible pairs (as explained above), and we use the one with the minimal 
second component. These pairs can be interpreted as rewrite rules, giving the value of the 
considered term: the second component is the right-hand side of the rule and the first component is 
the normal form of the right-hand side. 
As usual, such rewrite rules are obtained from ground clauses that have a strictly positive 
maximal literal, no selected literals, and that are not validated by the constructed interpretation.
›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">trm_rep</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">trm_rep</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>is_compound <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
      <span class="main">∧</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span><span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> 
                   <span class="keyword1">then</span> 
              <span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>Comb <span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span>
              <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span>get_min <span class="free"><span class="bound"><span class="entity">t</span></span></span> 
         <span class="main">{</span> <span class="bound">pair</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="bound">s</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> 
           <span class="bound">pair</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span>
          <span class="main">∧</span> <span class="bound">CC</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∉</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="bound">CC</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="bound">CC</span><span class="main">)</span><span class="main">.</span> occurs_in <span class="bound">x</span> <span class="main">(</span>subst <span class="bound">x'</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">⟶</span> <span class="main">(</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">x</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>         
          <span class="main">∧</span> <span class="main">(</span><span class="bound">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="bound">CC</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">z</span> <span class="main">=</span> <span class="free">trm_rep</span> <span class="bound">s</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="bound">L'</span> <span class="bound">t'</span> <span class="bound">s'</span> pos <span class="bound">σ</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="free">sel</span> <span class="bound">C'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>  <span class="main">(</span><span class="bound">L'</span> <span class="main">∈</span> <span class="bound">C'</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="bound">L</span> <span class="bound">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="bound">L'</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="bound">C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="bound">C'</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span>ground_clause <span class="bound">C</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">t'</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">s'</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="bound">C'</span><span class="main">)</span> 
          <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span> <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> 
              <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="bound">C</span> <span class="main">⟶</span> orient_lit <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> pos 
                <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">u</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≠</span>  <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">v</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span>
            <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="bound">C</span> <span class="main">⟶</span> orient_lit <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> neg <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">u</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">v</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s''</span><span class="main">.</span> <span class="main">(</span> 
              <span class="main">(</span>eq_occurs_in_cl <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">s''</span> <span class="main">(</span><span class="bound">C'</span><span class="main">-</span> <span class="main">{</span> <span class="bound">L'</span> <span class="main">}</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s''</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">s</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">trm_rep</span> <span class="bound">s''</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"<span class="free">trm_ord</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trm_ord_wf<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now introduce a few shorthands and rewrite the previous definition into an equivalent 
simpler form. The key point is to prove that a term is always greater than its normal form.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subterm_reduction_aux</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subterm_reduction_aux</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> 
         <span class="keyword1">then</span> <span class="main">(</span>trm_rep <span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subterm_reduction</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span> trm"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subterm_reduction</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> 
              <span class="main">(</span>trm_rep <span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximal_literal_is_unique</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">maximal_literal_is_unique</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">s''</span><span class="main">.</span> <span class="main">(</span> 
              <span class="main">(</span>eq_occurs_in_cl <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">s''</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">-</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s''</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
                <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="bound">s''</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">smaller_lits_are_false</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">smaller_lits_are_false</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> 
              <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> orient_lit <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> pos 
                <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
                <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">≠</span>  <span class="main">(</span>trm_rep <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span>
            <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> orient_lit <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> neg <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
                <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">int_clset</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">int_clset</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smaller_lits_are_false_if_cl_not_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"smaller_lits_are_false <span class="free">t</span> <span class="free">C</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int_clset <span class="free">S</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>smaller_lits_are_false <span class="free">t</span> <span class="free">C</span> <span class="free">S</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span>orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> neg <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> smaller_lits_are_false_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span>orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> neg <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> c_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> pos"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> c_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> pos›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">v</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="skolem">L</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> validate_ground_lit.simps<span class="main">(</span>1<span class="main">)</span> validate_ground_eq.simps 
      <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def 
      <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> c_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> neg <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> neg"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> c_neg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> neg›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">v</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">u</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="skolem">L</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> validate_ground_lit.simps<span class="main">(</span>2<span class="main">)</span> validate_ground_eq.simps 
      <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def 
      <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function states that all instances of the terms attached to a clause are in 
normal form w.r.t.\ the interpretation associated with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, up to some maximal term 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trms_irreducible</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">trms_irreducible</span> <span class="free"><span class="bound"><span class="entity">CC</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">CC</span></span></span><span class="main">)</span><span class="main">.</span> occurs_in <span class="bound">x</span> <span class="main">(</span>subst <span class="bound">x'</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
              <span class="main">(</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>         

<span class="keyword1"><span class="command">lemma</span></span> trms_irreducible_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trms_irreducible <span class="free">C</span> <span class="free">σ</span> <span class="free">S</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>trms_irreducible <span class="free">C</span> <span class="free">σ</span> <span class="free">S</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">∈</span> trms_ecl <span class="free">C</span><span class="main">.</span> occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="bound">x'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">x</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x'</span><span class="main">∈</span> trms_ecl <span class="free">C</span><span class="main">.</span> occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="bound">x'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">x'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">x</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">x</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following predicate states that a term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">z</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the normal form of the right-hand 
side of a rule of left-hand side <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. It is used to define the set of possible values for 
term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The actual value is that corresponding to the smallest right-hand side.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">candidate_values</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">candidate_values</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">CC</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">CC</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∉</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">CC</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>trms_irreducible <span class="free"><span class="bound"><span class="entity">CC</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">CC</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> trm_rep <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> pos <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">sel</span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ground_clause <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> 
          <span class="main">∧</span> <span class="main">(</span>smaller_lits_are_false <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span>maximal_literal_is_unique <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_of_candidate_values</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> trm <span class="main">×</span> <span class="tfree">'a</span> trm<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_of_candidate_values</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>  <span class="main">=</span> 
         <span class="main">{</span> <span class="bound">pair</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="bound">s</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> 
           <span class="bound">pair</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>candidate_values <span class="bound">z</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="bound">s</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subterm_reduction_applicable_aux</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subterm_reduction_applicable_aux</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span>
   <span class="main">(</span>is_compound <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>  <span class="main">∧</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>
      <span class="main">∧</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span><span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subterm_reduction_applicable</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subterm_reduction_applicable</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span>
   <span class="main">(</span>is_compound <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>lhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>rhs <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_is_lower_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="bound">y</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="bound">y</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>trm_rep <span class="bound">y</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lhs <span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>›</span></span> args_are_strictly_lower 
      subterm_reduction_applicable_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rhs <span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>›</span></span> args_are_strictly_lower 
    subterm_reduction_applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>lhs <span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>lhs <span class="free">t</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>trm_rep  <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>rhs <span class="free">t</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rhs <span class="free">t</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>trm_rep  <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_applicable_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep  <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this 
     <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Comb <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span>  <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_reduction_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Comb <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span>  <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_compound.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subterm_reduction_applicable_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep  <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trm_ord_reduction_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_compound.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            subterm_reduction_applicable_def trm_ord_trans transE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>     
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep  <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this 
      <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_reduction_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 
     <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> basic_superposition.subterm_reduction_applicable_def  
            basic_superposition_axioms is_compound.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep  <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>  <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trm_ord_reduction_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> basic_superposition.subterm_reduction_applicable_def 
            basic_superposition_axioms is_compound.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            trm_ord_trans transE<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma corresponds to the initial definition of the function 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"trm_rep"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_init_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>subterm_reduction_applicable_aux <span class="bound">S</span> <span class="free">t</span><span class="main">)</span> 
                        <span class="keyword1">then</span> <span class="main">(</span>subterm_reduction_aux <span class="bound">S</span> <span class="free">t</span><span class="main">)</span>
                        <span class="keyword1">else</span> <span class="main">(</span>get_min <span class="free">t</span> <span class="main">(</span>set_of_candidate_values <span class="bound">S</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_aux_def set_of_candidate_values_def candidate_values_def 
   subterm_reduction_applicable_aux_def maximal_literal_is_unique_def smaller_lits_are_false_def 
   trms_irreducible_def
<span class="keyword1"><span class="command">using</span></span> trm_rep.simps <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_aux_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="bound">y</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="bound">y</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>trm_rep <span class="bound">y</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span><span class="main">)</span> 
                        <span class="keyword1">then</span> <span class="main">(</span>subterm_reduction <span class="free">S</span> <span class="free">t</span><span class="main">)</span>
                        <span class="keyword1">else</span> <span class="main">(</span>get_min <span class="free">t</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable_aux <span class="free">S</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> args_are_strictly_lower 
      subterm_reduction_applicable_def subterm_reduction_applicable_aux_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterm_reduction_aux <span class="free">S</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> trm_rep_init_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">t</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>›</span></span> assms trm_rep_is_lower_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹trm_rep <span class="free">t</span> <span class="free">S</span> <span class="main">=</span> subterm_reduction_aux <span class="free">S</span> <span class="free">t</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>›</span></span> 
        subterm_reduction_def 
        subterm_reduction_aux_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>subterm_reduction_applicable_aux <span class="free">S</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subterm_reduction_applicable_def subterm_reduction_applicable_aux_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> trm_rep_init_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> trm_rep_is_lower<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">t</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> wf_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">trm_ord</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trm_ord_wf<span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> c1 <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterm_reduction <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_rep_aux_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span> <span class="main">⋅</span> trm_rep <span class="main">(</span>rhs <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> trm_ord_trans transE<span class="main">)</span> 
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> c2 <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_min <span class="skolem">x</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_rep_aux_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> get_min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> some_in_eq<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">pair</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> min_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span>  <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> candidate_values <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">)</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="skolem">x</span> <span class="free">S</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> set_of_candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span>  <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> candidate_values <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">)</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="skolem">x</span> <span class="free">S</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">pair</span> <span class="main">=</span> snd <span class="skolem">pair</span> <span class="main">∨</span> <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">,</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trm_ord_trans transD<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_is_lower_subt_red<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">x</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="free">x</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower_aux trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterm_reduction <span class="free">S</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_rep_aux_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> trm_rep <span class="var">?v</span> <span class="free">S</span> <span class="main">∨</span> <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="free">x</span><span class="main">)</span> <span class="free">S</span> <span class="main">⋅</span> trm_rep <span class="main">(</span>rhs <span class="free">x</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> trm_ord_trans transE<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_is_lower_root_red<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_min <span class="free">x</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_rep_aux_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> get_min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> some_in_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">pair</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> min_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">x</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span>  <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> candidate_values <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">)</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="free">x</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_of_candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span>  <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> candidate_values <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">)</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="free">x</span> <span class="free">S</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span> <span class="main">∨</span> <span class="main">(</span>trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_ord_trans trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, the next lemma gives a simpler and more convenient definition 
of the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"trm_rep"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_simp_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="free">t</span><span class="main">)</span> 
                        <span class="keyword1">then</span> <span class="main">(</span>subterm_reduction <span class="free">S</span> <span class="free">t</span><span class="main">)</span>
                        <span class="keyword1">else</span> <span class="main">(</span>get_min <span class="free">t</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower  trm_rep_aux_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now establish some useful properties of the normalization function.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_involutive<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">t</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> wf_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">trm_ord</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trm_ord_wf<span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="main">(</span>lhs <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="main">(</span>rhs <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower_aux trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_rep_aux_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> c1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">x</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="var">?v</span> <span class="free">S</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_rep_simp_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="var">?v</span> <span class="free">S</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">x</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="var">?v</span> <span class="free">S</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> c2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_min <span class="skolem">x</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_rep_simp_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> c2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> trm_rep_simp_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">unfolding</span></span> get_min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> some_in_eq<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair</span></span> <span class="keyword2"><span class="keyword">where</span></span>  
            <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">pair</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> min_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span>  <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> 
                    candidate_values <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">)</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="skolem">x</span> <span class="free">S</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> set_of_candidate_values_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">pair</span> <span class="main">=</span> trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>snd <span class="skolem">pair</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following predicate is true if all proper subterms are in normal form.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">root_term</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">(</span>trm_rep <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_min <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>set_of_candidate_values <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function checks that the considered term contains a subterm that can be 
reduced.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">st_red</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> eclause set <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_red</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subterm <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">p</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>root_term <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="bound">t'</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≠</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> red_arg_implies_red_trm <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="free">t1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">∨</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="free">t2</span> <span class="free">t1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t1</span> <span class="skolem">p</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"root_term <span class="free">S</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">t'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> st_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="free">t1</span> <span class="skolem">p</span> <span class="skolem">t'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t</span> <span class="skolem">q</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subterm.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subterm.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹root_term <span class="free">S</span> <span class="skolem">t'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">t'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t'</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> st_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subterms_of_irred_trms_are_irred<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="free">t</span> <span class="main">⟶</span> st_red <span class="free">S</span> <span class="free">t</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="free">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> wf_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">trm_ord</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trm_ord_wf<span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> neg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>st_red <span class="free">S</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span>subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> decomp_case<span class="main">:</span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_compound.elims<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> decomp_case <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep <span class="skolem">x1</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x1</span> <span class="main">∨</span> <span class="main">(</span>trm_rep <span class="skolem">x2</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> lhs.simps<span class="main">(</span>1<span class="main">)</span> rhs.simps<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x1</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x1</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> trm_ord_subterm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x1</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x1</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg_h <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
              <span class="keyword1"><span class="command">using</span></span> red_arg_implies_red_trm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x2</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> trm_ord_subterm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x2</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg_h <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Comb <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
              <span class="keyword1"><span class="command">using</span></span> red_arg_implies_red_trm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">x2</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_min <span class="skolem">x</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trm_rep_simp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_term <span class="free">S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">x</span> <span class="main">[]</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹root_term <span class="free">S</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> st_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg_h <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trm_rep_compatible_with_structure<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"value_is_compatible_with_structure <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>value_is_compatible_with_structure <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> neg_h<span class="main">:</span><span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>Comb <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="main">(</span>Comb <span class="main">(</span>trm_rep <span class="skolem">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>trm_rep <span class="skolem">s</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> value_is_compatible_with_structure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">t</span> <span class="main">∨</span> <span class="main">(</span>trm_rep <span class="skolem">s</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="main">(</span>Comb <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_applicable_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_compound.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>Comb <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subterm_reduction <span class="free">S</span> <span class="main">(</span>Comb <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_rep_simp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> neg_h <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function checks that a position can be reduced, taking into account the 
order on positions associated with the considered clause and term. A term is reducible when all 
terms occurring at smaller positions are irreducible.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimal_redex</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minimal_redex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span>
    <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subterm <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">q</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next function checks that a given clause contains two equations with the same
left-hand side and whose right-hand sides are equivalent in a given interpretation. If no such 
equations exist then it is clear that the maximal literal is necessarily unique.›</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">equivalent_eq_exists</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">equivalent_eq_exists</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">-</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">}</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span>
    <span class="main">(</span>orient_lit_inst <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span>  <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>subst <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> maximal_literal_is_unique_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>equivalent_eq_exists <span class="free">t</span> <span class="free">s</span> <span class="free">C</span> <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="free">σ</span> <span class="free">L1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximal_literal_is_unique <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">C</span> <span class="free">L1</span> <span class="free">S</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>maximal_literal_is_unique <span class="var">?t</span> <span class="var">?s</span> <span class="free">C</span> <span class="free">L1</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eq_occurs_in_cl <span class="var">?t</span> <span class="skolem">s''</span> <span class="main">(</span><span class="free">C</span><span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="var">?s</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="skolem">s''</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_is_unique_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eq_occurs_in_cl <span class="var">?t</span> <span class="skolem">s''</span> <span class="main">(</span><span class="free">C</span><span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">∈</span> <span class="main">(</span><span class="free">C</span><span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L'</span> <span class="skolem">t'</span> <span class="skolem">s'</span> pos <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> subst <span class="skolem">s'</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_occurs_in_cl_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">=</span> subst <span class="skolem">s'</span> <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="var">?s</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="skolem">s''</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="var">?s</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="main">(</span><span class="free">C</span><span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L'</span> <span class="skolem">t'</span> <span class="skolem">s'</span> pos <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?t</span>›</span></span> 
  <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="var">?s</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_eq_exists <span class="free">t</span> <span class="free">s</span> <span class="free">C</span> <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="free">σ</span> <span class="free">L1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> equivalent_eq_exists_def same_values_def int_clset_def
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_pos_lit_dominates_cl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> pos <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L'</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>equivalent_eq_exists <span class="free">t</span> <span class="free">s</span> <span class="free">C</span> <span class="free">I</span> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="var">?s</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L'</span> <span class="main">=</span> <span class="main">(</span>Neg  <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> literal.exhaust equation.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">polarity</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L'</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">polarity</span> <span class="free">σ</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span>  <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  
    trm_ord_trans trm_ord_irrefl <span class="keyword1"><span class="command">unfolding</span></span> trans_def irrefl_def orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L'</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="var">?u</span> <span class="main">⊆</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="var">?v</span> <span class="main">⊆</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="var">?t</span> <span class="main">⊆</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="var">?s</span> <span class="main">⊆</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L'</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L</span> <span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?L</span><span class="main">,</span><span class="var">?L'</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="var">?u</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_dominating_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?t</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?u</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?u</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?u</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?u</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?v</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">=</span> <span class="var">?v</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="var">?u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="var">?s</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?t</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?s</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?s</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?v</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?s</span> <span class="main">⊆</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="var">?s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?s</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?u</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="var">?v</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="var">?u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?u</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> 
      assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  lit_ord_dominating_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?u</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?u</span><span class="main">,</span><span class="var">?t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> pos"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">≠</span> pos"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?L</span><span class="main">,</span><span class="var">?L'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_neg_lit_lhs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?L</span><span class="main">,</span><span class="var">?L'</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="var">?s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="var">?s</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def 
        equivalence_relation_def reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L'</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span> <span class="main">=</span> pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_eq_exists <span class="free">t</span> <span class="free">s</span> <span class="free">C</span> <span class="free">I</span> <span class="free">σ</span> <span class="free">L</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> equivalent_eq_exists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?s</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?s</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span><span class="main">=</span>pos›</span></span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?L</span><span class="main">,</span><span class="var">?L'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_rhs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?L</span><span class="main">,</span><span class="var">?L'</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span><span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">≠</span> <span class="var">?s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="var">?s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?s</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">,</span><span class="var">?s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="var">?t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L</span> <span class="var">?t</span> <span class="var">?s</span> pos›</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="var">?L'</span> <span class="var">?u</span> <span class="var">?v</span> <span class="skolem">polarity</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span><span class="main">=</span>pos›</span></span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?L'</span><span class="main">,</span><span class="var">?L</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">using</span></span> lit_ord_rhs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> if_all_smaller_are_false_then_cl_not_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>smaller_lits_are_false <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fo_interpretation <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> pos <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>equivalent_eq_exists <span class="free">t</span> <span class="free">s</span> <span class="free">C</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span> <span class="free">L1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span><span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span><span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">polarity</span></span> <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L'</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">polarity</span> <span class="free">σ</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> literal.exhaust equation.exhaust 
      trm_ord_trans trm_ord_irrefl <span class="keyword1"><span class="command">unfolding</span></span> trans_def irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">from</span></span> o <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> o' <span class="main">:</span> <span class="quoted"><span class="quoted">"orient_lit <span class="skolem">L</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">polarity</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span>  
    <span class="keyword1"><span class="command">have</span></span> o1 <span class="main">:</span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> pos"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L1</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted">pos</span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> o1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="skolem">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_pos <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span><span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="skolem">L</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span><span class="main">=</span>pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> lit_ord_dominating_term <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"subst <span class="free">t</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u</span> <span class="free">σ</span>"</span></span>  
          <span class="quoted"><span class="quoted">"subst <span class="skolem">v</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">L1</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">s</span> <span class="free">σ</span>"</span></span> <span class="quoted">pos</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this o <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L1</span> <span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span> <span class="main">=</span> pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>7<span class="main">)</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> equivalent_eq_exists_def same_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total trm_ord_trans 
        <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span> <span class="main">=</span> pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span><span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> smaller_lits_are_false_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polarity</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> orient_lit_semantics_neg <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span><span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="skolem">L</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> lit_ord_dominating_term <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"subst <span class="free">t</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u</span> <span class="free">σ</span>"</span></span>  
            <span class="quoted"><span class="quoted">"subst <span class="skolem">v</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">L1</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">s</span> <span class="free">σ</span>"</span></span> <span class="quoted">pos</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="skolem">L</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span> <span class="keyword2"><span class="keyword">and</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span><span class="main">=</span>neg›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">L</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">t</span> <span class="free">σ</span> <span class="main">≠</span> subst <span class="skolem">u</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lit_ord_neg_lit_lhs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">,</span> subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword2"><span class="keyword">and</span></span> o' <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span><span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> smaller_lits_are_false_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the notion of a reduction, which is a ground superposition inference 
satisfying some additional conditions: 

(i) the ``from'' clause is smaller than the ``into'' clause;

(ii) its ``body'' (i.e., the part of the clause without the equation involved 
in the rule) is false in a given interpretation and strictly smaller than the involved equation.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reduction</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">reduction</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">polarity</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span>  
       <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>eligible_literal <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>eligible_literal <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span>
       <span class="main">∧</span> ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>minimal_redex <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>coincide_on <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>allowed_redex <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> is_a_variable <span class="free"><span class="bound"><span class="entity">u'</span></span></span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">polarity</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span> 
       <span class="main">∧</span> <span class="main">(</span>orient_lit_inst <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> pos <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span> 
       <span class="main">∧</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">}</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord
       <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">}</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord<span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span>  <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span><span class="main">)</span><span class="main">)</span> 
       <span class="main">∧</span> <span class="main">(</span>subterm <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemma states that the rules used to evaluate terms can be renamed so that
they share no variable with the clause in which the term occurs.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> candidate_values_renaming<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="free">z</span> <span class="free">CC</span> <span class="free">C'</span> <span class="free">C</span> <span class="free">s</span> <span class="free">L</span> <span class="free">L'</span> <span class="free">σ</span> <span class="free">t'</span> <span class="free">s'</span> <span class="free">t</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C'</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="main">(</span><span class="free">D</span><span class="main">::</span> <span class="tfree">'a</span> eclause<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed_under_renaming <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ball <span class="free">S</span> well_constrained"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">CC_bis</span> <span class="bound">C'_bis</span> <span class="bound">L'_bis</span> <span class="bound">σ_bis</span> <span class="bound">t'_bis</span> <span class="bound">s'_bis</span> <span class="bound">t_bis</span><span class="main">.</span>
     <span class="main">(</span>candidate_values <span class="free">z</span> <span class="bound">CC_bis</span> <span class="bound">C'_bis</span> <span class="free">C</span> <span class="free">s</span> <span class="free">L</span> <span class="bound">L'_bis</span> <span class="bound">σ_bis</span> <span class="bound">t'_bis</span> <span class="bound">s'_bis</span> <span class="free">t</span> <span class="free">S</span><span class="main">)</span>
     <span class="main">∧</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="bound">CC_bis</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_cl 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> infinite_vars <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>finite <span class="free">vars</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>finite <span class="free">vars</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"renaming <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> renaming_exists <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vars</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">η</span> <span class="main">)</span> <span class="skolem">η'</span><span class="main">)</span> 
                                      <span class="main">=</span> <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> renamings_admit_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CC_bis</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC_bis</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="free">CC</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'_bis</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="free">C'</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl_ecl.simps trms_ecl.elims<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">CC_bis</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="free">CC</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">CC_bis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">z</span> <span class="main">=</span> trm_rep <span class="free">s</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>maximal_literal <span class="free">L</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L'</span> <span class="main">∈</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>smaller_lits_are_false <span class="free">t</span> <span class="free">C</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="free">L'</span> <span class="free">t'</span> <span class="free">s'</span> pos <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trms_irreducible <span class="free">CC</span> <span class="free">σ</span> <span class="free">S</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> subst <span class="free">t'</span> <span class="free">σ</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> subst <span class="free">s'</span> <span class="free">σ</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">CC</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">CC_bis</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="free">CC</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC_bis</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>   
    <span class="keyword1"><span class="command">unfolding</span></span> closed_under_renaming_def renaming_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sel</span> <span class="free">C'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sel_renaming <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'_bis</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L'</span> <span class="main">∈</span> <span class="free">C'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'_bis</span> <span class="main">∈</span> <span class="skolem">C'_bis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>comp <span class="main">(</span>comp <span class="skolem">η</span> <span class="skolem">η'</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="free">C'</span>›</span></span> i  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">η</span> <span class="main">)</span> <span class="skolem">η'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L'</span> <span class="main">∈</span> <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="free">L'</span> <span class="main">⊆</span> vars_of_cl <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_lit <span class="free">L'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">L'</span> <span class="var">?θ</span>
    <span class="main">=</span> subst_lit <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="skolem">η</span><span class="main">)</span> <span class="var">?θ'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coincide_on_def coincide_on_lit composition_of_substs_lit<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="var">?θ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'_bis</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span>  <span class="main">=</span> subst_cl <span class="free">C'</span> <span class="var">?θ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coincide_on_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="free">C'</span> <span class="var">?θ</span>
    <span class="main">=</span> subst_cl <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="var">?θ'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> composition_of_substs_cl<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span>  <span class="main">=</span> subst_cl <span class="free">C'</span> <span class="var">?θ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> subst_cl <span class="skolem">C'_bis</span> <span class="var">?θ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>finite <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C'_bis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∉</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">CC_bis</span><span class="main">)</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>  
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">CC_bis</span><span class="main">)</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">CC_bis</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">CC_bis</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">CC_bis</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="free">CC</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> trms_ecl <span class="free">CC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">CC</span> <span class="main">=</span> Ecl <span class="free">C'</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?θ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">v</span> <span class="var">?θ</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> trms_ecl <span class="free">CC</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">CC</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">v</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ball_def well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">v</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dom_trm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">v</span> <span class="var">?θ</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> trms_ecl <span class="free">CC</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">CC</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trms_irreducible <span class="skolem">CC_bis</span> <span class="var">?θ'</span> <span class="free">S</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>trms_irreducible <span class="skolem">CC_bis</span> <span class="var">?θ'</span> <span class="free">S</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> trms_ecl <span class="skolem">CC_bis</span>"</span></span> 
            <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">CC_bis</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">CC_bis</span> <span class="main">=</span> <span class="main">(</span>subst_ecl <span class="free">CC</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> trms_ecl <span class="free">CC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">CC</span> <span class="main">=</span> Ecl <span class="free">C'</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="var">?θ'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> subst <span class="skolem">v</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> trms_ecl <span class="free">CC</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">CC</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">v</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ball_def well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">v</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dom_trm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">CC</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> trms_ecl <span class="free">CC</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trms_irreducible <span class="free">CC</span> <span class="free">σ</span> <span class="free">S</span> <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">unfolding</span></span> trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'_bis</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'_bis</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="free">L'</span> <span class="free">t'</span> <span class="free">s'</span> pos <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t'</span> <span class="main">⊆</span> vars_of_lit <span class="free">L'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_lit <span class="free">L'</span><span class="main">)</span>›</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of <span class="free">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">t'</span> <span class="var">?θ</span> <span class="main">=</span> subst <span class="free">t'</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">t'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t'_bis</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="free">t'</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="free">L'</span> <span class="free">t'</span> <span class="free">s'</span> pos <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">s'</span> <span class="main">⊆</span> vars_of_lit <span class="free">L'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_lit <span class="free">L'</span><span class="main">)</span>›</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of <span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">s'</span> <span class="var">?θ</span> <span class="main">=</span> subst <span class="free">s'</span> <span class="free">σ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">s'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">s'_bis</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="free">s'</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L'_bis</span> <span class="skolem">t'_bis</span> <span class="skolem">s'_bis</span> pos <span class="var">?θ'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="free">L'</span> <span class="free">t'</span> <span class="free">s'</span> pos <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="free">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free">s'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="free">L'</span> <span class="free">t'</span> <span class="free">s'</span> pos <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t'</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s'</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orient_lit_inst_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this 
      <span class="quoted"><span class="quoted">‹<span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">t'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">s'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">t'_bis</span> <span class="skolem">s'_bis</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">s'_bis</span> <span class="skolem">t'_bis</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">s'_bis</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="free">s'</span> <span class="free">σ</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t'_bis</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="free">t'</span> <span class="free">σ</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="free">t'</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="free">s'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t'_bis</span> <span class="var">?θ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s'_bis</span> <span class="var">?θ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">t'_bis</span> <span class="skolem">s'_bis</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">s'_bis</span> <span class="skolem">t'_bis</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>maximal_literal_is_unique <span class="free">t</span> <span class="free">s</span> <span class="skolem">C'_bis</span> <span class="skolem">L'_bis</span> <span class="free">S</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>maximal_literal_is_unique <span class="free">t</span> <span class="free">s</span> <span class="skolem">C'_bis</span> <span class="skolem">L'_bis</span> <span class="free">S</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eq_occurs_in_cl <span class="free">t</span> <span class="skolem">s''</span> <span class="main">(</span><span class="skolem">C'_bis</span><span class="main">-</span> <span class="main">{</span> <span class="skolem">L'_bis</span> <span class="main">}</span><span class="main">)</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s''</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="free">s</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="skolem">s''</span> <span class="free">S</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span>  maximal_literal_is_unique_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eq_occurs_in_cl <span class="free">t</span> <span class="skolem">s''</span> <span class="main">(</span><span class="skolem">C'_bis</span><span class="main">-</span> <span class="main">{</span> <span class="skolem">L'_bis</span> <span class="main">}</span><span class="main">)</span> <span class="var">?θ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">C'_bis</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L'_bis</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="var">?θ'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq_occurs_in_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">C'_bis</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L'_bis</span> <span class="main">}</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="free">C'</span><span class="main">-</span> <span class="main">{</span> <span class="free">L'</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">M'</span> <span class="skolem">η</span> <span class="main">=</span>  <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="var">?θ'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="var">?θ'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">v</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="var">?θ'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?θ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">M'</span> <span class="skolem">η</span> <span class="main">=</span>  <span class="skolem">M</span>›</span></span> 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_equation <span class="skolem">e'</span> <span class="skolem">η</span><span class="main">)</span>  <span class="main">=</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> subst_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subst_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> atom.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          literal.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> positive_literal.elims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">v</span> <span class="skolem">u</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_equation <span class="skolem">e'</span> <span class="skolem">η</span><span class="main">)</span>  <span class="main">=</span> <span class="skolem">e</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">v'</span> <span class="skolem">u'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subst_equation.simps equation.inject subterms_of_eq.cases<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?θ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="var">?θ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v'</span> <span class="var">?θ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">v'</span> <span class="skolem">u'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="var">?θ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈</span> <span class="free">C'</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L'</span> <span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">M'</span> <span class="main">⊆</span> vars_of_cl <span class="free">C'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_lit <span class="skolem">M'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="var">?θ</span> <span class="free">σ</span> <span class="main">(</span>vars_of_lit <span class="skolem">M'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="var">?θ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_coincide <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="var">?θ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">u'</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">M'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
       <span class="quoted"><span class="quoted">"vars_of <span class="skolem">v'</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">M'</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">u'</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">M'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="var">?θ</span> <span class="free">σ</span> <span class="main">(</span>vars_of_lit <span class="skolem">M'</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="var">?θ</span> <span class="free">σ</span> <span class="main">(</span>vars_of <span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u'</span> <span class="var">?θ</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">v'</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">M'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="var">?θ</span> <span class="free">σ</span> <span class="main">(</span>vars_of_lit <span class="skolem">M'</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="var">?θ</span> <span class="free">σ</span> <span class="main">(</span>vars_of <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">v'</span> <span class="var">?θ</span> <span class="main">=</span> subst <span class="skolem">v'</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">v</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="skolem">v'</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">v</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="skolem">v'</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="var">?θ'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">u</span> <span class="var">?θ'</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="var">?θ'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈</span> <span class="free">C'</span> <span class="main">-</span> <span class="main">{</span> <span class="free">L'</span><span class="main">}</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eq_occurs_in_cl <span class="free">t</span> <span class="skolem">s''</span> <span class="main">(</span><span class="free">C'</span><span class="main">-</span> <span class="main">{</span> <span class="free">L'</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq_occurs_in_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">s''</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="free">s</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trm_rep <span class="skolem">s''</span> <span class="free">S</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>maximal_literal_is_unique <span class="free">t</span> <span class="free">s</span> <span class="free">C'</span> <span class="free">L'</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_is_unique_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> subst <span class="free">t'</span> <span class="free">σ</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> subst <span class="skolem">t'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> subst <span class="free">t'</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'_bis</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">s'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">=</span> subst <span class="free">s'</span> <span class="free">σ</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> subst <span class="skolem">s'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">s'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> subst <span class="free">s'</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">CC_bis</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="skolem">CC_bis</span><span class="main">)</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹trms_irreducible <span class="skolem">CC_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="free">t</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> cl_ecl <span class="skolem">CC_bis</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">=</span> trm_rep <span class="free">s</span> <span class="free">S</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L'_bis</span> <span class="skolem">t'_bis</span> <span class="skolem">s'_bis</span> pos <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sel</span> <span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'_bis</span> <span class="main">∈</span> <span class="skolem">C'_bis</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="free">L</span> <span class="free">C</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> subst_lit <span class="skolem">L'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">=</span> subst_cl <span class="skolem">C'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹ground_clause <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> subst <span class="skolem">t'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">=</span> subst <span class="skolem">s'_bis</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹finite <span class="skolem">C'_bis</span>›</span></span> <span class="quoted"><span class="quoted">‹smaller_lits_are_false <span class="free">t</span> <span class="free">C</span> <span class="free">S</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹maximal_literal_is_unique <span class="free">t</span> <span class="free">s</span> <span class="skolem">C'_bis</span> <span class="skolem">L'_bis</span> <span class="free">S</span> <span class="main">(</span>comp <span class="skolem">η'</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="free">z</span> <span class="skolem">CC_bis</span> <span class="skolem">C'_bis</span> <span class="free">C</span> <span class="free">s</span> <span class="free">L</span> <span class="skolem">L'_bis</span> <span class="var">?θ'</span> <span class="skolem">t'_bis</span> <span class="skolem">s'_bis</span> <span class="free">t</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">CC_bis</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">CC_bis</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">CC_bis</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="skolem">C'_bis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="skolem">C'_bis</span>›</span></span>  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> <span class="skolem">C'_bis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">∈</span> <span class="skolem">C'_bis</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'_bis</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">N'</span> <span class="main">∈</span> <span class="free">C'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> subst_lit <span class="skolem">N'</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_lit <span class="skolem">N</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of_eq <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> negative_literal.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> negative_literal.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> vars_of_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            vars_of_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">=</span> subst_lit <span class="skolem">N'</span> <span class="skolem">η</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">N'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">N'</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> subst_equation <span class="skolem">e'</span> <span class="skolem">η</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subst_lit.elims atom.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atom.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_eq <span class="skolem">e</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">u</span> <span class="main">∪</span> vars_of <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equation.exhaust vars_of_eq.simps<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> subst_equation <span class="skolem">e'</span> <span class="skolem">η</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subst_equation.simps equation.exhaust equation.inject<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">u</span> <span class="main">∪</span> vars_of <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">u</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="skolem">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vars_of_instances <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="skolem">u'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_eq <span class="skolem">e'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">N'</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_lit <span class="skolem">N'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">∈</span> <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_cl <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"Var <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_a_variable.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singletonD vars_of.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> vars_of_cl <span class="free">C'</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vars_of_instances <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> vars_of <span class="skolem">v'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="skolem">u'</span> <span class="skolem">v'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_eq <span class="skolem">e'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="skolem">e'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">N'</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="skolem">e'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_lit <span class="skolem">N'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N'</span> <span class="main">∈</span> <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> vars_of_cl <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹renaming <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"Var <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">y</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_a_variable.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singletonD vars_of.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> vars_of_cl <span class="free">C'</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subst_codomain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst_codomain <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="free">C'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>candidate_values <span class="free">z</span> <span class="skolem">CC_bis</span> <span class="skolem">C'_bis</span> <span class="free">C</span> <span class="free">s</span> <span class="free">L</span> <span class="skolem">L'_bis</span> <span class="var">?θ'</span> <span class="skolem">t'_bis</span> <span class="skolem">s'_bis</span> <span class="free">t</span> <span class="free">S</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pos_ord_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> acyclic_irrefl pos_ord_irrefl pos_ord_trans<span class="main">)</span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proper_subterm_red</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">proper_subterm_red</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>subterm <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">p</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> Nil <span class="main">∧</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≠</span> <span class="main">(</span>subst <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma states that if an eligible term in a clause instance 
is not in normal form, then the clause instance must be reducible (according to the previous
definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"reduction"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). This is the key lemma for proving completeness. 
Note that we assume that the considered substitution is in normal form, so that the reduction 
cannot occur inside a variable. We also rename the clause used for the reduction, to ensure that it 
shares no variable with the provided clause.  
The proof requires an additional hypothesis in the case where the reducible term occurs at the root
position in an eligible term of a positive literal, see the first hypothesis below 
and function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"equivalent_eq_exists"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reduction_exists<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="main">¬</span> equivalent_eq_exists <span class="free">t</span> <span class="free">s</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="free">σ</span> <span class="free">L1</span>
    <span class="main">∨</span> proper_subterm_red <span class="free">t</span> <span class="free">S</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span> <span class="bound">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>occurs_in <span class="bound">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">⟶</span> trm_rep <span class="bound">y</span> <span class="free">S</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="free">L1</span> <span class="free">C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span>  <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fo_interpretation <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ball <span class="free">S</span> well_constrained"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed_under_renaming <span class="free">S</span>"</span></span>

  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ'</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">p</span> <span class="bound">v</span> <span class="bound">D</span> <span class="bound">L2</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">(</span>reduction <span class="free">L1</span> <span class="free">C</span> <span class="bound">σ'</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="bound">L2</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">p</span> <span class="bound">v</span> <span class="bound">D</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span>variable_disjoint <span class="free">C</span> <span class="bound">D</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first step is to get the minimal reducible position in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>subst <span class="free"><span class="free">t</span></span> <span class="free"><span class="free">σ</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
the corresponding subterm <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Redexes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span><span class="main">.</span> subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">∧</span> root_term <span class="free">S</span> <span class="bound">v</span> <span class="main">∧</span> trm_rep <span class="bound">v</span> <span class="free">S</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Redexes</span> <span class="main">⊆</span> pos_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?Redexes</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">x</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"position_in <span class="skolem">x</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> position_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pos_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?Redexes</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_of_positions_is_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterms_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="var">?Redexes</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> st_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?Redexes</span>›</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mp</span> <span class="main">∈</span> <span class="var">?Redexes</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="skolem">mp</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">p'</span> <span class="main">∉</span> <span class="var">?Redexes</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> pos_ord_acyclic <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> finite_proj_wf <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Redexes</span></span></span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="quoted">"<span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> mr<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_redex <span class="skolem">mp</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">C</span> <span class="free">S</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>minimal_redex <span class="skolem">mp</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">C</span> <span class="free">S</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p''</span><span class="main">,</span><span class="skolem">mp</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p''</span> <span class="skolem">v'</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> minimal_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>root_term <span class="free">S</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p''</span> <span class="skolem">v'</span>›</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v'</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">∈</span><span class="var">?Redexes</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="skolem">mp</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">p'</span> <span class="main">∉</span> <span class="var">?Redexes</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p''</span><span class="main">,</span><span class="skolem">mp</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>root_term <span class="free">S</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"st_red <span class="free">S</span> <span class="skolem">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subterms_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'''</span></span> <span class="skolem"><span class="skolem">v''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">v'</span> <span class="skolem">p'''</span> <span class="skolem">v''</span>"</span></span> <span class="quoted"><span class="quoted">"root_term <span class="free">S</span> <span class="skolem">v''</span>"</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v''</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> st_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">v'</span> <span class="skolem">p'''</span> <span class="skolem">v''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p''</span> <span class="skolem">v'</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>append <span class="skolem">p''</span> <span class="skolem">p'''</span><span class="main">)</span> <span class="skolem">v''</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subterm_of_a_subterm_is_a_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v''</span>›</span></span> <span class="quoted"><span class="quoted">‹root_term <span class="free">S</span> <span class="skolem">v''</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>append <span class="skolem">p''</span> <span class="skolem">p'''</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Redexes</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="skolem">mp</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">p'</span> <span class="main">∉</span> <span class="var">?Redexes</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>append <span class="skolem">p''</span> <span class="skolem">p'''</span><span class="main">,</span><span class="skolem">mp</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p''</span><span class="main">,</span><span class="skolem">mp</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> pos_ord_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>  
   
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">mp</span> <span class="main">∈</span> <span class="var">?Redexes</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mp</span><span class="main">=</span><span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"root_term <span class="free">S</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> st_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Second, we find the clause <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">C2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and substitution <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">η</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that are used to 
determine the value of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> according to the definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"trm_rep"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
 and we prove that they satisfy all the desired properties. 
In particular, clause <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">C2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>  is renamed to ensure that it shares no variable
with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    si<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="free">t</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>is_a_variable <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="free">t</span> <span class="skolem">p</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subterms_of_instances <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹root_term <span class="free">S</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> root_term_def get_min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> some_in_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">∈</span> min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> fst <span class="skolem">pair</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    min_pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pair'</span><span class="main">∈</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">v</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">pair'</span><span class="main">,</span> snd <span class="skolem">pair</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> min_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair</span> <span class="main">∈</span> <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="bound">s</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span><span class="main">.</span> <span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>candidate_values <span class="bound">z</span> <span class="bound">CC</span> <span class="bound">C'</span> <span class="bound">C</span> <span class="bound">s</span> <span class="bound">L</span> <span class="bound">L'</span> <span class="bound">σ</span> <span class="bound">t'</span> <span class="bound">s'</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_of_candidate_values_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="skolem"><span class="skolem">C2_init</span></span> <span class="skolem"><span class="skolem">Cl_C2_init</span></span> <span class="skolem"><span class="skolem">gr_Cl_C2</span></span> <span class="skolem"><span class="skolem">gr_rhs</span></span> <span class="skolem"><span class="skolem">gr_L2</span></span> <span class="skolem"><span class="skolem">L2_init</span></span> <span class="skolem"><span class="skolem">η_init</span></span> <span class="skolem"><span class="skolem">lhs_init</span></span> <span class="skolem"><span class="skolem">rhs_init</span></span>  
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">zz</span><span class="main">,</span>  <span class="skolem">gr_rhs</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="skolem">zz</span> <span class="skolem">C2_init</span> <span class="skolem">Cl_C2_init</span> <span class="skolem">gr_Cl_C2</span> <span class="skolem">gr_rhs</span> <span class="skolem">gr_L2</span> <span class="skolem">L2_init</span>
          <span class="skolem">η_init</span> <span class="skolem">lhs_init</span> <span class="skolem">rhs_init</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>candidate_values <span class="skolem">zz</span> <span class="skolem">C2_init</span> <span class="skolem">Cl_C2_init</span> <span class="skolem">gr_Cl_C2</span> <span class="skolem">gr_rhs</span> <span class="skolem">gr_L2</span> <span class="skolem">L2_init</span> 
            <span class="skolem">η_init</span> <span class="skolem">lhs_init</span> <span class="skolem">rhs_init</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>›</span></span>   
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Cl_C2_init</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    
   <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>11<span class="main">)</span> <span class="quoted"><span class="quoted">‹closed_under_renaming <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Cl_C2_init</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>candidate_values <span class="skolem">zz</span> <span class="skolem">C2_init</span> <span class="skolem">Cl_C2_init</span> <span class="skolem">gr_Cl_C2</span> <span class="skolem">gr_rhs</span> <span class="skolem">gr_L2</span> <span class="skolem">L2_init</span> 
        <span class="skolem">η_init</span> <span class="skolem">lhs_init</span> <span class="skolem">rhs_init</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">Cl_C2</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">lhs</span></span> <span class="skolem"><span class="skolem">rhs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="skolem">zz</span> <span class="skolem">C2</span> <span class="skolem">Cl_C2</span> <span class="skolem">gr_Cl_C2</span> <span class="skolem">gr_rhs</span> <span class="skolem">gr_L2</span> <span class="skolem">L2</span> <span class="skolem">η</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∩</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> candidate_values_renaming <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">zz</span></span> <span class="quoted"><span class="skolem">C2_init</span></span> <span class="quoted"><span class="skolem">Cl_C2_init</span></span> <span class="quoted"><span class="skolem">gr_Cl_C2</span></span> <span class="quoted"><span class="skolem">gr_rhs</span></span> <span class="quoted"><span class="skolem">gr_L2</span></span> <span class="quoted"><span class="skolem">L2_init</span></span>
        <span class="quoted"><span class="skolem">η_init</span></span> <span class="quoted"><span class="skolem">lhs_init</span></span> <span class="quoted"><span class="skolem">rhs_init</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>candidate_values <span class="skolem">zz</span> <span class="skolem">C2</span> <span class="skolem">Cl_C2</span> <span class="skolem">gr_Cl_C2</span> <span class="skolem">gr_rhs</span> <span class="skolem">gr_L2</span> <span class="skolem">L2</span> <span class="skolem">η</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">zz</span><span class="main">,</span>  <span class="skolem">gr_rhs</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> cv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="var">?v</span> <span class="skolem">C2</span> <span class="skolem">Cl_C2</span> <span class="skolem">gr_Cl_C2</span> <span class="skolem">gr_rhs</span> <span class="skolem">gr_L2</span> <span class="skolem">L2</span> <span class="skolem">η</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span> 
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="skolem">gr_Cl_C2</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

   <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_of_variables_is_finite_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smaller_lits_are_false <span class="skolem">v</span> <span class="skolem">gr_Cl_C2</span> <span class="free">S</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="skolem">gr_L2</span> <span class="skolem">gr_Cl_C2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="skolem">gr_Cl_C2</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gr_L2</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="skolem">gr_rhs</span> <span class="free">S</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C2</span> <span class="main">=</span> cl_ecl <span class="skolem">C2</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">gr_L2</span> <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L2</span> <span class="skolem">C2</span> <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x'</span><span class="main">∈</span> trms_ecl <span class="skolem">C2</span><span class="main">.</span> occurs_in <span class="bound">x</span> <span class="main">(</span>subst <span class="bound">x'</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span> <span class="main">⟶</span> trm_rep <span class="bound">x</span> <span class="free">S</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gr_rhs</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   
   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

   <span class="keyword1"><span class="command">have</span></span> no_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> equivalent_eq_exists <span class="skolem">lhs</span> <span class="skolem">rhs</span> <span class="skolem">Cl_C2</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">η</span> <span class="skolem">L2</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"equivalent_eq_exists <span class="skolem">lhs</span> <span class="skolem">rhs</span> <span class="skolem">Cl_C2</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">η</span> <span class="skolem">L2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L</span><span class="main">∈</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span><span class="main">.</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> orient_lit_inst <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="skolem">η</span> <span class="main">∧</span>
           subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="bound">u</span> <span class="skolem">η</span> <span class="main">∧</span> same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="bound">v</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> equivalent_eq_exists_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span><span class="main">∈</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> orient_lit_inst <span class="skolem">M</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="skolem">η</span> <span class="main">∧</span>
           subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="bound">u</span> <span class="skolem">η</span> <span class="main">∧</span> same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="bound">v</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> e <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="skolem">η</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="skolem">η</span> <span class="main">∧</span> same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="var">?u'</span> <span class="var">?v'</span> pos"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span> 
      <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> pos"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eq_occurs_in_cl <span class="var">?u'</span> <span class="var">?v'</span> <span class="main">(</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span><span class="main">)</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq_occurs_in_cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">∈</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">∈</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span>  
      <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> pos›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="var">?u'</span> <span class="var">?v'</span> pos›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="var">?v'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">gr_L2</span> <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gr_L2</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> lit_ord"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="var">?u'</span> <span class="var">?v'</span> pos›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> pos›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="skolem">η</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span><span class="main">,</span><span class="var">?v'</span><span class="main">)</span> <span class="main">∉</span>  <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lit_ord_rhs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="var">?v'</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?v'</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>  <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v'</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal_is_unique <span class="skolem">v</span> <span class="skolem">gr_rhs</span> <span class="skolem">Cl_C2</span> <span class="skolem">L2</span> <span class="free">S</span> <span class="skolem">η</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> pos <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">gr_rhs</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">u'</span> <span class="skolem">η</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹eq_occurs_in_cl <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span><span class="main">)</span> <span class="skolem">η</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹maximal_literal_is_unique <span class="skolem">v</span> <span class="skolem">gr_rhs</span> <span class="skolem">Cl_C2</span> <span class="skolem">L2</span> <span class="free">S</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> 
            maximal_literal_is_unique_def<span class="main">)</span> 

    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">from</span></span>  this <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span>›</span></span>  
   <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span>  
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹smaller_lits_are_false <span class="skolem">v</span> <span class="skolem">gr_Cl_C2</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span>›</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">gr_L2</span> <span class="skolem">gr_Cl_C2</span>›</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">η</span>›</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="skolem">gr_rhs</span> <span class="free">S</span>›</span></span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> if_all_smaller_are_false_then_cl_not_valid <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lhs</span></span> <span class="quoted"><span class="skolem">η</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C2</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">L2</span></span> <span class="quoted"><span class="skolem">rhs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We fuse the substitutions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">η</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> so that the superposition rule 
can be applied:›</span></span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_clauses_and_ground_substs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∩</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
    <span class="quoted"><span class="quoted">‹ground_on <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span>›</span></span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ'</span> <span class="free">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> combine_substs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="free">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> coincide_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> coincide_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="free">L1</span> <span class="free">C</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="free">L1</span> <span class="free">C</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eligible_literal_coincide <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L2</span> <span class="skolem">C2</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> 
          <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L2</span> <span class="skolem">C2</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eligible_literal_coincide <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> cl_ecl <span class="skolem">C2</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> coincide_on_cl<span class="main">)</span> 

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="free">L1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">L2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="free">L1</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_coincide <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L1</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">polarity</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">L2</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_coincide  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To prove that the superposition rule is applicable, we need to show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
does not occur inside a variable:›</span></span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="free">t</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">q1</span> <span class="bound">q2</span><span class="main">.</span> <span class="main">(</span>is_a_variable <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="main">(</span>subst <span class="bound">x</span> <span class="free">σ</span><span class="main">)</span> <span class="bound">q1</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="main">(</span>subterm <span class="free">t</span> <span class="bound">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span>append <span class="bound">q2</span> <span class="bound">q1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_a_variable <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">x</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">q1</span> <span class="skolem">v</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="main">(</span>subst <span class="skolem">x</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">q1</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="free">t</span> <span class="skolem">q2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterm <span class="main">(</span>subst <span class="skolem">x</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">q1</span> <span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">v</span> <span class="main">(</span>subst <span class="skolem">x</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_a_variable <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Var <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_a_variable.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="free">t</span> <span class="skolem">q2</span> <span class="skolem">x</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of <span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subterms_of.simps <span class="keyword1"><span class="command">unfolding</span></span>  occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of_lit <span class="free">L1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orient_lit_inst_subterms<span class="main">)</span>   
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">x</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">v</span> <span class="main">(</span>subst <span class="skolem">x</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Var <span class="skolem">x'</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> si <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_a_variable <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="free">t</span> <span class="skolem">p</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="free">t</span> <span class="skolem">p</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">u</span> <span class="main">⊆</span> vars_of <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vars_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_lit <span class="free">L1</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">u</span> <span class="main">⊆</span> vars_of <span class="free">t</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="free">L1</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">lhs</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">rhs</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">lhs</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L2</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">L2</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of <span class="skolem">lhs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">rhs</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L2</span>›</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">L2</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of <span class="skolem">rhs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">rhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">σ'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="skolem">gr_rhs</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">rhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">σ'</span>›</span></span>  <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">u</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u</span> <span class="skolem">σ'</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span>  <span class="main">(</span>vars_of_cl <span class="main">(</span><span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coincide_on_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>cl_ecl <span class="skolem">C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span>cl_ecl <span class="skolem">C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>  
      <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gr_L2</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> cl_ecl <span class="skolem">C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">gr_Cl_C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> cl_ecl <span class="skolem">C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">gr_L2</span> <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> cl_ecl <span class="skolem">C2</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>  
    <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span>›</span></span> no_fact assms<span class="main">(</span>9<span class="main">)</span>
    <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">η</span><span class="main">,</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> max_pos_lit_dominates_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">L2</span></span> <span class="quoted"><span class="skolem">η</span></span> <span class="quoted"><span class="skolem">Cl_C2</span></span> <span class="quoted"><span class="skolem">lhs</span></span> <span class="quoted"><span class="skolem">rhs</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L2</span> <span class="main">⊆</span> vars_of_cl <span class="skolem">Cl_C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> cl_ecl <span class="skolem">C2</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">L2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cl_ecl <span class="skolem">C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">x</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_lit <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span> <span class="main">=</span> subst_lit <span class="skolem">x</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">η</span><span class="main">,</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> lit_ord›</span></span>
      <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span> <span class="main">=</span> subst_lit <span class="skolem">x</span> <span class="skolem">η</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">,</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">y</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> trms_ecl <span class="skolem">C2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>11<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C2</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">x'</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ball_def well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x''</span></span> 
       <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">x''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> dom_trm_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹dom_trm <span class="skolem">x'</span> <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">x'</span>  <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> dom_trm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ'</span> <span class="skolem">η</span> <span class="main">(</span>vars_of <span class="skolem">x'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> trms_ecl <span class="skolem">C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x''</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subterm_cl_subst <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x''</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">C2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="skolem">gr_L2</span>  <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="skolem">gr_rhs</span> pos"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹orient_lit <span class="skolem">gr_L2</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span> <span class="skolem">gr_rhs</span> pos›</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="skolem">gr_L2</span> <span class="skolem">gr_Cl_C2</span>›</span></span>  
    <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> cl_ecl <span class="skolem">C2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>  
    <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subterms_dominated <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">gr_L2</span></span> <span class="quoted"><span class="skolem">gr_Cl_C2</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">gr_rhs</span></span> <span class="quoted">pos</span> <span class="quoted"><span class="quoted">"subst <span class="skolem">x''</span> <span class="skolem">η</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x''</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">x''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>subst <span class="skolem">x''</span> <span class="skolem">η</span><span class="main">)</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_trans trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">η</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">y</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def 
        <span class="keyword1"><span class="command">using</span></span> subterm_trm_ord_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_trans 
        <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> norm <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">y</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">y</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> trms_ecl <span class="skolem">C2</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
   
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="free">t</span> <span class="skolem">p</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_trm_ord_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="free">L1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">η</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">L2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">gr_Cl_C2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_Cl_C2</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove that the ``into'' clause is strictly smaller than the ``from'' clause. This is
easy if the rewritten literal is negative or if the reduction does not occur at root level. 
Otherwise, we must use the fact that the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"trm_rep"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> selects the smallest right-hand
side to compute the value of a term.›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>  
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="skolem">σ'</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> 
          <span class="main">(</span>subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">polarity</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L1</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">polarity</span></span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">σ'</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> 
          <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> pos"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">,</span> subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="quoted"><span class="quoted">"subst <span class="skolem">u</span> <span class="skolem">σ'</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">,</span> subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹subst <span class="skolem">u</span> <span class="free">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">L2</span> <span class="skolem">η</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">polarity</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        lit_ord_dominating_term <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">,</span> subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span> 
        <span class="quoted"><span class="quoted">‹subst <span class="skolem">u</span> <span class="skolem">σ'</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">polarity</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> pos›</span></span> 
        <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        lit_ord_dominating_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="free">t</span> <span class="skolem">p</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Nil"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_trm_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proper_subterm_red <span class="free">t</span> <span class="free">S</span> <span class="free">σ</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proper_subterm_red <span class="free">t</span> <span class="free">S</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> Nil"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subterm <span class="free">t</span> <span class="skolem">p'</span> <span class="skolem">s</span>"</span></span> 
        <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proper_subterm_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> Nil›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> Nil›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> pos_ord_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="free">t</span> <span class="skolem">p'</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p'</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> substs_preserve_subterms<span class="main">)</span>
        
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="free">C</span> <span class="free">t</span><span class="main">)</span>›</span></span> mr <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">mp</span><span class="main">=</span><span class="skolem">p</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> minimal_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">≠</span> pos"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">t</span> <span class="skolem">σ'</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> 
          <span class="main">(</span>subst <span class="free">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">polarity</span>›</span></span> 
           <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> 
          <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> pos›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span>
          <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span>  <span class="main">=</span> <span class="main">{}</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> lit_ord_neg_lit_lhs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> assms<span class="main">(</span>6<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lift_orient_lit orient_lit_vars 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> assms<span class="main">(</span>6<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lift_orient_lit orient_lit_vars 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> same_values_def <span class="keyword1"><span class="command">using</span></span> validate_ground_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> same_values_def <span class="keyword1"><span class="command">using</span></span> validate_ground_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span><span class="main">=</span>pos›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L1</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">L1</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        subst_lit <span class="free">L1</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> validate_ground_lit.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">have</span></span> cv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="free">C</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> 
                  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">L1</span> <span class="free">σ</span> <span class="free">t</span> <span class="free">s</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span><span class="main">=</span>pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>negative_literal <span class="free">L1</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span>  orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="free">L1</span> <span class="free">C</span> <span class="free">σ</span>›</span></span>  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span><span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sel_neg <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> subst <span class="free">t</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>12<span class="main">)</span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="free">t</span> <span class="free">σ</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="free">t</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smaller_lits_are_false <span class="skolem">v</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> smaller_lits_are_false_if_cl_not_valid <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proper_subterm_red <span class="free">t</span> <span class="free">S</span> <span class="free">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span><span class="main">=</span>pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="free">t</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"maximal_literal_is_unique <span class="skolem">v</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">L1</span> <span class="free">S</span> <span class="free">σ</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> maximal_literal_is_unique_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">L1</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_irreducible <span class="free">C</span> <span class="free">σ</span> <span class="free">S</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trms_irreducible_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
            <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">,</span> subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span><span class="main">=</span>pos›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> cl_ecl <span class="free">C</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="free">t</span> <span class="free">σ</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹smaller_lits_are_false <span class="skolem">v</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal_is_unique <span class="skolem">v</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">L1</span> <span class="free">S</span> <span class="free">σ</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trms_irreducible <span class="free">C</span> <span class="free">σ</span> <span class="free">S</span> <span class="skolem">v</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> cv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="free">C</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> 
            <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="free">σ</span><span class="main">)</span> <span class="free">L1</span> <span class="free">σ</span> <span class="free">t</span> <span class="free">s</span> <span class="skolem">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">qed</span></span>
          
     <span class="keyword1"><span class="command">from</span></span> cv' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span><span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set_of_candidate_values <span class="free">S</span> <span class="skolem">v</span>"</span></span> 
     <span class="keyword1"><span class="command">unfolding</span></span> set_of_candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> min_pair <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">zz</span><span class="main">,</span>  <span class="skolem">gr_rhs</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="skolem">gr_rhs</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_conv<span class="main">)</span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">≠</span> <span class="skolem">gr_rhs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="skolem">gr_rhs</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>›</span></span>   
            <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">gr_rhs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">rhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">σ'</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">L2</span> <span class="skolem">η</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">gr_L2</span> <span class="main">=</span> subst_lit <span class="skolem">L2</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">η</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> pos›</span></span> 
      <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">gr_L2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">≠</span> <span class="skolem">gr_rhs</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">gr_rhs</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="skolem">gr_rhs</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span><span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span> subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">rhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">σ'</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹subst_lit <span class="free">L1</span> <span class="free">σ</span> <span class="main">=</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">η</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> pos›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
        assms<span class="main">(</span>6<span class="main">)</span> lit_ord_rhs lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∉</span> lit_ord›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">v</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"allowed_redex <span class="skolem">u</span> <span class="free">C</span> <span class="free">σ</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>allowed_redex <span class="skolem">u</span> <span class="free">C</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">ss</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> allowed_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ss</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">ss</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>12<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">ss</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">lhs</span> <span class="skolem">σ'</span> <span class="main">≠</span> subst <span class="skolem">rhs</span> <span class="skolem">σ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">gr_rhs</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹subst <span class="skolem">lhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹subst <span class="skolem">rhs</span> <span class="skolem">η</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">σ'</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="skolem">gr_rhs</span> <span class="main">=</span> subst <span class="skolem">rhs</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">η</span>›</span></span> trm_ord_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">mp</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>is_a_variable <span class="skolem">u</span><span class="main">)</span>›</span></span>
   <span class="quoted"><span class="quoted">‹all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>›</span></span>
   <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="free">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord›</span></span> 
   <span class="quoted"><span class="quoted">‹all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>›</span></span>  
   <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>cl_ecl <span class="skolem">C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">L2</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">,</span> subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> lit_ord<span class="main">)</span>›</span></span> 
   <span class="quoted"><span class="quoted">‹<span class="skolem">C2</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="free">L1</span> <span class="free">C</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L2</span> <span class="skolem">C2</span> <span class="skolem">σ'</span>›</span></span> 
   <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="skolem">Cl_C2</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C2</span> <span class="main">=</span> cl_ecl <span class="skolem">C2</span>›</span></span> 
    mr <span class="quoted"><span class="quoted">‹coincide_on <span class="free">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L1</span> <span class="main">∈</span> cl_ecl <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="skolem">Cl_C2</span>›</span></span>  
    <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L1</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="skolem">σ'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">rhs</span> pos <span class="skolem">σ'</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterm <span class="free">t</span> <span class="skolem">p</span> <span class="skolem">u</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">u</span> <span class="skolem">σ'</span> <span class="main">=</span> subst <span class="skolem">lhs</span> <span class="skolem">σ'</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">rhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">lhs</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="skolem">Cl_C2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹allowed_redex <span class="skolem">u</span> <span class="free">C</span> <span class="free">σ</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reduction <span class="free">L1</span> <span class="free">C</span> <span class="skolem">σ'</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">u</span> <span class="skolem">mp</span> <span class="skolem">rhs</span> <span class="skolem">C2</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reduction_def same_values_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∩</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"variable_disjoint <span class="free">C</span> <span class="skolem">C2</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> variable_disjoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>reduction <span class="free">L1</span> <span class="free">C</span> <span class="skolem">σ'</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="skolem">L2</span> <span class="skolem">lhs</span> <span class="skolem">u</span> <span class="skolem">mp</span> <span class="skolem">rhs</span> <span class="skolem">C2</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span>›</span></span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subts_of_irred_trms_are_irred<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="free">y</span> <span class="free">S</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> subterm <span class="bound">x</span> <span class="free">p</span> <span class="free">y</span> <span class="main">⟶</span> trm_rep <span class="bound">x</span> <span class="free">S</span> <span class="main">≠</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subterm.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> subterm <span class="bound">x</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">y</span> <span class="main">⟶</span> trm_rep <span class="bound">x</span> <span class="free">S</span> <span class="main">≠</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">x</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Comb <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left <span class="main">|</span> <span class="skolem">i</span> <span class="main">=</span> Right"</span></span> <span class="keyword1"><span class="command">using</span></span> indices.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">x</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Left"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">x</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Comb <span class="skolem">x1</span> <span class="skolem">x2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">x1</span> <span class="skolem">p</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Cons.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">x1</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Comb <span class="skolem">x1</span> <span class="skolem">x2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_applicable_def  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_compound.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  trm_rep_is_lower_subt_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Right"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">x</span> <span class="main">(</span>Cons <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Comb <span class="skolem">x1</span> <span class="skolem">x2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">x2</span> <span class="skolem">p</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Cons.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">x2</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Comb <span class="skolem">x1</span> <span class="skolem">x2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm_reduction_applicable <span class="free">S</span> <span class="skolem">x</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> subterm_reduction_applicable_def  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_compound.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rhs.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="skolem">x</span> <span class="free">S</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  trm_rep_is_lower_subt_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> allowed_redex_coincide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"allowed_redex <span class="free">t</span> <span class="free">C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> subterms_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"allowed_redex <span class="free">t</span> <span class="free">C</span> <span class="free">σ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>allowed_redex <span class="free">t</span> <span class="free">C</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> allowed_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> dom_trm_vars <span class="keyword1"><span class="command">unfolding</span></span> well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">s</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="free">t</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span>vars_of <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> trms_ecl <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>allowed_redex <span class="free">t</span> <span class="free">C</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> allowed_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemma states that the irreducibility of an instance of a set of terms 
is preserved when the substitution is replaced by its equivalent normal form.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irred_terms_and_reduced_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">=</span> <span class="main">(</span>map_subst <span class="free">f</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">σ</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> int_clset <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalent_on  <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">η</span> <span class="free">σ</span>  <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> trms_ecl <span class="bound">x</span> <span class="main">⟶</span> dom_trm <span class="bound">y</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">η</span> <span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">η</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">t</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="skolem">y</span> <span class="skolem">p</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subts_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">η</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>7<span class="main">)</span> assms<span class="main">(</span>8<span class="main">)</span> assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">z</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">z</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dom_trm_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">z</span><span class="main">)</span> <span class="free">I</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">z</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="free">η</span> <span class="free">σ</span>  <span class="main">(</span>vars_of <span class="skolem">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
       <span class="quoted"><span class="quoted">‹lower_on <span class="free">η</span> <span class="free">σ</span>  <span class="main">(</span>vars_of <span class="skolem">z</span><span class="main">)</span>›</span></span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> lower_on_term <span class="keyword1"><span class="command">unfolding</span></span> lower_or_eq_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span> <span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trm_ord_trans trm_ord_irrefl irrefl_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>10<span class="main">)</span> <span class="quoted"><span class="quoted">‹equivalent_on <span class="free">σ</span> <span class="free">η</span> <span class="main">(</span>vars_of <span class="skolem">z</span><span class="main">)</span> <span class="free">I</span>›</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equivalent_on_term 
      <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span> <span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">z</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">z</span> <span class="free">η</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_valid_literal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> pos <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> neg_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int_clset <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> neg_hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def <span class="keyword1"><span class="command">using</span></span> validate_ground_eq.simps 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> same_values_def  int_clset_def  <span class="keyword1"><span class="command">using</span></span> validate_ground_eq.simps 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="free">L</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
            subst_lit <span class="free">L</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> validate_ground_lit.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lifting›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section contains all the necessary lemmata for transforming ground inferences into 
first-order inferences. We show that all the necessary properties can be lifted.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_orient_lit_inst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst  <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">θ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subst_eq <span class="free">θ</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="free">L</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span>
         <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span>
         <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span>
         <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span>
         <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>subst <span class="free">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_maximal_literal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="free">L</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>maximal_literal <span class="free">L</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="main">,</span><span class="skolem">M</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">L</span><span class="main">,</span><span class="skolem">M</span><span class="main">)</span> <span class="main">∈</span> lit_ord›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lit_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_eligible_literal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="free">L</span> <span class="free">C</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="free">L</span> <span class="free">C</span> <span class="free">θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="free">sel</span><span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
    <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">∈</span> <span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span><span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
     <span class="main">∧</span> <span class="main">(</span>maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="var">?σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subst_eq_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_lit <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">θ</span></span> <span class="quoted"><span class="free">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="var">?σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subst_eq_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="quoted">"<span class="var">?σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cl_ecl <span class="free">C</span>"</span></span> <span class="quoted"><span class="free">θ</span></span> <span class="quoted"><span class="free">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> 
         <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_maximal_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_allowed_redex<span class="main">:</span>  
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>allowed_redex <span class="free">u</span> <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>allowed_redex <span class="free">u</span> <span class="free">C</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>allowed_redex <span class="free">u</span> <span class="free">C</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>occurs_in <span class="main">(</span>subst <span class="free">u</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> allowed_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>occurs_in <span class="main">(</span>subst <span class="free">u</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>occurs_in <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">u</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substs_preserve_occurs_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">u</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>occurs_in <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">u</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="free">u</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">θ</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>occurs_in <span class="main">(</span>subst <span class="free">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> allowed_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_decompose_literal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span> <span class="free">t</span> <span class="free">s</span> <span class="free">polarity</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subst_eq <span class="free">θ</span> <span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">s</span> <span class="free">η</span><span class="main">)</span> <span class="free">polarity</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">s</span> <span class="free">η</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>comp <span class="free">σ</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="var">?L</span> <span class="free">η</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 
      subst_eq_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?L'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos <span class="main">∨</span> <span class="free">polarity</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> pos"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L'</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="var">?t'</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L'</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="var">?s'</span> <span class="var">?t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this  <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?L'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="var">?t'</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> Pos <span class="main">(</span>Eq <span class="var">?s'</span> <span class="var">?t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> pos›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def 
      decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">polarity</span> <span class="main">=</span> neg"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">t</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="var">?t'</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="var">?s'</span> <span class="var">?t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="var">?L'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="var">?t'</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>subst_lit <span class="free">L</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="var">?s'</span> <span class="var">?t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">polarity</span> <span class="main">=</span> neg›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def 
      decompose_equation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_dom_trm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="var">?t</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t''</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?t'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="free">t</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">θ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>decompose_literal <span class="bound">L</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="bound">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="var">?t</span> <span class="main">=</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">θ</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="var">?t</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹decompose_literal <span class="skolem">L</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span>  <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">η</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_decompose_literal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">L'</span></span> <span class="quoted"><span class="free">θ</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="var">?t</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="var">?t'</span> <span class="main">=</span> <span class="var">?u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t'</span><span class="main">,</span><span class="var">?u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t''</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="var">?t''</span> <span class="main">=</span> <span class="var">?u</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t''</span><span class="main">,</span><span class="var">?u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹decompose_literal <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">η</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="free">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">C</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_irreducible_terms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> get_trms <span class="free">C</span> <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_set <span class="bound">T'</span> <span class="free">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">∧</span> <span class="bound">T'</span> <span class="main">=</span> get_trms <span class="free">C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">filter_trms</span> <span class="free">C'</span> <span class="var">?E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T'</span> <span class="main">=</span> get_trms <span class="free">C'</span> <span class="var">?E</span> FirstOrder"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="var">?E'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="var">?T'</span> <span class="free">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?E'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="var">?T'</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?T'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?T'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filter_trms_inclusion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">θ</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">x'</span> <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">θ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹dom_trm <span class="skolem">x'</span> <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">θ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_dom_trm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="free">E</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹dom_trm <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="free">D</span> <span class="free">σ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?E'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">y</span> <span class="main">(</span><span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">x'</span> <span class="free">η</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">θ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">y</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?E'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?E'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">T</span> <span class="main">=</span> <span class="var">?E'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?T'</span> <span class="main">=</span> get_trms <span class="free">C'</span> <span class="var">?E</span> FirstOrder›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We eventually deduce the following lemma, which allows one to transform ground derivations
into first-order derivations.›</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> lifting_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"derivable <span class="free">C</span> <span class="free">P</span> <span class="free">S</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">D</span> <span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>derivable <span class="bound">D</span> <span class="free">P</span> <span class="free">S</span> <span class="bound">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ</span> <span class="main">≐</span> <span class="bound">θ</span> <span class="main">◊</span> <span class="bound">η</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>trms_subsumes <span class="bound">D</span> <span class="free">C</span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">D</span> <span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>derivable <span class="bound">D</span> <span class="free">P</span> <span class="free">S</span> <span class="bound">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ</span> <span class="main">≐</span> <span class="bound">θ</span> <span class="main">◊</span> <span class="bound">η</span><span class="main">)</span> 
                <span class="main">∧</span> <span class="main">(</span>trms_subsumes <span class="bound">D</span> <span class="free">C</span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> not_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span><span class="main">,</span> <span class="bound">P2</span> <span class="main">}</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">P1</span><span class="main">,</span> <span class="bound">P2</span> <span class="main">}</span> <span class="main">∧</span> superposition <span class="bound">P1</span> <span class="bound">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">P1</span><span class="main">,</span> <span class="skolem">P2</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">Cl_P1</span></span> <span class="skolem"><span class="skolem">Cl_P2</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">polarity</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">trms_C</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="skolem">Cl_P1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_P2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">M</span> <span class="skolem">P2</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>variable_disjoint <span class="skolem">P1</span> <span class="skolem">P2</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> is_a_variable <span class="skolem">u'</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="free">σ</span> Ground<span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">trms_C</span> <span class="main">=</span> get_trms <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">∪</span> 
          <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">P1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> superposition_def get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="free">σ</span> Ground<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Unifier <span class="free">σ</span> <span class="skolem">u'</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">u'</span> <span class="skolem">u</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> MGU_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">u'</span> <span class="skolem">u</span> <span class="main">=</span> Some <span class="skolem">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MGU <span class="skolem">θ</span> <span class="skolem">u'</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unify_computes_MGU <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Unifier <span class="free">σ</span> <span class="skolem">u'</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> MGU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">L</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L</span> <span class="skolem">P1</span> <span class="skolem">θ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_eligible_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">M</span> <span class="skolem">P2</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">M</span> <span class="skolem">P2</span> <span class="skolem">θ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_eligible_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹MGU <span class="skolem">θ</span> <span class="skolem">u'</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="skolem">θ</span> FirstOrder"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">P1</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_allowed_redex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">η</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">∪</span> 
          <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">P1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms  <span class="skolem">Cl_C</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">∪</span> 
          <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">P1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
        <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set 
        <span class="skolem">E</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Cl_C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
        <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set 
        <span class="skolem">E</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_set <span class="bound">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span> <span class="main">∧</span> <span class="bound">T'</span> <span class="main">=</span> get_trms <span class="var">?Cl_C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_irreducible_terms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="skolem">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> get_trms <span class="var">?Cl_C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_fo</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="skolem">Cl_P1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_P2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">L</span> <span class="skolem">P1</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">M</span> <span class="skolem">P2</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>variable_disjoint <span class="skolem">P1</span> <span class="skolem">P2</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P2</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">¬</span> is_a_variable <span class="skolem">u'</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">P1</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="skolem">θ</span> FirstOrder<span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">T'</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="var">?Cl_C'</span> <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">E</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder<span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">P2</span><span class="main">)</span> <span class="main">∪</span> 
          <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">P1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="skolem">C_fo</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> superposition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">P1</span><span class="main">,</span> <span class="skolem">P2</span> <span class="main">}</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable <span class="skolem">C_fo</span> <span class="free">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> 
      i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?Cl_C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">η</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subst_eq_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i ii  <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P1</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P2</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">M</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?Cl_C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Cl_C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="skolem">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trms_subsumes <span class="skolem">C_fo</span> <span class="free">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> trms_subsumes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>derivable <span class="skolem">C_fo</span> <span class="free">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> not_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">=</span>  <span class="free">P</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∧</span> factorization <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">P1</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"factorization <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">Cl_P</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">trms_C</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="free">σ</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="free">σ</span> Ground<span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">trms_C</span>  <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
          <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="main">(</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> Ground"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> factorization_def get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="free">σ</span> Ground<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Unifier <span class="free">σ</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> MGU_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span> Some <span class="skolem">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MGU <span class="skolem">θ</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unify_computes_MGU <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Unifier <span class="free">σ</span> <span class="skolem">t</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> MGU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="skolem">θ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_eligible_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹MGU <span class="skolem">θ</span> <span class="skolem">t</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">θ</span> FirstOrder"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">v</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms  <span class="skolem">Cl_C</span> 
          <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="main">(</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> Ground›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
        <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Cl_C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
        <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_set <span class="bound">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span> <span class="main">∧</span> <span class="bound">T'</span> <span class="main">=</span> get_trms <span class="var">?Cl_C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_irreducible_terms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="skolem">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> get_trms <span class="var">?Cl_C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_fo</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 
      <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="skolem">θ</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">θ</span> FirstOrder<span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">T'</span> <span class="main">=</span> get_trms<span class="var">?Cl_C'</span> 
        <span class="main">(</span>dom_trms <span class="var">?Cl_C'</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factorization <span class="skolem">P1</span> <span class="skolem">C_fo</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> factorization_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">P1</span> <span class="main">}</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable <span class="skolem">C_fo</span> <span class="free">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> 
      i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?Cl_C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">η</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subst_eq_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i ii  <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?Cl_C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Cl_C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="skolem">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trms_subsumes <span class="skolem">C_fo</span> <span class="free">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> trms_subsumes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>derivable <span class="skolem">C_fo</span> <span class="free">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> not_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span> <span class="bound">P1</span> <span class="main">}</span> <span class="main">=</span> <span class="free">P</span>  <span class="main">∧</span> reflexion <span class="bound">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="skolem">P1</span> <span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="skolem">P1</span> <span class="free">C</span> <span class="free">σ</span> Ground <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">Cl_P</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">trms_C</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="free">σ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="free">σ</span> Ground<span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">trms_C</span> <span class="main">=</span> get_trms <span class="skolem">Cl_C</span>
          <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="main">(</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>"</span></span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> reflexion_def get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="free">σ</span> Ground<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Unifier <span class="free">σ</span> <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> MGU_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unify <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">=</span> Some <span class="skolem">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MGU <span class="skolem">θ</span> <span class="skolem">t</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unify_computes_MGU <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Unifier <span class="free">σ</span> <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> MGU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="free">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="skolem">θ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lift_eligible_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹MGU <span class="skolem">θ</span> <span class="skolem">t</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">θ</span> FirstOrder"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="free">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lift_orient_lit_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
          <span class="main">(</span>dom_trms <span class="skolem">Cl_C</span> <span class="main">(</span>subst_set <span class="main">(</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span>  <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> Ground›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms <span class="skolem">Cl_C</span> 
        <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="skolem">E</span>  <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Cl_C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trms_C</span> <span class="main">=</span> <span class="main">(</span>get_trms  <span class="skolem">Cl_C</span> 
        <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>subst_set 
        <span class="main">(</span><span class="skolem">E</span>  <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span>  <span class="free">σ</span><span class="main">)</span><span class="main">)</span> Ground<span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_set <span class="bound">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span> <span class="main">∧</span> <span class="bound">T'</span> <span class="main">=</span> get_trms <span class="var">?Cl_C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="skolem">E</span>  <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_irreducible_terms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="skolem">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> get_trms <span class="var">?Cl_C'</span> 
    <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="skolem">E</span>  <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_fo</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">P1</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">P1</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="skolem">θ</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span>ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">θ</span> FirstOrder<span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">T'</span> <span class="main">=</span> get_trms  <span class="var">?Cl_C'</span>
          <span class="main">(</span>dom_trms <span class="main">(</span>subst_cl <span class="free">C'</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> FirstOrder<span class="main">)</span>›</span></span> 
     <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>
     <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>›</span></span>
     <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="skolem">P1</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflexion <span class="skolem">P1</span> <span class="skolem">C_fo</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reflexion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">{</span> <span class="skolem">P1</span> <span class="main">}</span> <span class="main">=</span> <span class="free">P</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable <span class="skolem">C_fo</span> <span class="free">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?Cl_C'</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> 
      i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?Cl_C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">η</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="main">=</span>  <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl<span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subst_eq_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i ii  <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_P</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">)</span> <span class="free">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="var">?Cl_C'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Cl_C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="skolem">T'</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">trms_C</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">C</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="skolem">Cl_C</span> <span class="skolem">trms_C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C_fo</span> <span class="main">=</span> <span class="main">(</span>Ecl <span class="var">?Cl_C'</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C_fo</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trms_subsumes <span class="skolem">C_fo</span> <span class="free">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> trms_subsumes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>derivable <span class="skolem">C_fo</span> <span class="free">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="free">C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1"><span class="command">from</span></span> not_sup not_ref not_fact <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trms_subsumes_and_red_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trms_subsumes <span class="free">D</span> <span class="free">C</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant_inference <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span> <span class="free">S</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"redundant_inference <span class="free">C</span> <span class="free">S</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">D'</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">D'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> redundant_inference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> trms_subsumes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cl_D</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">=</span> Ecl <span class="skolem">Cl_D</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eclause.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Cl_D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="free">D</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">=</span> Ecl <span class="skolem">Cl_D</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_ecl <span class="free">D</span> <span class="free">η</span> <span class="main">=</span> Ecl <span class="main">(</span>subst_cl <span class="skolem">Cl_D</span> <span class="free">η</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="skolem">T</span> <span class="free">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_D</span> <span class="free">η</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="skolem">T</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_D</span> <span class="free">η</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Cl_D</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trms_ecl <span class="free">D</span> <span class="main">=</span> <span class="skolem">T</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="skolem">T</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> trms_subsumes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E1</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E2</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E2'</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E2</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E2'</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E2</span> <span class="main">⊆</span> <span class="skolem">E2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E1</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>›</span></span> 
         <span class="quoted"><span class="quoted">‹<span class="skolem">E2</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
         <span class="quoted"><span class="quoted">‹trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="free">D</span><span class="main">)</span> <span class="free">η</span><span class="main">)</span>›</span></span> 
         <span class="quoted"><span class="quoted">‹<span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="main">(</span>subst_ecl <span class="free">D</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterms_inclusion <span class="skolem">E1</span> <span class="skolem">E2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E2</span> <span class="main">⊆</span> <span class="skolem">E2'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterms_inclusion <span class="skolem">E1</span> <span class="skolem">E2'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subterms_inclusion_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E1</span> <span class="main">=</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E2'</span> <span class="main">=</span> <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">D'</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">D'</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"redundant_inference <span class="free">C</span> <span class="free">S</span> <span class="free">P</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> redundant_inference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_inference<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inference_saturated <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ground_inference_saturated <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>ground_inference_saturated <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"grounding_set <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>redundant_inference <span class="skolem">C</span> <span class="free">S</span> <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_inference_saturated_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>"</span></span> <span class="quoted"><span class="quoted">"trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lifting_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>redundant_inference <span class="skolem">C</span> <span class="free">S</span> <span class="skolem">P</span> <span class="skolem">σ</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> redundant_inference <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trms_subsumes_and_red_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span>›</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="quoted"><span class="quoted">‹trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span>›</span></span>
   <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹grounding_set <span class="skolem">P</span> <span class="skolem">σ</span>›</span></span> 
   <span class="quoted"><span class="quoted">‹<span class="main">¬</span> redundant_inference <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">P</span> <span class="skolem">σ</span>›</span></span>
    assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> inference_saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_redundant_cl <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C'</span> <span class="main">=</span> subst_cl <span class="free">D</span> <span class="free">θ</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="free">C</span> <span class="free">S</span> <span class="free">η</span> <span class="free">C'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">≐</span> <span class="free">θ</span> <span class="main">◊</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="free">C</span> <span class="free">S</span> <span class="free">σ</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">S'</span><span class="main">.</span> <span class="main">(</span><span class="bound">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="bound">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">unfolding</span></span>  redundant_clause_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>trms_ecl <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> 
  iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>mset_cl <span class="main">(</span><span class="free">C'</span><span class="main">,</span><span class="free">η</span><span class="main">)</span><span class="main">,</span>mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mset_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this iv 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_cl <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mult_mult_trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i ii iii <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span>  redundant_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We deduce the following (trivial) lemma, stating that sets that are closed under all 
inferences are also saturated.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inference_closed_sets_are_saturated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inference_closed <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"clause_saturated <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="skolem"><span class="skolem">η</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable <span class="skolem">C</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="skolem">C'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ground_clause <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="skolem">C'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> clause_saturated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> inference_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> derivable_clauses_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trms_subsumes <span class="skolem">D</span> <span class="skolem">C</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> trms_subsumes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">=</span> subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">(</span><span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subst_eq_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> composition_of_substs_cl <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>ground_clause <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">η</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">C'</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="skolem">C'</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">η</span> <span class="main">(</span>subst_cl <span class="skolem">C'</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> self_redundant_clause  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this  <span class="quoted"><span class="quoted">‹derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="free">S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"finite <span class="skolem">C'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> derivable_clauses_are_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> subst_cl <span class="skolem">C'</span> <span class="skolem">θ</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">η</span> <span class="main">(</span>subst_cl <span class="skolem">C'</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">σ</span> <span class="main">≐</span> <span class="skolem">θ</span> <span class="main">◊</span> <span class="skolem">η</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="skolem">C'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_redundant_cl  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>redundant_clause <span class="main">(</span>subst_ecl <span class="skolem">D</span> <span class="skolem">η</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="skolem">C'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Satisfiability of Saturated Sets with No Empty Clause›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We are now in the position to prove that the previously constructed interpretation 
is indeed a model of the set of extended clauses, if the latter is saturated and does not contain
an extended clause with empty clausal part. More precisely, the constructed interpretation satisfies 
the clausal part of every extended clause whose attached set of terms is in normal form. This is the 
case in particular if this set is empty, hence if the clause is an input clause. 

Note that we do not provide any function for explicitly 
constructing such saturated sets, except by generating all derivable clauses (see below).›</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> int_clset_is_a_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground_inference_saturated <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ball <span class="free">S</span> well_constrained"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed_under_renaming <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">C</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>fst <span class="free">pair</span> <span class="main">=</span> <span class="bound">C</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">σ</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">pair</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> 
    ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span> validate_ground_clause <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span>"</span></span> 
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">pair</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> wf_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"ecl_ord"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">pair</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ecl_ord<span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proof is by induction and contradiction. We consider a minimal instance  
that is not true in the interpretation and we derive a contradiction.›</span></span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pair</span> <span class="keyword3"><span class="command">assume</span></span> hyp_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> ecl_ord <span class="main">⟶</span> <span class="main">(</span><span class="var">?P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="var">?I</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">using</span></span> trm_rep_compatible_with_structure same_values_fo_int  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?P</span> <span class="skolem">pair</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?P</span> <span class="skolem">pair</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">pair</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> <span class="main">(</span>snd <span class="skolem">pair</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> cm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, we prove that no reduction is possible (otherwise the superposition rule applies).›</span></span>

     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nored</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">D</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">u'</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span> <span class="bound">polarity</span> <span class="bound">σ'</span><span class="main">.</span> 
      <span class="main">¬</span> <span class="main">(</span><span class="main">(</span>reduction <span class="bound">L1</span> <span class="skolem">C</span> <span class="bound">σ'</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">polarity</span> <span class="bound">L2</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">p</span> <span class="bound">v</span> <span class="bound">D</span> <span class="var">?I</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>variable_disjoint <span class="skolem">C</span> <span class="bound">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?nored</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?nored</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">polarity</span></span> <span class="skolem"><span class="skolem">σ'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"reduction <span class="skolem">L1</span> <span class="skolem">C</span> <span class="skolem">σ'</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">u'</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">D</span> <span class="var">?I</span> <span class="free">S</span> <span class="skolem">σ</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"variable_disjoint <span class="skolem">C</span> <span class="skolem">D</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_a_variable <span class="skolem">u'</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> el1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">C</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> el2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L2</span> <span class="skolem">D</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>minimal_redex <span class="skolem">p</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">C</span> <span class="free">S</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span>  o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span>  o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">σ'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span>  e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord<span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">C</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> st <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> <span class="main">(</span>subterms_of <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_lit <span class="skolem">L1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> <span class="main">(</span>subterms_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">C</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          assms<span class="main">(</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> rte<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>allowed_redex <span class="skolem">u'</span> <span class="skolem">C</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> allowed_redex_coincide <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> 
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> reduction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

        <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">u'</span> <span class="skolem">u</span> <span class="skolem">σ'</span> Ground"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∉</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">L2</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> lit_ord›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∉</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>›</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">L2</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord<span class="main">)</span>›</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∉</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>›</span></span> 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∉</span> lit_ord"</span></span> 
                                        <span class="keyword1"><span class="command">unfolding</span></span> lit_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst_lit <span class="skolem">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord›</span></span>  
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> lit_ord›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> lit_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> all_finite <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span>  mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> mset_ecl_and_mset_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈#</span> mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">x'</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈#</span> <span class="main">(</span>mset_set <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> count_mset_set<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_eq_zero_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span><span class="main">.</span> 
          <span class="main">(</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>›</span></span> 
                  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">x'</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">show</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 
          dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">K</span><span class="main">.</span> <span class="bound">J</span> <span class="main">≠</span> <span class="main">{#}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span>set_mset <span class="bound">K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span><span class="main">∈</span>set_mset <span class="bound">J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="bound">I</span> <span class="main">+</span> <span class="bound">K</span><span class="main">,</span> <span class="bound">I</span> <span class="main">+</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> one_step_implies_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>mset_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span>  mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>   
                <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#}</span> <span class="main">+</span> mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span> <span class="main">{#}</span> <span class="main">+</span> mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dom <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">D</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span> mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span> <span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> ecl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> st <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>replace_subterm <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> replace_subterm_is_a_function <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> st  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">Cl_R</span></span> <span class="skolem"><span class="skolem">nt_R</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="skolem"><span class="skolem">Cl_D</span></span>  <span class="keyword2"><span class="keyword">where</span></span> 
            ntr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nt_R</span> <span class="main">=</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_R</span> <span class="main">(</span>subst_set 
              <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> clc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> cld<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_D</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> clr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> mk_lit <span class="skolem">polarity</span> <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="skolem">σ'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> orient_lit_inst_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">L1</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="skolem">t</span> <span class="main">⊆</span> vars_of_lit <span class="skolem">L1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">t</span> <span class="main">⊆</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span>subst_lit <span class="bound">x</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∈</span> lit_ord<span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strictly_maximal_literal <span class="skolem">D</span> <span class="skolem">L2</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strictly_maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">from</span></span> ntr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nt_R</span> <span class="main">=</span> get_trms <span class="skolem">Cl_R</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_R</span> <span class="main">(</span>subst_set 
              <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> Ground"</span></span>
               <span class="keyword1"><span class="command">unfolding</span></span> get_trms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_a_variable <span class="skolem">u'</span>›</span></span> l1 l2 el1 el2  
        <span class="quoted"><span class="quoted">‹variable_disjoint <span class="skolem">C</span> <span class="skolem">D</span>›</span></span> rte r o1 o2 t st rt l' clr ntr clr clc cld <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> lit_ord›</span></span>  
        <span class="quoted"><span class="quoted">‹strictly_maximal_literal <span class="skolem">D</span> <span class="skolem">L2</span> <span class="skolem">σ'</span> ›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"superposition <span class="skolem">C</span> <span class="skolem">D</span> <span class="skolem">R</span> <span class="skolem">σ'</span> Ground <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> superposition_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> l2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> vars_of_lit.simps vars_of_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  coincide_on_cl <span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  
              coincide_on_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

         <span class="keyword1"><span class="command">from</span></span> l1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> vars_of_lit.simps vars_of_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> vars_of_lit.simps vars_of_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> rt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_replacement <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_eq <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> l' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> <span class="main">(</span>Pos <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L'</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mk_lit.elims <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_eq <span class="main">(</span>subst_equation <span class="main">(</span>Eq <span class="skolem">t'</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">‹superposition <span class="skolem">C</span> <span class="skolem">D</span> <span class="skolem">R</span> <span class="skolem">σ'</span> Ground <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">R</span> <span class="main">{</span> <span class="skolem">C</span><span class="main">,</span><span class="skolem">D</span> <span class="main">}</span> <span class="free">S</span> <span class="skolem">σ'</span> Ground <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="skolem">Cl_R</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ground_clause <span class="skolem">Cl_R</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="skolem">Cl_R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> clr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">=</span> <span class="skolem">L'</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">≠</span> <span class="skolem">L'</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> l1 clc cld <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
           <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"grounding_set <span class="main">{</span> <span class="skolem">C</span><span class="main">,</span><span class="skolem">D</span> <span class="main">}</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> grounding_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">Cl_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">R</span> <span class="main">{</span> <span class="skolem">C</span><span class="main">,</span><span class="skolem">D</span> <span class="main">}</span> <span class="free">S</span> <span class="skolem">σ'</span> Ground <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_inference_saturated <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹grounding_set <span class="main">{</span> <span class="skolem">C</span><span class="main">,</span><span class="skolem">D</span> <span class="main">}</span> <span class="skolem">σ'</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>redundant_inference <span class="skolem">R</span> <span class="free">S</span> <span class="main">{</span> <span class="skolem">C</span><span class="main">,</span><span class="skolem">D</span> <span class="main">}</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_inference_saturated_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> order<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord 
          <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> all_normalized_term_included<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> 
          <span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>  
              <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> redundant_inference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

        <span class="keyword1"><span class="command">have</span></span> all_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> ecl_ord"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> order <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord 
          <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">(</span><span class="skolem">D</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord›</span></span> <span class="keyword3"><span class="command">show</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span> <span class="keyword1"><span class="command">using</span></span> ecl_ord_trans 
                <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_ecl <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> ecl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> ecl_ord_coincide <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="quoted"><span class="skolem">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>mset_ecl <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mset_ecl <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>mset_ecl <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>mult <span class="main">(</span>mult <span class="free">trm_ord</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
              <span class="keyword1"><span class="command">unfolding</span></span> ecl_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="var">?I</span> <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_clause_set <span class="var">?I</span> <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="var">?I</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> validate_clause_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> clset_instances_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> all_smaller <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pair'</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">=</span> snd <span class="skolem">pair</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pair'</span><span class="main">,</span><span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">pair'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_normalized_term_included <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span>"</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w'</span> <span class="skolem">w</span>"</span></span>
            <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">w'</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w''</span> <span class="main">∈</span> trms_ecl <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w</span> <span class="skolem">w''</span>"</span></span> 
             <span class="keyword1"><span class="command">unfolding</span></span> subterms_inclusion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w</span> <span class="skolem">w''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w'</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w'</span> <span class="skolem">w''</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> occur_in_subterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
          <span class="keyword1"><span class="command">from</span></span>  ntr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nt_R</span> <span class="main">⊆</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> dom_trms_subset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Cl_R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w''</span> <span class="main">∈</span> trms_ecl <span class="skolem">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">w''</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'''</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">∪</span> 
              <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w''</span> <span class="main">=</span> subst <span class="skolem">w'''</span> <span class="skolem">σ'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w'</span> <span class="skolem">w''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w'</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w'</span> <span class="skolem">w''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w''</span> <span class="main">=</span> subst <span class="skolem">w'''</span> <span class="skolem">σ'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
              <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w'</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="skolem">w'''</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dom_trm_vars 
                <span class="keyword1"><span class="command">unfolding</span></span> Ball_def well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of <span class="skolem">w'''</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">w'''</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">w'''</span> <span class="skolem">σ'</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> coincide_on_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this 
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w'</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w'</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span> 
                  <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">using</span></span> subst_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">w'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">D</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">D</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w'</span> <span class="skolem">w''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w''</span> <span class="main">=</span> subst <span class="skolem">w'''</span> <span class="skolem">σ'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
              <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">w'</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">D</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span> 
                  <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">using</span></span> subst_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">w'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">w'''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>trms_ecl <span class="skolem">D</span><span class="main">)</span> 
            <span class="main">∪</span> <span class="main">{</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>subterm <span class="skolem">t</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">w'''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q_w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm <span class="skolem">t</span> <span class="skolem">q_w</span> <span class="skolem">w'''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q_w</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="skolem">t</span> <span class="skolem">q_w</span> <span class="skolem">w'''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="skolem">q_w</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> substs_preserve_subterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">w'</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subterm  <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="skolem">q</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="skolem">q_w</span> <span class="main">(</span>subst <span class="skolem">w'''</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>append <span class="skolem">q_w</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">w'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subterm_of_a_subterm_is_a_subterm
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>append <span class="skolem">q_w</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">w'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">q_w</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>append <span class="skolem">q_w</span> <span class="skolem">q</span><span class="main">)</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pos_ord</span> <span class="skolem">C</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> pos_ord_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹minimal_redex <span class="skolem">p</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">C</span> <span class="free">S</span> <span class="skolem">t</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>append <span class="skolem">q_w</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">w'</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> minimal_redex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">w'</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">w'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          ii<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="skolem">pair'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> i ii iii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="var">?I</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ii substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">Cl_R</span>›</span></span> 
            cl_ecl.simps substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_C</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∉</span> cl_ecl <span class="skolem">C</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">M</span> <span class="main">⊆</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span>  
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coincide_on <span class="skolem">σ</span> <span class="skolem">σ'</span> <span class="main">(</span>vars_of_lit <span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coincide_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">M</span> <span class="skolem">σ</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincide_on_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ'</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> subst_cl.simps mem_Collect_eq 
              validate_ground_clause.simps<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> cm <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∉</span> <span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword2"><span class="keyword">and</span></span> cld <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> subst_cl.simps mem_Collect_eq validate_ground_clause.simps<span class="main">)</span>  
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span>cl_ecl <span class="skolem">D</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≠</span> <span class="skolem">L'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">L'</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ'</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">σ'</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> rt <span class="keyword2"><span class="keyword">and</span></span> st <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">σ'</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> replacement_preserves_congruences <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> 
              <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> l1 <span class="keyword2"><span class="keyword">and</span></span> cm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span> <span class="main">=</span> subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹subst_lit <span class="skolem">L1</span> <span class="skolem">σ'</span> <span class="main">∈</span> subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ'</span>›</span></span> 
            validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> l' <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">polarity</span> <span class="skolem">σ'</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="skolem">σ'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> trm_rep_preserves_lit_semantics <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">L1</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">polarity</span></span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">L'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ'</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∉</span> <span class="skolem">Cl_D</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∉</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> m clc  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Second, we show that the clause contains no contradictory literal (otherwise the reflexion 
rule applies).›</span></span>

     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?no_cont</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">L</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>eligible_literal <span class="bound">L</span> <span class="skolem">C</span> <span class="skolem">σ</span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span>orient_lit_inst <span class="bound">L</span> <span class="bound">t</span> <span class="bound">s</span> neg <span class="skolem">σ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="bound">t</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>subst <span class="bound">t</span> <span class="skolem">σ</span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span>subst <span class="bound">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="bound">s</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?no_cont</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?no_cont</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> neg <span class="skolem">σ</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">σ</span> Ground"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> l <span class="keyword2"><span class="keyword">and</span></span> e <span class="keyword2"><span class="keyword">and</span></span> o <span class="keyword2"><span class="keyword">and</span></span> t <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">Cl_R</span></span> <span class="skolem"><span class="skolem">nt_R</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            <span class="quoted"><span class="quoted">"reflexion <span class="skolem">C</span> <span class="skolem">R</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span>dom_trms <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> reflexion_def get_trms_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹reflexion <span class="skolem">C</span> <span class="skolem">R</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">R</span> <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="skolem">Cl_R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"grounding_set <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> grounding_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span>
         <span class="quoted"><span class="quoted">‹derivable <span class="skolem">R</span> <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_inference_saturated <span class="free">S</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>redundant_inference <span class="skolem">R</span> <span class="free">S</span> <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_inference_saturated_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> all_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> all_normalized_term_included<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> 
          <span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>  
              <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> redundant_inference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="var">?I</span> <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_clause_set <span class="var">?I</span> <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="var">?I</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> validate_clause_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> clset_instances_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> all_smaller <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pair'</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">=</span> snd <span class="skolem">pair</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pair'</span><span class="main">,</span><span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">pair'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trms_ecl <span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span>dom_trms <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dom_trms_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_normalized_term_included <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">t''</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">t''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t''</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">t'</span> <span class="skolem">s'</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> subterms_inclusion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trms_ecl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> subst <span class="skolem">s''</span> <span class="skolem">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">t</span> <span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span> <span class="main">∨</span> <span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">=</span> subst <span class="skolem">s''</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t'</span> <span class="skolem">s'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">t'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t''</span> <span class="skolem">t'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">t''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t''</span>›</span></span><span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> occurs_in_def subts_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">=</span> subst <span class="skolem">s''</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">s'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">s'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">s'</span>›</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">t''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t''</span>›</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t'</span> <span class="skolem">s'</span>›</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t''</span> <span class="skolem">t'</span>›</span></span> 
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> occurs_in_def subts_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          ii<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="skolem">pair'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> i ii iii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="var">?I</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ii substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">Cl_R</span>›</span></span> 
            cl_ecl.simps substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="skolem">L'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> subst_lit <span class="skolem">L''</span> <span class="skolem">σ</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">=</span> subst_lit <span class="skolem">L''</span> <span class="skolem">σ</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L'</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> subst_cl.simps mem_Collect_eq 
              validate_ground_clause.simps<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> cm <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Third, we prove that the clause contains no pair of equations with the same left-hand side
and equivalent right-hand sides (otherwise the factorization rule applies and a smaller false clause
is derived).›</span></span>

     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?no_fact</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">t</span> <span class="bound">s</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>eligible_literal <span class="bound">L1</span> <span class="skolem">C</span> <span class="skolem">σ</span><span class="main">)</span> 
       <span class="main">⟶</span> <span class="main">(</span><span class="bound">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>orient_lit_inst <span class="bound">L1</span> <span class="bound">t</span> <span class="bound">s</span> pos <span class="skolem">σ</span><span class="main">)</span> 
       <span class="main">⟶</span> <span class="main">(</span>orient_lit_inst <span class="bound">L2</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="skolem">σ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>subst <span class="bound">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="bound">u</span> <span class="skolem">σ</span><span class="main">)</span>
       <span class="main">⟶</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>proper_subterm_red <span class="bound">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⟶</span> <span class="main">(</span>trm_rep <span class="main">(</span><span class="main">(</span>subst <span class="bound">s</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span>  <span class="main">(</span>trm_rep <span class="main">(</span><span class="main">(</span>subst <span class="bound">v</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?no_fact</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?no_fact</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eligible_literal <span class="skolem">L1</span> <span class="skolem">C</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L1</span> <span class="skolem">t</span> <span class="skolem">s</span> pos <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span>proper_subterm_red <span class="skolem">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>trm_rep <span class="main">(</span><span class="main">(</span>subst <span class="skolem">v</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"ck_unifier <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">σ</span> Ground"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ck_unifier_def Unifier_def 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"inferences.distinct"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L1</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> o1 <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> no_valid_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">≠</span> subst <span class="skolem">s</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L1</span> <span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this o2 <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> no_valid_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">≠</span> subst <span class="skolem">v</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">Cl_R</span></span> <span class="skolem"><span class="skolem">nt_R</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            ntr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nt_R</span> <span class="main">=</span> <span class="main">(</span>dom_trms <span class="skolem">Cl_R</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> clr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ntr r l' clr l1 l2 o1 o2 e1 t
        <span class="quoted"><span class="quoted">‹subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">≠</span> subst <span class="skolem">s</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">≠</span> subst <span class="skolem">v</span> <span class="skolem">σ</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factorization <span class="skolem">C</span> <span class="skolem">R</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> factorization_def get_trms_def <span class="keyword1"><span class="command">using</span></span> inferences.distinct
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl_ecl.simps<span class="main">)</span>
         
         <span class="keyword1"><span class="command">from</span></span> l2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L2</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> vars_of_lit.simps vars_of_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

         <span class="keyword1"><span class="command">from</span></span> l1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L1</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> o1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">using</span></span> vars_of_lit.simps vars_of_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> l' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹factorization <span class="skolem">C</span> <span class="skolem">R</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable <span class="skolem">R</span> <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> derivable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="skolem">Cl_R</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ground_clause <span class="skolem">Cl_R</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="skolem">Cl_R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="skolem">Cl_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> clr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span><span class="main">,</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span><span class="main">,</span> <span class="skolem">L1</span> <span class="main">}</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">=</span> <span class="skolem">L'</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">≠</span> <span class="skolem">L'</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> l1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M'</span> <span class="main">∈</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span><span class="main">,</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span><span class="main">,</span> <span class="skolem">L1</span> <span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>subst_lit <span class="skolem">M'</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">‹vars_of_lit <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
          
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">Cl_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"grounding_set <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> grounding_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">R</span> <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="free">S</span> <span class="skolem">σ</span> Ground <span class="main">(</span><span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_inference_saturated <span class="free">S</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>redundant_inference <span class="skolem">R</span> <span class="free">S</span> <span class="main">{</span> <span class="skolem">C</span> <span class="main">}</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_inference_saturated_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> all_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord<span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> all_normalized_term_included<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S'</span><span class="main">.</span> 
          <span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> redundant_inference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="var">?I</span> <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_clause_set <span class="var">?I</span> <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_clause <span class="var">?I</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> validate_clause_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span><span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> clset_instances_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> all_smaller <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pair'</span><span class="main">,</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">=</span> snd <span class="skolem">pair</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pair'</span><span class="main">,</span><span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">pair'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="keyword1"><span class="command">from</span></span> r ntr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span>dom_trms <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span> 
            <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> dom_trms_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_normalized_term_included <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

         <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">t''</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">t''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t''</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subterms_inclusion <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">t'</span> <span class="skolem">s'</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> subterms_inclusion_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">(</span>trms_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trms_ecl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span><span class="main">(</span>subst_set <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> subst <span class="skolem">s''</span> <span class="skolem">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span> 
            <span class="main">∨</span> <span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">=</span> subst <span class="skolem">s''</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t'</span> <span class="skolem">s'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">t'</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t''</span> <span class="skolem">t'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">t''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t''</span>›</span></span><span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> occurs_in_def subts_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t'</span> <span class="skolem">s'</span>›</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">t''</span> <span class="skolem">t'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s''</span> <span class="main">⊲</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">t''</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">t''</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">s''</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span>  <span class="main">(</span>subst <span class="skolem">s''</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> occurs_in_def subts_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">∈</span> <span class="main">(</span>proper_subterms_of <span class="skolem">t</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>proper_subterm_red <span class="skolem">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> proper_subterm_red_def <span class="quoted">"proper_subterms_of.simps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          ii<span class="main">:</span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span>instances <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pair'</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instances_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="skolem">pair'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> i ii iii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="main">(</span>fst <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">pair'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_clause <span class="var">?I</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ii substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>set_entails_clause <span class="main">(</span>clset_instances <span class="skolem">S'</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_entails_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="skolem">Cl_R</span>›</span></span> 
            cl_ecl.simps substs_preserve_ground_clause validate_clause.simps<span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">R</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> Ecl <span class="skolem">Cl_R</span> <span class="skolem">nt_R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_R</span> <span class="main">=</span> <span class="main">(</span>subst_cl <span class="main">(</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span> <span class="main">}</span> <span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L2</span><span class="main">,</span> <span class="skolem">L1</span> <span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span> <span class="skolem">L'</span><span class="main">,</span> <span class="skolem">L1</span> <span class="main">}</span> <span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∉</span> cl_ecl <span class="skolem">C</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> m <span class="keyword2"><span class="keyword">and</span></span> l1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">L'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L'</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L''</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?I</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> validate_ground_lit.simps<span class="main">(</span>2<span class="main">)</span> validate_ground_eq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L''</span> <span class="main">=</span> subst_lit <span class="skolem">M</span> <span class="skolem">σ</span>›</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="skolem">L''</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> subst_cl.simps mem_Collect_eq 
              validate_ground_clause.simps<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> cm <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now, it remains to prove that the considered clause yields a rule which can be used to 
reduce the left-hand side of the maximal equation, which (since no reduction is possible)
entails that the left-hand side must be equivalent to the right-hand side 
(thus contradicting the fact that the clause is false).›</span></span>

       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> all_finite<span class="main">)</span> 
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> all_non_empty<span class="main">)</span> 
       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eligible_lit_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust equation.exhaust  
         <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl trm_ord_trans
         <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def irrefl_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first show that the terms occurring inside variables are irreducible. To this aim, 
we need to consider the normal form of the substitution <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, obtained by replacing the 
image of each variable by its normal form.›</span></span>

       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
        <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> occurs_in <span class="bound">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">⟶</span> trm_rep <span class="bound">y</span> <span class="free">S</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>  
       <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> occurs_in <span class="bound">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">⟶</span> trm_rep <span class="bound">y</span> <span class="free">S</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"occurs_in <span class="skolem">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="skolem">y</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹occurs_in <span class="skolem">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subterm <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">y</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> occurs_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subterm <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="skolem">y</span> <span class="free">S</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> subts_of_irred_trms_are_irred <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_subst <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_on <span class="skolem">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="var">?I</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>equivalent_on <span class="skolem">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="var">?I</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?I</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> equivalent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="var">?I</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> trm_rep_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> map_subst_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="var">?I</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> fo_interpretation_def congruence_def equivalence_relation_def reflexive_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> equivalent_on_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lower_on <span class="var">?θ</span> <span class="skolem">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lower_on <span class="var">?θ</span> <span class="skolem">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> lower_on_def lower_or_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> map_subst_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>›</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">z</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">≠</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">=</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>ground_on <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> ground_on_def ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ground_clauses_and_ground_substs <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span> <span class="main">≠</span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> map_subst_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="var">?θ</span> <span class="skolem">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>    
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="var">?θ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lower_on_cl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> fst <span class="skolem">pair</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">=</span> snd <span class="skolem">pair</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="var">?θ</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ecl_ord›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="var">?θ</span><span class="main">)</span><span class="main">,</span><span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> ecl_ord"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
         <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> hyp_ind  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="var">?θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="quoted"><span class="quoted">‹lower_on <span class="var">?θ</span> <span class="skolem">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span>
              <span class="quoted"><span class="quoted">‹equivalent_on <span class="skolem">σ</span> <span class="var">?θ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="var">?I</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span>
             <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> irred_terms_and_reduced_subst <span class="keyword1"><span class="command">unfolding</span></span> Ball_def well_constrained_def 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_clauses_and_ground_substs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹lower_on <span class="var">?θ</span> <span class="skolem">σ</span> <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_on <span class="main">(</span>vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="var">?θ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> lower_on_ground <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ground_substs_yield_ground_clause <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
         <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">from</span></span> this 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="var">?θ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="var">?θ</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, we show that the eligible term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is in normal form. 
We first need to establish the result for proper subterms of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> before considering 
the general case.›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>proper_subterm_red <span class="skolem">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proper_subterm_red <span class="skolem">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> subst <span class="skolem">t</span> <span class="skolem">σ</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> proper_subterm_red_def substs_preserve_subterms subts_of_irred_trms_are_irred 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>proper_subterm_red <span class="skolem">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
        <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> occurs_in <span class="bound">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">⟶</span> trm_rep <span class="bound">y</span> <span class="free">S</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span>›</span></span>
        <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> subst <span class="skolem">t</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹fo_interpretation <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹Ball <span class="free">S</span> well_constrained›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
        <span class="quoted"><span class="quoted">‹all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹closed_under_renaming <span class="free">S</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
            <span class="main">∃</span><span class="bound">σ''</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">pa</span> <span class="bound">v</span> <span class="bound">D</span> <span class="bound">L2</span><span class="main">.</span> <span class="main">(</span>reduction <span class="skolem">L</span> <span class="skolem">C</span> <span class="bound">σ''</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="bound">L2</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">pa</span> <span class="bound">v</span> <span class="bound">D</span> 
              <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="main">∧</span> variable_disjoint <span class="skolem">C</span> <span class="bound">D</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> reduction_exists <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">L</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?nored</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="main">¬</span> equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span>
        <span class="skolem">L</span>"</span></span> 
       <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> 
          <span class="keyword3"><span class="command">assume</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="main">¬</span> equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> 
            <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">L</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> neg"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> neg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">L</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> neg›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> pos"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">L</span>›</span></span> 
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> orient_lit_inst <span class="skolem">L2</span> <span class="bound">u</span> <span class="bound">v</span> pos <span class="skolem">σ</span> <span class="main">∧</span>
                subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="bound">u</span> <span class="skolem">σ</span> <span class="main">∧</span> trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="bound">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>     
            <span class="keyword1"><span class="command">unfolding</span></span> equivalent_eq_exists_def <span class="keyword1"><span class="command">unfolding</span></span> same_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
          <span class="keyword1"><span class="command">from</span></span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">σ</span> <span class="main">∧</span> subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ</span> 
            <span class="main">∧</span> trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">σ</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L2</span> <span class="skolem">u</span> <span class="skolem">v</span> pos <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">t</span> <span class="skolem">σ</span> <span class="main">=</span> subst <span class="skolem">u</span> <span class="skolem">σ</span>›</span></span>  
            <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> trm_rep <span class="main">(</span>subst <span class="skolem">v</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> pos›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L2</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span> <span class="skolem">L</span> <span class="main">}</span>›</span></span>
            <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span>›</span></span>
           <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>proper_subterm_red <span class="skolem">t</span> <span class="free">S</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?no_fact</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span>  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="main">¬</span> equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">L</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
        <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> vars_of_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> occurs_in <span class="bound">y</span> <span class="main">(</span>subst <span class="main">(</span>Var <span class="bound">x</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">⟶</span> trm_rep <span class="bound">y</span> <span class="free">S</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span>›</span></span>
        <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> subst <span class="skolem">t</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹fo_interpretation <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹Ball <span class="free">S</span> well_constrained›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
        <span class="quoted"><span class="quoted">‹all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹closed_under_renaming <span class="free">S</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
            <span class="main">∃</span><span class="bound">σ''</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">pa</span> <span class="bound">v</span> <span class="bound">D</span> <span class="bound">L2</span><span class="main">.</span> <span class="main">(</span>reduction <span class="skolem">L</span> <span class="skolem">C</span> <span class="bound">σ''</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="bound">L2</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">pa</span> <span class="bound">v</span> <span class="bound">D</span> 
              <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="skolem">σ</span> <span class="main">∧</span> variable_disjoint <span class="skolem">C</span> <span class="bound">D</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> reduction_exists <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">L</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?nored</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">⊆</span> vars_of_lit  <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span>  orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">⊆</span> vars_of_lit  <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span>  orient_lit_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span>
          <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹vars_of <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using the fact that the eligible term is in normal form and that the eligible literal
is false in the considered interpretation but is not a contradiction, we deduce that this literal 
must be positive.›</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> pos"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> pos"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> neg"</span></span> <span class="keyword1"><span class="command">using</span></span> sign.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span>  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> neg›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?no_cont</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span>
           <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> subst <span class="skolem">t</span> <span class="skolem">σ</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="main">]</span> trm_ord_trans <span class="keyword1"><span class="command">unfolding</span></span> trans_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> same_values_def int_clset_def <span class="keyword1"><span class="command">using</span></span> validate_ground_eq.simps 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> same_values_def  int_clset_def <span class="keyword1"><span class="command">using</span></span> validate_ground_eq.simps 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span>neg›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_lit <span class="skolem">L</span> <span class="skolem">σ</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∨</span> subst_lit <span class="skolem">L</span> <span class="skolem">σ</span> <span class="main">=</span> <span class="main">(</span>Neg <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>validate_ground_eq <span class="var">?I</span> <span class="main">(</span>Eq <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> validate_ground_lit.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹validate_ground_lit <span class="var">?I</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> validate_ground_clause.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                   
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This entails that the right-hand side of the eligible literal occurs in the set of 
possible values for the left-hand side <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which is impossible since this term is 
irreducible.›</span></span>

     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> pos›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">≠</span> trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_valid_literal <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_ord_ground_total <span class="keyword1"><span class="command">unfolding</span></span> ground_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span>pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>negative_literal <span class="skolem">L</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span>  orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹eligible_literal <span class="skolem">L</span> <span class="skolem">C</span> <span class="skolem">σ</span>›</span></span>  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel</span><span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"maximal_literal <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sel_neg <span class="keyword1"><span class="command">unfolding</span></span> eligible_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smaller_lits_are_false <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> smaller_lits_are_false_if_cl_not_valid <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> pos›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> neg <span class="main">∨</span> <span class="main">¬</span> equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> 
                          <span class="main">(</span>same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trm_rep <span class="bound">x</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">L</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> equivalent_eq_exists <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>int_clset <span class="free">S</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> int_clset_def
        <span class="keyword1"><span class="command">using</span></span> sign.distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span>pos›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_literal_is_unique <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">L</span> <span class="free">S</span> <span class="skolem">σ</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> maximal_literal_is_unique_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">L</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="free">S</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_irreducible <span class="skolem">C</span> <span class="skolem">σ</span> <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trms_irreducible_lemma  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">∈</span> trms_ecl <span class="skolem">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom_trm <span class="skolem">t'</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> Ball_def well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"decompose_literal <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_trm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="skolem">q'</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal.exhaust equation.exhaust  
         <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl trm_ord_trans
         <span class="keyword1"><span class="command">unfolding</span></span> orient_lit_inst_def irrefl_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹decompose_literal <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="skolem">q'</span> <span class="skolem">σ</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def orient_lit_inst_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atom.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> decompose_equation_def equation.inject literal.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
              literal.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹decompose_literal <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="skolem">q'</span> <span class="skolem">σ</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> decompose_literal_def orient_lit_inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vars_of_cl <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">M</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="skolem">q'</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">q'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> lift_orient_lit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> trm_ord_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">q'</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">u</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v'</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> lit_ord_dominating_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> neg"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">u'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">v'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">q'</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹orient_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t'</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t'</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> neg›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> pos›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars_of_lit <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v'</span>›</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>subst_lit <span class="skolem">M</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lit_ord"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> lit_ord_neg_lit_lhs lit_ord_neg_lit_rhs <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> maximal_literal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∉</span> <span class="free">trm_ord</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> neg <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>

     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">,</span> subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span>pos›</span></span> <span class="quoted"><span class="quoted">‹orient_lit_inst <span class="skolem">L</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sel</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> cl_ecl <span class="skolem">C</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>  
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹smaller_lits_are_false <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span>›</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹maximal_literal_is_unique  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">L</span> <span class="free">S</span> <span class="skolem">σ</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹trms_irreducible <span class="skolem">C</span> <span class="skolem">σ</span> <span class="free">S</span>  <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∉</span> subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> cv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>candidate_values <span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">C</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> 
          <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>subst_lit <span class="skolem">L</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">L</span> <span class="skolem">σ</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> cv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set_of_candidate_values <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> set_of_candidate_values_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower_subt_red trm_ord_irrefl irrefl_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span> subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> 
              <span class="main">∈</span> set_of_candidate_values <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_of_candidate_values <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span> subst <span class="skolem">s</span> <span class="skolem">σ</span><span class="main">)</span> 
              <span class="main">∈</span> set_of_candidate_values <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> min_trms_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>subterm_reduction_applicable <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹min_trms <span class="main">(</span>set_of_candidate_values <span class="free">S</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">,</span><span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trm_ord</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> trm_rep_is_lower_root_red <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">t</span> <span class="skolem">σ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>trm_rep <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subst <span class="skolem">t</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> 
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> trm_ord_irrefl irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As an immediate consequence of the previous lemma, we show that the set of clauses that 
are derivable from an unsatisfiable clause set must contain an empty clause (since this set is
trivially saturated).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> COMPLETENESS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span>trms_ecl <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>satisfiable_clause_set <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>derivable_ecl <span class="bound">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> cl_ecl <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>derivable_ecl <span class="bound">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> cl_ecl <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>derivable_ecl <span class="bound">y</span> <span class="free">S</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"same_values <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>trm_rep <span class="bound">x</span> <span class="var">?S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fo_interpretation <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trm_rep_compatible_with_structure same_values_fo_int 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cl_ecl <span class="skolem">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">x</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CollectD<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this  <span class="quoted"><span class="quoted">‹cl_ecl <span class="skolem">x</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>derivable_ecl <span class="bound">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> cl_ecl <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="main">(</span>cl_ecl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">x</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CollectD<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> finite <span class="main">(</span>cl_ecl <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">using</span></span> all_derived_clauses_are_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="free">S</span> well_constrained"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> well_constrained_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="var">?S</span> well_constrained"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">x</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CollectD<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹Ball <span class="free">S</span> well_constrained›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"well_constrained <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> all_derived_clauses_are_wellconstrained 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed_under_renaming <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"renaming_cl <span class="skolem">C</span> <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∉</span> <span class="var">?S</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> closed_under_renaming_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">C</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CollectD<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹derivable_ecl <span class="skolem">C</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹renaming_cl <span class="skolem">C</span> <span class="skolem">D</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable_ecl <span class="skolem">D</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> derivable_ecl.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∉</span> <span class="var">?S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inference_closed <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="var">?S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∉</span> <span class="var">?S</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> inference_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="var">?S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivable_premisses <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">⟶</span> derivable_ecl <span class="bound">x</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">⊆</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">x</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CollectD<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>derivable <span class="skolem">D</span> <span class="skolem">P</span> <span class="var">?S</span> <span class="skolem">θ</span> FirstOrder <span class="skolem">C'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">D</span> <span class="free">S</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> derivable_ecl.intros<span class="main">(</span>3<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">D</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">C'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">∉</span> <span class="var">?S</span>›</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this all_finite <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clause_saturated <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inference_closed_sets_are_saturated <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">from</span></span> this all_finite <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inference_saturated <span class="var">?S</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> clause_saturated_and_inference_saturated <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_inference_saturated <span class="var">?S</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lift_inference <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_clause_set <span class="var">?I</span> <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cl_C</span></span> <span class="keyword2"><span class="keyword">where</span></span> clc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">∈</span> <span class="main">(</span>cl_ecl <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="var">?I</span> <span class="skolem">Cl_C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> validate_clause_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> clc  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"derivable_ecl <span class="skolem">C</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> derivable_ecl.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>validate_clause <span class="var">?I</span> <span class="skolem">Cl_C</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ground_clause <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> validate_clause.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pair</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="var">?pair</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="var">?pair</span> <span class="main">=</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trms_ecl <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> derivable_ecl <span class="bound">y</span> <span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> all_trms_irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ground_inference_saturated <span class="var">?S</span>›</span></span> all_finite <span class="quoted"><span class="quoted">‹Ball <span class="var">?S</span> well_constrained›</span></span> 
      <span class="quoted"><span class="quoted">‹closed_under_renaming <span class="var">?S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="main">(</span>cl_ecl <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="bound">σ</span><span class="main">.</span> fst <span class="var">?pair</span> <span class="main">=</span> <span class="bound">C</span> <span class="main">⟶</span>
           <span class="bound">σ</span> <span class="main">=</span> snd <span class="var">?pair</span> <span class="main">⟶</span>
           <span class="bound">C</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> derivable_ecl <span class="bound">y</span> <span class="free">S</span><span class="main">}</span> <span class="main">⟶</span>
           ground_clause <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">⟶</span>
           all_trms_irreducible <span class="main">(</span>subst_set <span class="main">(</span>trms_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> trm_rep <span class="bound">t</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> derivable_ecl <span class="bound">y</span> <span class="free">S</span><span class="main">}</span><span class="main">)</span> 
           <span class="main">⟶</span> validate_ground_clause <span class="var">?I</span>  <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="bound">C</span><span class="main">)</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> int_clset_is_a_model <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="var"><span class="quoted"><span class="var">?pair</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹fst <span class="var">?pair</span> <span class="main">=</span> <span class="skolem">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="quoted"><span class="quoted">‹snd <span class="var">?pair</span> <span class="main">=</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹ground_clause <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span> n
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validate_ground_clause <span class="var">?I</span>  <span class="main">(</span>subst_cl <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>validate_ground_clause <span class="var">?I</span> <span class="main">(</span>subst_cl <span class="skolem">Cl_C</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cl_C</span> <span class="main">=</span> <span class="main">(</span>cl_ecl <span class="skolem">C</span><span class="main">)</span>›</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹fo_interpretation <span class="var">?I</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> satisfiable_clause_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>